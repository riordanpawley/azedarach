{"id":"az-lex","title":"setup ~/prog/Chefy with az config","description":"we need to setup chefy ready to use az with a proper config. draw inspo from this repo's config. chefy uses pnpm so pnpm i not bun i on new worktrees, it also uses direnv but should use envdev as well after direnv allow, should also use zsh, etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:46:08.985802+11:00","updated_at":"2025-12-17T15:35:21.03052+11:00","closed_at":"2025-12-17T15:35:21.030523+11:00"}
{"id":"az-dpi","title":"Integrate Agent Mail with SessionManager","description":"Wire Agent Mail into session lifecycle for automatic reservation management.\n\nDesign:\n- SessionManager.start() calls agentMail.reserve() before worktree creation\n- SessionManager.stop() calls agentMail.release() after cleanup\n- SessionManager.pause() keeps reservation but updates status\n- Add reservation info to Session type\n- Fail session start if issue already reserved by another agent\n- Handle reservation conflicts gracefully\n- Update Kanban board to show reservation status (who owns what)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.738474+11:00","updated_at":"2025-12-12T10:33:13.738474+11:00","dependencies":[{"issue_id":"az-dpi","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.870895+11:00","created_by":"daemon"},{"issue_id":"az-dpi","depends_on_id":"az-4r0","type":"blocks","created_at":"2025-12-12T10:33:21.939099+11:00","created_by":"daemon"},{"issue_id":"az-dpi","depends_on_id":"az-tgc","type":"blocks","created_at":"2025-12-12T10:33:21.972727+11:00","created_by":"daemon"}]}
{"id":"az-wiu","title":"Eliminate React hooks in favor of Effect services (audit \u0026 migrate)","description":"Per az-x4e, 9 files still use React hooks (useEffect/useMemo/useState):\n\n- src/ui/App.tsx\n- src/ui/Board.tsx\n- src/ui/Column.tsx\n- src/ui/CompactView.tsx\n- src/ui/Toast.tsx\n- src/ui/DetailPanel.tsx\n- src/ui/CreateTaskPrompt.tsx\n- src/ui/ClaudeCreatePrompt.tsx\n- src/index.tsx\n\n**Audit each file** to determine:\n1. What state/effects can move to Effect services\n2. What computation can move to atoms\n3. What's truly local UI state (may be acceptable)\n\nDocument findings and create migration plan. This task is the audit; az-x4e is the execution.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T15:59:45.338873+11:00","updated_at":"2025-12-17T15:59:45.338873+11:00"}
{"id":"az-vpz","title":"Migrate state management to Effect-atom native patterns","description":"Refactor current state management to use Effect-atom native patterns for better integration with the Effect ecosystem. This includes:\n\n- Audit current state management approach\n- Identify candidates for migration to effect-atom\n- Implement atomic state with proper Effect integration\n- Ensure reactive updates flow through the TUI correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T10:32:35.479946+11:00","updated_at":"2025-12-15T12:42:24.805977+11:00","closed_at":"2025-12-15T12:42:24.80598+11:00"}
{"id":"az-c9y","title":"Replace verbose StatusBar stats with compact indicators","description":"Replace verbose 'Tasks: 12  Active: 3' with compact indicators '12⚙ 3⏸ 2✗'. Expand to full text on wide terminals (≥100 cols). Add noteworthy alerts section that appears only when sessions need attention.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.538659+11:00","updated_at":"2025-12-12T13:25:20.220062+11:00","dependencies":[{"issue_id":"az-c9y","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.209397+11:00","created_by":"daemon"}]}
{"id":"az-2m9","title":"search mode needs to accept enter/return to return to normal mode","description":"should have the selected item from search selected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:28:34.821948+11:00","updated_at":"2025-12-16T23:20:14.269865+11:00","closed_at":"2025-12-16T23:20:14.269868+11:00"}
{"id":"az-lsi","title":"figure out whats next with our claude status hook system","notes":"Starting implementation of Option 1: Integrate Claude Code's native hooks (Notification, Stop, SessionEnd) for authoritative state detection in spawned worktrees.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:54.252353+11:00","updated_at":"2025-12-17T11:17:26.126289+11:00","closed_at":"2025-12-17T11:17:26.126292+11:00"}
{"id":"az-6la","title":"Add context health border colors to TaskCard","description":"Encode context health into TaskCard border color when session is active: lavender (healthy, \u003c70%), yellow (warning, 70-90%), red (critical, \u003e90%). Requires contextPercent from TaskWithSession.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.426477+11:00","updated_at":"2025-12-12T13:25:20.07394+11:00","dependencies":[{"issue_id":"az-6la","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.111928+11:00","created_by":"daemon"}]}
{"id":"az-dqt","title":"Extend TaskWithSession type with session metrics","description":"Extend TaskWithSession interface with optional session metrics: contextPercent (0-100), sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput. This is the foundation for other session metrics features.","notes":"Session 2025-12-12: Created from Claude Code best practices research.\n\nRESEARCH CONTEXT:\n- 6 parallel research agents analyzed: Anthropic blog, Reddit, latest features, orchestration tools, CLAUDE.md patterns, real-world usage\n- Key finding: Context % monitoring is critical - users hit auto-compact (95%) unexpectedly\n- Key finding: MCP servers consume 55K-134K tokens before conversation starts\n- Design: Use progressive disclosure - border colors for at-a-glance, DetailPanel for full metrics\n\nUI DESIGN DECISIONS:\n- Border color encodes context health: lavender (\u003c70%), yellow (70-90%), red (\u003e90%)\n- Only show metrics when session is active (not idle)\n- Extend existing TaskWithSession type (no new components needed)\n\nIMPLEMENTATION NOTES:\n- Add: contextPercent, sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput\n- All fields optional (populated when session active)\n- This is foundation - unblocks az-6la, az-5p5, az-2ek, az-c9y\n\nNEXT STEP: Implement type changes in src/ui/types.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T13:25:00.109541+11:00","updated_at":"2025-12-14T00:37:36.658207+11:00","closed_at":"2025-12-13T00:58:21.053672+11:00"}
{"id":"az-dn2","title":"we keep losing beads in the tui when doing stuff like killing other bead's sessions etc","description":"the following log may be related:\ntimestamp=2025-12-16T13:19:15.063Z level=WARN fiber=#1356 message=\"Sync failed for az-31i: ParseError: Failed to parse JSON: SyntaxError: JSON Parse error: Unrecognized token '→'\"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:04.341522+11:00","updated_at":"2025-12-17T01:02:07.434596+11:00","closed_at":"2025-12-17T01:02:07.4346+11:00"}
{"id":"az-fjy","title":"add a git push keybind","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:59:10.618121+11:00","updated_at":"2025-12-17T10:32:36.837731+11:00","closed_at":"2025-12-17T10:32:36.837731+11:00"}
{"id":"az-04d","title":"Add \"Merge to main\" action for completed worktree tasks","description":"When a task is done (manual mode, not CV mode), user should be able to press Space → m to merge the worktree branch to main and clean up.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T21:49:14.135837+11:00","updated_at":"2025-12-16T22:21:47.442705+11:00","closed_at":"2025-12-16T22:21:47.442705+11:00"}
{"id":"az-7oa","title":"Add test coverage for core services","description":"Currently only FileLockManager.test.ts exists. Add tests for:\n\n**High priority (business-critical):**\n- SessionManager - lifecycle, state transitions\n- BeadsClient - CLI parsing, error handling\n- CommandQueueService - serialization, race conditions\n- StateDetector - pattern matching accuracy\n\n**Medium priority:**\n- BoardService - filtering, sorting\n- NavigationService - cursor movement, boundary handling\n- WorktreeManager - git operations\n\nUse Effect's testing utilities and TestClock for time-based tests.","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:45.163878+11:00","updated_at":"2025-12-17T15:59:45.163878+11:00"}
{"id":"az-odr","title":"Fix Space+m merge workflow to prevent merge conflicts","description":"The Space+m (merge to main) workflow has repeatedly failed to prevent merge conflicts from reaching the main branch. This has happened multiple times, requiring manual conflict resolution.\n\n## Root Cause Analysis\nThe current `checkMergeConflicts` in PRWorkflow.ts only does a file-level overlap check (files modified on both branches). This doesn't catch actual content conflicts - Git only discovers those during the merge attempt.\n\n## What's Happening Now\n1. `checkMergeConflicts` compares file lists between branches\n2. If files overlap, shows a confirmation dialog\n3. User confirms (or no overlap detected), merge proceeds\n4. Git attempts merge and finds actual conflicts\n5. Conflicts land on main branch\n\n## Expected Behavior\nThe merge should NEVER introduce conflicts to main. If conflicts exist, they should be resolved in the worktree BEFORE the merge to main happens.\n\n## Proposed Solution\n1. **Perform a test merge first** - In the worktree, do `git fetch origin main \u0026\u0026 git merge --no-commit origin/main`\n2. **Check for conflicts** - If conflicts occur, abort the test merge and report them\n3. **Only proceed if clean** - If test merge succeeds, then push to main\n4. **Auto-abort on conflict** - If test merge has conflicts, abort it (`git merge --abort`) and show which files conflict\n\nThis ensures main always stays clean.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-17T17:00:52.211803+11:00","updated_at":"2025-12-17T17:03:40.086985+11:00"}
{"id":"az-d8z","title":"Session Management","description":"Core orchestration layer: git worktrees, tmux sessions, Claude spawning, state detection, and file locking to prevent concurrent access.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.762911+11:00","updated_at":"2025-12-12T10:33:37.439444+11:00","closed_at":"2025-12-12T10:33:37.439444+11:00"}
{"id":"az-hri","title":"Basic Kanban board component (OpenTUI + Solid)","description":"Create the main Ink-based Kanban board displaying beads issues in columns by status.","notes":"Implemented basic Kanban board component with OpenTUI + SolidJS:\n\n- Created UI types (SessionState, TaskWithSession, COLUMNS, SESSION_INDICATORS)\n- TaskCard.tsx: displays individual tasks with title, ID, session indicator, priority color\n- Column.tsx: vertical list of tasks per status with header and count\n- Board.tsx: horizontal layout of columns using Yoga flexbox\n- StatusBar.tsx: bottom bar with keyboard shortcuts and stats\n- App.tsx: root component with Effect runtime, fetches tasks from BeadsClient\n- launch.tsx: TUI initialization with OpenTUI render\n\nAll components use OpenTUI primitives (box, text) with proper styling (fg/bg colors, attributes for bold, border styles). Successfully type checks with strict mode.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.662469+11:00","updated_at":"2025-12-11T18:03:13.707242+11:00","closed_at":"2025-12-11T18:03:13.707242+11:00","dependencies":[{"issue_id":"az-hri","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.667781+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.898548+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-fvj","type":"blocks","created_at":"2025-12-11T14:46:26.110348+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-mq9","type":"blocks","created_at":"2025-12-11T17:10:08.980724+11:00","created_by":"daemon"}]}
{"id":"az-z5n","title":"i feel like any beads that have a tmux session should be in progress","description":"currently you can have tmux sessions running on open/closed beads","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:35:21.548241+11:00","updated_at":"2025-12-16T22:04:52.421753+11:00","closed_at":"2025-12-16T22:04:52.421753+11:00"}
{"id":"az-4vc","title":"paste from clipboard not working on mac still","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:25.365057+11:00","updated_at":"2025-12-17T16:41:03.28691+11:00","closed_at":"2025-12-17T16:41:03.286913+11:00"}
{"id":"az-cs0","title":"when performing left/right actions keep action mode active. otherwise return to normal mode immediately","description":"currently if i space S action mode remains until the toast appears instead of returning to normal mode as soon as i press \"S\". this is just an example","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:15:17.592791+11:00","updated_at":"2025-12-17T14:15:21.967725+11:00","closed_at":"2025-12-17T14:15:21.967725+11:00"}
{"id":"az-5p5","title":"Add session metrics section to DetailPanel","description":"Add Session Metrics section to DetailPanel modal showing: Context % with warning indicator, session duration, estimated token count. Only visible when session is active (not idle).","notes":"## Progress\n\n### ✅ Completed\n- DetailPanel UI section for metrics (lines 257-289)\n- Color-coded context % display (lavender/yellow/red thresholds)\n- Duration formatting from sessionStartedAt  \n- Token count display with K suffix\n- Visibility guard (only shows when session active)\n- Agent phase display (bonus)\n- **NEW**: BoardService now maps sessionStartedAt from SessionManager\n\n### ❌ Still Missing (requires az-zu3)\n- contextPercent: Needs PTY monitoring to parse Claude's status line\n- estimatedTokens: Needs PTY monitoring to parse Claude's status line\n- agentPhase: StateDetector exists but isn't wired to active monitoring\n\n### Dependency\nThis issue depends on az-zu3 (hybrid state detection) for full metrics collection.\nSession duration works NOW since SessionManager tracks startedAt.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.666185+11:00","updated_at":"2025-12-17T14:46:52.042889+11:00","closed_at":"2025-12-17T14:46:52.042889+11:00","dependencies":[{"issue_id":"az-5p5","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.146395+11:00","created_by":"daemon"},{"issue_id":"az-5p5","depends_on_id":"az-zu3","type":"blocks","created_at":"2025-12-17T14:44:22.017914+11:00","created_by":"daemon"}]}
{"id":"az-bjp","title":"Parallel worker spawning from orchestration mode","description":"When user confirms orchestration, spawn workers in parallel.\n\n**Implementation:**\n- Use Effect.forEach with concurrency for parallel worktree creation\n- Each worker: WorktreeManager.create → TmuxService.newSession → inject template\n- Reserve issues via Agent Mail (if available)\n- Track all spawned workers in SessionManager\n\n**Error handling:**\n- If any spawn fails, show toast but continue with others\n- Partial success is acceptable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.790073+11:00","updated_at":"2025-12-14T02:13:30.509642+11:00","dependencies":[{"issue_id":"az-bjp","depends_on_id":"az-7sr","type":"blocks","created_at":"2025-12-12T13:29:24.844916+11:00","created_by":"daemon"},{"issue_id":"az-bjp","depends_on_id":"az-lqb","type":"blocks","created_at":"2025-12-12T13:29:24.88113+11:00","created_by":"daemon"},{"issue_id":"az-bjp","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.765448+11:00","created_by":"daemon"}]}
{"id":"az-451","title":"Use immutable Data types in SubscriptionRef state","description":"Non-primitive state stored in SubscriptionRef should use Effect's immutable data types for proper equality and functional programming patterns.\n\n**Problems:**\n1. Objects/arrays without Data wrapping cause reference equality issues\n2. Mutable collections like `Map` don't play well with Effect's functional paradigm\n\n**Solutions:**\n\n**Data Wrapping:**\n- Use `Schema.Data` to wrap state schemas, OR\n- Manually wrap with `Data.array()` for arrays\n- Manually wrap with `Data.struct()` for objects/records\n\n**Immutable Collections:**\n- Replace `Map` with `ReadonlyRecord` (from `effect/Record`)\n- Replace `Set` with `HashSet` (from `effect/HashSet`)\n- Use `HashMap` if key hashing is needed\n\n**Specific changes:**\n- `tasksByColumn: Map\u003c...\u003e` → `tasksByColumn: ReadonlyRecord\u003cstring, ReadonlyArray\u003cTask\u003e\u003e`\n\n**Files to audit:**\n- All services using SubscriptionRef with non-primitive state\n- Check EditorService, NavigationService, OverlayService, BeadsService, etc.","notes":"## Completed\n- ✅ tasksByColumn: Map → Record.ReadonlyRecord with emptyRecord() singleton\n- ✅ jumpLabels: ReadonlyMap → Record.ReadonlyRecord\n- ✅ Created src/lib/empty.ts with singleton emptyRecord() and emptyArray()\n- ✅ Updated all consumers: BoardService, KeyboardService, EditorService, atoms.ts, Board.tsx, CompactView.tsx, useEditorMode.ts, types.ts\n- ✅ Board.tsx and CompactView.tsx now accept readonly TaskWithSession[] arrays\n- ✅ Type errors from concurrent work FIXED in commit 092959c\n\n## Session 2025-12-15 Update\nThe type issues around readonly arrays are now resolved:\n- BoardProps.tasks: readonly TaskWithSession[]\n- CompactViewProps.tasks: readonly TaskWithSession[]\n- Column props were fixed (isActiveColumn instead of isActive, etc.)\n\n## Remaining\n- Data wrapping for non-primitive SubscriptionRef state (EditorMode, SortConfig, Overlay[], Toast[], etc.)\n- Consider using Data.struct() for cursor/position types\n- Audit all services for remaining mutable collections\n\n## Note\nThe linter (biome) auto-converts ReadonlyMap ↔ Record.ReadonlyRecord. Need to be consistent with Record.ReadonlyRecord and use Object.entries() for iteration.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-15T12:23:05.047807+11:00","updated_at":"2025-12-15T12:57:22.737672+11:00","closed_at":"2025-12-15T12:57:22.737672+11:00"}
{"id":"az-7vk","title":"Auto-wrap in tmux on startup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:16:24.296316+11:00","updated_at":"2025-12-12T17:16:32.587438+11:00","closed_at":"2025-12-12T17:16:32.587438+11:00"}
{"id":"az-9ch","title":"Worktree init hooks (direnv, env vars, custom commands)","description":"Allow configuring commands to run when a worktree is created or session is started. Common use cases: direnv allow, setting env vars, installing deps, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:13:03.534484+11:00","updated_at":"2025-12-12T17:24:21.906802+11:00","closed_at":"2025-12-12T17:24:21.906802+11:00","dependencies":[{"issue_id":"az-9ch","depends_on_id":"az-pnx","type":"blocks","created_at":"2025-12-12T12:13:09.239776+11:00","created_by":"daemon"}]}
{"id":"az-eei","title":"creating beads with space C (capital) not working","description":"i dont see any errors in log either","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:12.469026+11:00","updated_at":"2025-12-17T01:07:50.693525+11:00","closed_at":"2025-12-17T01:07:50.693525+11:00"}
{"id":"az-58v","title":"Implement issue type change in EditorService","description":"src/core/EditorService.ts line 773 has TODO:\n\"Implement type change (delete old, create new, preserve deps)\"\n\nChanging issue type (task→bug, feature→epic) requires:\n1. Capture existing dependencies\n2. Delete original issue\n3. Create new issue with same ID pattern but new type\n4. Re-link dependencies\n\nThis is a data migration operation that needs careful handling.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.827186+11:00","updated_at":"2025-12-17T15:59:44.827186+11:00"}
{"id":"az-xw8","title":"Generate hooks config when spawning sessions","description":"SessionManager generates .claude/hooks.json in worktree when spawning sessions. Hooks auto-sync beads on Stop event and update issue notes. Pure bash-based automation without MCP overhead.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:25:00.000819+11:00","updated_at":"2025-12-12T13:25:20.656259+11:00","dependencies":[{"issue_id":"az-xw8","depends_on_id":"az-aiu","type":"blocks","created_at":"2025-12-12T13:25:32.748995+11:00","created_by":"daemon"}]}
{"id":"az-6c5","title":"allow space S which starts a claude code instance and gets it to start working on the task","description":"e.g. prompt it with \"work on bead [bead-id]\"","notes":"Starting implementation. Approach:\n1. Add actionStartSessionWithPrompt() - starts session, waits for Claude init, sends prompt\n2. Add S-s keybinding (Shift+s) for \"start and work\"\n3. Update ActionPalette to show 'S work' option","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:26:05.162586+11:00","updated_at":"2025-12-17T00:54:24.960417+11:00","closed_at":"2025-12-17T00:54:24.960417+11:00"}
{"id":"az-06p","title":"TUI polish: card heights, priority labels, sticky action mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:23:49.590359+11:00","updated_at":"2025-12-12T10:23:55.435441+11:00","closed_at":"2025-12-12T10:23:55.435441+11:00"}
{"id":"az-gds","title":"Subagent orchestration for parallel epic development","description":"Enable TUI to orchestrate multiple parallel Claude sessions working on related tasks (e.g., epic children). Each worker runs in its own worktree/tmux session. Coordination via Agent Mail for real-time updates, beads for persistent state.\n\n**Key Features:**\n1. Space+o on epic → orchestration mode showing child tasks\n2. Select which tasks to parallelize\n3. Spawn workers (worktree + tmux + claude per task)\n4. Workers get injected context about epic and coordination rules\n5. Real-time progress tracking via Agent Mail status broadcasts\n6. Epic progress bar showing X/Y tasks complete\n7. Optional orchestrator Claude for planning/review phases\n\n**Architecture:**\n- TUI is external orchestrator (not a Claude subagent)\n- Workers are independent Claude sessions\n- Agent Mail handles: reservations, status, completion signals\n- Beads handles: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\n**New UI:**\n- Orchestration mode (Space+o)\n- Epic progress indicator (████░░ 3/5)\n- Indented child tasks under epic\n- Worker status in session indicators\n\n**Session Templates:**\n- worker.md template with epic context injection\n- Coordination rules (stay focused, report discoveries)\n- Auto-close task on completion","notes":"Session 2025-12-12: Designed from Claude Code best practices research.\n\nRESEARCH VALIDATION:\n- Pattern confirmed: Git worktrees are de facto standard for parallel AI agents (Cursor, ccswarm, Claude-Flow all use this)\n- Key insight: TUI as external orchestrator avoids Claude subagent nesting limits\n- Agent Mail provides \u003c100ms coordination vs 2-5s git sync\n\nARCHITECTURE DECISIONS:\n- TUI spawns workers (not Claude spawning subagents) - no nesting limits\n- Each worker: worktree + tmux session + Claude instance\n- Agent Mail for: reservations, status broadcasts, completion signals  \n- Beads for: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\nUI DESIGN:\n- Space+o triggers orchestration mode on epics\n- Reuse select mode patterns for task selection\n- Progress bar: ████░░ 3/5 format\n- Indented children under epics in board view\n\nDEPENDENCIES:\n- az-7sr (orch mode) + az-lqb (template) → az-bjp (spawning)\n- az-l7a (Agent Mail epic) → az-2il (status broadcasts)\n\nNEXT STEP: Implement az-7sr (orchestration mode) or az-lqb (worker template) - both are ready","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:28:50.911119+11:00","updated_at":"2025-12-12T16:35:31.355396+11:00"}
{"id":"az-f4q","title":"Add auto-pilot toggle keybinding (a)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T01:05:15.523081+11:00","updated_at":"2025-12-14T01:06:38.936838+11:00","closed_at":"2025-12-14T01:06:38.936838+11:00"}
{"id":"az-7rj","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.\n\n## Requirements\n- User provides a description of the task/feature they want to create\n- Claude interprets the prompt and creates the appropriate bead (title, type, description, etc.)\n- The tmux session used for bead creation should persist after creation\n- This allows the user to immediately start working on the newly created bead in the same session\n\n## Use Case\nInstead of manually running `bd create`, user can describe what they need in natural language from within azedarach's TUI, and Claude handles the bead creation. The persistent session means they can seamlessly transition from \"create this task\" to \"now work on it\".","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:27:20.092741+11:00","updated_at":"2025-12-14T19:41:43.218996+11:00","closed_at":"2025-12-14T02:45:45.653563+11:00"}
{"id":"az-05y","title":"Project Foundation","description":"Set up the core project infrastructure: TypeScript, Ink, CLI scaffolding, and foundational utilities.","notes":"Session 2025-12-11:\n\nEPIC PROGRESS: 3/4 tasks completed (75%)\n\nCOMPLETED CHILDREN:\n- az-ags: Project scaffolding ✅\n- az-fvj: BeadsClient Effect service ✅\n- az-kis: Utility modules ✅\n\nREMAINING:\n- az-2qy: CLI argument parsing with @effect/cli (ready to start)\n\nPHASE 1 DELIVERABLES:\n- Full project infrastructure with Bun + Effect + OpenTUI + SolidJS\n- Working CLI entry point (./bin/az.ts)\n- Core services: BeadsClient, TmuxService, TerminalService\n- Custom effect-atom SolidJS adapter (az-mq9, separate from this epic)\n\nNEXT SESSION:\n- Complete az-2qy (CLI parsing) to close this epic\n- Then move to Phase 2: TUI components (az-pza epic)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.657366+11:00","updated_at":"2025-12-12T10:24:42.833983+11:00","closed_at":"2025-12-12T10:24:42.833983+11:00"}
{"id":"az-q5c","title":"Test bead for output check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:23:49.203815+11:00","updated_at":"2025-12-15T01:24:28.486686+11:00","closed_at":"2025-12-15T01:24:28.486686+11:00"}
{"id":"az-yf4","title":"PRWorkflow - automated GitHub PR creation","description":"Automate PR creation when tasks complete using gh CLI.\n\nDesign:\n- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, WorktreeManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n\nMethods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n  - cleanup(beadId): Effect\u003cvoid, GitError\u003e -- NEW\n\nWorkflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n\nPR body template includes bead description, acceptance criteria.\nLink PR back to bead via bd update --notes.\nUse Effect.retry with Schedule for transient failures.\n\n**Cleanup after merge:**\n  1. Ensure session is stopped\n  2. WorktreeManager.remove() - delete worktree directory\n  3. git push origin --delete \u003cbranch\u003e - delete remote branch\n  4. git branch -D \u003cbranch\u003e - delete local branch\n  5. bd close \u003cbeadId\u003e - mark task complete\n\nThis cleanup function will also be exposed for manual use (az-6t6).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.509773+11:00","updated_at":"2025-12-12T12:30:29.541722+11:00","closed_at":"2025-12-12T12:30:29.541722+11:00","dependencies":[{"issue_id":"az-yf4","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.444969+11:00","created_by":"daemon"},{"issue_id":"az-yf4","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.29207+11:00","created_by":"daemon"}]}
{"id":"az-cl1","title":"Add concurrency limit config for parallel sessions","description":"Add configuration option to limit maximum number of parallel Claude sessions.\n\nInspiration: AutoMaker's maxConcurrency setting with canStartNewTask check.\n\nImplementation:\n1. Add maxConcurrency to config schema (default: unlimited or 5)\n2. Check limit in SessionManager before starting new session\n3. Show visual indicator when at capacity\n4. Optionally queue pending starts when limit reached\n5. Display running/max in status bar (e.g., '3/5 sessions')","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:04Z","updated_at":"2025-12-16T12:00:04Z"}
{"id":"az-vn0","title":"i just ended a session and then all beads with active sessions disappeared from the board","description":"i used space x to end the session and after quitting az and restarting it the beads that disappeared are still not back","notes":"## Investigation (2025-12-15)\n\n### Analysis\n\nInvestigated the bug where beads with active sessions disappeared after ending a session with Space+x.\n\n**Key findings:**\n1. Beads ARE present in the database (verified with `bd list` - 76 beads, 26 open, 1 in_progress)\n2. The `SessionManager.stop()` function only removes session tracking, doesn't modify beads\n3. The `bd sync` operation syncs changes FROM worktrees but shouldn't delete beads\n\n**Possible causes identified:**\n1. Error in `BoardService.refresh()` scheduled task causing stale/empty data\n2. Mismatch between session tracking and bead data after sync\n3. Transient issue that's difficult to reproduce\n\n**Root cause could not be definitively identified** - the code looks correct and beads exist in the database.\n\n### Fixes Applied\n\nAdded diagnostic logging to help identify the issue if it recurs:\n\n1. **BoardService.ts**: Added error logging for scheduled refresh failures\n2. **SessionManager.ts**: Added logging around session stop operations:\n   - Log when stopping session\n   - Log when sync completes/fails\n   - Log final session state\n3. **BoardService.ts**: Added warning log when task counts seem inconsistent (0 beads or session mismatch)\n\n### How to Diagnose in Future\n\nIf the bug recurs, check `az.log` for:\n- \"BoardService refresh failed\" - indicates data loading error\n- \"Stopping session for\" / \"Session stopped for\" - tracks session lifecycle\n- \"Sync failed for\" - indicates beads sync issues\n- \"Task load: X beads, Y active sessions\" - tracks data counts\n\n### Status\n\nClosing as \"cannot reproduce\" with diagnostic logging added. The logging will help identify the root cause if the issue occurs again.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:40:32.916186+11:00","updated_at":"2025-12-16T17:16:31.935474+11:00","closed_at":"2025-12-16T17:16:31.935474+11:00"}
{"id":"az-czq","title":"Tmux popup persists after Ctrl-C when editor was opened via 'c'","description":"When user presses 'c' to create a bead via editor, a tmux popup is spawned. If user Ctrl-C's azedarach before closing the popup, the popup remains orphaned and must be manually dismissed.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.795322+11:00","updated_at":"2025-12-14T21:46:18.162342+11:00","closed_at":"2025-12-14T21:46:18.162342+11:00"}
{"id":"az-x4e","title":"avoid useEffect, useMemo, useState, etc.","description":"switch from react hooks such as those in the title to fully encapsulating state mgmt in effect services","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:24:52.577357+11:00","updated_at":"2025-12-17T15:03:52.386143+11:00","dependencies":[{"issue_id":"az-x4e","depends_on_id":"az-wiu","type":"blocks","created_at":"2025-12-17T15:59:52.10568+11:00","created_by":"daemon"}]}
{"id":"az-pza","title":"TUI \u0026 Interaction","description":"Ink-based terminal UI: Kanban board, keyboard navigation, session attachment, and user interaction flows.","notes":"Session 2025-12-12:\n\nEPIC PROGRESS: 6/7 tasks completed (86%)\n\nCOMPLETED CHILDREN:\n- az-hri: Basic Kanban board ✅\n- az-mq9: effect-atom SolidJS adapter ✅\n- az-t4t: Keyboard navigation (Helix-style) ✅\n- az-pn6: StatusBar component ✅\n- az-g19: Terminal attachment (external) ✅\n- az-srh: Detail view panel ✅\n\nREMAINING:\n- az-stv: Task actions (start/attach/pause/resume) - NOW UNBLOCKED\n  - Depends on SessionManager (az-xi5) which is now complete\n  - This is the final task to wire session lifecycle to TUI\n\nPHASE 2 STATUS:\nTUI is fully functional with all navigation, selection, task movement, and viewing features. Only session lifecycle integration remains.\n\nNEXT SESSION:\n- Complete az-stv to close this epic\n- Wire SessionManager.start/stop/pause/resume to keyboard actions\n- Add visual feedback for session states in TaskCard","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.871997+11:00","updated_at":"2025-12-12T10:54:04.23523+11:00","closed_at":"2025-12-12T10:54:04.23523+11:00"}
{"id":"az-tgj","title":"Shift-D delete bead not working - reports \"no worktree to delete\"","description":"When pressing Space -\u003e Shift-D to delete a bead, the wrong action fires. The keyboard library reports event.name as lowercase even when shift is held, so case \"D\" never matches - it falls through to case \"d\" (cleanup worktree).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.746846+11:00","updated_at":"2025-12-14T21:43:51.026071+11:00","closed_at":"2025-12-14T21:43:51.026071+11:00"}
{"id":"az-y6n","title":"up arrow in compact view moves a whole page up not a single task up","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:08:27.533042+11:00","updated_at":"2025-12-17T10:27:38.776467+11:00","closed_at":"2025-12-17T10:27:38.776471+11:00"}
{"id":"az-u9t","title":"when i start a session it moves in the list","description":"when i press space s to start a tmux session for a bead it moves in the list due to sorting i guess and sometimes this moves it out of view","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:25:41.450657+11:00","updated_at":"2025-12-16T21:29:29.243055+11:00","closed_at":"2025-12-16T21:29:29.243055+11:00"}
{"id":"az-foy","title":"Update docs from Ink to OpenTUI + React","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-12T17:16:24.188255+11:00","updated_at":"2025-12-12T17:16:32.49283+11:00","closed_at":"2025-12-12T17:16:32.49283+11:00"}
{"id":"az-w2m","title":"up/down arrow should wrap around the current column when at the bottom/top not move to next column","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:54:54.218653+11:00","updated_at":"2025-12-17T17:02:47.827581+11:00","closed_at":"2025-12-17T17:02:47.827581+11:00"}
{"id":"az-z4n","title":"Improve error messages with actionable guidance","description":"Current errors may be cryptic. Enhance error handling:\n\n**Error categories:**\n- Git errors → Suggest git commands to fix (merge conflicts, dirty worktree)\n- Beads errors → Guide to bd commands or sync issues\n- Tmux errors → Check tmux installation, session conflicts\n- PR errors → GitHub auth issues, branch protection rules\n\n**Implementation:**\n- Create ErrorFormatter service\n- Map error types to user-friendly messages\n- Include \"Try:\" suggestions with specific commands\n- Show in Toast with longer duration for errors\n- Option to copy error details to clipboard","notes":"Implementation complete:\\n\\n**Created ErrorFormatter service (src/services/ErrorFormatter.ts):**\\n- Registry of 30+ error formatters for all tagged error types\\n- Pattern matching within formatters for sub-cases (merge conflicts, auth issues, network errors)\\n- User-friendly messages with actionable \\\"Try:\\\" suggestions\\n- Exports: format(), formatForToast(), logFormatted(), ErrorFormatter service\\n\\n**Updated KeyboardService:**\\n- showErrorToast() now uses formatForToast() for rich error messages\\n- Merge error handling uses formatForToast()\\n\\n**Updated atoms.ts:**\\n- Task creation error uses formatForToast()\\n\\n**Updated Toast component:**\\n- Multi-line message support (for error + suggestion)\\n- Error toasts now last 8 seconds (vs 5 for info/success)\\n- Wider max width (70 chars) to accommodate suggestions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:59:45.712759+11:00","updated_at":"2025-12-17T16:28:45.033741+11:00","closed_at":"2025-12-17T16:28:45.033741+11:00"}
{"id":"az-tgc","title":"Agent Mail configuration and environment","description":"Add configuration support for Agent Mail settings.\n\nDesign:\n- Environment variables:\n  - BEADS_AGENT_MAIL_URL (optional)\n  - BEADS_AGENT_NAME (defaults to hostname or generated)\n  - BEADS_PROJECT_ID (defaults to git remote or project path hash)\n- Config service using @effect/platform Config\n- Validation with @effect/schema\n- Auto-detect if Agent Mail server is available\n- CLI flag --agent-mail-url to override\n- Show Agent Mail status in TUI StatusBar","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.864792+11:00","updated_at":"2025-12-12T10:33:13.864792+11:00","dependencies":[{"issue_id":"az-tgc","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.905172+11:00","created_by":"daemon"}]}
{"id":"az-dl1","title":"Add detail level toggle for cards","description":"Add toggle to switch between minimal/standard/detailed card views.\n\nInspiration: AutoMaker's three-level detail toggle.\n\nLevels:\n- Minimal: ID + title only (fits more tasks on screen)\n- Standard: Current view (ID, title, priority, status indicator)\n- Detailed: Add description preview, session metrics, context health\n\nImplementation:\n1. Add detailLevel to ViewService (minimal/standard/detailed)\n2. Add 'd' key to cycle through levels\n3. Adjust TaskCard rendering based on level\n4. Persist preference in config","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:02Z","updated_at":"2025-12-16T12:00:02Z"}
{"id":"az-6t6","title":"Manual worktree cleanup action (Space+d)","description":"Add Space+d action to manually delete a worktree and its branch.\n\n**Use cases:**\n- Abandoned work that won't be merged\n- Failed PRs that need cleanup\n- Manual housekeeping\n\n**Implementation:**\n- Add to ActionPalette with state check (only available when worktree exists)\n- Confirm dialog before deletion (destructive action)\n- WorktreeManager.remove() + git branch -D\n- Update task card to remove blue dot\n- Toast notification on success/failure\n\n**Depends on:** az-yf4 (PRWorkflow) for the cleanup utility function","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T12:26:24.70141+11:00","updated_at":"2025-12-12T12:34:29.581402+11:00","dependencies":[{"issue_id":"az-6t6","depends_on_id":"az-yf4","type":"blocks","created_at":"2025-12-12T12:26:35.152751+11:00","created_by":"daemon"}]}
{"id":"az-nk1","title":"Add number keys 1-9 for quick session attach","description":"Allow pressing 1-9 keys in normal mode to quickly attach to running sessions.\n\nInspiration: AutoMaker uses 1-9, 0 to view output for first 10 in-progress cards.\n\nImplementation:\n1. In normal mode, number keys 1-9 attach to nth running session\n2. Sessions ordered by: busy first, then waiting, then by start time\n3. Show number indicators on cards when sessions are running\n4. 0 could attach to 10th session or be used for other purpose","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T12:00:03Z","updated_at":"2025-12-16T12:00:03Z"}
{"id":"az-c7e","title":"FileLockManager - prevent concurrent file access","description":"Implement socket-based file locking to prevent multiple Claude sessions from editing the same file simultaneously.","notes":"Implemented FileLockManager service following Effect patterns:\n\nCore implementation:\n- Service defined using Effect.Tag pattern (FileLockManager)\n- Lock types: exclusive (write) vs shared (read)\n- Error types: LockError, LockTimeoutError, LockConflictError\n- Lock state tracking via Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n\nKey methods:\n- acquireLock(path, type, timeout?, sessionId?): acquires lock or waits in queue\n- releaseLock(lock): releases lock and processes wait queue\n- getLockState(path): inspection for debugging/monitoring\n- withLock(options, effect): scoped convenience function for automatic cleanup\n\nLock semantics:\n- Exclusive locks: only one holder, blocks all other locks\n- Shared locks: multiple holders allowed, blocks exclusive locks\n- Wait queue processing: FIFO with automatic grant when compatible\n\nFeatures:\n- Effect.ensuring for automatic lock release\n- Deferred + timeoutFail for timeout handling\n- Automatic wait queue cleanup on fiber interruption\n- Path normalization for consistent lock granularity\n- Project hash for socket paths: /tmp/azedarach-\u003chash\u003e.sock\n\nFiles created:\n- src/core/FileLockManager.ts (580 lines)\n- src/core/FileLockManager.example.ts (354 lines with 8 examples)\n\nType checking: CLEAN (no errors)\nFollows patterns from: TmuxService, WorktreeManager, StateDetector","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:45.033059+11:00","updated_at":"2025-12-12T10:30:40.810809+11:00","closed_at":"2025-12-12T10:30:40.810809+11:00","dependencies":[{"issue_id":"az-c7e","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.562322+11:00","created_by":"daemon"}]}
{"id":"az-7y9","title":"worktree created but not found","description":"we may be looking in the wrong spot for worktrees sometimes. i looked in finder and the worktree existed so not sure how we failed to find it. also make sure that errors that we should via toast are also logged via Effect.logError","notes":"Fixed both issues: (1) Added Effect.logError to all toast error handlers in KeyboardService, (2) Updated WorktreeManager to use branch name as beadId (more reliable than path parsing), added path normalization to avoid symlink/trailing slash issues, added diagnostic logging when worktree not found in cache, made the fallback regex case-insensitive to support any prefix (e.g., Chefy-xxx). Also added MCP tool permissions to project settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:32:16.690535+11:00","updated_at":"2025-12-15T15:32:17.764918+11:00","closed_at":"2025-12-15T15:32:17.764918+11:00"}
{"id":"az-t4t","title":"Keyboard navigation (vim-style)","description":"Implement vim-style keyboard navigation for the Kanban board.","notes":"Session 2025-12-11 (evening):\n\nCOMPLETED:\n- Full Helix-style modal keybinding system implemented\n- Normal mode: hjkl navigation, g→goto, v→select, Space→action menu\n- Goto mode: gw shows 2-char jump labels (home row keys), gg/ge first/last, gh/gl column ends\n- Select mode: multi-selection via Space toggle, hjkl navigation\n- Action mode: h/l moves task(s) to adjacent column (updates status via bd CLI)\n- Ctrl-d/Ctrl-u half-page scrolling\n- Catppuccin Mocha theme colors\n- Virtual scrolling: columns show maxVisible tasks based on terminal height\n- StatusBar shows mode (NOR/SEL/GTO/ACT) with contextual keybind hints\n\nFILES MODIFIED:\n- src/ui/types.ts - Added EditorMode, GotoSubMode, JumpTarget types, generateJumpLabels()\n- src/ui/App.tsx - Full modal state machine, keyboard handling, terminal height calculation\n- src/ui/Board.tsx - Added activeTaskIndex, terminalHeight props\n- src/ui/Column.tsx - Virtual scrolling with scroll indicators\n- src/ui/TaskCard.tsx - Simplified to avoid OpenTUI fragment bugs\n- src/ui/StatusBar.tsx - Mode indicator + contextual keybinds per mode\n- src/ui/theme.ts - Catppuccin Mocha color palette\n- src/ui/atoms.ts - moveTaskEffect, moveTasksEffect for task movement\n- README.md - Comprehensive Helix-style keybinding documentation\n\nISSUES FIXED:\n- client.ready() only returned open/unblocked tasks - changed to client.list()\n- OpenTUI JSX fragments caused rendering corruption - use single text elements\n- Column overflow - implemented virtual scrolling\n\nREMAINING:\n- Some minor rendering artifacts in first column (title-only cards occasionally)\n- Action mode only implements h/l (move) - s/a/p/r/d/P not yet implemented\n\nNEXT STEPS:\n- Could close this bead - core vim-style navigation is complete\n- Action mode commands (start session, attach, etc.) belong in az-stv (Task actions)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.772639+11:00","updated_at":"2025-12-11T23:49:35.046226+11:00","closed_at":"2025-12-11T23:49:35.046226+11:00","dependencies":[{"issue_id":"az-t4t","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.800764+11:00","created_by":"daemon"},{"issue_id":"az-t4t","depends_on_id":"az-hri","type":"blocks","created_at":"2025-12-11T14:46:26.269114+11:00","created_by":"daemon"}]}
{"id":"az-h3v","title":"Agent Mail server for local development","description":"Implement simple Agent Mail server for local multi-agent testing.\n\nDesign:\n- Bun HTTP server with Effect\n- In-memory reservation store (Map\u003cissueId, agentName\u003e)\n- Endpoints:\n  - POST /reserve/:issueId - acquire reservation\n  - POST /release/:issueId - release reservation\n  - GET /ready - list unreserved, unblocked issues\n  - POST /status/:issueId - update status\n  - GET /health - server health check\n- WebSocket support for real-time notifications (optional)\n- Configurable port via CLI argument\n- Graceful shutdown handling","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T10:33:13.621222+11:00","updated_at":"2025-12-12T10:33:13.621222+11:00","dependencies":[{"issue_id":"az-h3v","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.836567+11:00","created_by":"daemon"}]}
{"id":"az-9an","title":"gg command should take me to top of current column not top of open column always","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:50.236333+11:00","updated_at":"2025-12-17T01:01:29.643058+11:00","closed_at":"2025-12-17T01:01:29.643058+11:00"}
{"id":"az-l7a","title":"Agent Mail Integration for Multi-Agent Coordination","description":"Implement Agent Mail coordination layer for multi-agent beads workflows. Agent Mail reduces coordination latency from 2-5 seconds (git sync) to \u003c100ms (HTTP API), preventing work collisions when multiple Claude sessions operate simultaneously.\n\nKey benefits:\n- 20-50x faster coordination than git sync\n- Prevents duplicate work through exclusive file reservations\n- Lightweight (~50MB memory footprint)\n- Optional with graceful degradation to git-only\n\nIntegration points:\n1. Issue reservation before starting work\n2. Issue release when work completes\n3. Ready query to find unblocked, unreserved issues\n4. Status updates for real-time visibility\n\nConfiguration:\n- BEADS_AGENT_MAIL_URL: Server endpoint\n- BEADS_AGENT_NAME: Unique agent identifier\n- BEADS_PROJECT_ID: Shared namespace\n\nReference: https://github.com/steveyegge/beads/blob/main/docs/AGENT_MAIL.md","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T10:32:57.000556+11:00","updated_at":"2025-12-12T10:32:57.000556+11:00"}
{"id":"az-kis","title":"Utility modules: paths, logger, tmux helpers","description":"Create foundational utility modules used throughout the codebase.","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- TmuxService Effect service\n- TerminalService Effect service\n- paths.ts pure utility functions\n\nFILES CREATED:\n- src/core/TmuxService.ts (3.6KB) - tmux session management\n- src/core/TerminalService.ts (1.8KB) - terminal detection/launching\n- src/core/paths.ts (868B) - path utilities\n- src/core/example-usage.ts (2.5KB) - usage examples\n\nTMUX SERVICE METHODS:\n- newSession(name, opts?) - Create detached session\n- killSession(name) - Kill session\n- listSessions() - List with metadata (windows, created, attached)\n- hasSession(name) - Check existence\n- sendKeys(session, keys) - Send keystrokes\n- attachCommand(session) - Get attach command string\n\nTERMINAL SERVICE METHODS:\n- detect() - Returns \"ghostty\" | \"iterm\" | \"terminal-app\" | \"unknown\"\n- openWithCommand(cmd) - Opens new terminal window with command\n\nPATH UTILITIES:\n- getProjectName(path) - Extract basename\n- getWorktreePath(projectPath, beadId) - ../ProjectName-\u003cbeadId\u003e/\n- getSessionName(beadId) - Uses bead ID directly\n- normalizePath(path) - path.resolve()\n\nVERIFICATION:\n- All files compile with TypeScript strict mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:44:26.516814+11:00","updated_at":"2025-12-11T17:27:44.742141+11:00","closed_at":"2025-12-11T17:25:14.137924+11:00","dependencies":[{"issue_id":"az-kis","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.116031+11:00","created_by":"daemon"},{"issue_id":"az-kis","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.747591+11:00","created_by":"daemon"}]}
{"id":"az-vx2","title":"Add debug overlay (d key) showing service state","description":"Developer tool for debugging state issues:\n\n**Debug overlay shows:**\n- Current mode (EditorService)\n- Cursor position and focused task ID (NavigationService)  \n- Active sessions with states (SessionManager)\n- Command queue status (CommandQueueService)\n- Filter/sort settings (BoardService)\n- Recent errors/warnings\n\n**Toggle with 'd' key in normal mode**\n- Semi-transparent overlay on right side\n- Auto-refreshes every 500ms\n- Useful for debugging state sync issues like az-vn0 (disappearing tasks)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:59:45.895225+11:00","updated_at":"2025-12-17T17:06:44.78128+11:00","closed_at":"2025-12-17T17:06:44.78128+11:00"}
{"id":"az-bth","title":"can't put cursor on started task in normal mode","description":"its right above current cursor but up arrow does nothing. check az.log","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:50:52.307315+11:00","updated_at":"2025-12-15T14:07:19.991268+11:00","closed_at":"2025-12-15T14:07:19.991268+11:00"}
{"id":"az-et1","title":"Add elapsed timer to TaskCard","description":"Display MM:SS elapsed timer on TaskCards when session is active (busy/waiting state).\n\nInspiration: AutoMaker's CountUpTimer component.\n\nImplementation:\n1. Already have session startedAt timestamp in session metrics\n2. Add timer display component that updates every second\n3. Show on card when session state is busy or waiting\n4. Format as MM:SS (pad with zeros)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:01Z","updated_at":"2025-12-17T14:09:14.159624+11:00","closed_at":"2025-12-17T14:09:14.159624+11:00"}
{"id":"az-ags","title":"Project scaffolding with Bun, Effect, OpenTUI, and SolidJS","description":"Initialize the project with package.json, tsconfig.json (strict mode), and build tooling. Set up Ink as the TUI framework with React 18.","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- package.json with Bun runtime, Effect ecosystem, OpenTUI + SolidJS\n- tsconfig.json with strict mode, SolidJS JSX config, path aliases\n- Directory structure: src/{core,lib,ui,config}, bin/\n- bin/az.ts CLI entry point (executable, runs successfully)\n- src/index.tsx placeholder with solid-js import\n- All dependencies installed via `bun install`\n\nFILES CREATED:\n- package.json - Full dependency list for Effect + OpenTUI stack\n- tsconfig.json - Strict TS with jsx: \"react-jsx\", jsxImportSource: \"solid-js\"\n- bin/az.ts - Shebang entry point\n- src/index.tsx - Placeholder entry\n\nKEY DECISIONS:\n- Using Bun (not Node) because OpenTUI requires Bun's FFI for Zig backend\n- Using pnpm despite Bun runtime (hybrid setup works)\n- tsup for bundling (simpler than esbuild config)\n\nVERIFICATION:\n- `bun run type-check` passes\n- `./bin/az.ts` outputs \"Azedarach - TUI Kanban for Claude orchestration\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.210523+11:00","updated_at":"2025-12-11T17:27:44.457444+11:00","closed_at":"2025-12-11T17:25:13.896919+11:00","dependencies":[{"issue_id":"az-ags","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.779213+11:00","created_by":"daemon"}]}
{"id":"az-krz","title":"User documentation and guides","description":"Create comprehensive user documentation in docs/ folder covering TUI usage, keybindings, tmux integration, services architecture, and testing procedures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:43:35.93321+11:00","updated_at":"2025-12-12T10:43:42.698148+11:00","closed_at":"2025-12-12T10:43:42.698148+11:00"}
{"id":"az-r9u","title":"looks like there is hidden bead that doesnt quite fit in the screen","description":"our screen size calc must be off","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:26:58.321424+11:00","updated_at":"2025-12-16T21:36:22.5216+11:00","closed_at":"2025-12-16T21:36:22.5216+11:00"}
{"id":"az-lqb","title":"Worker session template with epic context injection","description":"Create worker.md session template that injects:\n- Task title, description, design\n- Parent epic context (title, design, goals)\n- Coordination rules (stay focused, report discoveries)\n- bd commands for status updates\n\n**Template variables:** $TASK_ID, $TASK_TITLE, $EPIC_ID, $EPIC_TITLE, $EPIC_DESIGN\n\n**Location:** .claude/session-templates/worker.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.913748+11:00","updated_at":"2025-12-14T02:13:27.604322+11:00","dependencies":[{"issue_id":"az-lqb","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.80298+11:00","created_by":"daemon"}]}
{"id":"az-8ep","title":"Beads sync coordination for worktrees","description":"Coordinate beads sync across main repo and worktrees.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.819887+11:00","updated_at":"2025-12-12T12:17:55.89465+11:00","closed_at":"2025-12-12T12:17:55.89465+11:00","dependencies":[{"issue_id":"az-8ep","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.882335+11:00","created_by":"daemon"}]}
{"id":"az-uxz","title":"Action palette overlay for Space menu","description":"Action mode keybindings are getting crowded in the status bar. Create a proper floating action palette that appears when Space is pressed, showing all available actions with descriptions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:00:26.143992+11:00","updated_at":"2025-12-12T12:16:53.933473+11:00","closed_at":"2025-12-12T12:16:53.933473+11:00"}
{"id":"az-cgf","title":"Add VC command input mode (:)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-14T01:05:15.626687+11:00","updated_at":"2025-12-14T01:10:33.962738+11:00","closed_at":"2025-12-14T01:10:33.962738+11:00","dependencies":[{"issue_id":"az-cgf","depends_on_id":"az-f4q","type":"blocks","created_at":"2025-12-14T01:05:21.400864+11:00","created_by":"daemon"}]}
{"id":"az-kzk","title":"Quick task creation from TUI","description":"Create new beads tasks without leaving the TUI.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:42.159577+11:00","updated_at":"2025-12-12T12:20:02.57418+11:00","closed_at":"2025-12-12T12:20:02.57418+11:00","dependencies":[{"issue_id":"az-kzk","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.411847+11:00","created_by":"daemon"}]}
{"id":"az-7sr","title":"Add orchestration mode (Space+o) to TUI","description":"New editor mode for orchestrating parallel workers on an epic.\n\n**Trigger:** Space+o when cursor is on an epic task\n**Mode behavior:**\n- Query child tasks of epic via bd\n- Display as selectable list (like select mode)\n- Space toggles task inclusion\n- Enter confirms and triggers spawn\n- Esc cancels\n\n**UI:** Reuse select mode patterns but with orchestration-specific keybinds shown in StatusBar.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.653445+11:00","updated_at":"2025-12-14T02:13:30.983526+11:00","dependencies":[{"issue_id":"az-7sr","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.732517+11:00","created_by":"daemon"}]}
{"id":"az-om3","title":"WorktreeManager - git worktree lifecycle","description":"Manage git worktree creation, tracking, and cleanup for isolated task execution.","notes":"Implemented WorktreeManager Effect service with:\n- Service interface with create, remove, list, exists, get methods\n- Error types: GitError, WorktreeNotFoundError, WorktreeExistsError, NotAGitRepoError\n- Idempotent create operation (safe to call multiple times)\n- Ref-based state tracking for active worktrees\n- Parses git worktree list --porcelain output\n- acquireRelease pattern via acquireWorktree for cleanup guarantees\n- Convenience functions for all operations\n- WorktreeManagerLive and WorktreeManagerLiveWithPlatform layers\n- Comprehensive example file with 7 usage patterns\n- Follows BeadsClient and TmuxService patterns\n- All type checks pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.585679+11:00","updated_at":"2025-12-11T18:03:13.741817+11:00","closed_at":"2025-12-11T18:03:13.741817+11:00","dependencies":[{"issue_id":"az-om3","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.224593+11:00","created_by":"daemon"}]}
{"id":"az-fn1","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:19:56.843403+11:00","updated_at":"2025-12-17T00:20:45.047717+11:00"}
{"id":"az-mlv","title":"when i press space m on beads that are in closed column but have tmux session running they seem to merge ok but the beads disappear from closed","description":"no idea where they disappear to","notes":"Root cause found: PRWorkflow.mergeToMain calls `beadsClient.sync(worktree.path)` without `--from-main` flag. Comment says --from-main but code doesn't use it. Fix: add syncFromMain method to BeadsClient and use it in merge workflow.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T17:11:43.179532+11:00","updated_at":"2025-12-17T17:15:28.316768+11:00"}
{"id":"az-shf","title":"when a bead action is occurring such as space S, disable further actions from being taken on that bead until its idle again","notes":"Starting implementation. Strategy:\n1. Create taskQueueInfoAtom for reactive queue state\n2. Add isBusy check to ActionPalette isAvailable()\n3. Add busy guard to handlers that use withQueue\n4. Show running operation label in toast when blocked","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T16:04:50.355647+11:00","updated_at":"2025-12-17T17:13:42.018862+11:00"}
{"id":"az-mq9","title":"Create effect-atom SolidJS adapter","description":"Create a SolidJS adapter for effect-atom since only React and Vue adapters exist. This bridges Effect services to SolidJS's reactive system.","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full SolidJS adapter for @effect-atom/atom\n- Implements all core hooks matching React adapter API\n\nFILES CREATED:\n- src/lib/effect-atom-solid/hooks.ts - useAtomValue, useAtomSet, useAtom, useAtomMount, useAtomRefresh\n- src/lib/effect-atom-solid/Provider.tsx - AtomProvider with registry options\n- src/lib/effect-atom-solid/index.ts - Barrel exports\n- src/lib/effect-atom-solid/example.tsx - Working counter example\n- src/lib/effect-atom-solid/README.md - Full documentation\n\nKEY DECISIONS:\n- Used createSignal + subscription pattern (SolidJS equivalent of useSyncExternalStore)\n- Values returned as Accessor\u003cT\u003e (must call: count()) per SolidJS conventions\n- Default scheduler: queueMicrotask (not React Scheduler)\n- Used onCleanup for automatic subscription cleanup\n\nPOTENTIAL CONTRIBUTION:\n- This adapter could be contributed back to tim-smart/effect-atom\n- API surface mirrors @effect-atom/atom-react for easy migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:10:02.323692+11:00","updated_at":"2025-12-11T17:27:44.548067+11:00","closed_at":"2025-12-11T17:25:13.974746+11:00","dependencies":[{"issue_id":"az-mq9","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T17:10:08.844553+11:00","created_by":"daemon"},{"issue_id":"az-mq9","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T17:10:08.914278+11:00","created_by":"daemon"}]}
{"id":"az-g7p","title":"sometimes space S/s moves the task to in progress but doesnt start a tmux session","description":"what could even cause the tmux session to not be started? check az.log maybe","notes":"Root cause identified: Action handlers in KeyboardService use Effect.tap() which fires-and-forgets the inner Effect. Need to change to Effect.flatMap() to properly await the session start.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:44:06.046821+11:00","updated_at":"2025-12-17T17:01:19.62138+11:00","closed_at":"2025-12-17T17:01:19.62138+11:00"}
{"id":"az-ap1","title":"Complete CLI commands (attach, pause, status, sync)","description":"src/cli/index.ts has 5 TODO placeholders:\n\n- **attach** (line 174): Implement session attachment via TmuxService\n- **pause** (line 201): Implement session pause\n- **status** (line 226): Display session/board status summary\n- **sync** (line 255-259): Sync worktrees (all vs current directory)\n\nCLI should be fully functional for non-TUI workflows.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:59:44.511089+11:00","updated_at":"2025-12-17T15:59:44.511089+11:00"}
{"id":"az-4r0","title":"AgentMailClient Effect service","description":"Create Effect service wrapper for Agent Mail HTTP API.\n\nDesign:\n- Define AgentMailClient as Effect.Service\n- Use @effect/platform HttpClient for requests\n- Methods:\n  - reserve(issueId): Effect\u003cReservation, ReservationError\u003e\n  - release(issueId): Effect\u003cvoid, ReleaseError\u003e\n  - ready(): Effect\u003cIssue[], AgentMailError\u003e\n  - updateStatus(issueId, status): Effect\u003cvoid, AgentMailError\u003e\n  - isAvailable(): Effect\u003cboolean, never\u003e (health check)\n- Read config from environment variables\n- Graceful degradation: return fallback when server unavailable\n- Retry logic with exponential backoff\n- Create AgentMailClientLive and AgentMailClientTest layers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.475812+11:00","updated_at":"2025-12-12T10:33:13.475812+11:00","dependencies":[{"issue_id":"az-4r0","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.800097+11:00","created_by":"daemon"}]}
{"id":"az-stv","title":"Task actions: start, attach, pause, resume","description":"Implement keyboard shortcuts for task lifecycle actions.","notes":"Session 2025-12-12:\n\nNOW UNBLOCKED - All dependencies completed:\n- az-xi5 (SessionManager): ✅ Closed - full orchestration service\n- az-t4t (Keyboard navigation): ✅ Closed - Helix-style modal keybindings\n\nIMPLEMENTATION PLAN:\n1. Wire SessionManager to Action mode commands:\n   - Space+s: SessionManager.start() - create worktree + spawn Claude\n   - Space+a: Already done (AttachmentService.attachExternal)\n   - Space+p: SessionManager.pause() - Ctrl+C + WIP commit\n   - Space+r: SessionManager.resume() - reattach to paused session\n\n2. Update TaskCard to show live session state:\n   - Use SessionManager.subscribeToStateChanges() PubSub\n   - Update sessionState in TaskWithSession reactively\n   - Already have session indicators: 🔵🟡✅❌⏸️\n\n3. Validate action availability:\n   - 's' only on idle tasks\n   - 'a' only on busy/waiting tasks\n   - 'p' only on busy tasks\n   - 'r' only on paused tasks\n\nDEPENDENCIES NOW MET:\n- SessionManager: src/core/SessionManager.ts\n- WorktreeManager: src/core/WorktreeManager.ts\n- TmuxService: src/core/TmuxService.ts\n- StateDetector: src/core/StateDetector.ts\n\nFILES TO MODIFY:\n- src/ui/App.tsx - Add action handlers for s/p/r\n- src/ui/atoms.ts - Add session lifecycle effects\n- src/ui/TaskCard.tsx - May need state subscription","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.880144+11:00","updated_at":"2025-12-12T10:53:49.478801+11:00","closed_at":"2025-12-12T10:53:49.478801+11:00","dependencies":[{"issue_id":"az-stv","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.920801+11:00","created_by":"daemon"},{"issue_id":"az-stv","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.054522+11:00","created_by":"daemon"},{"issue_id":"az-stv","depends_on_id":"az-t4t","type":"blocks","created_at":"2025-12-11T14:46:28.161361+11:00","created_by":"daemon"}]}
{"id":"az-4zq","title":"session monitoring not working. i assume due to permission denied on hooks","description":"we may need to chmod hook scripts?","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T17:14:22.614097+11:00","updated_at":"2025-12-17T17:15:06.925435+11:00"}
{"id":"az-d5q","title":"Help overlay with keybinding reference","description":"Contextual help overlay showing available commands.","notes":"Created HelpOverlay component with Catppuccin-themed modal showing all keybindings grouped by category (Navigation, Modes, Select Mode, Action Mode, General). Added '?' keybind to App.tsx to toggle the help overlay. The overlay dismisses on any key press. Successfully type-checked with no errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.840117+11:00","updated_at":"2025-12-12T01:29:02.41928+11:00","closed_at":"2025-12-12T01:29:02.41928+11:00","dependencies":[{"issue_id":"az-d5q","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.144875+11:00","created_by":"daemon"}]}
{"id":"az-6nu","title":"help me figure out this tool use issue in claude sessions started via space s/S","description":"- it always stdouts ERROR: wrong usage\n - i have no idea what program/script logs it\n - it doesnt happen if i ctrl-a % to split and open a new claude session and tell it to type check\n - doesnt happen for read/write tool use only commands that use shell like bun run type-check etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:01:53.842983+11:00","updated_at":"2025-12-17T16:17:50.228619+11:00","closed_at":"2025-12-17T16:17:50.228619+11:00"}
{"id":"az-qmg","title":"instead of using an extra line to underline column headers just use underlined ascii characters maybe?","notes":"Starting work - will use text underline attribute instead of separate line","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T12:57:11.332088+11:00","updated_at":"2025-12-17T00:44:19.692037+11:00","closed_at":"2025-12-17T00:44:19.692037+11:00"}
{"id":"az-k5m","title":"Persist session state via tmux query","description":"Session state is lost on azedarach restart because SessionManager stores state in-memory Ref. Fix by querying tmux list-sessions on startup and matching session names to bead IDs.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:33:52.363085+11:00","updated_at":"2025-12-12T11:34:33.533566+11:00","closed_at":"2025-12-12T11:34:33.533566+11:00"}
{"id":"az-nqo","title":"Complete SessionService implementation (spawn/attach/onComplete)","description":"SessionService is a thin facade that consolidates scattered session logic in KeyboardService into a reusable API layer.\n\n**Current State (Duplicated):**\n- `spawn()` logic: KeyboardService lines 362-369 (Space+s) and 388-401 (Space+i) both call sessionManager.start()\n- `attach()` logic: KeyboardService line 443 (Space+a) calls attachmentService.attachExternal()\n- `onComplete()` logic: **MISSING** — no PR workflow automation exists\n\n**Refactoring Goals:**\n1. Extract `spawn()` → consolidate both keybinding paths into SessionService.spawn()\n2. Extract `attach()` → consolidate Space+a/Space+o paths into SessionService.attach()  \n3. Implement `onComplete()` → wire PRWorkflow for automatic PR creation + board updates (NEW)\n4. Update KeyboardService to delegate to SessionService instead of direct core service calls\n\n**Benefit:** Single source of truth for session operations, enables auto-PR workflow, cleaner architecture (UI routing vs business logic separation).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T15:59:44.332899+11:00","updated_at":"2025-12-17T16:57:47.268317+11:00","closed_at":"2025-12-17T16:57:47.268317+11:00"}
{"id":"az-v6h","title":"use effect STM or something to enforce atomic operations where possible","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:43:45.048239+11:00","updated_at":"2025-12-17T15:43:45.048239+11:00"}
{"id":"az-pnx","title":"Configuration system with @effect/schema and Effect Config","description":"User configuration loading and validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.673276+11:00","updated_at":"2025-12-12T17:24:13.126088+11:00","closed_at":"2025-12-12T17:24:13.126088+11:00","dependencies":[{"issue_id":"az-pnx","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.015922+11:00","created_by":"daemon"}]}
{"id":"az-ssm","title":"i tried az in Chefy and for some reason the cursor got lost after i sorted by updated","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:49:22.39364+11:00","updated_at":"2025-12-15T14:06:56.110719+11:00","closed_at":"2025-12-15T14:06:56.110719+11:00"}
{"id":"az-31i","title":"the claude create task feature needs work. we should use claude cli or something not a full claude ode session/instance","notes":"Analyzing current implementation and planning CLI-based approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:31.58228+11:00","updated_at":"2025-12-17T00:18:36.483483+11:00","closed_at":"2025-12-17T00:18:36.483483+11:00"}
{"id":"az-bf8","title":"queue up commands that would conflict if run all at once","description":"e.g. space m (we shouldnt try to merge two branches at once!)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:48:33.510147+11:00","updated_at":"2025-12-17T15:51:46.00979+11:00","closed_at":"2025-12-17T15:51:46.009793+11:00"}
{"id":"az-2il","title":"Agent Mail status broadcast integration","description":"Workers broadcast status via Agent Mail for real-time TUI updates.\n\n**Events:**\n- STARTED: Worker began task\n- PROGRESS: Periodic heartbeat with context %\n- BLOCKED: Worker discovered blocker\n- COMPLETED: Worker finished task\n- ERROR: Worker encountered error\n\n**TUI subscription:**\n- Poll Agent Mail for status updates (or WebSocket if available)\n- Update TaskCard session indicators in real-time\n- Show toast for important events (blocked, error)\n\n**Depends on:** Agent Mail integration (az-l7a)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:15.170002+11:00","updated_at":"2025-12-14T02:13:25.698677+11:00","dependencies":[{"issue_id":"az-2il","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T13:29:24.916405+11:00","created_by":"daemon"},{"issue_id":"az-2il","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.86955+11:00","created_by":"daemon"}]}
{"id":"az-g19","title":"Terminal attachment (external and inline)","description":"Implement session attachment for manual intervention.","notes":"Implementation complete:\n\n1. Created AttachmentService (src/core/AttachmentService.ts):\n   - External attachment via attachExternal() - opens new terminal window/tab\n   - Inline attachment stub via attachInline() - reserved for future implementation\n   - Terminal type detection (Ghostty, iTerm, Terminal.app)\n   - Attachment history tracking\n   - Proper Effect error handling with AttachmentError and SessionNotFoundError\n\n2. Updated atoms.ts:\n   - Added AttachmentService to runtime layer (appLayer)\n   - Created attachExternalEffect() and attachInlineEffect() helper functions\n   - Properly composed layers with dependencies (AttachmentService depends on TmuxService and TerminalService)\n\n3. Integrated with App.tsx keyboard handling:\n   - Added 'a' key in action mode (Space + a) for external attachment\n   - Added 'A' key in action mode (Space + A) for inline attachment (shows error for now)\n   - Session ID is constructed as 'claude-{task.id}'\n   - Error handling with console.error fallback\n\nTechnical details:\n- AttachmentService uses TmuxService for session validation and attach command generation\n- TerminalService provides terminal detection and command execution\n- External attachment opens new terminal with 'tmux attach-session -t {sessionId}'\n- Inline attachment is stubbed - future implementation will require suspending TUI renderer\n- All code passes type-check with strict TypeScript mode\n- No 'as' casts or 'any' types used\n\nUsage:\n1. Navigate to a task with hjkl\n2. Press Space to enter action mode\n3. Press 'a' to attach externally in new terminal window\n4. Press 'A' to attempt inline (will show error message)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:08.219579+11:00","updated_at":"2025-12-12T10:32:33.851115+11:00","closed_at":"2025-12-12T10:32:33.851115+11:00","dependencies":[{"issue_id":"az-g19","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.313043+11:00","created_by":"daemon"}]}
{"id":"az-kud","title":"improve tmux workflow","description":"i want to figure out a way to use az as the primary way i navigate through tmux to the right sessions.\ni am just starting to learn tmux so i may be doing thing all wrong but so far i've been pressing ctrl-a s to open the tmux session picker i guess and then navigating to az session or another session created previously by az.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:24:37.484276+11:00","updated_at":"2025-12-16T22:37:21.448766+11:00","closed_at":"2025-12-16T22:37:21.448766+11:00"}
{"id":"az-xi5","title":"SessionManager - Claude session orchestration","description":"Core orchestration: spawn Claude in tmux sessions, manage lifecycle, coordinate with worktrees.","notes":"Implemented SessionManager service in src/core/SessionManager.ts following Effect service pattern.\n\nKey implementation details:\n- Service interface with 7 methods: start, stop, pause, resume, getState, listActive, updateState, subscribeToStateChanges\n- Uses Effect.gen pattern for orchestration\n- Composes WorktreeManager, TmuxService, BeadsClient, and StateDetector services\n- Tracks sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- PubSub for state change events\n- SessionManagerLive layer with all dependencies included\n- All methods require CommandExecutor in context (provided by BunContext layer)\n- Type-safe error handling with typed error unions\n- Comprehensive JSDoc documentation\n\nThe start() method creates worktree, spawns tmux session, and launches Claude.\nThe pause() method sends Ctrl+C and creates WIP commit.\nThe stop() method kills tmux session.\n\nAll types pass strict TypeScript checking (pnpm type-check).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.82144+11:00","updated_at":"2025-12-12T10:32:34.049829+11:00","closed_at":"2025-12-12T10:32:34.049829+11:00","dependencies":[{"issue_id":"az-xi5","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.3385+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-om3","type":"blocks","created_at":"2025-12-11T14:46:26.452316+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-kis","type":"blocks","created_at":"2025-12-11T14:46:26.845057+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-a8i","type":"blocks","created_at":"2025-12-11T14:46:27.560945+11:00","created_by":"daemon"}]}
{"id":"az-n6k","title":"i seem to only be able to space m merge to main one bead and then i have to restart az","description":"after one the next time i space m a different bead it does nothing","notes":"Root cause: `Effect.fork` in CommandQueueService.processNext was creating fibers tied to the parent scope. When processNext returned, the scope closed and interrupted the forked fiber before it could clean up (set running = null). This left the queue in a stuck state where `running !== null` blocked subsequent operations.\n\nFix: \n1. Changed service from `effect:` to `scoped:` to get a layer-level Scope\n2. Captured scope at construction: `const serviceScope = yield* Effect.scope`\n3. Changed `Effect.fork` to `Effect.forkIn(effect, serviceScope)`\n\nThis ensures command fibers:\n- Aren't interrupted when processNext returns (outlive parent)\n- Get cleaned up when app shuts down (not daemon fibers)\n\n---\n\nRoot cause: `Effect.fork` in CommandQueueService.processNext was creating fibers tied to the parent scope. When processNext returned, the scope closed and interrupted the forked fiber before it could clean up (set running = null). This left the queue in a stuck state where `running !== null` blocked subsequent operations.\n\nFix: \n1. Changed service from `effect:` to `scoped:` to get a layer-level Scope\n2. Captured scope at construction: `const serviceScope = yield* Effect.scope`\n3. Changed `Effect.fork` to `Effect.forkIn(effect, serviceScope)`\n\nThis ensures command fibers:\n- Aren't interrupted when processNext returns (outlive parent)\n- Get cleaned up when app shuts down (not daemon fibers)\n\n---\n\nRoot cause: `Effect.fork` in CommandQueueService.processNext was creating fibers tied to the parent scope. When processNext returned, the scope closed and interrupted the forked fiber before it could clean up (set running = null). This left the queue in a stuck state where `running !== null` blocked subsequent operations.\n\nFix: Changed `Effect.fork` to `Effect.forkDaemon` so the fiber runs independently and completes its cleanup properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:32:43.637796+11:00","updated_at":"2025-12-17T17:12:59.43952+11:00","closed_at":"2025-12-17T17:12:59.43952+11:00"}
{"id":"az-voa","title":"i dont like ctrl-a A as a way to return to az, come up with a better global key command","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T10:08:08.210971+11:00","updated_at":"2025-12-17T10:48:27.086814+11:00","closed_at":"2025-12-17T10:48:27.086814+11:00"}
{"id":"az-g84","title":"space c (chat with claude about task) not working","description":"it seems to start a session cause i see a blue dot in az tui but when i press space a it says it failed to attach (not found) i also think it would be better to attach inline or whatever its called in this instance (overlay tui and end on closing out) similar to the log viewer (L) keybind","notes":"Investigated the issue. Found two problems:\n\n1. Space+c starts session but doesn't auto-attach - user sees blue dot but session lookup fails on Space+a\n2. User wants inline popup attach (like Shift+L for logs) instead of external terminal\n\nSolution: Modify actionChatAboutTask to use tmux displayPopup like the log viewer, which will:\n- Start the Claude chat session\n- Immediately show it in a popup overlay\n- Auto-close popup when session ends","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:21:47.203086+11:00","updated_at":"2025-12-17T16:27:28.647989+11:00","closed_at":"2025-12-17T16:27:28.647989+11:00"}
{"id":"az-zv6","title":"Automation \u0026 Workflows","description":"Automated workflows: PR creation, state transition hooks, notifications, and beads sync coordination.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:04.97152+11:00","updated_at":"2025-12-11T14:44:04.97152+11:00"}
{"id":"az-kgq","title":"Multi-project support","description":"Monitor tasks across multiple beads-enabled projects.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-11T14:45:41.986553+11:00","updated_at":"2025-12-11T14:45:41.986553+11:00","dependencies":[{"issue_id":"az-kgq","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.274456+11:00","created_by":"daemon"}]}
{"id":"az-s1n","title":"add a pre tool use hook to prevent type casting like we have in ~/prog/Chefy","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:45:55.42323+11:00","updated_at":"2025-12-17T17:08:36.020343+11:00","closed_at":"2025-12-17T17:08:36.020343+11:00"}
{"id":"az-shv","title":"Error toast notifications in TUI","description":"Show dismissible error toasts when actions fail (e.g., attach to non-existent session, start on non-idle task). Currently errors only go to console.error which users don't see.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T10:59:23.087691+11:00","updated_at":"2025-12-12T11:07:55.898746+11:00","closed_at":"2025-12-12T11:07:55.898746+11:00"}
{"id":"az-2ek","title":"Add warning glyphs to TaskCard header","description":"Add tiny warning glyphs (⚠🔄) to TaskCard headerLine after session indicator. ⚠ for context warning (\u003e70%), 🔄 for recently compacted. Space cost: 1-2 characters.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.779379+11:00","updated_at":"2025-12-12T13:25:20.429502+11:00","dependencies":[{"issue_id":"az-2ek","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.178601+11:00","created_by":"daemon"}]}
{"id":"az-e0w","title":"board doesn't seem to update when i change sort mode","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T16:48:52.461805+11:00","updated_at":"2025-12-17T16:48:52.461805+11:00"}
{"id":"az-09e","title":"Modularize KeyboardService into domain-specific handlers","description":"KeyboardService.ts is 1,572 lines - the largest service in the codebase.\n\nRefactor into smaller, focused modules:\n- **SessionKeyHandlers** - start/stop/pause/attach session actions\n- **NavigationKeyHandlers** - movement, selection, goto\n- **TaskKeyHandlers** - create/edit/delete/move tasks\n- **PRKeyHandlers** - PR creation, merge, cleanup\n- **ModeKeyHandlers** - mode transitions (search, command, etc.)\n\nEach module exports handler functions that KeyboardService composes.\nThis improves maintainability and makes testing individual handlers easier.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:44.99229+11:00","updated_at":"2025-12-17T16:54:21.233588+11:00","closed_at":"2025-12-17T16:54:21.233588+11:00"}
{"id":"az-vpj","title":"make sure we warn the user if space m will cause conflicts and they can press y/n to proceed or cancel","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:26.919959+11:00","updated_at":"2025-12-17T01:09:17.730326+11:00","closed_at":"2025-12-17T01:09:17.730326+11:00"}
{"id":"az-o5a","title":"Complete KeyboardService migration - replace App.tsx inline handlers","description":"Finish the half-completed migration from inline useKeyboard handlers in App.tsx to the data-driven KeyboardService + useKeyboardBridge pattern.","notes":"## Session Progress (2025-12-15)\n\n### Completed\n- Phase 1: NavigationService methods added (halfPageDown, halfPageUp, goToFirst, goToLast, goToFirstColumn, goToLastColumn, jumpToEnd)\n- Layer composition in atoms.ts restructured to support NavigationService → BoardService dependency\n- KeyboardService rewritten with all modes and ~60 keybindings\n- **Fixed type errors** by:\n  1. Removing explicit `Effect.Effect\u003cvoid\u003e` return types from helper functions (let TS infer)\n  2. Updated `Keybinding` interface to allow `BeadsError` and `KeybindingDeps` (CommandExecutor | FileSystem)\n  3. Removed explicit return type from `handleKey` method\n- **Extended BeadsClient** to support all bd CLI fields:\n  - `update()`: Added title, description, design, acceptance, assignee, estimate, labels\n  - `create()`: Added design, acceptance, assignee, estimate, labels\n- **Refactored BeadEditorService** to use BeadsClient instead of running bd commands directly\n- **MAJOR: ID-based cursor navigation** - Changed cursor from index-based {columnIndex, taskIndex} to focusedTaskId: string | null\n  - Eliminates sync issues between UI and services\n  - NavigationService now uses EditorService for search/sort config\n  - Navigation operations find current position in filtered view, calculate new position, store new task ID\n- **Single data source** - App.tsx now uses boardTasksAtom from BoardService instead of separate tasksAtom\n  - When board.refresh() is called, UI updates automatically\n- **Skip empty columns** - Left/right navigation skips empty columns to find next non-empty one\n- **Cursor safety** - After deleting a bead, nav.initialize() moves cursor to valid task\n- **az-451 Data.struct refactor** - SubscriptionRef state now uses Data.struct() for structural equality:\n  - EditorService: EditorMode variants + SortConfig\n  - OverlayService: Overlay objects + emptyArray() singleton\n  - ToastService: Toast objects + emptyArray() singleton\n  - Created src/lib/empty.ts with singleton emptyRecord()/emptyArray()\n\n### Status: TYPE-CHECK PASSES ✓\n\n### Files Modified This Session\n- src/services/NavigationService.ts - Complete rewrite for ID-based cursor\n- src/services/KeyboardService.ts - Updated getSelectedTask to use focusedTaskId\n- src/services/BoardService.ts - Added getFilteredTasksByColumn, getFilteredTaskAt, Map→Record\n- src/services/EditorService.ts - Data.struct() wrapping for EditorMode/SortConfig\n- src/services/OverlayService.ts - Data.struct() wrapping + emptyArray()\n- src/services/ToastService.ts - Data.struct() wrapping + emptyArray()\n- src/ui/App.tsx - Use boardTasksAtom, call refreshBoard on mount\n- src/ui/atoms.ts - Removed cursorAtom, added initializeNavigationAtom, refreshBoardAtom\n- src/ui/hooks/useNavigation.ts - Derives position from focusedTaskId locally\n- src/ui/Board.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/ui/CompactView.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/lib/empty.ts - NEW: singleton emptyRecord()/emptyArray()\n\n### Remaining Work\n1. Wire useKeyboardBridge into App.tsx (handleKeyAtom already connected)\n2. Remove any remaining inline handlers from App.tsx\n3. Test all keybindings thoroughly\n4. Consider removing debug logging from KeyboardService\n\n### Recent Commits\n- eccbe28 - refactor: Add Data.struct wrapping to SubscriptionRef state\n- 19beb0a - feat: Add singleton empty collection utilities\n- 092959c - refactor: ID-based cursor navigation and single data source","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T00:43:39.319315+11:00","updated_at":"2025-12-15T13:36:38.73138+11:00","closed_at":"2025-12-15T13:36:38.73138+11:00"}
{"id":"az-pn6","title":"StatusBar component","description":"Bottom status bar showing available actions and system status.","notes":"Enhanced StatusBar component with:\n1. Connection/sync status indicator (● connected, ○ disconnected) using theme colors\n2. Responsive terminal width handling - hides keybinds \u003c100 cols, mode display \u003c80 cols, selected count \u003c60 cols\n3. Project name 'azedarach' displayed on left with bold styling\n4. Improved visual hierarchy using Catppuccin theme colors (green for connected, overlay0 for disconnected)\n5. Added optional 'connected' prop to StatusBarProps (defaults to true)\n6. Type-safe implementation - pnpm type-check passes with no errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:07.987695+11:00","updated_at":"2025-12-12T01:29:02.416939+11:00","closed_at":"2025-12-12T01:29:02.416939+11:00","dependencies":[{"issue_id":"az-pn6","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.038999+11:00","created_by":"daemon"}]}
{"id":"az-8mp","title":"Fix TUI height in tmux and improve session scrolling","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T00:37:17.384839+11:00","updated_at":"2025-12-14T00:37:34.04098+11:00","closed_at":"2025-12-14T00:37:34.04098+11:00"}
{"id":"az-use","title":"bd sync doesnt have a json output. need to parse it differently","description":"sync failed for [bd id] -\u003e not valid json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:25:05.897274+11:00","updated_at":"2025-12-17T16:53:52.433343+11:00","closed_at":"2025-12-17T16:53:52.433345+11:00"}
{"id":"az-53o","title":"Notification system (terminal bell, system notifications)","description":"Alert user when sessions need attention.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.717497+11:00","updated_at":"2025-12-11T14:54:42.593575+11:00","dependencies":[{"issue_id":"az-53o","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.727137+11:00","created_by":"daemon"}]}
{"id":"az-l7d","title":"enhance docs with all keybinds, modes, vc explainer, etc","description":"Enhanced documentation with:\\n- keybindings.md: Space+m (merge), Space+i (image attach), Image Attachment Overlay section\\n- services.md: ImageAttachmentService documentation\\n- README.md: Expanded VC Integration with architecture diagram, decision table, examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:14:45.203716+11:00","updated_at":"2025-12-17T14:14:51.661199+11:00","closed_at":"2025-12-17T14:14:51.661199+11:00"}
{"id":"az-ofl","title":"have to allow claude permissions again in every worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:26:49.402571+11:00","updated_at":"2025-12-15T10:58:08.359395+11:00","closed_at":"2025-12-15T10:58:08.359395+11:00"}
{"id":"az-2qy","title":"CLI argument parsing with @effect/cli","description":"Set up CLI entry point with argument parsing for the az command.","notes":"Implemented complete CLI structure with @effect/cli:\n- Created src/cli/index.ts with all commands (default, start, attach, pause, status, sync)\n- Proper Option.Option handling for optional parameters\n- Type-safe argument parsing using Args and Options from @effect/cli\n- Integration with BeadsClient and BunContext\n- Help system auto-generates for all commands\n\nNOTE: Discovered potential issue with @effect/cli 0.72.1 where subcommands show help instead of executing. The CLI structure is correct per official docs, but runtime behavior needs investigation. Commands are properly registered (visible in help output) but not routing correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.3098+11:00","updated_at":"2025-12-11T18:03:13.670101+11:00","closed_at":"2025-12-11T18:03:13.670101+11:00","dependencies":[{"issue_id":"az-2qy","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.891408+11:00","created_by":"daemon"},{"issue_id":"az-2qy","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.453515+11:00","created_by":"daemon"}]}
{"id":"az-srh","title":"Detail view for selected task","description":"Expandable detail panel showing full task information.","notes":"Implementation complete. Created DetailPanel.tsx component that shows full task details in a modal overlay. Added Enter key handler in normal mode to toggle the detail view. Updated HelpOverlay to document the Enter key. Component displays: task ID, type, priority, status, session state, description, design notes, notes, timestamps, and available actions based on task state. Follows same overlay pattern as HelpOverlay with semi-transparent background and centered box using Catppuccin theme colors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:08.103114+11:00","updated_at":"2025-12-12T10:32:33.95362+11:00","closed_at":"2025-12-12T10:32:33.95362+11:00","dependencies":[{"issue_id":"az-srh","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.178011+11:00","created_by":"daemon"}]}
{"id":"az-lit","title":"when we create a bead we should immediately put the cursor on it","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:22:17.05286+11:00","updated_at":"2025-12-17T00:52:00.683781+11:00","closed_at":"2025-12-17T00:52:00.683781+11:00"}
{"id":"az-9b8","title":"Epic progress indicator in TaskCard","description":"Show progress bar for epic tasks: ████░░ 3/5\n\n**Implementation:**\n- Query child task statuses\n- Calculate completed/total\n- Render as Unicode progress bar\n- Only show for issue_type=epic\n\n**Space cost:** One line, replaces description line for epics","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.040003+11:00","updated_at":"2025-12-12T13:29:15.040003+11:00","dependencies":[{"issue_id":"az-9b8","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.835556+11:00","created_by":"daemon"}]}
{"id":"az-qmo","title":"Add stop session action (Space+x)","description":"No way to stop/kill a running session from the TUI. Need Space+x to kill tmux session and mark task as idle.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:42:23.169998+11:00","updated_at":"2025-12-12T11:43:10.52549+11:00","closed_at":"2025-12-12T11:43:10.52549+11:00"}
{"id":"az-385","title":"Indented child task display under epics","description":"Show epic children indented in the board view.\n\n**Visual:**\n┌─────────────────┐\n│ 🎯 az-epic      │\n│   ├─ az-a ⚙    │\n│   ├─ az-b ✓    │\n│   └─ az-c ⏸    │\n└─────────────────┘\n\n**Implementation:**\n- Query parent field from beads\n- Group tasks by parent in Board.tsx\n- Render children with tree prefix (├─ └─)\n- Collapse/expand with Enter on epic?\n\n**Consideration:** May need variable card heights or separate epic view","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.298636+11:00","updated_at":"2025-12-12T13:29:15.298636+11:00","dependencies":[{"issue_id":"az-385","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.905066+11:00","created_by":"daemon"}]}
{"id":"az-tsf","title":"sometimes i have to bd init when i create a worktree and attach to the session with az","description":"i assume its to do with the fact the new session has to wait for direnv (with flake) to setup the env. maybe we need to increase a timeout somewhere?","notes":"Root cause identified: tmux session uses `bash -c` which bypasses direnv shell hooks. Fix: wrap claude command with `direnv exec .` to explicitly load environment before starting Claude.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:01:38.873045+11:00","updated_at":"2025-12-16T22:11:39.827838+11:00","closed_at":"2025-12-16T22:11:39.827838+11:00"}
{"id":"az-65k","title":"Selection jumps to top of column after moving task left","notes":"Session progress (2025-12-14):\n\nROOT CAUSE ANALYSIS:\n- Navigation tracks position (columnIndex, taskIndex) not task ID\n- After moving RIGHT into empty column, taskIndex clamps to 0\n- Moving LEFT then uses stale taskIndex (0), navigating to top of column\n\nSOLUTION DESIGNED:\n1. Add `followTaskId` state to track which task to follow after moves\n2. Add useEffect watching followTaskId + tasksByColumn\n3. When data refreshes, find task by ID and navigate to its new position\n4. Update LEFT/RIGHT handlers in action mode to use setFollowTaskId()\n\nFILES TO MODIFY:\n- src/ui/App.tsx:\n  - Line 4: Add useEffect import\n  - After line 112: Add followTaskId state\n  - After navigateTo (line 206): Add useEffect for following task\n  - Lines 405-430: Update LEFT handler to use setFollowTaskId\n  - Lines 431-456: Update RIGHT handler to use setFollowTaskId\n\nFIX WAS APPLIED BUT REVERTED:\n- The fix was successfully implemented\n- A linter/formatter reverted the changes\n- Need to re-apply with proper formatting\n\nNEXT STEP:\nRe-apply the fix, ensuring it passes linting/formatting","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T17:17:04.148671+11:00","updated_at":"2025-12-14T02:13:17.044684+11:00","closed_at":"2025-12-14T02:13:17.044687+11:00"}
{"id":"az-csh","title":"when a title is too long truncate it so the text doesnt overflow","notes":"Working on adding title truncation to TaskCard.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:27:43.068828+11:00","updated_at":"2025-12-17T00:47:49.957663+11:00","closed_at":"2025-12-17T00:47:49.957663+11:00"}
{"id":"az-zu3","title":"Implement hybrid state detection: native hooks + PTY monitoring","description":"Design and implement a hybrid state detection system that combines Claude Code's native hooks (authoritative state) with PTY output monitoring (supplementary signals).\n\n## Architecture\n- Native hooks (idle_prompt, stop, session_end) provide authoritative state transitions\n- PTY stream provides error pattern detection and \"busy\" feedback\n- State aggregator reconciles signals into final state\n\n## Benefits\n- Authoritative state from hooks\n- Graceful degradation if hooks fail\n- Error detection via PTY patterns\n- Future-proof as Claude adds more hooks\n\n## Depends on\n- az-lsi (native hook integration - provides foundation)","notes":"## Implementation Plan Approved\n\n### Approach\n- Full PTYMonitor service (separate scoped service)\n- Full state detection (busy, error, done using existing StateDetector patterns)\n- Hooks take priority (2s window after hook fires)\n- 500ms polling interval\n\n### Files to Modify\n1. `src/core/TmuxService.ts` - Add `capturePane` method\n2. `src/core/PTYMonitor.ts` - Create new service (~180 lines)\n3. `src/ui/atoms.ts` - Wire PTYMonitor, update session atoms\n4. `src/services/BoardService.ts` - Integrate metrics into loadTasks\n\n### Types Already Exist\n- SessionMetrics, AgentPhase, TaskWithSession in src/ui/types.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T01:04:40.22594+11:00","updated_at":"2025-12-17T16:45:38.912457+11:00","closed_at":"2025-12-17T16:45:38.912457+11:00","dependencies":[{"issue_id":"az-zu3","depends_on_id":"az-lsi","type":"blocks","created_at":"2025-12-17T01:04:47.033729+11:00","created_by":"daemon"}]}
{"id":"az-xoz","title":"fix action mode delete bead keybind","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:25:22.242622+11:00","updated_at":"2025-12-15T01:37:29.061321+11:00","closed_at":"2025-12-15T01:37:29.061321+11:00"}
{"id":"az-xmj","title":"something is wrong with create task with claude STILL","description":"redesign the feature from the ground up cause we have tried to fix it 3 times already","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:05.459264+11:00","updated_at":"2025-12-17T17:12:46.123383+11:00"}
{"id":"az-ph1","title":"Add agent phase detection and display","description":"Detect and display Claude agent phases (Planning/Action/Verification) on TaskCards. Parse Claude output patterns to identify current phase and show visual indicator.\n\nInspiration: AutoMaker shows phase status on cards with Planning → Action → Verification workflow.\n\nImplementation:\n1. Extend StateDetector to detect phase transitions from output patterns\n2. Add phase field to session state (idle/planning/implementing/testing/done)\n3. Display phase badge/indicator on TaskCard when session is active\n4. Update phase in real-time as output is parsed","notes":"Explored codebase. Key files:\n- StateDetector.ts: Pattern-based detection, returns SessionState (idle/busy/waiting/done/error)\n- types.ts: SessionState, SessionMetrics, TaskWithSession, SESSION_INDICATORS\n- TaskCard.tsx: Shows indicator from SESSION_INDICATORS, has header line with id/type/indicator\n- DetailPanel.tsx: Shows session metrics when active\n\nImplementation plan:\n1. Add AgentPhase type and PHASE_INDICATORS to types.ts\n2. Add agentPhase field to SessionMetrics interface\n3. Extend StateDetector with phase detection patterns\n4. Update TaskCard to show phase indicator\n5. Update DetailPanel to show phase in metrics section","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T12:00:00Z","updated_at":"2025-12-17T10:53:47.419713+11:00","closed_at":"2025-12-17T10:53:47.419713+11:00"}
{"id":"az-2p4","title":"the space m to merge feature should move the bead to closed too","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:41:22.254096+11:00","updated_at":"2025-12-17T17:01:33.047876+11:00","closed_at":"2025-12-17T17:01:33.047876+11:00"}
{"id":"az-moj","title":"State transition hooks system","description":"Pluggable hook system for state transition events.","notes":"Implemented state transition hooks system with the following components:\n\n**Core Services:**\n- `HookRegistry` (src/core/HookRegistry.ts): Main service for hook registration/triggering with Effect.Service pattern\n- `HookOrchestrator` (src/core/HookOrchestrator.ts): Wires HookRegistry to SessionManager's PubSub, registers user shell hooks from config\n\n**Built-in Hooks:**\n- `BuiltInHooks` (src/hooks/BuiltInHooks.ts): Registers NotificationHook, PRCreationHook, BeadsSyncHook\n\n**Configuration:**\n- Added `hooks` section to config schema (schema.ts, defaults.ts)\n- User can define shell commands for each event type: onWaiting, onDone, onError, onPaused\n- Shell hooks receive context via environment variables: HOOK_TASK_ID, HOOK_TASK_TITLE, etc.\n- Can disable built-in hooks with `hooks.disableBuiltIn: true`\n\n**Key Design:**\n- Hook types as tagged union: \"onWaiting\" | \"onDone\" | \"onError\" | \"onPaused\"\n- HookContext: { task, session, worktree, stateChange }\n- Parallel execution with Effect.forEach({ concurrency: \"unbounded\" })\n- Error isolation via Effect.catchAll per hook\n- PubSub subscription for event monitoring\n\nAll types pass strict TypeScript checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.613629+11:00","updated_at":"2025-12-17T00:46:56.514818+11:00","closed_at":"2025-12-17T00:46:56.514818+11:00","dependencies":[{"issue_id":"az-moj","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.589726+11:00","created_by":"daemon"},{"issue_id":"az-moj","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.411943+11:00","created_by":"daemon"}]}
{"id":"az-fvj","title":"BeadsClient - wrapper around bd CLI","description":"Create a TypeScript wrapper around the bd CLI for reading and updating beads issues.","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full Effect service wrapping bd CLI\n- Schema validation for Issue type\n- All major bd commands wrapped with typed errors\n\nFILES CREATED:\n- src/core/BeadsClient.ts (447 lines) - Complete service\n- src/core/BeadsClient.example.ts (152 lines) - 8 usage examples\n\nSERVICE METHODS:\n- list(filters?) - List issues with status/priority/type filters\n- show(id) - Get single issue details\n- update(id, fields) - Update status/notes/priority\n- close(id, reason?) - Close issue\n- sync() - Push/pull beads database\n- ready() - Get unblocked issues\n- search(query) - Search issues\n\nERROR TYPES:\n- BeadsError - Generic bd command failures\n- NotFoundError - Issue not found\n- ParseError - JSON/Schema validation errors\n\nLAYERS:\n- BeadsClientLive - Service only (needs BunContext)\n- BeadsClientLiveWithPlatform - Complete with platform deps (recommended)\n\nVERIFICATION:\n- Type check passes\n- Runtime test fetched 10 ready issues from actual beads database","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.409567+11:00","updated_at":"2025-12-11T17:27:44.655776+11:00","closed_at":"2025-12-11T17:25:14.06403+11:00","dependencies":[{"issue_id":"az-fvj","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.006035+11:00","created_by":"daemon"},{"issue_id":"az-fvj","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.575251+11:00","created_by":"daemon"}]}
{"id":"az-esy","title":"Implement inline attachment mode in AttachmentService","description":"src/core/AttachmentService.ts line 204 has TODO for inline attachment.\n\nCurrently only external tmux attachment works. Inline mode should:\n- Capture session output in current terminal\n- Overlay UI on top of session stream\n- Allow quick interactions without leaving TUI","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.670743+11:00","updated_at":"2025-12-17T15:59:44.670743+11:00"}
{"id":"az-ee4","title":"Configuration \u0026 Polish","description":"User configuration (cosmiconfig + zod), multi-project support, help system, and final polish.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:05.070257+11:00","updated_at":"2025-12-11T14:44:05.070257+11:00"}
{"id":"az-aiu","title":"Implement session templates for pre-planning prompts","description":"Create .claude/session-templates/ with task-type-specific CLAUDE.md templates (feature.md, bugfix.md, refactor.md, epic.md). Templates inject 'think first' planning phase. SessionManager loads appropriate template when spawning.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.891181+11:00","updated_at":"2025-12-12T13:25:20.531813+11:00"}
{"id":"az-zqi","title":"Full bead editor (Space+e)","description":"Open selected bead in $EDITOR with structured markdown format. Parse on save, validate structure, discard if invalid, update via bd CLI if valid.","notes":"Type change handling:\nIf user changes Type: field (e.g., task → epic), the editor must:\n1. Detect type changed during parse\n2. bd create --type=newType with all other fields → get new ID\n3. Copy dependencies: bd dep add new-id (for each dep)\n4. bd delete old-id\n5. Navigate TUI to new bead\n\nThis is necessary because bd update cannot change issue_type after creation.\n\nFormat is Azedarach-owned since bd has no full-bead format - only per-field edit (bd edit --notes) or CLI flags (bd update --notes='...').","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:59:31.596266+11:00","updated_at":"2025-12-12T12:20:24.690791+11:00","closed_at":"2025-12-12T12:20:24.690791+11:00","dependencies":[{"issue_id":"az-zqi","depends_on_id":"az-shv","type":"blocks","created_at":"2025-12-12T10:59:35.281709+11:00","created_by":"daemon"}]}
{"id":"az-ghj","title":"clean up open tasks and offer to create 5-10 new tasks based on gaps in our program/tech debt","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:59.901658+11:00","updated_at":"2025-12-17T16:13:04.792748+11:00","closed_at":"2025-12-17T16:13:04.792751+11:00"}
{"id":"az-3rk","title":"Add rate_limited session state","description":"Add 'rate_limited' to SessionState type and SESSION_INDICATORS map (⏱ glyph). Extend StateDetector patterns to detect rate limiting from Claude output (patterns like 'Rate limit', 'Too many requests', 'Please wait').","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.309325+11:00","updated_at":"2025-12-12T13:25:19.967333+11:00"}
{"id":"az-a8i","title":"StateDetector - Claude output pattern matching","description":"Detect Claude session state by monitoring PTY output and matching patterns.","notes":"✅ StateDetector service complete and tested.\n\nFiles created:\n- src/core/StateDetector.ts (main service)\n- src/core/StateDetector.example.ts (usage examples)\n\nFeatures implemented:\n✓ SessionState type: idle | busy | waiting | done | error\n✓ Effect.Service with Effect.Tag pattern\n✓ detectFromChunk() - stateless pattern matching\n✓ createDetector() - stateful detector with debouncing\n✓ Priority-based pattern matching (waiting \u003e error \u003e done \u003e busy)\n✓ StateDetectorLive layer (no dependencies)\n✓ Convenience functions for easy usage\n✓ Debouncing: busy state coalesces rapid output\n✓ Terminal state stickiness: done/error persist until reset\n✓ Comprehensive examples demonstrating all features\n\nPattern matching:\n- waiting: [y/n], 'Do you want to', 'Press Enter', etc.\n- error: 'Error:', 'Exception:', 'Failed:', 'ENOENT', etc.\n- done: 'Task completed', 'Successfully', 'Done.', etc.\n- busy: any non-empty output not matching above\n\nType checking: ✅ No errors\nRuntime testing: ✅ All examples run successfully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.92773+11:00","updated_at":"2025-12-12T01:29:02.419812+11:00","closed_at":"2025-12-12T01:29:02.419812+11:00","dependencies":[{"issue_id":"az-a8i","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.44929+11:00","created_by":"daemon"}]}
