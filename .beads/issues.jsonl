{"id":"az-25ph","title":"toggling any dev server needs to come with all PORT envs for all servers","description":"so when i toggle Chefy's web server it should grab a port for the server server too and set that env var in the web server. if i then toggle server server we use both the same env vars as the web server","design":"## Problem\nWhen toggling a dev server (e.g., \"web\"), only that server's port env vars are set (e.g., VITE_PORT=5173). But the web server may need to know the API server's port to configure API URLs.\n\n## Solution\nChange port allocation to be **per-bead** rather than **per-server**:\n\n1. **First server for a bead**: Allocate ALL ports from ALL configured servers and store them\n2. **Subsequent servers**: Reuse the same port allocations from the first server\n\n## Implementation\n\n### 1. Add bead-level port allocation tracking\nStore allocated ports per-bead in a new Ref:\n```typescript\n// Map from beadId -\u003e { envVar -\u003e allocatedPort }\nconst beadPortsRef = yield* Ref.make\u003cMap\u003cstring, Record\u003cstring, number\u003e\u003e\u003e(new Map())\n```\n\n### 2. Modify `getPortEnv` to work at bead level\n```typescript\nconst getOrAllocateBeadPorts = (beadId: string, allServers: Record\u003cstring, ServerConfig\u003e) =\u003e\n  Effect.gen(function* () {\n    const existing = yield* Ref.get(beadPortsRef)\n    if (existing.has(beadId)) {\n      return existing.get(beadId)!\n    }\n    \n    // First server for this bead - allocate ALL ports from ALL servers\n    const ports: Record\u003cstring, number\u003e = {}\n    const beadServers = yield* getBeadServers(beadId)\n    const offset = HashMap.size(HashMap.filter(beadServers, s =\u003e s.status === \"running\"))\n    \n    for (const serverConfig of Object.values(allServers)) {\n      for (const [envVar, basePort] of Object.entries(serverConfig.ports ?? {})) {\n        if (!ports[envVar]) {\n          ports[envVar] = yield* allocatePort(basePort + offset)\n        }\n      }\n    }\n    \n    yield* Ref.update(beadPortsRef, m =\u003e new Map(m).set(beadId, ports))\n    return ports\n  })\n```\n\n### 3. Update `start()` to use bead-level ports\n```typescript\n// In start():\nconst allServerConfigs = config.servers ?? {}\nconst beadPorts = yield* getOrAllocateBeadPorts(beadId, allServerConfigs)\n\n// Build env string with ALL ports\nconst envStr = Object.entries(beadPorts)\n  .map(([k, v]) =\u003e `${k}=${v}`)\n  .join(\" \")\n\n// Primary port is still this server's first port\nconst thisPorts = srvConfig.ports ?? {}\nconst primary = beadPorts[Object.keys(thisPorts)[0]] ?? 3000\n```\n\n### 4. Update `stop()` to release ports only when last server stops\n```typescript\n// In stop():\nconst remainingServers = HashMap.filter(beadServers, s =\u003e \n  s.name !== name \u0026\u0026 s.status === \"running\"\n)\nif (HashMap.size(remainingServers) === 0) {\n  // Last server stopping - release all bead ports\n  const beadPorts = yield* Ref.get(beadPortsRef)\n  for (const port of Object.values(beadPorts.get(beadId) ?? {})) {\n    yield* releasePort(port)\n  }\n  yield* Ref.update(beadPortsRef, m =\u003e { m.delete(beadId); return m })\n}\n```\n\n### 5. Handle discovery on startup\nWhen discovering existing servers, reconstruct beadPortsRef from their stored ports.\n\n## Files to modify\n- `src/services/DevServerService.ts` - Core logic changes\n\n## Edge cases\n- Two servers with same env var name â†’ first one wins (deduplicated)\n- Server stops then restarts â†’ reuses same bead ports if other servers still running\n- All servers stop â†’ ports released, next start gets fresh allocation","notes":"ğŸ“ [mjj85j35-tbcz.png](.beads/images/az-25ph/mjj85j35-tbcz.png) (clipboard, 12/24/2025, 10:37:07 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:37:04.237362+11:00","updated_at":"2025-12-29T15:05:23.67676+11:00","closed_at":"2025-12-29T15:05:23.676763+11:00"}
{"id":"az-29ey","title":"add more cli commands so that ai can do stuff like restart dev servers","design":"## CLI Commands for Dev Server Control\n\n### Commands to implement:\n- `az dev start \u003cbead-id\u003e [--server=\u003cname\u003e]` - Start dev server (default: 'default')\n- `az dev stop \u003cbead-id\u003e [--server=\u003cname\u003e]` - Stop dev server\n- `az dev restart \u003cbead-id\u003e [--server=\u003cname\u003e]` - Stop + start (atomic restart)\n- `az dev status \u003cbead-id\u003e` - Show all servers for a bead with status/port/uptime\n- `az dev list` - Show all running dev servers across all beads\n\n### Design decisions:\n1. All commands go through DevServerService to maintain state consistency\n2. Default server name is 'default' (matches DevServerService.DEFAULT_SERVER_NAME)\n3. Support `--json` flag for machine-readable output (AI parsing)\n4. Use existing Layer composition pattern from other CLI commands\n5. status/list show: server name, status, port, bead-id, uptime\n\n### Implementation:\n1. Add dev command handlers in src/cli/index.ts\n2. Create parent command `az dev` with subcommands\n3. Wire up DevServerService via Layer.provideMerge pattern\n4. Add to CLI_SUBCOMMANDS in bin/az.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T11:52:26.448429+11:00","updated_at":"2025-12-29T15:19:47.913945+11:00","closed_at":"2025-12-29T15:19:47.913945+11:00","close_reason":"Added dev server CLI commands: az dev start/stop/restart/status/list. Commands sync state via tmux metadata to keep TUI consistent."}
{"id":"az-2d6r","title":"LustreTUI - OpenTUI-style TUI framework for Gleam","description":"Build a Gleam TUI framework modeled after OpenTUI (github.com/sst/opentui) that uses Lustre for the declarative layer.\n\n## Why\n- Shore has limitations: no hex colors, Row layout divides width equally (breaks inline text), Fill sizing issues\n- OpenTUI's architecture is clean and proven (used by opencode, terminaldotshop)\n- Lustre is Gleam's mature TEA framework - perfect for the declarative adapter\n\n## Architecture\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    lustre_tui                                â”‚  â† Lustre reconciler + runtime\nâ”‚  Element types â”‚ Reconciler â”‚ Runtime loop                  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                    tui_core                                  â”‚  â† Pure Gleam primitives\nâ”‚  Color â”‚ Text â”‚ FrameBuffer â”‚ Renderables â”‚ Layout â”‚ Borderâ”‚\nâ”‚  Renderer â”‚ Input â”‚ Resize                                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Build Order (Dependency Graph)\n```\nPhase 0 - Research Spikes (parallelize):\n  az-lvah: Etch library evaluation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  az-9gxm: Gleam FFI patterns (parallel)    â”œâ”€â”€â”\n  az-a0g1: Unicode width research â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\n                                               â”‚\nPhase 0.5 - Decision Checkpoint:               â”‚\n  az-kwwr: Finalize architecture â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    â†“ blocks\n    \nPhase 1 - Foundation (blocked by checkpoint):\n  az-hkfa: Color utilities (P0)\n  az-ebxf: Text utilities (P1)\n  az-zh3y: Input handling (P2)\n  \nPhase 2 - Core:\n  az-xe2h: FrameBuffer â†â”€â”€ Color\n  az-ud48: Renderables â†â”€â”€ FrameBuffer, Text\n  az-kmuk: Borders â†â”€â”€ FrameBuffer, Color\n  az-otrx: Terminal resize â†â”€â”€ Input\n  \nPhase 3 - Layout \u0026 Rendering:\n  az-se6w: Layout engine â†â”€â”€ Renderables\n  az-5xza: Renderer â†â”€â”€ Layout, Borders\n  \nPhase 4 - Lustre Integration:\n  az-uwcd: Element types â†â”€â”€ Renderables\n  az-7tzh: Reconciler â†â”€â”€ Element types\n  az-d19m: Runtime â†â”€â”€ Reconciler, Renderer, Input, Resize\n  \nPhase 5 - Validation \u0026 Migration:\n  az-8zkp: Demo app â†â”€â”€ Runtime\n  az-lyq4: Port Azedarach â†â”€â”€ Demo\n```\n\n## Task Summary (17 MVP tasks + 3 deferred)\n\n### Phase 0 - Research Spikes\n| ID | Task | Priority | Blocks |\n|----|------|----------|--------|\n| az-lvah | Etch library evaluation | P0 | Decision |\n| az-9gxm | Gleam FFI patterns | P0 | Decision |\n| az-a0g1 | Unicode width research | P0 | Decision |\n\n### Phase 0.5 - Decision Checkpoint\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-kwwr | Finalize tui_core architecture | P0 | All spikes |\n\n### Phase 1-2 - Foundation \u0026 Core\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-hkfa | Color utilities | P0 | Decision checkpoint |\n| az-ebxf | Text utilities | P1 | Decision checkpoint |\n| az-zh3y | Input handling | P2 | Decision checkpoint |\n| az-xe2h | FrameBuffer | P1 | Color |\n| az-ud48 | Renderable types | P1 | FrameBuffer, Text |\n| az-kmuk | Border drawing | P2 | FrameBuffer, Color |\n| az-otrx | Terminal resize | P1 | Input |\n\n### Phase 3-4 - Layout \u0026 Integration\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-se6w | Layout engine | P1 | Renderables |\n| az-5xza | Renderer | P1 | Layout, Borders |\n| az-uwcd | Element types | P2 | Renderables |\n| az-7tzh | Reconciler | P2 | Elements |\n| az-d19m | Runtime | P2 | Reconciler, Renderer, Input, Resize |\n\n### Phase 5 - Validation\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-8zkp | Demo app | P3 | Runtime |\n| az-lyq4 | Port Azedarach | P3 | Demo |\n\n## Deferred/Future Work (Post-MVP)\n\nThese features are tracked as P4 issues, blocked by their dependencies:\n\n| ID | Feature | Blocked By | Rationale |\n|----|---------|------------|-----------|\n| az-wwui | Mouse events | Runtime (az-d19m) | Keyboard navigation sufficient for MVP |\n| az-vw20 | Scroll containers | Layout (az-se6w) | Kanban columns are fixed height |\n| az-2iv8 | Focus management | Runtime (az-d19m) | No form inputs in MVP |\n\n## Reference\n- OpenTUI source: https://github.com/sst/opentui\n- Etch (Gleam terminal backend): https://github.com/bananaofhappiness/etch\n- Lustre: https://github.com/lustre-labs/lustre","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-28T11:25:31.045025+11:00","updated_at":"2025-12-28T12:13:22.857101+11:00","labels":["framework","gleam","lustre","tui"]}
{"id":"az-2ek","title":"Add warning glyphs to TaskCard header","description":"Add tiny warning glyphs (âš ğŸ”„) to TaskCard headerLine after session indicator. âš  for context warning (\u003e70%), ğŸ”„ for recently compacted. Space cost: 1-2 characters.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.779379+11:00","updated_at":"2025-12-12T13:25:20.429502+11:00","dependencies":[{"issue_id":"az-2ek","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.178601+11:00","created_by":"daemon"}]}
{"id":"az-2il","title":"Agent Mail status broadcast integration","description":"Workers broadcast status via Agent Mail for real-time TUI updates.\n\n**Events:**\n- STARTED: Worker began task\n- PROGRESS: Periodic heartbeat with context %\n- BLOCKED: Worker discovered blocker\n- COMPLETED: Worker finished task\n- ERROR: Worker encountered error\n\n**TUI subscription:**\n- Poll Agent Mail for status updates (or WebSocket if available)\n- Update TaskCard session indicators in real-time\n- Show toast for important events (blocked, error)\n\n**Depends on:** Agent Mail integration (az-l7a)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:15.170002+11:00","updated_at":"2025-12-14T02:13:25.698677+11:00","dependencies":[{"issue_id":"az-2il","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T13:29:24.916405+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-2il","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.86955+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-2iv8","title":"Focus management for input elements","description":"**Status:** Deferred to post-MVP\n\n## Overview\nAdd focus management for interactive elements (text inputs, buttons, etc.).\n\n## Features\n- Focus state tracking (which element is focused)\n- Tab/Shift+Tab navigation between focusable elements\n- Focus ring styling (visual indicator of focused element)\n- Focus events (onFocus, onBlur handlers)\n\n## API Addition\n```gleam\n// Attributes\nfn focusable() -\u003e Attribute(msg)\nfn autofocus() -\u003e Attribute(msg)\nfn on_focus(msg: msg) -\u003e Attribute(msg)\nfn on_blur(msg: msg) -\u003e Attribute(msg)\nfn tab_index(index: Int) -\u003e Attribute(msg)\n\n// In Runtime or a FocusManager service\nfn focus(element_id: String) -\u003e Effect(msg)\nfn blur() -\u003e Effect(msg)\nfn get_focused() -\u003e Option(String)\n```\n\n## Complexity\nMedium. Requires:\n- Element ID system (for focus targeting)\n- Focus order calculation (tab index + DOM order)\n- Keyboard event routing (Tab, Shift+Tab)\n- Style modifications for focused state\n\n## Dependencies\n- Input elements must exist first (text input, button)\n- Currently no input elements are planned for MVP\n\n## Why Deferred\nAzedarach MVP uses global keyboard shortcuts, not focusable form elements. No text inputs or buttons requiring focus.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T12:07:34.567029+11:00","updated_at":"2025-12-28T12:07:34.567029+11:00","labels":["deferred","gleam","input","lustre-tui"],"dependencies":[{"issue_id":"az-2iv8","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T12:07:48.85588+11:00","created_by":"daemon"},{"issue_id":"az-2iv8","depends_on_id":"az-d19m","type":"blocks","created_at":"2025-12-28T12:07:49.074529+11:00","created_by":"daemon"}]}
{"id":"az-3k2l","title":"add a icon to the header of a task when there is an active PR","design":"## Implementation Design\n\n### Goal\nShow a visual indicator (ğŸ”—) in TaskCard headers when a task has an associated PR, and provide quick access to open the PR in browser.\n\n### Approach: Parse notes field (minimal changes)\n\nPR URLs are stored in the `notes` field with format `PR: https://github.com/...`. We'll:\n1. Parse notes with regex to detect PR presence\n2. Show icon in header line\n3. Add action to open PR in browser\n\n**Why this approach:**\n- No GitHub API calls (fast, no rate limiting)\n- Follows existing indicator patterns in TaskCard\n- Minimal code changes\n\n### Changes Required\n\n**1. src/ui/types.ts**\n- Add `PR_INDICATOR = \"ğŸ”—\"` constant\n\n**2. src/ui/TaskCard.tsx**\n- Add helper function: `extractPRUrl(notes?: string): string | undefined`\n  - Uses regex: `PR:\\s*(https://[^\\s]+)`\n  - Returns first match or undefined\n- Add `hasPR` boolean based on notes field\n- Append `PR_INDICATOR` to header line after operation indicators, before attachments\n\n**3. src/ui/ActionPalette.tsx**\n- Add new action `o` (Open PR) that:\n  - Only available when task has PR URL in notes\n  - Opens URL in default browser via `open` command\n- Add to actions list with label \"Open PR\"\n\n**4. src/ui/atoms/pr.ts** (or new file)\n- Add `openPRInBrowserAtom` that:\n  - Extracts PR URL from task notes\n  - Shells out to `open \u003curl\u003e` (macOS) / `xdg-open` (Linux)\n\n**5. src/ui/App.tsx**\n- Wire up 'o' key in action mode to trigger openPRInBrowser\n\n### PR Detection Logic\n\n```typescript\nconst PR_URL_PATTERN = /PR:\\s*(https:\\/\\/[^\\s]+)/i\n\nexport const extractPRUrl = (notes?: string): string | undefined =\u003e {\n  if (!notes) return undefined\n  const match = notes.match(PR_URL_PATTERN)\n  return match?.[1]\n}\n```\n\n### Icon Position in Header\n\n```\n[P1] [az-xxx] [task] [ğŸ”µ] [âš”ï¸] [ğŸ“‹] [ğŸ’»] [â³] [ğŸ”—] [ğŸ“2] [*]\n ^     ^       ^      ^     ^     ^     ^     ^    ^     ^    ^\n |     |       |      |     |     |     |     |    |     |    multiSelect\n |     |       |      |     |     |     |     |    |     attachments\n |     |       |      |     |     |     |     |    PR (NEW)\n |     |       |      |     |     |     |     operation\n |     |       |      |     |     |     devServer\n |     |       |      |     |     phase\n |     |       |      |     conflict\n |     |       |      session\n |     |       type\n |     id\n priority\n```\n\n### Testing\n- Create a task, start session, create PR with `P` action\n- Verify ğŸ”— icon appears in header\n- Press `o` in action mode to open PR in browser\n- Verify action is disabled when no PR exists","acceptance_criteria":"- [ ] ğŸ”— icon appears in TaskCard header when task has PR URL in notes\n- [ ] Icon positioned after operation indicators, before attachments\n- [ ] 'o' action in ActionPalette opens PR in browser (when available)\n- [ ] 'o' action disabled/hidden when task has no PR\n- [ ] Works with existing PR creation flow (PR: URL format in notes)\n- [ ] No performance regression (no API calls, just regex parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:29:08.934201+11:00","updated_at":"2025-12-29T15:05:38.050429+11:00","closed_at":"2025-12-29T15:05:38.050432+11:00"}
{"id":"az-3rk","title":"Add rate_limited session state","description":"Add 'rate_limited' to SessionState type and SESSION_INDICATORS map (â± glyph). Extend StateDetector patterns to detect rate limiting from Claude output (patterns like 'Rate limit', 'Too many requests', 'Please wait').","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.309325+11:00","updated_at":"2025-12-12T13:25:19.967333+11:00"}
{"id":"az-4mqg","title":"in remote workflowMode i need a way to compile an epic's work into one PR","description":"i dont want to create a PR per epic task against base branch\nso maybe we enable the merge flow for this but where base branch for epic children is the epic branch","design":"## Epic-Consolidated PR Workflow\n\n### Problem\nIn remote workflowMode, each task creates its own PR against main. For epics with multiple child tasks, this creates PR sprawl. We need a way to consolidate an epic's work into a single PR.\n\n### Solution: Context-Aware Branch Targeting\n\nWhen a bead has a `parent-child` dependency to an epic:\n1. **Worktree Creation**: Branch from epic branch (not main)\n2. **Space+m (Merge)**: Merge to epic branch (not main)\n3. **Space+P (PR)**: Create PR targeting epic branch (not main)\n\nFor epics themselves (or tasks without epic parent):\n- Behavior unchanged: target main branch\n\n### Implementation Plan\n\n#### 1. Add `getParentEpic()` helper to BeadsClient\n- Given a beadId, find its parent epic via `parent-child` dependency\n- Return `Option\u003cBeadInfo\u003e` (None if no epic parent)\n\n#### 2. Add `getEffectiveBaseBranch()` to AppConfig or PRWorkflow\n- If bead has parent epic â†’ return epic branch name (e.g., `az-epic`)\n- Otherwise â†’ return configured baseBranch (e.g., `main`)\n- Respects workflowMode for origin/ prefix\n\n#### 3. Modify WorktreeManager/ClaudeSessionManager\n- When creating worktree for child task, use epic branch as start point\n- `git worktree add -b {childId} {path} {epicBranch}`\n- **If epic branch doesn't exist**: Auto-create epic worktree first, then create child worktree\n\n#### 4. Modify PRWorkflow.createPR()\n- Use `getEffectiveBaseBranch()` for `--base` flag\n- PR from child branch â†’ epic branch\n\n#### 5. Modify PRWorkflow.mergeToMain()\n- Rename or generalize to `mergeToTarget()`\n- Use `getEffectiveBaseBranch()` as merge target\n- When merging epic â†’ main: auto-close all child beads\n\n#### 6. Update UI/StatusBar\n- Show effective target branch in status (helpful for users to see \"â†’ az-epic\" vs \"â†’ main\")\n\n### Edge Cases\n\n1. **Epic branch doesn't exist yet**: Auto-create epic worktree/branch from main, then branch child from it\n2. **Child of non-existent epic**: Error gracefully, fall back to main\n3. **Nested epics**: Support N levels by walking parent chain to find root epic, OR limit to 1 level\n4. **Multiple parents**: If task has multiple epic parents, use first one (or error)\n\n### Testing Checklist\n- [ ] Create epic, spawn session â†’ worktree branches from main\n- [ ] Create child task of epic â†’ worktree branches from epic branch\n- [ ] Space+m on child â†’ merges to epic branch\n- [ ] Space+P on child â†’ PR targets epic branch\n- [ ] Space+m on epic â†’ merges to main, closes children\n- [ ] Space+P on epic â†’ PR targets main\n- [ ] Child spawned before epic â†’ auto-creates epic branch\n\n### Acceptance Criteria\n- [ ] Child tasks automatically target their parent epic's branch\n- [ ] Epic merges to main consolidate all child work\n- [ ] Works in both workflowMode: origin and local\n- [ ] UI shows effective merge target","acceptance_criteria":"- [x] Child tasks automatically target their parent epic's branch for worktree creation\n- [x] Child tasks create PRs targeting epic branch (not main) \n- [x] Child tasks merge to epic branch via Space+m (not main)\n- [x] Epic merges to main consolidate all child work\n- [x] When epic merges to main with closeBead=true, all children are auto-closed\n- [x] DiffViewer shows correct base branch (epic branch for children)\n- [x] If child spawned before epic, epic worktree is auto-created first\n- [x] Works in both workflowMode: origin and local\n- [x] Type-check and build pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T17:20:49.005057+11:00","updated_at":"2025-12-30T00:04:49.632078+11:00","closed_at":"2025-12-30T00:04:49.632078+11:00","close_reason":"Implemented context-aware branch targeting for epic-consolidated PRs"}
{"id":"az-4r0","title":"AgentMailClient Effect service","description":"Create Effect service wrapper for Agent Mail HTTP API.\n\nDesign:\n- Define AgentMailClient as Effect.Service\n- Use @effect/platform HttpClient for requests\n- Methods:\n  - reserve(issueId): Effect\u003cReservation, ReservationError\u003e\n  - release(issueId): Effect\u003cvoid, ReleaseError\u003e\n  - ready(): Effect\u003cIssue[], AgentMailError\u003e\n  - updateStatus(issueId, status): Effect\u003cvoid, AgentMailError\u003e\n  - isAvailable(): Effect\u003cboolean, never\u003e (health check)\n- Read config from environment variables\n- Graceful degradation: return fallback when server unavailable\n- Retry logic with exponential backoff\n- Create AgentMailClientLive and AgentMailClientTest layers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.475812+11:00","updated_at":"2025-12-12T10:33:13.475812+11:00","dependencies":[{"issue_id":"az-4r0","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.800097+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-519a","title":"sometimes az loses track of sessions like the one in the image","description":"the one in the image DOES have a tmux session thats running claude","design":"## Root Cause Analysis\n\nThe issue was a race condition in session recovery where `TmuxSessionMonitor` would detect sessions and call `updateStateFromTmux()`, but if the session wasn't already registered in `sessionsRef`, the update would **fail silently** with a `SessionNotFoundError` that gets swallowed.\n\n**Flow that caused the bug:**\n1. `TmuxSessionMonitor.start()` polls tmux sessions and reads `@az_status`\n2. For each session, handler calls `manager.updateStateFromTmux(beadId, status)`\n3. If session isn't in `sessionsRef`, it throws `SessionNotFoundError`\n4. Error is caught and swallowed by `.pipe(Effect.catchAll(() =\u003e Effect.void))`\n5. Session never gets added â†’ UI shows task as \"idle\"\n\n**Why it happened on startup:**\n- `BoardService.listActive()` also recovers orphaned sessions, but there's a race\n- If `TmuxSessionMonitor` runs before `listActive()` completes, sessions are missed\n- Sessions started from worktrees or manually outside Azedarach always fail\n\n## Implementation\n\nModified `updateStateFromTmux` to accept optional session metadata:\n- If session doesn't exist BUT metadata is provided â†’ create orphaned session\n- Log recovery event for debugging\n- Persist recovered session to disk\n- Publish state change event (idle â†’ current state)\n\nUpdated handler in `session.ts` to pass full `SessionStateUpdate` metadata including:\n- `sessionName`: tmux session name\n- `createdAt`: unix timestamp\n- `worktreePath`: from `@az_worktree` option\n- `projectPath`: from `@az_project` option\n\nThis ensures ANY tmux session matching the bead naming pattern gets recovered automatically when detected by the monitor.","notes":"Implementation complete. Key changes:\n\n1. `src/core/ClaudeSessionManager.ts`:\n   - Extended `updateStateFromTmux` signature to accept `sessionMeta`\n   - When session not found but meta provided, creates orphaned session\n   - Uses metadata for worktreePath/projectPath with sensible fallbacks\n\n2. `src/ui/atoms/session.ts`:\n   - Updated handler to pass full update metadata to `updateStateFromTmux`\n\nBuild passes. Type check has pre-existing errors unrelated to this change.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T15:19:00.677143+11:00","updated_at":"2025-12-29T18:06:43.223042+11:00","closed_at":"2025-12-29T18:06:43.223044+11:00","close_reason":"Fixed silent failure in session recovery. updateStateFromTmux now creates orphaned sessions when metadata is provided, ensuring all tmux sessions matching bead naming pattern are recovered automatically."}
{"id":"az-53o","title":"Notification system (terminal bell, system notifications)","description":"Alert user when sessions need attention.","design":"- Define NotificationService as Effect.Service\n- Methods:\n  - notify(title, body, urgency): Effect\u003cvoid, NotificationError\u003e\n  - bell(): Effect\u003cvoid\u003e // terminal bell \\x07\n- Notification backends:\n  - macOS: osascript via @effect/platform Command\n  - Cross-platform fallback: node-notifier (optional dep)\n- Use Effect.race with timeout for notification delivery\n- Notification triggers: subscribe to SessionManager PubSub\n- Configurable via Config service:\n  - enable/disable per event type\n  - sound option\n  - cooldown duration\n- Use Schedule.spaced for cooldown to prevent spam","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.717497+11:00","updated_at":"2025-12-11T14:54:42.593575+11:00","dependencies":[{"issue_id":"az-53o","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.727137+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-58v","title":"Implement issue type change in EditorService","description":"src/core/EditorService.ts line 773 has TODO:\n\"Implement type change (delete old, create new, preserve deps)\"\n\nChanging issue type (taskâ†’bug, featureâ†’epic) requires:\n1. Capture existing dependencies\n2. Delete original issue\n3. Create new issue with same ID pattern but new type\n4. Re-link dependencies\n\nThis is a data migration operation that needs careful handling.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.827186+11:00","updated_at":"2025-12-17T15:59:44.827186+11:00"}
{"id":"az-5ctw","title":"design how to show dependencies in epic drill down view","description":"then implement it","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:44:41.367965+11:00","updated_at":"2025-12-19T11:44:41.367965+11:00"}
{"id":"az-5jl","title":"File bug report for bd merge driver deleting beads incorrectly","description":"The `bd merge` driver uses standard 3-way merge semantics which can incorrectly delete beads.\n\n**Issue:** When a bead exists in base (ancestor) and main, but NOT in the branch being merged, the driver interprets this as \"branch deleted the bead\" and removes it. But the real scenario is often \"branch was created before this bead existed.\"\n\n**Expected behavior:** Beads should use additive merge semantics - beads are never deleted by merge, only added/updated. If a bead exists in either branch, it should appear in the result.\n\n**Workaround:** Azedarach now calls `bd sync --import-only` after merge to recover lost beads (az-mlv fix).\n\n**Suggested fix:** The merge driver should check `bead.created_at` against the branch divergence point. If the bead was created after the fork, keep it regardless of whether the branch has it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-18T02:09:27.362267+11:00","updated_at":"2025-12-18T02:09:27.362267+11:00","labels":["bd","upstream"]}
{"id":"az-5xza","title":"tui_core: Renderer - terminal output with ANSI escape codes","description":"Render FrameBuffer to terminal using ANSI escape codes.\n\n## What\n- Convert Colors (from az-hkfa) to ANSI escape sequences\n- Diff current vs previous FrameBuffer, only emit changes (optimization)\n- Handle cursor positioning, clearing, alt screen buffer\n\n## API (Gleam)\n```gleam\ntype Renderer {\n  Renderer(\n    prev_buffer: Option(FrameBuffer),\n    stdout: Fd,  // or however Gleam handles stdout\n    alt_screen: Bool,\n    cursor_visible: Bool,\n  )\n}\n\nfn new() -\u003e Renderer\nfn render(renderer: Renderer, fb: FrameBuffer) -\u003e Renderer  // Returns updated renderer with prev state\nfn enter_alt_screen(renderer: Renderer) -\u003e Renderer\nfn exit_alt_screen(renderer: Renderer) -\u003e Renderer\nfn show_cursor(renderer: Renderer) -\u003e Renderer\nfn hide_cursor(renderer: Renderer) -\u003e Renderer\nfn move_cursor(renderer: Renderer, x: Int, y: Int) -\u003e Renderer\nfn clear_screen(renderer: Renderer) -\u003e Renderer\nfn flush(renderer: Renderer) -\u003e Renderer\n```\n\n## Rendering Strategy\n```\n1. Compare new FrameBuffer to prev_buffer\n2. For each changed cell:\n   - Move cursor if not adjacent to last write\n   - Set colors/attributes if changed\n   - Write character\n3. Store new buffer as prev for next diff\n4. Flush output\n```\n\n## ANSI Escape Sequences\n```\n\\\\x1b[H          - Move cursor to home (0,0)\n\\\\x1b[{y};{x}H   - Move cursor to position\n\\\\x1b[38;2;R;G;Bm - Set foreground RGB (true color)\n\\\\x1b[48;2;R;G;Bm - Set background RGB (true color)\n\\\\x1b[0m         - Reset all attributes\n\\\\x1b[?1049h     - Enter alt screen\n\\\\x1b[?1049l     - Exit alt screen\n\\\\x1b[?25h      - Show cursor\n\\\\x1b[?25l      - Hide cursor\n```\n\n## Dependencies\n- az-xe2h: FrameBuffer (what we render)\n- az-hkfa: Color (for ANSI conversion)\n- az-se6w: Layout (provides laid-out content to render)\n- az-kmuk: Borders (border drawing during render)\n\n## Reference\n- OpenTUI CliRenderer: packages/core/src/cli-renderer.ts\n\n## Acceptance Criteria\n- [ ] Render FrameBuffer to terminal correctly\n- [ ] Efficient diffing (only redraw changed cells)\n- [ ] Alt screen buffer works (clean enter/exit)\n- [ ] Cursor visibility control works\n- [ ] No visual artifacts or flicker\n- [ ] True color (24-bit) output works","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:26:07.647035+11:00","updated_at":"2025-12-28T11:35:21.612104+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-5xza","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.658778+11:00","created_by":"daemon"},{"issue_id":"az-5xza","depends_on_id":"az-xe2h","type":"blocks","created_at":"2025-12-28T11:26:28.695953+11:00","created_by":"daemon"},{"issue_id":"az-5xza","depends_on_id":"az-se6w","type":"blocks","created_at":"2025-12-28T11:33:58.495698+11:00","created_by":"daemon"},{"issue_id":"az-5xza","depends_on_id":"az-kmuk","type":"blocks","created_at":"2025-12-28T11:33:58.572521+11:00","created_by":"daemon"}]}
{"id":"az-6la","title":"Add context health border colors to TaskCard","description":"Encode context health into TaskCard border color when session is active: lavender (healthy, \u003c70%), yellow (warning, 70-90%), red (critical, \u003e90%). Requires contextPercent from TaskWithSession.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.426477+11:00","updated_at":"2025-12-12T13:25:20.07394+11:00","dependencies":[{"issue_id":"az-6la","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.111928+11:00","created_by":"daemon"}]}
{"id":"az-6t6","title":"Manual worktree cleanup action (Space+d)","description":"Add Space+d action to manually delete a worktree and its branch.\n\n**Use cases:**\n- Abandoned work that won't be merged\n- Failed PRs that need cleanup\n- Manual housekeeping\n\n**Implementation:**\n- Add to ActionPalette with state check (only available when worktree exists)\n- Confirm dialog before deletion (destructive action)\n- WorktreeManager.remove() + git branch -D\n- Update task card to remove blue dot\n- Toast notification on success/failure\n\n**Depends on:** [deleted:az-yf4] (PRWorkflow) for the cleanup utility function","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T12:26:24.70141+11:00","updated_at":"2025-12-28T11:48:04.451447+11:00","dependencies":[{"issue_id":"az-6t6","depends_on_id":"az-yf4","type":"blocks","created_at":"2025-12-12T12:26:35.152751+11:00","created_by":"daemon"}]}
{"id":"az-7oa","title":"Add test coverage for core services","description":"Currently only FileLockManager.test.ts exists. Add tests for:\n\n**High priority (business-critical):**\n- SessionManager - lifecycle, state transitions\n- BeadsClient - CLI parsing, error handling\n- CommandQueueService - serialization, race conditions\n- StateDetector - pattern matching accuracy\n\n**Medium priority:**\n- BoardService - filtering, sorting\n- NavigationService - cursor movement, boundary handling\n- WorktreeManager - git operations\n\nUse Effect's testing utilities and TestClock for time-based tests.","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:45.163878+11:00","updated_at":"2025-12-17T15:59:45.163878+11:00"}
{"id":"az-7tzh","title":"lustre_tui: Reconciler - convert Lustre Elements to Renderables","description":"Convert Lustre Element trees to tui_core Renderable trees.\n\n## Why Separate\nThe reconciler is the bridge between declarative Lustre views and the imperative rendering system. Element types are in az-uwcd, runtime is in az-d19m.\n\n## Core Function\n```gleam\n/// Convert a Lustre Element tree to a Renderable tree\nfn element_to_renderable(el: Element(msg)) -\u003e Renderable\n\n/// Internal: Convert attributes to styles\nfn attrs_to_box_style(attrs: List(Attribute(msg))) -\u003e BoxStyle\nfn attrs_to_text_style(attrs: List(Attribute(msg))) -\u003e TextStyle\n\n/// Extract event handlers from element tree (for input dispatch)\nfn collect_handlers(el: Element(msg)) -\u003e List(#(Selector, fn(Key) -\u003e Option(msg)))\n```\n\n## Implementation Notes\n- Pattern match on Element variant (Box, Text, Span)\n- Extract style attributes, build corresponding style types\n- Recursively process children\n- Track event handlers for input dispatch\n\n## Example Flow\n```\nview(model) â†’ Element(msg) tree\n    â†“ element_to_renderable\nRenderable tree\n    â†“ layout (az-se6w)\nLayoutNode tree (with positions)\n    â†“ render_tree\nFrameBuffer\n    â†“ renderer (az-5xza)\nTerminal output\n```\n\n## Acceptance Criteria\n- [ ] Box elements convert to Box renderables\n- [ ] Text/Span elements convert correctly\n- [ ] All style attributes map correctly\n- [ ] Nested elements handle correctly\n- [ ] Event handlers extracted for dispatch","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:26:08.268961+11:00","updated_at":"2025-12-28T11:32:54.539651+11:00","labels":["gleam","lustre-tui"],"dependencies":[{"issue_id":"az-7tzh","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.871442+11:00","created_by":"daemon"},{"issue_id":"az-7tzh","depends_on_id":"az-ud48","type":"blocks","created_at":"2025-12-28T11:26:28.831699+11:00","created_by":"daemon"},{"issue_id":"az-7tzh","depends_on_id":"az-5xza","type":"blocks","created_at":"2025-12-28T11:26:28.901966+11:00","created_by":"daemon"},{"issue_id":"az-7tzh","depends_on_id":"az-uwcd","type":"blocks","created_at":"2025-12-28T11:34:13.268266+11:00","created_by":"daemon"}]}
{"id":"az-8f4j","title":"board refresh failed","description":"timestamp=2025-12-22T00:37:24.824Z level=ERROR fiber=#561 message=\"BoardService refresh failed\" message=\"ParseError: Schema validation failed: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly description?: string | undefined; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly priority: number; readonly issue_type: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\"; readonly created_at: string; readonly updated_at: string; readonly closed_at?: string | null | undefined; readonly assignee?: string | null | undefined; readonly labels?: ReadonlyArray\u003cstring\u003e | undefined; readonly design?: string | undefined; readonly notes?: string | undefined; readonly acceptance?: string | undefined; readonly estimate?: number | undefined; readonly dependent_count?: number | undefined; readonly dependency_count?: number | undefined; readonly dependents?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined; readonly dependencies?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined }\u003e\\nâ””â”€ [0]\\n   â””â”€ { readonly id: string; readonly title: string; readonly description?: string | undefined; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly priority: number; readonly issue_type: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\"; readonly created_at: string; readonly updated_at: string; readonly closed_at?: string | null | undefined; readonly assignee?: string | null | undefined; readonly labels?: ReadonlyArray\u003cstring\u003e | undefined; readonly design?: string | undefined; readonly notes?: string | undefined; readonly acceptance?: string | undefined; readonly estimate?: number | undefined; readonly dependent_count?: number | undefined; readonly dependency_count?: number | undefined; readonly dependents?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined; readonly dependencies?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined }\\n      â””â”€ [\\\"priority\\\"]\\n         â””â”€ is missing\\nâ””â”€ [0]\\n   â””â”€ { readonly id: string; readonly title: string; readonly description?: string | undefined; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly priority: number; readonly issue_type: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\"; readonly created_at: string; readonly updated_at: string; readonly closed_at?: string | null | undefined; readonly assignee?: string | null | undefined; readonly labels?: ReadonlyArray\u003cstring\u003e | undefined; readonly design?: string | undefined; readonly notes?: string | undefined; readonly acceptance?: string | undefined; readonly estimate?: number | undefined; readonly dependent_count?: number | undefined; readonly dependency_count?: number | undefined; readonly dependents?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined; readonly dependencies?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined }\\n      â””â”€ [\\\"priority\\\"]\\n         â””â”€ is missing\\n    at \u003canonymous\u003e (/Users/riordan/prog/azedarach/src/core/BeadsClient.ts:424:11)\"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T11:38:31.466993+11:00","updated_at":"2025-12-22T11:38:31.466993+11:00"}
{"id":"az-8zkp","title":"lustre_tui: Demo app - validate framework before Azedarach port","description":"Build a simple demo app to validate LustreTUI works before porting the full Azedarach.\n\n## Why\nCatch issues early with a minimal test case rather than debugging in a complex app.\n\n## Demo Features\n```gleam\n// Simple counter with styled UI\ntype Model { Model(count: Int) }\ntype Msg { Increment | Decrement | Quit }\n\nfn view(model: Model) -\u003e Element(Msg) {\n  box([flex_direction(Column), padding(1), border(Rounded)], [\n    text([fg(\"#cad3f5\")], \"LustreTUI Demo\"),\n    box([flex_direction(Row), gap(2)], [\n      button([on_click(Decrement)], \"-\"),\n      text([fg(\"#8aadf4\"), bold()], int.to_string(model.count)),\n      button([on_click(Increment)], \"+\"),\n    ]),\n    text([fg(\"#6e738d\")], \"Press q to quit\"),\n  ])\n}\n```\n\n## Validation Checklist\n- [ ] Basic layout (Row, Column) works\n- [ ] Nested boxes render correctly\n- [ ] Hex colors display properly\n- [ ] Border styles work\n- [ ] Keyboard input dispatches messages\n- [ ] Screen clears and redraws without flicker\n- [ ] Alt screen buffer works (clean exit)\n\n## Acceptance Criteria\n- [ ] Demo compiles and runs\n- [ ] All validation checklist items pass\n- [ ] No visual glitches or artifacts\n- [ ] Clean exit (terminal restored)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T11:31:22.714961+11:00","updated_at":"2025-12-28T11:31:22.714961+11:00","labels":["demo","gleam","lustre-tui"],"dependencies":[{"issue_id":"az-8zkp","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.559459+11:00","created_by":"daemon"},{"issue_id":"az-8zkp","depends_on_id":"az-d19m","type":"blocks","created_at":"2025-12-28T11:34:13.559695+11:00","created_by":"daemon"}]}
{"id":"az-9b8","title":"Epic progress indicator in TaskCard","description":"Show progress bar for epic tasks: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 3/5\n\n**Implementation:**\n- Query child task statuses\n- Calculate completed/total\n- Render as Unicode progress bar\n- Only show for issue_type=epic\n\n**Space cost:** One line, replaces description line for epics","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.040003+11:00","updated_at":"2025-12-12T13:29:15.040003+11:00","dependencies":[{"issue_id":"az-9b8","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.835556+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-9co","title":"bd sync needs atomic operations to prevent race conditions","notes":"## Problem\n\nMultiple bd processes (daemon, beads-mcp servers, manual bd sync) can race to update the beads-sync branch, causing data loss.\n\n## Race Scenario\n\n1. Process A reads JSONL with [issue-1, issue-2]\n2. Process B creates issue-3, exports to JSONL\n3. Process A commits its JSONL to beads-sync (missing issue-3!)\n4. Process B runs bd sync, pulls from beads-sync\n5. Process B tombstones issue-3 (sees it as \"deleted\")\n\n## Root Cause\n\n- bd sync is not atomic\n- No locking between concurrent bd processes\n- beads-sync branch can be overwritten by stale data\n\n## Proposed Fix (upstream)\n\nOption 1: Git ref transactions\n- Use git's atomic ref updates\n- bd sync should fail if beads-sync moved since last read\n\nOption 2: File-based locking\n- Acquire lock before any sync operation\n- Release after commit+push complete\n\nOption 3: CRDT-based merge\n- Instead of overwrite, use conflict-free merge\n- Tombstones require consensus, not just \"missing from one branch\"\n\n## Workaround (Azedarach)\n\n- Use FileLockManager around bd sync calls\n- Prevents races within our own operations\n- Does NOT fix races with external bd processes\n\n## Related\n\n- az-zby: bd sync incorrectly tombstones issues","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T12:55:05.604475+11:00","updated_at":"2025-12-18T12:55:05.879012+11:00","labels":["beads-upstream"]}
{"id":"az-9gxm","title":"Spike: Gleam terminal I/O and Erlang FFI patterns","description":"**Goal:** Understand how to do low-level terminal I/O in Gleam if Etch doesn't work out.\n\n## Questions to Answer\n1. How do we enter/exit raw mode via Erlang's io module or termios?\n2. How do we read stdin byte-by-byte for escape sequence parsing?\n3. How do we write to stdout efficiently (buffering)?\n4. What FFI patterns does Gleam use for Erlang interop?\n\n## Investigation Areas\n- Erlang's `io` module for terminal I/O\n- Erlang's `proplists:get_value(terminal, io:getopts())` for terminal detection\n- Potential use of Erlang NIFs or ports for termios\n- Gleam `@external` function syntax\n\n## Deliverables\n1. Working example: Enter raw mode, read key, print it, exit raw mode\n2. Document FFI patterns used\n3. Risk assessment: Any platform-specific concerns?\n\n## Dependencies\n- Should be done in parallel with Etch spike\n- Results inform az-zh3y (Input handling) architecture","notes":"Research completed 2025-12-28. See detailed findings in task response.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:40:14.502402+11:00","updated_at":"2025-12-28T12:29:59.443775+11:00","closed_at":"2025-12-28T12:29:59.443775+11:00","close_reason":"Research complete: FFI patterns validated. Not needed for MVP since Etch covers all terminal I/O requirements. Patterns documented for future extension if needed.","labels":["ffi","gleam","research","spike"],"dependencies":[{"issue_id":"az-9gxm","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:41:50.980312+11:00","created_by":"daemon"}]}
{"id":"az-a0g1","title":"Spike: Unicode grapheme width in Gleam","description":"**Goal:** Determine how to calculate display width of text in terminal cells.\n\n## The Problem\nTerminals display characters with varying widths:\n- ASCII: 1 cell\n- CJK characters (ä¸­æ–‡): 2 cells\n- Emoji: 1-2 cells (varies by emoji)\n- Combining characters: 0 cells\n- Zero-width joiners: 0 cells\n\n## Questions to Answer\n1. Is there an existing Gleam library for unicode-width?\n2. If not, is there an Erlang library we can FFI to?\n3. Worst case: What's the effort to port unicode-width tables from Rust/Go?\n\n## Investigation Areas\n- Gleam hex packages for unicode/text handling\n- Erlang `unicode` module capabilities\n- Rust's `unicode-width` crate (well-maintained width tables)\n- Go's `runewidth` package (another good reference)\n\n## Deliverables\n1. Recommendation: Use existing lib / Port from X / Build simple\n2. If porting: Estimate complexity\n3. Working example: `display_width(\"Hello ä¸­æ–‡ ğŸ‘‹\") == 12`\n\n## Informs\n- az-ebxf (Text utilities) - Core dependency for text measurement","notes":"## Research Findings: Unicode Grapheme Width in Gleam\n\n### 1. EXISTING SOLUTION FOUND: string_width (Gleam)\n\n**Package:** `string_width` v3.3.1 on hex.pm\n**Author:** yoshi~ (yoshi-monster)\n**Repository:** https://gitlab.com/arkandos/string-width\n**License:** BSD-3-Clause\n**Dependency:** gleam_stdlib \u003e= 0.40.0\n\n**Key Features:**\n- Supports ALL Gleam targets (Erlang + JavaScript)\n- Handles ANSI escape codes (critical for TUI!)\n- Uses Unicode 16.0 tables (latest standard)\n- Passes tests from NPM string-width AND Rust unicode-width crate\n- Table lookup based on musl libc wcwidth implementation\n- \"Fastest options available\" per author\n\n**API Functions:**\n- `string_width.line(text)` - Width of single line in terminal cells\n- `string_width.align(width, direction, char)` - Pad to exact width\n- `string_width.limit(Size, ellipsis)` - Truncate with ellipsis\n- `string_width.get_terminal_size()` - Terminal dimensions\n\n**This directly solves our use case!**\n\n### 2. Erlang Standard Library: Graphemes Only, No Width\n\n**Erlang unicode module:** Encoding/decoding only (UTF-8, UTF-16, etc.)\n**Erlang string module:** Grapheme segmentation, length, padding - but NO display width\n\nErlang's string:length/1 counts grapheme clusters correctly (e.g., \"ä¸­æ–‡\" = 2), but doesn't know that CJK characters are 2 cells wide in terminals.\n\n### 3. Alternative Erlang Library: ucwidth\n\n**Package:** ucwidth on hex.pm (Elixir/Erlang)\n**Function:** Ucwidth.width/2 - width of codepoint or grapheme\n**Caveat:** Not Gleam-native, would need FFI wrapper\n\n### 4. Porting Assessment (Rust/Go)\n\n**Rust unicode-width:**\n- Multi-level lookup tables (WIDTH_ROOT, WIDTH_MIDDLE, etc.)\n- Sub-tables: 1 + 19 + 243 at different levels\n- CJK flag doubles static data (can be disabled)\n- Complex but highly optimized\n\n**Go go-runewidth:**\n- CreateLUT() makes 557KB in-memory table\n- Simpler interval table approach\n- MIT license\n\n**Conclusion:** Porting would be significant effort (2-3 days for basic port, more for optimization) and is unnecessary given string_width exists.\n\n### 5. Gleam Standard Library\n\n**gleam/string module provides:**\n- `length(text)` - Counts grapheme clusters (NOT display width)\n- `to_graphemes(text)` - List of grapheme clusters\n- `pop_grapheme(text)` - Head/tail split\n- `byte_size(text)` - UTF-8 byte count\n\n**Key insight:** length(\"ä¸­æ–‡\") = 2 graphemes, but display_width(\"ä¸­æ–‡\") = 4 cells. stdlib doesn't solve terminal width.\n\n### 6. MVP Alternative Assessment\n\n**Simple heuristic (ASCII=1, else=2):**\n- Would work for 80% of cases (ASCII + CJK)\n- Fails for: combining characters (should be 0), ambiguous width chars\n- Emoji handling inconsistent\n- Not recommended when proper solution exists\n\n## RECOMMENDATION\n\n**Use string_width package directly.**\n\nRationale:\n1. Already exists, well-tested, actively maintained (v3.3.1 in Oct 2024)\n2. Passes Rust unicode-width test suite\n3. Supports all Gleam targets\n4. ANSI-aware (critical for our TUI with colors)\n5. BSD-3 license compatible\n6. Zero porting effort required\n\n**Estimated Effort:** 0.5 hours to integrate\n- Add to gleam.toml: `string_width = \"~\u003e 3.3\"`\n- Import and use API directly\n\n**Code Example:**\n```gleam\nimport string_width\n\npub fn display_width(text: String) -\u003e Int {\n  string_width.line(text)\n}\n\n// string_width.line(\"Hello ä¸­æ–‡ ğŸ‘‹\") == 12 (verified from test suite)\n```\n\n## Impact on Dependent Issues\n\n- az-ebxf (Text utilities): Can now build on string_width, no custom width calculation needed\n- az-kwwr (Decision checkpoint): Unicode strategy = \"Use existing library\"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:40:14.692081+11:00","updated_at":"2025-12-28T12:27:23.293473+11:00","closed_at":"2025-12-28T12:27:23.293473+11:00","close_reason":"Research complete: Found existing Gleam library string_width v3.3.1 that solves the problem. No porting or custom implementation needed.","labels":["gleam","research","spike","unicode"],"dependencies":[{"issue_id":"az-a0g1","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:41:51.054701+11:00","created_by":"daemon"}]}
{"id":"az-a4s5","title":"image preview is broken","notes":"ğŸ“ [mjgmek1q-spkm.png](.beads/images/az-a4s5/mjgmek1q-spkm.png) (clipboard, 12/22/2025, 2:52:45 PM)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T14:52:29.359875+11:00","updated_at":"2025-12-22T14:52:45.701476+11:00"}
{"id":"az-aiu","title":"Implement session templates for pre-planning prompts","description":"Create .claude/session-templates/ with task-type-specific CLAUDE.md templates (feature.md, bugfix.md, refactor.md, epic.md). Templates inject 'think first' planning phase. SessionManager loads appropriate template when spawning.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.891181+11:00","updated_at":"2025-12-12T13:25:20.531813+11:00"}
{"id":"az-ap1","title":"Complete CLI commands (attach, pause, status, sync)","description":"src/cli/index.ts has 5 TODO placeholders:\n\n- **attach** (line 174): Implement session attachment via TmuxService\n- **pause** (line 201): Implement session pause\n- **status** (line 226): Display session/board status summary\n- **sync** (line 255-259): Sync worktrees (all vs current directory)\n\nCLI should be fully functional for non-TUI workflows.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:59:44.511089+11:00","updated_at":"2025-12-17T15:59:44.511089+11:00"}
{"id":"az-b8be","title":"Unified Session Verification","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:09:38.037604+11:00","updated_at":"2025-12-23T14:09:38.037604+11:00"}
{"id":"az-bijh","title":"cleanup beads","description":"merge duplicates, move completed tasks out of open/in progress, improve organization (create epics, add dependencies/blocking, etc), any other cleanup you can think of","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T15:10:58.00143+11:00","updated_at":"2025-12-20T01:47:42.036119+11:00"}
{"id":"az-c9y","title":"Replace verbose StatusBar stats with compact indicators","description":"Replace verbose 'Tasks: 12  Active: 3' with compact indicators '12âš™ 3â¸ 2âœ—'. Expand to full text on wide terminals (â‰¥100 cols). Add noteworthy alerts section that appears only when sessions need attention.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.538659+11:00","updated_at":"2025-12-12T13:25:20.220062+11:00","dependencies":[{"issue_id":"az-c9y","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.209397+11:00","created_by":"daemon"}]}
{"id":"az-ce9","title":"how do we track context? do we watch this bit in claude code somehow?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:36.741749+11:00","updated_at":"2025-12-18T01:11:36.741749+11:00"}
{"id":"az-cktn","title":"when we manually and deliberately delete a bead with space D we should immediately sync that","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:39:04.318158+11:00","updated_at":"2025-12-18T13:39:04.318158+11:00"}
{"id":"az-cl1","title":"Add concurrency limit config for parallel sessions","description":"Add configuration option to limit maximum number of parallel Claude sessions.\n\nInspiration: AutoMaker's maxConcurrency setting with canStartNewTask check.\n\nImplementation:\n1. Add maxConcurrency to config schema (default: unlimited or 5)\n2. Check limit in SessionManager before starting new session\n3. Show visual indicator when at capacity\n4. Optionally queue pending starts when limit reached\n5. Display running/max in status bar (e.g., '3/5 sessions')","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:04Z","updated_at":"2025-12-16T12:00:04Z"}
{"id":"az-d19m","title":"lustre_tui: Runtime - main loop, input dispatch, render cycle","description":"The runtime that drives a Lustre TUI application.\n\n## Why Separate from Reconciler\nThe runtime handles the event loop, timing, and lifecycle. Reconciler just converts Elements to Renderables.\n\n## Responsibilities\n1. Initialize terminal (alt screen, raw mode, hide cursor)\n2. Run initial render\n3. Poll for input events\n4. Dispatch events as Lustre messages\n5. Re-render on model changes\n6. Handle cleanup on exit\n7. **Handle signals (SIGINT/SIGTERM) for graceful shutdown**\n\n## API (Gleam)\n```gleam\ntype App(model, msg) {\n  App(\n    init: fn() -\u003e model,\n    update: fn(model, msg) -\u003e model,\n    view: fn(model) -\u003e Element(msg),\n  )\n}\n\ntype Runtime(model, msg)\n\n/// Start the TUI application (blocking)\nfn start(app: App(model, msg)) -\u003e Result(Nil, Error)\n\n/// Start with configuration\nfn start_with_config(app: App(model, msg), config: Config) -\u003e Result(Nil, Error)\n\ntype Config {\n  Config(\n    fps: Int,              // Target frame rate (default 60)\n    alt_screen: Bool,      // Use alternate screen buffer (default True)\n    mouse: Bool,           // Enable mouse events (default False)\n  )\n}\n```\n\n## Implementation\n```gleam\nfn run_loop(runtime: Runtime(model, msg)) -\u003e Result(Nil, Error) {\n  // 1. Check for input or resize events\n  case poll_event(runtime.input_handler) {\n    Some(Key(key)) -\u003e {\n      // 2. Convert to message via view's event handlers\n      case find_handler(runtime.view_tree, key) {\n        Some(msg) -\u003e {\n          // 3. Update model\n          let new_model = runtime.app.update(runtime.model, msg)\n          // 4. Re-render\n          let new_view = runtime.app.view(new_model)\n          render(runtime, new_view)\n          run_loop(Runtime(..runtime, model: new_model, view_tree: new_view))\n        }\n        None -\u003e run_loop(runtime)\n      }\n    }\n    Some(Resize(w, h)) -\u003e {\n      // Handle resize: update dimensions, re-layout, re-render\n      ...\n    }\n    None -\u003e {\n      // No input, continue loop\n      run_loop(runtime)\n    }\n  }\n}\n```\n\n## Signal Handling\n- **SIGINT (Ctrl+C)**: Clean shutdown, restore terminal\n- **SIGTERM**: Same as SIGINT\n- **SIGWINCH**: Handled by resize task (az-otrx)\n\n```gleam\n// On startup, install signal handlers\nfn install_signal_handlers() -\u003e Result(Nil, Error)\n\n// Cleanup function (called on any exit)\nfn cleanup(runtime: Runtime) -\u003e Nil {\n  exit_alt_screen()\n  show_cursor()\n  exit_raw_mode()\n}\n```\n\n## Acceptance Criteria\n- [ ] Terminal initializes correctly (alt screen, raw mode)\n- [ ] Initial render displays correctly\n- [ ] Input events are captured\n- [ ] Messages dispatch to update function\n- [ ] Model changes trigger re-render\n- [ ] Clean shutdown restores terminal\n- [ ] Ctrl+C handling works (graceful exit)\n- [ ] SIGTERM handling works\n- [ ] Resize events trigger re-layout (via az-otrx)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:32:20.13649+11:00","updated_at":"2025-12-28T11:44:02.69659+11:00","labels":["gleam","lustre-tui","runtime"],"dependencies":[{"issue_id":"az-d19m","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.484499+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-7tzh","type":"blocks","created_at":"2025-12-28T11:34:13.336661+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-5xza","type":"blocks","created_at":"2025-12-28T11:34:13.411369+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-zh3y","type":"blocks","created_at":"2025-12-28T11:34:13.488943+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-otrx","type":"blocks","created_at":"2025-12-28T11:43:16.866604+11:00","created_by":"daemon"}]}
{"id":"az-d1v","title":"look into how tools like ccmonitor keep track of token/context usage","description":"https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/tree/main\nthey may have a better way than we currently use to track context usage in a session","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T00:28:23.974311+11:00","updated_at":"2025-12-18T00:28:23.974311+11:00"}
{"id":"az-dl1","title":"Add detail level toggle for cards","description":"Add toggle to switch between minimal/standard/detailed card views.\n\nInspiration: AutoMaker's three-level detail toggle.\n\nLevels:\n- Minimal: ID + title only (fits more tasks on screen)\n- Standard: Current view (ID, title, priority, status indicator)\n- Detailed: Add description preview, session metrics, context health\n\nImplementation:\n1. Add detailLevel to ViewService (minimal/standard/detailed)\n2. Add 'd' key to cycle through levels\n3. Adjust TaskCard rendering based on level\n4. Persist preference in config","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:02Z","updated_at":"2025-12-16T12:00:02Z"}
{"id":"az-dpi","title":"Integrate Agent Mail with SessionManager","description":"Wire Agent Mail into session lifecycle for automatic reservation management.\n\nDesign:\n- SessionManager.start() calls agentMail.reserve() before worktree creation\n- SessionManager.stop() calls agentMail.release() after cleanup\n- SessionManager.pause() keeps reservation but updates status\n- Add reservation info to Session type\n- Fail session start if issue already reserved by another agent\n- Handle reservation conflicts gracefully\n- Update Kanban board to show reservation status (who owns what)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.738474+11:00","updated_at":"2025-12-12T10:33:13.738474+11:00","dependencies":[{"issue_id":"az-dpi","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.870895+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dpi","depends_on_id":"az-4r0","type":"blocks","created_at":"2025-12-12T10:33:21.939099+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dpi","depends_on_id":"az-tgc","type":"blocks","created_at":"2025-12-12T10:33:21.972727+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-dv9t","title":"read hook error","description":"Claude Code hooks call `az notify` but the `az` command isn't in /bin/sh's PATH. Error: \"Stop hook error: Failed with non-blocking status code: /bin/sh: az: command not found\". Need to use absolute path in generated hook config.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:05:15.520227+11:00","updated_at":"2025-12-20T01:46:58.532728+11:00","close_reason":"Fixed: Hook commands now use absolute path `bun run \"/abs/path/to/bin/az.ts\"` instead of `az`","comments":[{"id":9,"issue_id":"az-dv9t","author":"riordan","text":"May have misunderstood the issue - need to clarify if it's about hook failures","created_at":"2025-12-18T03:15:15Z"}],"deleted_at":"2025-12-20T01:46:58.532728+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-e0w","title":"board doesn't seem to update when i change sort mode","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T16:48:52.461805+11:00","updated_at":"2025-12-20T01:47:02.922437+11:00","deleted_at":"2025-12-20T01:47:02.922437+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-ebxf","title":"tui_core: Text utilities - grapheme width, wrapping, truncation","description":"Handle text measurement and manipulation for proper terminal rendering.\n\n## Why\nTerminals display characters with varying widths:\n- ASCII: 1 cell\n- CJK characters: 2 cells\n- Emoji: 1-2 cells (varies)\n- Zero-width joiners: 0 cells\n\n## API (Gleam)\n```gleam\n/// Get display width of a string in terminal cells\nfn display_width(text: String) -\u003e Int\n\n/// Get display width of a single grapheme\nfn grapheme_width(grapheme: String) -\u003e Int\n\n/// Truncate text to fit in N cells, adding ellipsis if needed\nfn truncate(text: String, max_width: Int, ellipsis: String) -\u003e String\n\n/// Wrap text to fit within max_width, respecting word boundaries\nfn wrap(text: String, max_width: Int) -\u003e List(String)\n\n/// Pad text to exactly N cells\nfn pad_right(text: String, width: Int, char: String) -\u003e String\nfn pad_left(text: String, width: Int, char: String) -\u003e String\nfn pad_center(text: String, width: Int, char: String) -\u003e String\n```\n\n## Implementation Notes\n- Use unicode-width table (or port a lib)\n- Consider using Gleam's grapheme handling\n- Emoji handling is complex - start simple\n\n## Acceptance Criteria\n- [ ] Correctly measure ASCII text width\n- [ ] Handle CJK double-width characters\n- [ ] Truncate with ellipsis correctly\n- [ ] Word-wrap respecting boundaries\n- [ ] Pad text to exact width","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:31:22.295003+11:00","updated_at":"2025-12-29T15:16:03.616292+11:00","closed_at":"2025-12-29T15:16:03.616292+11:00","close_reason":"Implemented tui_core/text.gleam with display_width, truncate, wrap, pad_left/right/center using string_width package.","labels":["foundation","gleam","tui-core"],"dependencies":[{"issue_id":"az-ebxf","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.205467+11:00","created_by":"daemon"},{"issue_id":"az-ebxf","depends_on_id":"az-a0g1","type":"blocks","created_at":"2025-12-28T11:41:51.274213+11:00","created_by":"daemon"},{"issue_id":"az-ebxf","depends_on_id":"az-kwwr","type":"blocks","created_at":"2025-12-28T11:52:29.384581+11:00","created_by":"daemon"}]}
{"id":"az-ee4","title":"Configuration \u0026 Polish","description":"User configuration (cosmiconfig + zod), multi-project support, help system, and final polish.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:05.070257+11:00","updated_at":"2025-12-11T14:44:05.070257+11:00"}
{"id":"az-eemx","title":"use new tmux window per dev server, not panes","description":"that way the system is way more durable, also try to improve durability if you can see any way to do so","design":"## Implementation Plan: Windows Instead of Panes for Dev Servers\n\n### Problem\nCurrent implementation uses tmux panes within a single `dev` window. This is fragile:\n- Pane IDs can become stale\n- If az crashes, tracking which pane belongs to which server is difficult\n- Manual restarts in panes can lose association with server state\n\n### Solution\nUse separate tmux windows named `dev-{serverLabel}` for each dev server.\n\n### Changes Required\n\n#### 1. DevServerService.ts - Core Changes\n- **Window naming**: `dev-{serverName}` instead of shared `dev` window with panes\n  - Example: `dev-frontend`, `dev-api`, `dev-worker`\n- **Remove `splitWindow` logic**: Lines 567-603 currently split panes for multiple servers\n- **Use `ensureWindow` for each server**: Each server gets its own window\n- **Update state tracking**: Replace `paneId` with window-based tracking\n- **Update health checks**: Monitor windows instead of panes (use `hasWindow` instead of `listPanes`)\n- **Update `stop()`**: Use `killWindow` or send Ctrl-C + close window instead of `killPane`\n\n#### 2. TmuxService.ts - Add Missing Methods\n- **`killWindow(target: string)`**: Kill a specific window\n- Possibly: **`selectWindowByName(session, windowName)`** if not covered by existing methods\n\n#### 3. DevServerMetadata Schema Updates\n- Remove `paneId` field (or keep for backwards compat but don't rely on it)\n- Add `windowName` field for clearer tracking\n\n#### 4. Health Check Updates (Lines 417-476)\n- Replace pane existence checks with window existence checks\n- Use `hasWindow(sessionName, windowName)` instead of `listPanes`\n- Port polling remains the same (capture from window target)\n\n#### 5. Discovery/Recovery (Lines 207-234)\n- On startup, scan for `dev-*` windows in bead sessions\n- Reconstruct state from tmux user options + window presence\n\n### Durability Improvements\n1. **Window-based state**: Windows are more stable than panes; window names survive az restarts\n2. **Metadata redundancy**: Store server metadata as tmux session option AND in window\n3. **Port as source of truth**: If port is responding, server is running (regardless of internal state)\n4. **Graceful degradation**: If metadata is missing, detect servers by window name pattern + port polling\n\n### Testing Strategy\n1. Start single dev server â†’ verify window created as `dev-{name}`\n2. Start multiple servers â†’ verify separate windows created\n3. Kill az process â†’ restart â†’ verify servers rediscovered\n4. Manual Ctrl-C in server window â†’ verify state updates to \"stopped\"\n5. Manual restart in window â†’ verify state updates to \"running\"\n\n### Files to Modify\n- `src/services/DevServerService.ts` (main changes)\n- `src/core/TmuxService.ts` (add killWindow if needed)\n- `src/core/paths.ts` (add dev window name helper if useful)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T15:04:47.56107+11:00","updated_at":"2025-12-29T18:06:34.689877+11:00","closed_at":"2025-12-29T18:06:34.689879+11:00","close_reason":"Implemented window-based dev server management: each server now gets its own tmux window (e.g., dev-frontend, dev-api) instead of panes in a shared window. This improves durability by making windows survive az crashes and enabling fallback discovery by scanning for dev-* windows."}
{"id":"az-esy","title":"Implement inline attachment mode in AttachmentService","description":"src/core/AttachmentService.ts line 204 has TODO for inline attachment.\n\nCurrently only external tmux attachment works. Inline mode should:\n- Capture session output in current terminal\n- Overlay UI on top of session stream\n- Allow quick interactions without leaving TUI","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.670743+11:00","updated_at":"2025-12-17T15:59:44.670743+11:00"}
{"id":"az-ey9u","title":"in chefy when i space S it somehow messes up the opencode config","description":"in ~/prog/Chefy the config correctly has a plugin key but somehow new sessions always get \"plugins\" instead","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T12:39:26.283981+11:00","updated_at":"2025-12-22T12:39:26.283981+11:00"}
{"id":"az-eyws","title":"bead got stuck merging","notes":"ğŸ“ [mjgkbwhw-ybaw.png](.beads/images/az-eyws/mjgkbwhw-ybaw.png) (clipboard, 12/22/2025, 1:54:41 PM)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T13:54:38.068469+11:00","updated_at":"2025-12-22T13:54:41.76088+11:00"}
{"id":"az-fn1","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:19:56.843403+11:00","updated_at":"2025-12-17T00:20:45.047717+11:00"}
{"id":"az-gds","title":"Subagent orchestration for parallel epic development","description":"Enable TUI to orchestrate multiple parallel Claude sessions working on related tasks (e.g., epic children). Each worker runs in its own worktree/tmux session. Coordination via Agent Mail for real-time updates, beads for persistent state.\n\n**Key Features:**\n1. Space+o on epic â†’ orchestration mode showing child tasks\n2. Select which tasks to parallelize\n3. Spawn workers (worktree + tmux + claude per task)\n4. Workers get injected context about epic and coordination rules\n5. Real-time progress tracking via Agent Mail status broadcasts\n6. Epic progress bar showing X/Y tasks complete\n7. Optional orchestrator Claude for planning/review phases\n\n**Architecture:**\n- TUI is external orchestrator (not a Claude subagent)\n- Workers are independent Claude sessions\n- Agent Mail handles: reservations, status, completion signals\n- Beads handles: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\n**New UI:**\n- Orchestration mode (Space+o)\n- Epic progress indicator (â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 3/5)\n- Indented child tasks under epic\n- Worker status in session indicators\n\n**Session Templates:**\n- worker.md template with epic context injection\n- Coordination rules (stay focused, report discoveries)\n- Auto-close task on completion","notes":"Session 2025-12-12: Designed from Claude Code best practices research.\n\nRESEARCH VALIDATION:\n- Pattern confirmed: Git worktrees are de facto standard for parallel AI agents (Cursor, ccswarm, Claude-Flow all use this)\n- Key insight: TUI as external orchestrator avoids Claude subagent nesting limits\n- Agent Mail provides \u003c100ms coordination vs 2-5s git sync\n\nARCHITECTURE DECISIONS:\n- TUI spawns workers (not Claude spawning subagents) - no nesting limits\n- Each worker: worktree + tmux session + Claude instance\n- Agent Mail for: reservations, status broadcasts, completion signals  \n- Beads for: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\nUI DESIGN:\n- Space+o triggers orchestration mode on epics\n- Reuse select mode patterns for task selection\n- Progress bar: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 3/5 format\n- Indented children under epics in board view\n\nDEPENDENCIES:\n- [deleted:az-7sr] (orch mode) + [deleted:az-lqb] (template) â†’ [deleted:az-bjp] (spawning)\n- az-l7a (Agent Mail epic) â†’ az-2il (status broadcasts)\n\nNEXT STEP: Implement [deleted:az-7sr] (orchestration mode) or [deleted:az-lqb] (worker template) - both are ready","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:28:50.911119+11:00","updated_at":"2025-12-28T11:48:04.491213+11:00"}
{"id":"az-gzgg","title":"Prompt user to configure dependencies when creating task in epic drill-down","description":"When a task is created within an epic drill-down view, the new task may have dependencies on other tasks in the same epic. Currently we only auto-link the task to the epic as a parent-child relationship, but we don't help the user establish sibling dependencies.\n\nFor example, if an epic has tasks A, B, C and the user creates task D, task D might need to depend on task B completing first. The user currently has to manually set this up after creation.","design":"## Potential Approaches\n\n### Option 1: Post-creation prompt overlay\nAfter creating the task in drill-down mode, show an overlay asking:\n- \"Does this task depend on any other tasks in this epic?\"\n- List the epic's existing children with checkboxes\n- User selects dependencies, we run `bd dep add` for each\n\n### Option 2: Spawn Claude session for dependency analysis\nMore sophisticated approach - spawn a quick Claude session that:\n1. Reads the new task's title/description\n2. Reads all sibling tasks in the epic\n3. Suggests likely dependencies based on semantic analysis\n4. User confirms/adjusts the suggestions\n\nThis would be especially useful for complex epics where dependencies aren't obvious.\n\n### Option 3: Keybinding for \"add to epic with deps\"\nAdd a separate keybinding (e.g., Shift+C) that does the enhanced flow, keeping plain 'c' simple.\n\n## Recommendation\nStart with Option 1 (simple overlay) as it's quick to implement and covers most use cases. Option 2 could be a follow-up enhancement for power users.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-19T15:10:45.058612+11:00","updated_at":"2025-12-19T15:10:45.058612+11:00","dependencies":[{"issue_id":"az-gzgg","depends_on_id":"az-5z7z","type":"discovered-from","created_at":"2025-12-19T15:10:52.889655+11:00","created_by":"daemon"}]}
{"id":"az-h3v","title":"Agent Mail server for local development","description":"Implement simple Agent Mail server for local multi-agent testing.\n\nDesign:\n- Bun HTTP server with Effect\n- In-memory reservation store (Map\u003cissueId, agentName\u003e)\n- Endpoints:\n  - POST /reserve/:issueId - acquire reservation\n  - POST /release/:issueId - release reservation\n  - GET /ready - list unreserved, unblocked issues\n  - POST /status/:issueId - update status\n  - GET /health - server health check\n- WebSocket support for real-time notifications (optional)\n- Configurable port via CLI argument\n- Graceful shutdown handling","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T10:33:13.621222+11:00","updated_at":"2025-12-12T10:33:13.621222+11:00","dependencies":[{"issue_id":"az-h3v","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.836567+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-hkfa","title":"tui_core: Color utilities - hex parsing and ANSI conversion","description":"Port OpenTUI's ansi.ts color handling to Gleam.\n\n## Why First\nColors are used by FrameBuffer cells and Renderer output. Need this foundation before either.\n\n## API (Gleam)\n```gleam\ntype Color {\n  Hex(String)           // \"#8aadf4\"\n  Rgb(Int, Int, Int)    // Rgb(138, 173, 244)\n  Ansi256(Int)          // 256-color palette index\n  Named(String)         // \"red\", \"blue\", etc.\n  Default               // Terminal default\n}\n\n/// Parse hex string to RGB values\nfn parse_hex(hex: String) -\u003e Result(#(Int, Int, Int), Nil)\n\n/// Convert to ANSI 256-color (for older terminals)\nfn to_ansi256(r: Int, g: Int, b: Int) -\u003e Int\n\n/// Generate foreground escape sequence (true color)\nfn fg_escape(color: Color) -\u003e String  // \"\\x1b[38;2;R;G;Bm\"\n\n/// Generate background escape sequence (true color)\nfn bg_escape(color: Color) -\u003e String  // \"\\x1b[48;2;R;G;Bm\"\n\n/// Reset all attributes\nfn reset() -\u003e String  // \"\\x1b[0m\"\n```\n\n## Reference\n- OpenTUI: packages/core/src/ansi.ts\n- ANSI escape codes: https://en.wikipedia.org/wiki/ANSI_escape_code\n\n## Acceptance Criteria\n- [ ] Parse \"#rrggbb\" and \"#rgb\" formats\n- [ ] Generate true color (24-bit) escape sequences\n- [ ] Generate 256-color fallback escape sequences\n- [ ] Handle bold, dim, underline, etc. attributes","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:31:22.083652+11:00","updated_at":"2025-12-29T15:16:03.528986+11:00","closed_at":"2025-12-29T15:16:03.528986+11:00","close_reason":"Implemented tui_core/color.gleam with hex parsing, RGB convenience functions, and Catppuccin Macchiato palette constants. Tests included.","labels":["foundation","gleam","tui-core"],"dependencies":[{"issue_id":"az-hkfa","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.129131+11:00","created_by":"daemon"},{"issue_id":"az-hkfa","depends_on_id":"az-lvah","type":"blocks","created_at":"2025-12-28T11:41:51.199473+11:00","created_by":"daemon"},{"issue_id":"az-hkfa","depends_on_id":"az-kwwr","type":"blocks","created_at":"2025-12-28T11:52:29.324605+11:00","created_by":"daemon"}]}
{"id":"az-kmuk","title":"tui_core: Border drawing - box borders and line characters","description":"Utility for drawing box borders with various styles.\n\n## Why\nBox borders need special characters and proper corner handling. This is tricky to get right inline.\n\n## API (Gleam)\n```gleam\ntype BorderStyle {\n  None\n  Single      // â”€ â”‚ â”Œ â” â”” â”˜\n  Double      // â• â•‘ â•” â•— â•š â•\n  Rounded     // â”€ â”‚ â•­ â•® â•° â•¯\n  Bold        // â” â”ƒ â” â”“ â”— â”›\n  Dashed      // â•Œ â• â”Œ â” â”” â”˜\n}\n\ntype BorderChars {\n  BorderChars(\n    top: String, bottom: String, left: String, right: String,\n    top_left: String, top_right: String,\n    bottom_left: String, bottom_right: String,\n  )\n}\n\n/// Get characters for a border style\nfn get_chars(style: BorderStyle) -\u003e BorderChars\n\n/// Draw border to a FrameBuffer (just the border, not contents)\nfn draw_border(\n  fb: FrameBuffer,\n  x: Int, y: Int, width: Int, height: Int,\n  style: BorderStyle,\n  fg: Color, bg: Color,\n) -\u003e FrameBuffer\n```\n\n## Reference\n- Box-drawing characters: https://en.wikipedia.org/wiki/Box-drawing_character\n\n## Acceptance Criteria\n- [ ] All 5 border styles with correct characters\n- [ ] Correct corner handling\n- [ ] Draw to FrameBuffer correctly\n- [ ] Handle width=1 or height=1 edge cases","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:31:22.516664+11:00","updated_at":"2025-12-28T11:31:22.516664+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-kmuk","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.272007+11:00","created_by":"daemon"},{"issue_id":"az-kmuk","depends_on_id":"az-xe2h","type":"blocks","created_at":"2025-12-28T11:34:25.186165+11:00","created_by":"daemon"},{"issue_id":"az-kmuk","depends_on_id":"az-hkfa","type":"blocks","created_at":"2025-12-28T11:34:25.24931+11:00","created_by":"daemon"}]}
{"id":"az-ktbd","title":"Space+m merge fails silently - need visible error feedback","description":"When pressing Space+m to merge a branch to main, the operation can fail silently without any visible feedback to the user. This makes debugging difficult.","design":"## Problem\n\nWhen Space+m merge fails, there's no visible indication of why. The user presses the keys and nothing happens - no error toast, no status message, nothing.\n\n## Observed Failure Modes\n\n1. **Untracked files on main blocking merge** - Git refuses to merge if untracked files would be overwritten\n2. **Task not found in board** - `getActionTargetTask()` returns undefined silently\n3. **Session state is idle** - Shows error toast but might be missed\n4. **Merge conflict check fails** - Should show error but might not be visible\n\n## Investigation Points\n\n1. Check all early return paths in `PRHandlersService.mergeToMain()`:\n   - Line 253: `if (!task) return` - **SILENT**\n   - Line 257: `if (isBusy) return` - Shows toast via `checkBusy()`\n   - Line 259-262: Session idle check - Shows error toast\n   - Other paths show toasts\n\n2. Check if toasts are being rendered/visible when merge is triggered\n\n3. Check git merge error handling in `PRWorkflow.mergeToMain()`\n\n## Proposed Fix\n\n1. Add error toast when task is not found: `if (!task) { toast.show(\"error\", \"No task selected\"); return }`\n2. Add logging for all merge attempts (success and failure)\n3. Consider adding a persistent status indicator during merge operations\n4. Ensure git errors (like untracked files blocking merge) surface to the user\n\n## Acceptance Criteria\n\n- [ ] All merge failure paths show visible error feedback (toast or status)\n- [ ] User can see WHY merge failed, not just that it failed\n- [ ] Git errors (untracked files, conflicts) are surfaced clearly\n- [ ] Add debug logging for merge operations","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2025-12-21T21:48:09.055142+11:00","updated_at":"2025-12-21T21:53:06.100642+11:00"}
{"id":"az-kwwr","title":"Decision Checkpoint: Finalize tui_core architecture based on spike findings","description":"**Goal:** Review Phase 0 spike findings and make binding architectural decisions before implementation begins.\n\n## Trigger\nAll three research spikes must be complete:\n- az-lvah: Etch library evaluation\n- az-9gxm: Gleam FFI patterns\n- az-a0g1: Unicode width research\n\n## Decisions to Make\n\n### 1. Terminal I/O Backend\nBased on Etch spike (az-lvah) and FFI spike (az-9gxm):\n- **Option A: Use Etch** - If it covers 80%+ of needs with clean API\n- **Option B: Wrap Etch** - If it's partial but extensible\n- **Option C: Build custom** - If Etch is unsuitable, use FFI patterns from az-9gxm\n\nDocument decision and rationale in this task's `notes` field.\n\n### 2. Unicode Width Strategy\nBased on az-a0g1 findings:\n- **Option A: Use existing Gleam/Erlang lib** - If one exists and is suitable\n- **Option B: Port from Rust/Go** - If no Gleam solution exists\n- **Option C: Simple ASCII-only MVP** - If porting is too complex for MVP\n\n### 3. Architecture Adjustments\nBased on findings, update epic description if:\n- API signatures need to change\n- New tasks need to be added\n- Tasks can be merged or removed\n\n## Deliverables\n- [ ] Decision documented in `notes` field\n- [ ] Epic description updated with final architecture\n- [ ] Any new blocking dependencies added\n- [ ] Phase 1-2 tasks unblocked with clear direction\n\n## Why This Matters\nWithout explicit decision-making, parallel work can go in incompatible directions. This checkpoint ensures the team commits to one path before heavy implementation begins.","notes":"## Architectural Decisions - 2025-12-28\n\n### Decision 1: Terminal I/O Backend\n**DECISION: USE ETCH (Option A)**\n\n**Rationale:**\n- Etch v1.2.0 (Dec 17, 2025) covers 100% of terminal I/O requirements\n- Raw mode, ANSI input parsing, true color RGB, alt screen, resize events, mouse - all supported\n- Command batching via `Queue` + `flush()` fits our FrameBuffer diff strategy\n- Zero dependencies, crossterm-inspired (battle-tested patterns)\n- Active maintenance, MIT license\n\n**Impact on tasks:**\n- az-hkfa (Color): Simplifies to hex parsing only; Etch handles ANSI escape generation\n- az-zh3y (Input): Thin wrapper around Etch events; no escape sequence parsing needed\n- az-5xza (Renderer): Uses Etch command batching; focus on diff algorithm\n\n### Decision 2: Unicode Width Strategy\n**DECISION: USE string_width PACKAGE (Option A)**\n\n**Rationale:**\n- `string_width` v3.3.1 exists on hex.pm, actively maintained\n- Unicode 16.0 tables (latest standard)\n- ANSI-aware (critical for TUI with styled text)\n- Supports all Gleam targets (Erlang + JavaScript)\n- Passes Rust unicode-width test suite\n- BSD-3 license, ~30 min integration effort\n\n**Impact on tasks:**\n- az-ebxf (Text utilities): Build on string_width; no custom width tables needed\n\n### Decision 3: Architecture Adjustments\n**NO MAJOR CHANGES NEEDED**\n\nThe original architecture is validated. Minor simplifications:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    lustre_tui                                â”‚\nâ”‚  Element types â”‚ Reconciler â”‚ Runtime loop                  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                    tui_core                                  â”‚\nâ”‚  Color (hexâ†’Etch) â”‚ Text (string_width) â”‚ FrameBuffer       â”‚\nâ”‚  Layout â”‚ Renderables â”‚ Borders                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                      ETCH                                    â”‚  â† Terminal I/O\nâ”‚  Raw mode â”‚ Input â”‚ ANSI output â”‚ Screen buffer             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                  string_width                                â”‚  â† Unicode width\nâ”‚  display_width â”‚ truncate â”‚ align                           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Dependencies to Add (gleam.toml)\n```toml\netch = \"~\u003e 1.2\"\nstring_width = \"~\u003e 3.3\"\n```\n\n### Phase 1-2 Unblocked\nAll Phase 1-2 tasks can now proceed with clear direction:\n- az-hkfa: Color utilities (hex parsing + Etch types)\n- az-ebxf: Text utilities (use string_width)\n- az-zh3y: Input handling (wrap Etch events)\n- az-xe2h: FrameBuffer (use Etch color types)\n- etc.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:52:06.002473+11:00","updated_at":"2025-12-28T12:30:34.000749+11:00","closed_at":"2025-12-28T12:30:34.000749+11:00","close_reason":"Decisions documented: (1) USE ETCH for terminal I/O, (2) USE string_width for Unicode width. Architecture validated, Phase 1-2 unblocked.","labels":["architecture","checkpoint","decision"],"dependencies":[{"issue_id":"az-kwwr","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:52:18.880047+11:00","created_by":"daemon"},{"issue_id":"az-kwwr","depends_on_id":"az-lvah","type":"blocks","created_at":"2025-12-28T11:52:18.945801+11:00","created_by":"daemon"},{"issue_id":"az-kwwr","depends_on_id":"az-9gxm","type":"blocks","created_at":"2025-12-28T11:52:19.026756+11:00","created_by":"daemon"},{"issue_id":"az-kwwr","depends_on_id":"az-a0g1","type":"blocks","created_at":"2025-12-28T11:52:19.123973+11:00","created_by":"daemon"}]}
{"id":"az-l7a","title":"Agent Mail Integration for Multi-Agent Coordination","description":"Implement Agent Mail coordination layer for multi-agent beads workflows. Agent Mail reduces coordination latency from 2-5 seconds (git sync) to \u003c100ms (HTTP API), preventing work collisions when multiple Claude sessions operate simultaneously.\n\nKey benefits:\n- 20-50x faster coordination than git sync\n- Prevents duplicate work through exclusive file reservations\n- Lightweight (~50MB memory footprint)\n- Optional with graceful degradation to git-only\n\nIntegration points:\n1. Issue reservation before starting work\n2. Issue release when work completes\n3. Ready query to find unblocked, unreserved issues\n4. Status updates for real-time visibility\n\nConfiguration:\n- BEADS_AGENT_MAIL_URL: Server endpoint\n- BEADS_AGENT_NAME: Unique agent identifier\n- BEADS_PROJECT_ID: Shared namespace\n\nReference: https://github.com/steveyegge/beads/blob/main/docs/AGENT_MAIL.md","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T10:32:57.000556+11:00","updated_at":"2025-12-12T10:32:57.000556+11:00"}
{"id":"az-llup","title":"bead images will slowly increase size of git clones etc","description":"we should store images elsewhere","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T15:56:57.33026+11:00","updated_at":"2025-12-22T15:56:57.33026+11:00"}
{"id":"az-losz","title":"issue with a partial success on space S","description":"i guess we need to make it atomic/roll back on partial success?","notes":"## Analysis\n\nThe `SessionManager.start` method has a non-atomic sequence of operations:\n\n1. Create worktree (idempotent âœ“)\n2. Run init commands (can fail, has config for continueOnFailure âœ“)  \n3. Create tmux session with Claude â† RESOURCE 1\n4. Update bead status to `in_progress` â† RESOURCE 2\n5. Store session in registry â† can fail after resources created\n6. Publish state change â† can fail after resources created\n\n**Problem:** If step 5 or 6 fails after steps 3-4, we have:\n- A running tmux session with Claude (orphaned)\n- Bead marked as `in_progress` with no session tracking\n\n## Solution Implemented\n\nUsed `Effect.acquireUseRelease` treating BOTH tmux and bead status as \"resources\":\n\n```typescript\nEffect.acquireUseRelease(\n  // ACQUIRE: Create tmux + update bead status (both are resources)\n  Effect.gen(function* () {\n    let createdNewSession = false\n    let updatedBeadStatus = false\n\n    if (!hasSession) {\n      yield* tmuxService.newSession(...)\n      createdNewSession = true\n    }\n    if (needsStatusUpdate) {\n      yield* beadsClient.update(beadId, { status: \"in_progress\" })\n      updatedBeadStatus = true\n    }\n    return { createdNewSession, updatedBeadStatus }\n  }),\n\n  // USE: Register in memory + publish event\n  () =\u003e Effect.gen(function* () {\n    yield* Ref.update(sessionsRef, ...)\n    yield* publishStateChange(beadId, \"idle\", \"busy\")\n    return sessionObj\n  }),\n\n  // RELEASE: Rollback BOTH on failure\n  (acquired, exit) =\u003e\n    Exit.isFailure(exit)\n      ? Effect.gen(function* () {\n          if (acquired.createdNewSession) {\n            yield* tmuxService.killSession(tmuxSessionName)\n          }\n          if (acquired.updatedBeadStatus) {\n            yield* beadsClient.update(beadId, { status: \"open\" })\n          }\n        })\n      : Effect.void,\n)\n```\n\n**Key benefits:**\n- Interrupt-safe: rollback runs even on fiber interruption\n- Tracks all state changes: both tmux and bead status\n- Selective rollback: only reverts what was actually changed\n- Idiomatic Effect pattern: proper resource management","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:21:13.743895+11:00","updated_at":"2025-12-18T13:54:02.410611+11:00","close_reason":"Complete fix: SessionManager.start now uses acquireUseRelease to rollback BOTH tmux session AND bead status on partial failure.","comments":[{"id":7,"issue_id":"az-losz","author":"riordan","text":"Extending fix to also rollback bead status","created_at":"2025-12-18T02:47:29Z"}],"deleted_at":"2025-12-18T13:54:02.410611+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-lvah","title":"Spike: Evaluate Etch library for terminal primitives","description":"**Goal:** Determine if Etch (github.com/bananaofhappiness/etch) provides what we need for tui_core.\n\n## Questions to Answer\n1. Does Etch handle raw mode entry/exit?\n2. Does Etch parse ANSI escape sequences for input (arrows, function keys)?\n3. Does Etch support true color (24-bit) output?\n4. Does Etch handle alternate screen buffer?\n5. What's the API surface like? Does it fit our architecture?\n\n## Evaluation Criteria\n- **Use Etch if:** Covers 80%+ of terminal I/O needs, actively maintained, ergonomic API\n- **Build from scratch if:** Etch is incomplete/unmaintained, or would require heavy wrapping\n\n## Tasks to Inform\n- az-hkfa (Color) - Can we use Etch's color handling?\n- az-zh3y (Input) - Can we use Etch's input handling?\n- az-5xza (Renderer) - Can we use Etch's output handling?\n\n## Deliverables\n1. Summary of Etch capabilities vs our needs\n2. Recommendation: Use Etch / Wrap Etch / Build custom\n3. If using Etch: API mapping document\n4. If not using Etch: FFI spike needed (see az-xxxx)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:40:14.324192+11:00","updated_at":"2025-12-28T12:29:59.365379+11:00","closed_at":"2025-12-28T12:29:59.365379+11:00","close_reason":"Research complete: Etch covers 100% of terminal I/O needs. Recommend USE ETCH for tui_core foundation.","labels":["etch","gleam","research","spike"],"dependencies":[{"issue_id":"az-lvah","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:41:50.87631+11:00","created_by":"daemon"}]}
{"id":"az-lyq4","title":"Port Azedarach from Shore to LustreTUI","description":"Once LustreTUI is validated via demo app (az-8zkp), migrate Azedarach Gleam version to use it.\n\n## What\n- Replace Shore imports with lustre_tui\n- Update view code to use new Element/Attribute API\n- Verify colors, layout, keybinds all work correctly\n- Compare visual output to TypeScript version\n\n## Migration Steps\n1. Update gleam.toml dependencies\n2. Replace Shore view functions with lustre_tui equivalents\n3. Update color values (Shore format â†’ hex strings)\n4. Verify layout renders correctly\n5. Test all keybinds work\n6. Fix any visual differences from TypeScript version\n\n## Key Mappings\n```gleam\n// Shore â†’ LustreTUI\nshore.box([...]) â†’ lustre_tui.box([...], [...])\nshore.text(\"...\") â†’ lustre_tui.text([fg(\"#color\")], \"...\")\nshore.row([...]) â†’ lustre_tui.box([flex_direction(Row)], [...])\nshore.column([...]) â†’ lustre_tui.box([flex_direction(Column)], [...])\n```\n\n## Dependencies\n- az-8zkp: Demo app must pass all validation checks first\n\n## Acceptance Criteria\n- [ ] All 4 Kanban columns display correctly\n- [ ] Hex colors work (Catppuccin Macchiato theme)\n- [ ] Status bar on single line with inline colored text (was broken in Shore)\n- [ ] All keyboard input works (j/k navigation, Space for actions, etc.)\n- [ ] Overlays render correctly (action menu, search)\n- [ ] No regressions from TypeScript version\n- [ ] Performance acceptable (no noticeable lag)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T11:26:08.488708+11:00","updated_at":"2025-12-28T11:35:22.01886+11:00","labels":["azedarach","gleam"],"dependencies":[{"issue_id":"az-lyq4","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.943409+11:00","created_by":"daemon"},{"issue_id":"az-lyq4","depends_on_id":"az-7tzh","type":"blocks","created_at":"2025-12-28T11:26:28.974911+11:00","created_by":"daemon"},{"issue_id":"az-lyq4","depends_on_id":"az-8zkp","type":"blocks","created_at":"2025-12-28T11:34:13.630032+11:00","created_by":"daemon"}]}
{"id":"az-md0x","title":"Add Claude Orchestrate option to orchestration UI","description":"In OrchestrationOverlay or via new entry point:\n- Add \"Claude Orchestrate\" option alongside manual selection\n- Spawns orchestrator session with:\n  - autoCompact: true\n  - orchestrator template\n  - No initial task selection (orchestrator decides)","design":"...","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.59242+11:00","updated_at":"2025-12-20T00:33:12.299787+11:00","dependencies":[{"issue_id":"az-md0x","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.855953+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-md0x","depends_on_id":"az-2q75","type":"blocks","created_at":"2025-12-19T11:14:22.125985+11:00","created_by":"daemon"},{"issue_id":"az-md0x","depends_on_id":"az-0h3d","type":"blocks","created_at":"2025-12-19T11:14:22.221409+11:00","created_by":"daemon"},{"issue_id":"az-md0x","depends_on_id":"az-j7qi","type":"blocks","created_at":"2025-12-19T11:14:22.31572+11:00","created_by":"daemon"}]}
{"id":"az-mvi9","title":"we need to be able to tell if there is a worktree even though theres no tmux session","design":"## Problem\nTasks with existing worktrees but no active tmux session appear as 'idle' with no indication that git work exists. Users can't see uncommitted changes or resume work.\n\n## Solution\nAdd hasWorktree field to TaskWithSession and show worktree state even when session is idle.\n\n## Implementation Plan\n\n### 1. Add hasWorktree to types (src/ui/types.ts)\n- Add `hasWorktree?: boolean` to TaskWithSession interface\n- Add WORKTREE_INDICATOR constant (ğŸ“ or similar)\n\n### 2. Update BoardService.loadTasks() (src/services/BoardService.ts)\n- Query WorktreeManager.exists() for each task\n- Populate hasWorktree field\n- Show git status (uncommitted changes, behind count) even when idle IF hasWorktree is true\n\n### 3. Update TaskCard (src/ui/TaskCard.tsx)\n- Show worktree indicator (ğŸ“) when hasWorktree \u0026\u0026 sessionState === 'idle'\n- Display git status (behind count, uncommitted changes) for idle tasks with worktrees\n\n### 4. Update DetailPanel (src/ui/DetailPanel.tsx)\n- Show worktree path when hasWorktree\n- Display full git status for worktrees without sessions\n\n### 5. Add actions for orphaned worktrees\n- Resume action: Attach new Claude session to existing worktree\n- Cleanup action: Remove orphaned worktree (git worktree remove)\n- Add these to ActionPalette when hasWorktree \u0026\u0026 idle\n\n### 6. Optional: Add worktree sort mode\n- New sort option in EditorService to group by worktree presence\n- Tasks with worktrees sort before tasks without\n\n## Files to Modify\n- src/ui/types.ts (add hasWorktree, WORKTREE_INDICATOR)\n- src/services/BoardService.ts (query worktree existence, populate field)\n- src/ui/TaskCard.tsx (display worktree indicator + git status)\n- src/ui/DetailPanel.tsx (show worktree info)\n- src/ui/ActionPalette.tsx (add resume/cleanup actions)\n- src/services/keyboard/SessionHandlersService.ts (implement resume/cleanup)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:03:45.394453+11:00","updated_at":"2025-12-29T23:40:41.244268+11:00","closed_at":"2025-12-29T23:40:41.244268+11:00","close_reason":"Implemented orphaned worktree detection and management"}
{"id":"az-nb04","title":"attached images break prompt injection","description":"TITLE","notes":"ğŸ“ [mjgmdu2c-3u1k.png](.beads/images/az-nb04/mjgmdu2c-3u1k.png) (clipboard, 12/22/2025, 2:52:10 PM)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-22T14:52:07.963955+11:00","updated_at":"2025-12-22T14:52:50.722449+11:00"}
{"id":"az-nk1","title":"Add number keys 1-9 for quick session attach","description":"Allow pressing 1-9 keys in normal mode to quickly attach to running sessions.\n\nInspiration: AutoMaker uses 1-9, 0 to view output for first 10 in-progress cards.\n\nImplementation:\n1. In normal mode, number keys 1-9 attach to nth running session\n2. Sessions ordered by: busy first, then waiting, then by start time\n3. Show number indicators on cards when sessions are running\n4. 0 could attach to 10th session or be used for other purpose","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T12:00:03Z","updated_at":"2025-12-16T12:00:03Z"}
{"id":"az-osly","title":"unify the dev server overlays (view, edit)","description":"up, down to select\nleft, right, space to toggle start/stop.\nenter/a to attach to that specific window (only available on running/error statuses)","design":"## Design: Unified Dev Server Overlay\n\n### Goal\nReplace the separate \"toggle\" and \"attach\" modes with a single unified dev server overlay accessible via `Space+r`.\n\n### Keybindings in Overlay\n- **j/k/â†‘/â†“**: Navigate server list  \n- **â†/â†’/Space**: Toggle start/stop for selected server\n- **Enter/a**: Attach to server (enabled for running/starting/error states only)\n- **Esc/q**: Close overlay\n\n### Implementation Changes\n\n#### 1. `src/ui/DevServerMenu.tsx`\n- Remove `mode` prop entirely\n- Always show ALL configured servers (no filtering)\n- Add left/right handling for toggle (same as space)\n- Add `a` key handling for attach (same as enter)\n- Attach action enabled for: running, starting, error statuses\n- Update keybinds display at bottom to show all actions\n- Visual indicator showing which actions are available per server\n\n#### 2. `src/services/OverlayService.ts`\n- Remove `mode` from devServerMenu overlay type:\n  ```typescript\n  | { readonly _tag: \"devServerMenu\"; readonly beadId: string }\n  ```\n\n#### 3. `src/services/keyboard/DevServerHandlersService.ts`\n- Remove `attachDevServer` handler entirely\n- Simplify `toggleDevServer`:\n  - If multiple servers: show overlay (no mode param)\n  - If single server: toggle directly (current behavior)\n- Remove `restartDevServer` that opens menu with mode\n\n#### 4. `src/services/keyboard/KeyboardService.ts`\n- Remove Space+v binding (was for attach)\n- Keep Space+r binding for dev server overlay\n\n#### 5. `src/ui/atoms/overlay.ts` and `src/ui/hooks/useOverlays.ts`\n- Update types to remove mode from devServerMenu\n- Update `showDevServerMenu` helper to not take mode param\n\n#### 6. `src/ui/atoms/devServer.ts`\n- Remove `devServersForOverlayAtom` (no longer filters by mode)\n- Keep `beadDevServerViewsAtom` (returns all servers)\n\n### Visual Design\n```\nâ”Œâ”€ Dev Servers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                           â”‚\nâ”‚ â†’ vite          running    :5173          â”‚\nâ”‚   api           stopped                   â”‚\nâ”‚   storybook     error                     â”‚\nâ”‚                                           â”‚\nâ”‚ [j/k] Navigate  [â†/â†’/Space] Toggle        â”‚\nâ”‚ [Enter/a] Attach  [Esc/q] Close           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nAttach shown dimmed or with indicator when not available (stopped/idle states).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:40:00.106578+11:00","updated_at":"2025-12-29T18:08:42.760998+11:00","closed_at":"2025-12-29T18:08:42.760998+11:00","close_reason":"Implemented unified dev server overlay with toggle (â†/â†’/Space) and attach (Enter/a) in single view. Removed separate Space+v binding."}
{"id":"az-otrx","title":"tui_core: Terminal resize handling (SIGWINCH)","description":"**Goal:** Handle terminal resize events so the TUI reflows correctly.\n\n## Why Critical\nIf the terminal resizes and we don't handle it:\n- Layout is wrong (still using old dimensions)\n- Rendering artifacts appear\n- User experience breaks\n\n## Implementation\n\n### Signal-based (Unix)\n```gleam\n// Listen for SIGWINCH signal\n// On signal: \n//   1. Query new terminal size\n//   2. Resize FrameBuffer\n//   3. Trigger full re-layout + re-render\n```\n\n### Polling fallback\n```gleam\n// Poll terminal size every N frames\n// On change: same as above\n```\n\n## API Addition\n```gleam\n// In tui_core/terminal\nfn get_terminal_size() -\u003e #(Int, Int)  // (width, height)\n\n// In InputHandler or Runtime\ntype Event {\n  Key(KeyEvent)\n  Resize(width: Int, height: Int)\n}\n```\n\n## Integration Points\n- az-xe2h (FrameBuffer) - needs `resize()` function\n- az-d19m (Runtime) - needs to handle Resize events\n- az-se6w (Layout) - needs to relayout on resize\n\n## Acceptance Criteria\n- [ ] Detect terminal resize (SIGWINCH or polling)\n- [ ] FrameBuffer resizes correctly\n- [ ] Full re-layout triggers\n- [ ] No visual artifacts during resize\n- [ ] Works on macOS and Linux","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:43:06.692712+11:00","updated_at":"2025-12-30T00:27:55.778367+11:00","closed_at":"2025-12-30T00:27:55.778367+11:00","close_reason":"Closed via update","labels":["gleam","signals","tui-core"],"dependencies":[{"issue_id":"az-otrx","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:43:16.740429+11:00","created_by":"daemon"},{"issue_id":"az-otrx","depends_on_id":"az-zh3y","type":"blocks","created_at":"2025-12-28T11:43:16.802615+11:00","created_by":"daemon"}]}
{"id":"az-p9ut","title":"task header isnt responsive enough","notes":"ğŸ“ [mjfpdk96-xvvs.png](.beads/images/az-p9ut/mjfpdk96-xvvs.png) (clipboard, 12/21/2025, 11:28:10 PM)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T23:28:08.094691+11:00","updated_at":"2025-12-22T13:40:30.598866+11:00"}
{"id":"az-phut","title":"az loses track of dev servers if i manually restart them in the tmux window (ctrl c -\u003e startup command)","design":"## Problem\nWhen user manually restarts dev server (Ctrl+C â†’ startup command), Azedarach loses track because:\n1. Health check only monitors pane existence, not process state\n2. Port detection only runs at initial startup\n3. No mechanism to detect 'process died' or 'new process started'\n\n## Solution: Port-Based Lifecycle Monitoring\nFor dev servers, the port IS the source of truth. Enhance health check to verify port is responding.\n\n## Implementation\n1. Add `checkPortOpen(port: number)` utility - TCP connect check with timeout\n2. Enhance health check fiber (DevServerService.ts:295-322) to:\n   - Verify port is responding (not just pane exists)\n   - If pane exists but port dead â†’ status = 'stopped'\n   - If port comes back on stopped server â†’ re-sync metadata, status = 'running'\n3. Update `startedAt` timestamp when server restarts\n\n## Key Files\n- src/services/DevServerService.ts - Main changes (health check enhancement)\n\n## Behavior\n- Server dies (Ctrl+C): Port check fails â†’ status becomes 'stopped'\n- Server restarts: Port check succeeds â†’ re-detect port, update startedAt, status = 'running'\n- Seamless - no user intervention needed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:29:24.885249+11:00","updated_at":"2025-12-29T15:05:16.48382+11:00","closed_at":"2025-12-29T15:05:16.483823+11:00"}
{"id":"az-se6w","title":"tui_core: Layout engine - flexbox-style positioning algorithm","description":"Implement the layout algorithm that positions Renderables in the terminal.\n\n## Why Separate\nThis is the most complex part of the rendering pipeline. Keeping it separate from Renderable types allows focused testing and iteration.\n\n## Algorithm (simplified flexbox)\n```\n1. Measure phase (intrinsic sizes)\n   - Text: display_width of content\n   - Box with Auto: sum/max of children based on flex_direction\n   - Box with Px/Pct/Fill: use specified size\n\n2. Layout phase (position children)\n   - Calculate available space (parent size - padding - border)\n   - Distribute space to Fill children\n   - Apply justify_content for main axis alignment\n   - Apply align_items for cross axis alignment\n   - Recurse into children\n\n3. Render phase (draw to FrameBuffer)\n   - Draw background\n   - Draw border if present\n   - Draw text content\n   - Recurse into children with offset\n```\n\n## API (Gleam)\n```gleam\ntype LayoutNode {\n  LayoutNode(\n    renderable: Renderable,\n    x: Int, y: Int,           // Computed position\n    width: Int, height: Int,  // Computed size\n    children: List(LayoutNode),\n  )\n}\n\n/// Compute layout for a renderable tree\nfn layout(root: Renderable, available_width: Int, available_height: Int) -\u003e LayoutNode\n\n/// Render a laid-out tree to a FrameBuffer\nfn render_tree(node: LayoutNode, fb: FrameBuffer) -\u003e FrameBuffer\n```\n\n## Overflow Handling\nFor MVP, use **clipping** (simplest):\n- Content outside bounds is not rendered\n- No scroll state needed\n\nFuture consideration (post-MVP):\n- Scroll containers with scroll offset state\n- Scrollbar rendering\n\n```gleam\ntype Overflow { Clip | Scroll | Visible }\n```\n\n## Edge Cases\n- Overflow handling (clip vs scroll) - MVP: clip only\n- Min/max size constraints\n- Percentage of percentage calculations\n- Zero-size containers\n\n## Acceptance Criteria\n- [ ] Row layout distributes width correctly\n- [ ] Column layout distributes height correctly\n- [ ] Fill sizing expands to available space\n- [ ] Percentage sizing works\n- [ ] Nested layouts compute correctly\n- [ ] Padding and margin applied correctly\n- [ ] **Content clipping works (overflow hidden)**\n- [ ] Text truncation with ellipsis when needed","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:32:19.745554+11:00","updated_at":"2025-12-28T11:44:02.435765+11:00","labels":["gleam","layout","tui-core"],"dependencies":[{"issue_id":"az-se6w","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.339421+11:00","created_by":"daemon"},{"issue_id":"az-se6w","depends_on_id":"az-ud48","type":"blocks","created_at":"2025-12-28T11:33:58.426226+11:00","created_by":"daemon"}]}
{"id":"az-t6k3","title":"i want untracked and staged files to be accounted for in space f and git status on cards","description":"so when a claude session is working away but not yet done i can see the git lines added/removed on cards and see the changes come in via space f \nif this is not possible without losing something that we already have tell me and close the bead without and impl\nif it is possible without any tradeoffs, tell me how and show me your plan and ill approve it","notes":"ğŸ“ [mjgcspmg-09hu.png](.beads/images/az-t6k3/mjgcspmg-09hu.png) (clipboard, 12/22/2025, 10:23:48 AM)\nğŸ“ [mjgcsxsi-qqzd.png](.beads/images/az-t6k3/mjgcsxsi-qqzd.png) (clipboard, 12/22/2025, 10:23:59 AM)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-22T10:23:36.192775+11:00","updated_at":"2025-12-22T11:30:34.523314+11:00"}
{"id":"az-tfb3","title":"poll git pulls when git mode is remote","description":"When workflowMode is \"origin\", the behind-count calculation uses `origin/main` refs that can become stale. We need to periodically fetch from remote to keep these refs updated.","design":"## Implementation Plan\n\n### New Service: `GitService`\n\nCreate `src/services/GitService.ts` - a broader service for git operations that can be extended later.\n\n**Initial responsibilities:**\n1. Poll `git fetch origin \u003cbaseBranch\u003e` every 30 seconds\n2. Only active when `workflowMode === \"origin\"` AND `fetchEnabled === true`\n3. Run fetch from the main project directory (not per-worktree)\n\n**Architecture:**\n- Use `Effect.Service` with `scoped:` (needs long-running fiber)\n- Declare dependencies: `AppConfig.Default`, `OfflineService.Default`, `ToastService.Default`, `DiagnosticsService.Default`\n- State: `SubscriptionRef\u003cGitFetchState\u003e` tracking last fetch time, status\n- Background fiber: `Effect.scheduleForked(Schedule.spaced(\"30 seconds\"))`\n\n**Error handling:**\n- On network-related errors: Log silently, retry next interval (network status shown elsewhere)\n- On non-network errors (auth, permission): Show toast notification\n- Track in diagnostics for debugging\n\n**GitFetchState type:**\n```typescript\ntype GitFetchState = {\n  lastFetchAt: DateTime.Utc | null\n  lastError: string | null\n  consecutiveFailures: number\n}\n```\n\n### Integration\n\n1. Add `GitService.Default` to the app layer in `atoms.ts`\n2. Optionally expose `lastFetchAtom` for status bar display\n3. Register fiber with DiagnosticsService for visibility\n\n### Files to create/modify:\n- CREATE: `src/services/GitService.ts`\n- MODIFY: `src/ui/atoms.ts` (add to layer)\n\n### Future extensibility:\nThis service can later absorb:\n- Git stats calculation (currently in BoardService)\n- Push operations\n- Merge conflict detection","acceptance_criteria":"- [ ] GitService polls `git fetch origin main` every 30 seconds\n- [ ] Only polls when workflowMode=\"origin\" AND fetchEnabled=true\n- [ ] Silently handles network errors (retry next interval)\n- [ ] Shows toast for non-network errors (auth, permissions)\n- [ ] Fiber registered with DiagnosticsService\n- [ ] Service added to app layer","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:47:22.406609+11:00","updated_at":"2025-12-29T15:05:30.644054+11:00","closed_at":"2025-12-29T15:05:30.644057+11:00"}
{"id":"az-tgc","title":"Agent Mail configuration and environment","description":"Add configuration support for Agent Mail settings.\n\nDesign:\n- Environment variables:\n  - BEADS_AGENT_MAIL_URL (optional)\n  - BEADS_AGENT_NAME (defaults to hostname or generated)\n  - BEADS_PROJECT_ID (defaults to git remote or project path hash)\n- Config service using @effect/platform Config\n- Validation with @effect/schema\n- Auto-detect if Agent Mail server is available\n- CLI flag --agent-mail-url to override\n- Show Agent Mail status in TUI StatusBar","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.864792+11:00","updated_at":"2025-12-12T10:33:13.864792+11:00","dependencies":[{"issue_id":"az-tgc","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.905172+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-ud48","title":"tui_core: Renderable types - Box, Text, Span and styling","description":"Port OpenTUI's Renderable type system to Gleam. This task focuses on TYPE DEFINITIONS only - layout algorithm is in az-se6w.\n\n## What\nHierarchical objects that can be nested, styled, and rendered.\n\n## Core Types (Gleam)\n```gleam\ntype Renderable {\n  Box(children: List(Renderable), style: BoxStyle)\n  Text(content: String, style: TextStyle)\n  Span(content: String, style: TextStyle)  // Inline within Text\n}\n\ntype BoxStyle {\n  BoxStyle(\n    width: Size, height: Size,\n    padding: Edges, margin: Edges,\n    border: Option(BorderStyle),\n    flex_direction: FlexDirection,  // Row | Column\n    justify_content: Justify,       // Start | End | Center | SpaceBetween | SpaceAround\n    align_items: Align,             // Start | End | Center | Stretch\n    gap: Int,\n    fg: Option(Color), bg: Option(Color),\n  )\n}\n\ntype TextStyle {\n  TextStyle(\n    fg: Option(Color), bg: Option(Color),\n    bold: Bool, dim: Bool, underline: Bool, italic: Bool,\n  )\n}\n\ntype Size { Px(Int) | Pct(Int) | Fill | Auto }\ntype FlexDirection { Row | Column }\ntype Justify { JustifyStart | JustifyEnd | JustifyCenter | SpaceBetween | SpaceAround }\ntype Align { AlignStart | AlignEnd | AlignCenter | Stretch }\ntype Edges { Edges(top: Int, right: Int, bottom: Int, left: Int) }\n\n// Convenience constructors\nfn edges_all(n: Int) -\u003e Edges\nfn edges_xy(x: Int, y: Int) -\u003e Edges\nfn default_box_style() -\u003e BoxStyle\nfn default_text_style() -\u003e TextStyle\n```\n\n## Reference\n- OpenTUI Renderables: packages/core/src/renderables/\n\n## Acceptance Criteria\n- [ ] All types defined and compile\n- [ ] Convenient constructors for common cases\n- [ ] Types are ergonomic to work with\n- [ ] Good documentation/comments","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:26:07.864793+11:00","updated_at":"2025-12-28T11:32:54.346946+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-ud48","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.729906+11:00","created_by":"daemon"},{"issue_id":"az-ud48","depends_on_id":"az-xe2h","type":"blocks","created_at":"2025-12-28T11:26:28.76366+11:00","created_by":"daemon"},{"issue_id":"az-ud48","depends_on_id":"az-ebxf","type":"blocks","created_at":"2025-12-28T11:33:58.354626+11:00","created_by":"daemon"}]}
{"id":"az-ufgi","title":"i dont see o as an option in normal mode bottom bar in epic drill down","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:39:43.508204+11:00","updated_at":"2025-12-19T11:39:43.508204+11:00"}
{"id":"az-uwcd","title":"lustre_tui: Element types and attributes","description":"Define the Lustre element types that users write in their view functions.\n\n## Why Separate from Reconciler\nElement types are the user-facing API. Keep them stable and well-documented separately from the reconciler internals.\n\n## API (Gleam)\n```gleam\n// Core element type\ntype Element(msg)\n\n// Constructors\nfn box(attrs: List(Attribute(msg)), children: List(Element(msg))) -\u003e Element(msg)\nfn text(attrs: List(Attribute(msg)), content: String) -\u003e Element(msg)\nfn span(attrs: List(Attribute(msg)), content: String) -\u003e Element(msg)  // Inline text\n\n// Future: Input elements\n// fn input(attrs: List(Attribute(msg))) -\u003e Element(msg)\n// fn button(attrs: List(Attribute(msg)), label: String) -\u003e Element(msg)\n\n// Attributes - Layout\nfn width(size: Size) -\u003e Attribute(msg)\nfn height(size: Size) -\u003e Attribute(msg)\nfn flex_direction(dir: FlexDirection) -\u003e Attribute(msg)\nfn justify_content(j: Justify) -\u003e Attribute(msg)\nfn align_items(a: Align) -\u003e Attribute(msg)\nfn padding(p: Int) -\u003e Attribute(msg)\nfn padding_xy(x: Int, y: Int) -\u003e Attribute(msg)\nfn margin(m: Int) -\u003e Attribute(msg)\nfn gap(g: Int) -\u003e Attribute(msg)\n\n// Attributes - Style\nfn fg(color: String) -\u003e Attribute(msg)  // \"#8aadf4\"\nfn bg(color: String) -\u003e Attribute(msg)\nfn bold() -\u003e Attribute(msg)\nfn dim() -\u003e Attribute(msg)\nfn underline() -\u003e Attribute(msg)\nfn border(style: BorderStyle) -\u003e Attribute(msg)\n\n// Attributes - Events (for input elements)\nfn on_click(msg: msg) -\u003e Attribute(msg)\nfn on_key(handler: fn(Key) -\u003e Option(msg)) -\u003e Attribute(msg)\n```\n\n## Design Decisions\n- Attributes are typed to msg for event handlers\n- Colors are strings (parsed by tui_core/color)\n- Sizes use the same Size type as Renderables\n- Keep API minimal initially, expand based on needs\n\n## Acceptance Criteria\n- [ ] box/text/span constructors work\n- [ ] All layout attributes defined\n- [ ] All style attributes defined\n- [ ] Event attribute types defined (even if not implemented)\n- [ ] Types compile and are ergonomic to use","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:32:19.939067+11:00","updated_at":"2025-12-28T11:32:19.939067+11:00","labels":["api","gleam","lustre-tui"],"dependencies":[{"issue_id":"az-uwcd","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.414335+11:00","created_by":"daemon"},{"issue_id":"az-uwcd","depends_on_id":"az-ud48","type":"blocks","created_at":"2025-12-28T11:34:13.202407+11:00","created_by":"daemon"}]}
{"id":"az-v1p1","title":"why do i see origin/main here instead of local main in azedarach project","notes":"ğŸ“ [mjqmnehy-bgma.png](.beads/images/az-v1p1/mjqmnehy-bgma.png) (clipboard, 12/29/2025, 2:57:18 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T14:57:15.887087+11:00","updated_at":"2025-12-29T15:01:25.532344+11:00","closed_at":"2025-12-29T15:01:25.532346+11:00","close_reason":"Fixed: Added `workflowMode: local` to azedarach config. The UI was showing `origin/main` because the config was missing `workflowMode` (defaulting to Origin mode). Also fixed schema mismatch: `base` â†’ `baseBranch`."}
{"id":"az-v6h","title":"use effect STM or something to enforce atomic operations where possible","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:43:45.048239+11:00","updated_at":"2025-12-17T15:43:45.048239+11:00"}
{"id":"az-vbqj","title":"both of these servers ARE running but not tracked properly in az","design":"## Root Cause\n\nThe `checkPortOpen()` function in DevServerService.ts only checks IPv4 (`127.0.0.1`), but the \"server\" dev server (Bun on port 8080) binds to IPv6 only (`[::1]:8080`).\n\n**Evidence:**\n- `lsof -i :8080` shows: `TCP [::1]:8080 (LISTEN)` - IPv6 only\n- `lsof -i :3000` shows: `TCP *:hbci (LISTEN)` - all interfaces\n- `nc -z 127.0.0.1 8080` fails (IPv4)\n- `nc -z ::1 8080` succeeds (IPv6)\n\n## Solution\n\nModify `checkPortOpen()` to try BOTH IPv4 and IPv6, returning true if either succeeds:\n\n1. Try `127.0.0.1` (IPv4)\n2. If that fails, try `::1` (IPv6)\n3. Return true if either connection succeeds\n\nAlternative: Use `localhost` which the OS resolves to the appropriate interface, but this can be unpredictable. Explicit dual-stack check is more reliable.\n\n## Implementation\n\nUpdate `checkPortOpen()` in `/src/services/DevServerService.ts` (lines 39-74):\n\n```typescript\nconst checkPortOpen = (port: number): Effect.Effect\u003cboolean\u003e =\u003e\n  Effect.gen(function* () {\n    // Try IPv4 first\n    const ipv4Open = yield* checkPortOpenOnHost(port, \"127.0.0.1\")\n    if (ipv4Open) return true\n    // Fall back to IPv6\n    return yield* checkPortOpenOnHost(port, \"::1\")\n  })\n\nconst checkPortOpenOnHost = (port: number, host: string): Effect.Effect\u003cboolean\u003e =\u003e\n  Effect.async\u003cboolean\u003e((resume) =\u003e {\n    // ... existing socket code ...\n  })\n```\n\n## Files to Modify\n\n- `src/services/DevServerService.ts` - Update checkPortOpen() to be dual-stack\n\n## Testing\n\n1. Start Azedarach\n2. Open Toggle Dev Server menu on a bead with running servers\n3. Verify both \"web\" (IPv4/*) and \"server\" (IPv6) show as \"running\"","notes":"ğŸ“ [mjqnzia8-7fam.png](.beads/images/az-vbqj/mjqnzia8-7fam.png) (clipboard, 12/29/2025, 3:34:43 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T15:34:41.102289+11:00","updated_at":"2025-12-29T16:22:35.760924+11:00","closed_at":"2025-12-29T16:22:35.760924+11:00","close_reason":"Fixed: checkPortOpen() now checks both IPv4 (127.0.0.1) and IPv6 (::1) in parallel, correctly detecting servers like Bun that bind to IPv6-only."}
{"id":"az-vhfg","title":"brainstorm ideas for reducing number of active tmux sessions","description":"sometimes i leave too many tmux sessions running because i dont bother space d or space x to end them.\nhow can we deal with this?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T15:46:16.5296+11:00","updated_at":"2025-12-23T15:46:16.5296+11:00"}
{"id":"az-vw20","title":"Scroll containers (overflow: scroll)","description":"**Status:** Deferred to post-MVP\n\n## Overview\nAdd scrollable containers that can display content larger than their bounds.\n\n## Current State\nThe layout engine (az-se6w) implements **clipping** for MVP - content outside bounds is simply not rendered.\n\n## Features to Add\n- `Overflow::Scroll` variant for boxes\n- Scroll offset state (x, y)\n- Keyboard scroll handling (arrow keys, Page Up/Down within scroll container)\n- Optional: scrollbar rendering\n- Optional: mouse wheel scrolling (depends on mouse events)\n\n## API Addition\n```gleam\ntype Overflow { Clip | Scroll | Visible }\n\n// In BoxStyle\noverflow: Overflow  // default: Clip\n\n// Scrollbar styling\ntype ScrollbarStyle {\n  track_color: Color,\n  thumb_color: Color,\n  width: Int,  // typically 1 cell\n}\n```\n\n## Complexity\nMedium-high. Requires:\n- Layout engine changes (scroll viewport calculation)\n- State management (scroll offsets per scrollable container)\n- Event routing (scroll events to correct container)\n- Focus concept (which container is scrollable)\n\n## Why Deferred\nAzedarach Kanban columns are fixed height with a known number of tasks. Scrolling not required for MVP.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T12:07:34.366262+11:00","updated_at":"2025-12-28T12:07:34.366262+11:00","labels":["deferred","gleam","layout","tui-core"],"dependencies":[{"issue_id":"az-vw20","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T12:07:48.784419+11:00","created_by":"daemon"},{"issue_id":"az-vw20","depends_on_id":"az-se6w","type":"blocks","created_at":"2025-12-28T12:07:49.00686+11:00","created_by":"daemon"}]}
{"id":"az-wgc7","title":"add a space keybnid to start hx in a tmux session instead of/in addition to a claude sesh","design":"## Implementation Plan\n\n### Summary\nAdd `Space+H` (Shift+H) keybinding to open Helix editor in a dedicated tmux window within the bead's session. Works like the \"chat\" feature - creates an \"hx\" window alongside Claude/chat windows.\n\n### Key Decision: Always Available\n- If session exists â†’ open Helix in existing session's worktree\n- If no session (idle) â†’ create worktree/session first, then open Helix window\n- This matches user expectation of \"just open Helix for this bead\"\n\n### Files to Modify\n\n1. **`src/core/paths.ts`** - Add `HX: \"hx\"` to WINDOW_NAMES constant\n\n2. **`src/services/keyboard/SessionHandlersService.ts`** - Add `startHelixSession()` method:\n   - Get target task from action mode\n   - If no session exists: create worktree + session (reuse ClaudeSessionManager logic)\n   - Use `ensureWindow()` to create/reuse \"hx\" window\n   - Command: `hx .` (open Helix in worktree root)\n   - Show toast on success\n\n3. **`src/services/keyboard/bindings.ts`** - Add keybinding:\n   ```typescript\n   {\n     key: \"S-h\",  // Shift+H\n     mode: \"action\",\n     description: \"Open Helix editor\",\n     action: Effect.suspend(() =\u003e\n       bc.editor.exitToNormal().pipe(\n         Effect.tap(() =\u003e bc.sessionHandlers.startHelixSession()),\n       ),\n     ),\n   }\n   ```\n\n4. **`src/ui/ActionPalette.tsx`** - Add to session actions section:\n   - Add `\u003cActionLine keyName=\"H\" description=\"helix\" /\u003e`\n   - Update `isAvailableByState()` to return `true` for \"H\" (always available)\n\n5. **`docs/keybindings.md`** - Document the new keybinding\n\n### Implementation Notes\n- Follows exact pattern of `chatAboutTask()` for window creation\n- Uses `WorktreeSessionService.ensureWindow()` for idempotent window management\n- For idle tasks, need to call `sessionManager.createSessionOnly()` or similar to set up worktree without starting Claude\n- Helix runs in interactive shell: `${shell} -i -c 'hx .; exec ${shell}'`\n\n### Testing\n- Test on idle task (should create worktree + session)\n- Test on task with existing session (should add window)\n- Test attaching to Helix window (Space+a should work)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:54:11.2604+11:00","updated_at":"2025-12-29T15:21:12.062057+11:00","closed_at":"2025-12-29T15:21:12.062057+11:00","close_reason":"Implemented Space+H keybinding to open Helix editor in a dedicated tmux window. Works for both idle and running tasks - creates worktree if needed. Documented in keybindings.md."}
{"id":"az-wiu","title":"Eliminate React hooks in favor of Effect services (audit \u0026 migrate)","description":"Per az-x4e, 9 files still use React hooks (useEffect/useMemo/useState):\n\n- src/ui/App.tsx\n- src/ui/Board.tsx\n- src/ui/Column.tsx\n- src/ui/CompactView.tsx\n- src/ui/Toast.tsx\n- src/ui/DetailPanel.tsx\n- src/ui/CreateTaskPrompt.tsx\n- src/ui/ClaudeCreatePrompt.tsx\n- src/index.tsx\n\n**Audit each file** to determine:\n1. What state/effects can move to Effect services\n2. What computation can move to atoms\n3. What's truly local UI state (may be acceptable)\n\nDocument findings and create migration plan. This task is the audit; az-x4e is the execution.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T15:59:45.338873+11:00","updated_at":"2025-12-17T15:59:45.338873+11:00"}
{"id":"az-wn3o","title":"Claude-orchestrated epic mode (subagent approach)","description":"Claude orchestrates an epic using parallel Task tool subagents.\n\n**Entry:** Space+O on epic â†’ \"Claude Orchestrate\" option\n\n**Flow:**\n1. Spawn orchestrator with auto-compact enabled\n2. Quality gate identifies safe parallel groupings\n3. Orchestrator spawns subagent batches, monitors progress\n4. Updates beads on completion/blockers\n\n**Stretch:** Configurable subagents vs external sessions (az-zg9j)","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-19T11:09:41.316984+11:00","updated_at":"2025-12-19T11:15:56.423972+11:00","dependencies":[{"issue_id":"az-wn3o","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-19T11:14:30.801875+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-wwui","title":"Mouse events support","description":"**Status:** Deferred to post-MVP\n\n## Overview\nAdd mouse event handling to the TUI framework. The config already has a `mouse: Bool` field but implementation is deferred.\n\n## Features\n- Mouse click detection (x, y coordinates)\n- Mouse movement tracking (hover)\n- Mouse button identification (left, right, middle)\n- Scroll wheel events\n\n## Implementation Notes\n- Requires ANSI mouse tracking escape sequences\n- Enable: `\\x1b[?1000h` (basic) or `\\x1b[?1003h` (any event)\n- Disable: `\\x1b[?1000l`\n- Events come as escape sequences: `\\x1b[M\u003cbutton\u003e\u003cx\u003e\u003cy\u003e`\n\n## Reference\n- OpenTUI mouse handling (if present)\n- ANSI mouse tracking: https://invisible-island.net/xterm/ctlseqs/ctlseqs.html\n\n## Blocked By\n- Runtime (az-d19m) must be complete first\n\n## Why Deferred\nMouse is not required for Azedarach MVP - keyboard navigation is sufficient for the Kanban board.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T12:07:33.635045+11:00","updated_at":"2025-12-28T12:07:33.635045+11:00","labels":["deferred","gleam","input","tui-core"],"dependencies":[{"issue_id":"az-wwui","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T12:07:48.715183+11:00","created_by":"daemon"},{"issue_id":"az-wwui","depends_on_id":"az-d19m","type":"blocks","created_at":"2025-12-28T12:07:48.932984+11:00","created_by":"daemon"}]}
{"id":"az-x4e","title":"avoid useEffect, useMemo, useState, etc.","description":"switch from react hooks such as those in the title to fully encapsulating state mgmt in effect services","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:24:52.577357+11:00","updated_at":"2025-12-17T15:03:52.386143+11:00","dependencies":[{"issue_id":"az-x4e","depends_on_id":"az-wiu","type":"blocks","created_at":"2025-12-17T15:59:52.10568+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-xe2h","title":"tui_core: FrameBuffer - 2D cell grid with hex color support","description":"Port OpenTUI's FrameBuffer concept to Gleam.\n\n## What\nA 2D array of cells where each cell has:\n- Character (grapheme)\n- Foreground color (uses Color type from az-hkfa)\n- Background color\n- Attributes (bold, dim, underline, etc.)\n\n## API (Gleam)\n```gleam\ntype Cell { \n  Cell(\n    char: String, \n    fg: Color,      // From tui_core/color\n    bg: Color, \n    attrs: Attrs,   // Bitflags: Bold | Dim | Underline | Italic\n  ) \n}\n\ntype FrameBuffer { \n  FrameBuffer(\n    width: Int, \n    height: Int, \n    cells: Array(Cell),\n    dirty: Set(Int),  // Track which cells changed for efficient diff\n  ) \n}\n\nfn new(width: Int, height: Int) -\u003e FrameBuffer\nfn set_cell(fb: FrameBuffer, x: Int, y: Int, cell: Cell) -\u003e FrameBuffer\nfn get_cell(fb: FrameBuffer, x: Int, y: Int) -\u003e Cell\nfn fill_rect(fb: FrameBuffer, x: Int, y: Int, w: Int, h: Int, cell: Cell) -\u003e FrameBuffer\nfn draw_text(fb: FrameBuffer, x: Int, y: Int, text: String, fg: Color, bg: Color) -\u003e FrameBuffer\nfn clear(fb: FrameBuffer) -\u003e FrameBuffer\nfn resize(fb: FrameBuffer, width: Int, height: Int) -\u003e FrameBuffer\nfn get_dirty_cells(fb: FrameBuffer) -\u003e List(#(Int, Int, Cell))\nfn clear_dirty(fb: FrameBuffer) -\u003e FrameBuffer\n```\n\n## Dependencies\n- az-hkfa: Color utilities (for Color type)\n\n## Reference\n- OpenTUI FrameBuffer: packages/core/src/buffer.ts\n\n## Acceptance Criteria\n- [ ] Cell type with char, colors, and attributes\n- [ ] Efficient 2D array storage (consider flat array with index calculation)\n- [ ] Basic drawing operations work correctly\n- [ ] Dirty cell tracking for efficient re-rendering\n- [ ] Bounds checking on all operations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:26:07.426801+11:00","updated_at":"2025-12-28T11:35:21.414988+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-xe2h","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.590844+11:00","created_by":"daemon"},{"issue_id":"az-xe2h","depends_on_id":"az-hkfa","type":"blocks","created_at":"2025-12-28T11:33:58.159957+11:00","created_by":"daemon"}]}
{"id":"az-xi1r","title":"i want to enable the user to use claude code competitors","description":"e.g. they can configure to use opencode instead. we can just allow this one for now","design":"## Implementation Plan: CLI Tool Abstraction Layer + Settings UI\n\n### Overview\nCreate a structured CLI tool abstraction that allows users to switch between `claude` and `opencode`. The abstraction handles tool-specific command construction, flag mappings, model configuration, and leverages OpenCode's richer event system for better session status detection. Additionally, add an in-app settings overlay accessible via Ctrl+, for configuring these options.\n\n### Key Design Decisions\n\n1. **Scope**: Per-project config, applies to NEW sessions only\n2. **Architecture**: Full abstraction layer with tool-specific behaviors\n3. **Config Style**: Structured selector with validation\n4. **Model Config**: Add global model preference to config\n5. **Settings UI**: Ctrl+, opens extensible settings overlay\n\n---\n\n### NEW: Settings Overlay (Ctrl+,)\n\n**Trigger:** `Ctrl+,` (like VS Code) in normal mode\n\n**Design Goals:**\n- Extensible section-based layout for future config options\n- Live config updates (writes to `.azedarach.json`)\n- Escape to dismiss, Tab to navigate sections\n\n**Initial Sections:**\n1. **AI Tool** - Select CLI tool (claude/opencode)\n2. **Model** - Configure default and chat models\n\n**Future Sections (extensible):**\n- Session (shell, tmux prefix, permissions)\n- Git (auto-PR, branch naming)\n- UI (theme, keybindings)\n- Beads (sync behavior)\n\n**UI Layout:**\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                                  â”‚\nâ”‚  â”Œâ”€ AI Tool â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  CLI Tool:    [claude â–¼]                  â”‚  â”‚\nâ”‚  â”‚               claude | opencode           â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                  â”‚\nâ”‚  â”Œâ”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Default:     [sonnet_____________]       â”‚  â”‚\nâ”‚  â”‚  Chat:        [haiku______________]       â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                  â”‚\nâ”‚  [Tab] Next section  [Enter] Edit  [Esc] Close  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Keyboard Handling:**\n| Key | Action |\n|-----|--------|\n| Escape | Close settings, save changes |\n| Tab / Shift+Tab | Navigate between fields |\n| Enter | Edit current field (opens selector/input) |\n| j/k | Navigate within section |\n| h/l | Change enum value (claude â†” opencode) |\n\n**Implementation Files:**\n\n1. **NEW: `src/ui/SettingsOverlay.tsx`**\n   - Main settings overlay component\n   - Section-based layout with collapsible groups\n   - Uses `currentOverlayAtom` for state\n\n2. **NEW: `src/ui/settings/SettingsSection.tsx`**\n   - Reusable section container\n   - Header with title, collapsible content\n\n3. **NEW: `src/ui/settings/SettingField.tsx`**\n   - Field types: `select`, `text`, `toggle`\n   - Handles focus state and editing\n\n4. **MODIFY: `src/services/OverlayService.ts`**\n   - Add `{ _tag: \"settings\" }` to Overlay union\n\n5. **MODIFY: `src/services/keyboard/bindings.ts`**\n   - Add `C-,` binding in normal mode\n\n6. **MODIFY: `src/ui/hooks/useOverlays.ts`**\n   - Add `showSettings()` action and `showingSettings` flag\n\n7. **NEW: `src/services/SettingsService.ts`**\n   - Read/write `.azedarach.json`\n   - Validate changes against schema\n   - Publish config changes to subscribers\n\n**Settings State:**\n```typescript\ninterface SettingsState {\n  focusedSection: number      // 0 = AI Tool, 1 = Model\n  focusedField: number        // Field within section\n  editingField: boolean       // Input mode active\n  pendingChanges: Partial\u003cAppConfig\u003e  // Unsaved changes\n}\n```\n\n**SettingsService API:**\n```typescript\nexport class SettingsService extends Effect.Service\u003cSettingsService\u003e()(\"SettingsService\", {\n  effect: Effect.gen(function* () {\n    const configPath = yield* resolveConfigPath()\n    const config = yield* SubscriptionRef.make\u003cAppConfig\u003e(defaultConfig)\n    \n    return {\n      config,  // Reactive config state\n      \n      load: () =\u003e Effect.gen(function* () {\n        const raw = yield* readJsonFile(configPath)\n        const parsed = yield* Schema.decode(AppConfigSchema)(raw)\n        yield* SubscriptionRef.set(config, parsed)\n      }),\n      \n      update: \u003cK extends keyof AppConfig\u003e(key: K, value: AppConfig[K]) =\u003e\n        Effect.gen(function* () {\n          yield* SubscriptionRef.update(config, (c) =\u003e ({ ...c, [key]: value }))\n          yield* writeJsonFile(configPath, yield* SubscriptionRef.get(config))\n        }),\n      \n      getField: \u003cK extends keyof AppConfig\u003e(key: K) =\u003e\n        SubscriptionRef.get(config).pipe(Effect.map((c) =\u003e c[key]))\n    }\n  })\n}) {}\n```\n\n---\n\n### Model Configuration\n\n**Current State:**\n- Models only passed per-session via `StartSessionOptions.model`\n- Chat sessions hardcoded to `haiku`\n- No global config option\n\n**Proposed Config:**\n```typescript\nconst AppConfigSchema = Schema.Struct({\n  cliTool: Schema.optional(Schema.Literal(\"claude\", \"opencode\")),\n  \n  model: Schema.optional(Schema.Struct({\n    default: Schema.optional(Schema.String),\n    chat: Schema.optional(Schema.String),\n  })),\n  \n  session: Schema.Struct({ /* existing */ }),\n})\n```\n\n**Model Format Per Tool:**\n| Tool | Format | Examples |\n|------|--------|----------|\n| Claude | Short name | `haiku`, `sonnet`, `opus` |\n| OpenCode | Provider/model | `anthropic/claude-sonnet`, `openai/gpt-4o` |\n\n---\n\n### Hook System Comparison\n\n| Claude Code | OpenCode | Purpose |\n|-------------|----------|---------|\n| `.claude/settings.json` hooks | `.opencode/plugin/` JS modules | Config location |\n| `SessionStart` | `session.created` | Run `bd prime` at start |\n| `PreToolUse` | `tool.execute.before` | Block/modify tool calls |\n| `PreCompact` | `session.compacted` | Pre-compaction hooks |\n\n---\n\n### OpenCode Superior Status Detection\n\nOpenCode's plugin events enable **much better session status tracking**:\n\n| Status | Claude Code Detection | OpenCode Detection |\n|--------|----------------------|-------------------|\n| `busy` | Hook signal OR PTY pattern | `tool.execute.before` + `message.updated` |\n| `idle` | Hook signal OR PTY \"Done.\" | `session.idle` event (definitive!) |\n| `waiting` | Hook signal OR PTY `[y/n]` | `permission.updated` event (definitive!) |\n| `error` | Hook signal OR PTY \"Error:\" | `session.error` event (definitive!) |\n\n---\n\n### Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CliToolRegistry                           â”‚\nâ”‚  Maps tool names â†’ CliToolDefinition                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                          â”‚\n                          â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   CliToolDefinition                          â”‚\nâ”‚  - name: \"claude\" | \"opencode\"                              â”‚\nâ”‚  - executable: string                                        â”‚\nâ”‚  - buildCommand(opts): string                                â”‚\nâ”‚  - modelFlag: (model) =\u003e string                              â”‚\nâ”‚  - modelFormat: \"short\" | \"provider/model\"                   â”‚\nâ”‚  - hookConfigDir: \".claude\" | \".opencode\"                    â”‚\nâ”‚  - statusDetection: \"hooks+pty\" | \"events\"                   â”‚\nâ”‚  - sessionNamePrefix: \"claude\" | \"opencode\"                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Complete File Changes\n\n**Core:**\n1. **NEW: `src/core/CliToolRegistry.ts`** - Tool definitions + command builders\n2. **MODIFY: `src/config/schema.ts`** - Add `cliTool`, `model.default`, `model.chat`\n3. **MODIFY: `src/config/defaults.ts`** - Default values\n4. **MODIFY: `src/core/ClaudeSessionManager.ts` â†’ `SessionManager.ts`** - Use registry\n5. **MODIFY: `src/core/TmuxSessionMonitor.ts`** - Tool-specific prefixes\n\n**Settings UI:**\n6. **NEW: `src/services/SettingsService.ts`** - Config read/write/subscribe\n7. **NEW: `src/ui/SettingsOverlay.tsx`** - Main settings UI\n8. **NEW: `src/ui/settings/SettingsSection.tsx`** - Section container\n9. **NEW: `src/ui/settings/SettingField.tsx`** - Field components\n10. **MODIFY: `src/services/OverlayService.ts`** - Add settings overlay type\n11. **MODIFY: `src/services/keyboard/bindings.ts`** - Add Ctrl+, binding\n12. **MODIFY: `src/services/keyboard/InputHandlersService.ts`** - Settings input handling\n13. **MODIFY: `src/ui/hooks/useOverlays.ts`** - Add showSettings\n14. **MODIFY: `src/ui/App.tsx`** - Render SettingsOverlay\n\n**OpenCode Support:**\n15. **NEW: Template `.opencode/plugin/azedarach.js`** - Status events + hooks\n\n**Documentation:**\n16. **MODIFY: `docs/keybindings.md`** - Add Ctrl+, to docs\n17. **MODIFY: `docs/README.md`** - Document CLI tool and model config\n\n### Usage Examples\n\n**.azedarach.json (Claude):**\n```json\n{\n  \"cliTool\": \"claude\",\n  \"model\": {\n    \"default\": \"sonnet\",\n    \"chat\": \"haiku\"\n  }\n}\n```\n\n**.azedarach.json (OpenCode):**\n```json\n{\n  \"cliTool\": \"opencode\",\n  \"model\": {\n    \"default\": \"anthropic/claude-sonnet\",\n    \"chat\": \"anthropic/claude-haiku\"\n  }\n}\n```\n\n### Acceptance Criteria\n\n- [ ] User can set `cliTool: \"opencode\"` in config\n- [ ] User can set `model.default` and `model.chat` in config\n- [ ] Ctrl+, opens settings overlay\n- [ ] Settings overlay shows AI Tool and Model sections\n- [ ] Changes persist to `.azedarach.json`\n- [ ] New sessions spawn with correct CLI tool and model\n- [ ] Existing sessions unaffected by config changes\n- [ ] Session naming uses tool prefix (claude-xxx vs opencode-xxx)\n- [ ] OpenCode plugin template provided for status events\n- [ ] Type-safe config with validation errors\n- [ ] Documentation updated","notes":"## Session 2 Progress (2025-12-22)\n\n### Completed âœ“\n\n**OpenCode Plugin Ecosystem:**\n1. âœ“ Discovered existing `opencode-beads` plugin (handles bd prime, /bd-* commands)\n2. âœ“ Created `.opencode/plugin/azedarach.js` for session status monitoring\n3. âœ“ Installed globally at `~/.config/opencode/plugin/azedarach.js`\n\n**Skills Integration:**\n4. âœ“ Created `scripts/generate-opencode-skills.sh` - converts Claude skills to OpenCode format\n5. âœ“ Generated 19 skill wrappers for Chefy\n6. âœ“ Generated skill wrappers for Azedarach\n\n**CLI Command:**\n7. âœ“ Added `az opencode init` command for easy project setup\n   - Creates/updates opencode.json\n   - Checks global plugin installation\n   - Generates skill wrappers\n\n**Project Setup:**\n8. âœ“ Azedarach: opencode.json, AGENTS.md, skills\n9. âœ“ Chefy: opencode.json, skills, plugin\n\n### Remaining\n\n- [ ] Settings UI (Ctrl+, overlay) - lower priority\n- [ ] Consider publishing azedarach plugin to npm\n\n### Key Files\n\n- `.opencode/plugin/azedarach.js` - Session status plugin\n- `scripts/generate-opencode-skills.sh` - Skill generator\n- `src/cli/index.ts` - Added opencodeCommand","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T23:12:20.614607+11:00","updated_at":"2025-12-22T11:01:53.407255+11:00"}
{"id":"az-xw8","title":"Generate hooks config when spawning sessions","description":"SessionManager generates .claude/hooks.json in worktree when spawning sessions. Hooks auto-sync beads on Stop event and update issue notes. Pure bash-based automation without MCP overhead.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:25:00.000819+11:00","updated_at":"2025-12-12T13:25:20.656259+11:00","dependencies":[{"issue_id":"az-xw8","depends_on_id":"az-aiu","type":"blocks","created_at":"2025-12-12T13:25:32.748995+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-zby","title":"bd sync incorrectly tombstones issues that exist in JSONL","description":"When running `bd sync`, issues that exist in both the JSONL (from git) and the local database are incorrectly tombstoned instead of being reconciled.\n\n**Symptoms:**\n- After `bd sync`, issues disappear from the TUI/CLI\n- Database shows issues as `status='tombstone'` \n- JSONL file still contains the issues with valid status (open/closed)\n- No entries in deletions.jsonl for these tombstoned issues\n\n**Root cause hypothesis:**\nThe sync merge logic treats \"issue in JSONL but state differs from DB\" as \"deleted\" rather than \"updated from another branch\". This particularly affects issues merged from worktree branches.\n\n**Workaround:**\nManual SQL recovery to restore status from JSONL:\n```sql\nUPDATE issues SET status='\u003cjsonl_status\u003e', closed_at='\u003cjsonl_closed_at\u003e' WHERE id='\u003cid\u003e';\n```\n\n**Affected:** 21 issues in one incident (2025-12-18)","notes":"**Additional finding (2025-12-18):**\n\n`bd sync --import-only` does NOT recover tombstoned issues. It says \"8 skipped\" for issues that are tombstoned in the database but have valid status in JSONL.\n\nThe import logic appears to skip any issue that already exists in the DB, regardless of whether it's tombstoned. It should compare the JSONL status against DB status and update if JSONL has a non-tombstone status.\n\n**Affected code path:**\n- Azedarach's PRWorkflow.ts:724 calls `syncImportOnly` after git merge\n- This call is silently failing to recover tombstoned issues\n- The `Effect.catchAll(() =\u003e Effect.void)` means failures are swallowed\n\n**The fix should be in beads' import logic** - when importing from JSONL:\n1. If JSONL status is valid (not tombstone) AND DB status is tombstone\n2. Update DB to match JSONL status (un-tombstone the issue)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T02:12:15.839482+11:00","updated_at":"2025-12-18T02:16:18.616471+11:00","labels":["beads-upstream","data-loss"]}
{"id":"az-zg9j","title":"Stretch: configurable subagents vs external sessions","description":"Future enhancement: make it configurable whether orchestrator uses Task tool subagents or spawns external Claude Code sessions for true parallelism","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-19T11:14:04.695528+11:00","updated_at":"2025-12-19T11:14:04.695528+11:00","dependencies":[{"issue_id":"az-zg9j","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.945128+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-zg9j","depends_on_id":"az-md0x","type":"blocks","created_at":"2025-12-19T11:14:22.411606+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-zh3y","title":"tui_core: Input handling - keyboard events and raw mode","description":"Handle keyboard input in raw terminal mode.\n\n## What\n- Enter raw mode (disable line buffering, echo)\n- Parse ANSI escape sequences for special keys (arrows, function keys, etc.)\n- Emit typed key events\n\n## API (Gleam)\n```gleam\ntype Key {\n  Char(String)\n  Enter | Escape | Tab | Backspace | Delete | Space\n  Up | Down | Left | Right\n  Home | End | PageUp | PageDown\n  F(Int)  // F1-F12\n}\n\ntype Modifiers {\n  Modifiers(shift: Bool, ctrl: Bool, alt: Bool)\n}\n\ntype KeyEvent { \n  KeyEvent(key: Key, modifiers: Modifiers) \n}\n\ntype InputHandler\n\n/// Initialize input handling (enters raw mode)\nfn start() -\u003e Result(InputHandler, Error)\n\n/// Poll for input with timeout (non-blocking)\nfn poll(handler: InputHandler, timeout_ms: Int) -\u003e Option(KeyEvent)\n\n/// Read next key event (blocking)\nfn read(handler: InputHandler) -\u003e KeyEvent\n\n/// Clean up (exits raw mode)\nfn stop(handler: InputHandler) -\u003e Nil\n```\n\n## ANSI Escape Sequences for Special Keys\n```\n\\\\x1b[A  - Up arrow\n\\\\x1b[B  - Down arrow\n\\\\x1b[C  - Right arrow\n\\\\x1b[D  - Left arrow\n\\\\x1b[H  - Home\n\\\\x1b[F  - End\n\\\\x1b[5~ - Page Up\n\\\\x1b[6~ - Page Down\n\\\\x1bOP  - F1\n...\n```\n\n## Implementation Notes\n- May need platform-specific code (termios on Unix)\n- Consider using Etch if it handles this\n- Ctrl+key comes as byte value (Ctrl+C = 0x03)\n- Need to handle multi-byte sequences atomically\n\n## Reference\n- OpenTUI input: packages/core/src/cli-renderer.ts\n- Etch (Gleam terminal): https://github.com/bananaofhappiness/etch\n\n## Acceptance Criteria\n- [ ] Raw mode enters/exits cleanly\n- [ ] Regular character input works\n- [ ] Arrow keys detected correctly\n- [ ] Ctrl+key combinations work (esp. Ctrl+C)\n- [ ] Function keys work\n- [ ] No blocking issues on poll\n- [ ] Terminal restored on exit (even on crash)","notes":"## Implementation Complete - 2025-12-29\n\nCreated `/gleam/src/tui_core/input.gleam` which wraps Etch's event handling.\n\n### API Summary\n\n**Types (re-exported from etch/event):**\n- `Event` - Terminal events (Key, Mouse, Resize, FocusGained, FocusLost)\n- `KeyEvent` - Key press with code, modifiers, kind, state, text\n- `MouseEvent` - Mouse events with kind, column, row, modifiers\n- `KeyCode` - Which key was pressed (Char, UpArrow, Enter, Esc, F(n), etc.)\n- `Modifiers` - Modifier keys (shift, alt, control, super, hyper, meta)\n- `EventError` - Parse errors\n\n**Terminal Control:**\n- `init()` - Enter raw mode, alt screen, hide cursor, start event server\n- `init_with_mouse()` - Same + enable mouse capture\n- `cleanup()` - Show cursor, leave alt screen, exit raw mode\n- `cleanup_with_mouse()` - Same + disable mouse capture\n\n**Event Handling:**\n- `poll(timeout_ms)` - Non-blocking event read with timeout\n- `read()` - Blocking event read\n\n**Helper Functions:**\n- `is_key(evt, key_code)` - Check if event matches a key\n- `has_ctrl/alt/shift/super(key_event)` - Check modifiers\n- `has_any_modifier(key_event)` - Any modifier pressed\n- `get_char(key_event)` - Extract char from Char key code\n- `as_key/as_mouse/as_resize(evt)` - Type-safe extraction\n- `is_key_event/is_mouse_event/is_resize_event(evt)` - Type checks\n- `terminal_size()` - Get current terminal dimensions\n\n### Usage Pattern\n```gleam\nimport tui_core/input\nimport etch/event.{Key, Char, Esc}\nimport gleam/option.{None, Some}\n\npub fn main() {\n  input.init()\n  loop()\n}\n\nfn loop() {\n  case input.poll(100) {\n    Some(Ok(Key(k))) -\u003e case k.code {\n      Char(\"q\") | Esc -\u003e input.cleanup()\n      _ -\u003e loop()\n    }\n    _ -\u003e loop()\n  }\n}\n```\n\n### Acceptance Criteria Status\n- [x] Types re-exported correctly\n- [x] init() enters raw mode and alt screen\n- [x] cleanup() restores terminal\n- [x] poll() returns event or None based on timeout\n- [x] read() blocks until event received\n- [x] Helper functions work correctly\n- [x] `gleam build` succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T11:26:08.074138+11:00","updated_at":"2025-12-29T15:16:03.70551+11:00","closed_at":"2025-12-29T15:16:03.70551+11:00","close_reason":"Implemented tui_core/input.gleam wrapping Etch event handling with init/cleanup, poll/read, and key event helpers.","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-zh3y","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.800339+11:00","created_by":"daemon"},{"issue_id":"az-zh3y","depends_on_id":"az-lvah","type":"blocks","created_at":"2025-12-28T11:41:51.130935+11:00","created_by":"daemon"},{"issue_id":"az-zh3y","depends_on_id":"az-kwwr","type":"blocks","created_at":"2025-12-28T11:52:29.44578+11:00","created_by":"daemon"}]}
{"id":"az-zv6","title":"Automation \u0026 Workflows","description":"Automated workflows: PR creation, state transition hooks, notifications, and beads sync coordination.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:04.97152+11:00","updated_at":"2025-12-11T14:44:04.97152+11:00"}
