{"id":"az-010","title":"[Deleted]","description":"","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-17T03:55:46.593449Z","updated_at":"2025-12-17T14:56:41.393066+11:00","deleted_at":"2025-12-17T03:55:46.593449Z","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-01oo","title":"use better formatting for elapsed time. e.g. hours, days etc not just minutes","description":"","design":"## Problem\nCurrent elapsed time shows as `MM:SS` (e.g., \"61:05\"), which becomes hard to read for longer sessions and doesn't show days/hours clearly.\n\n## Solution\nImplement adaptive elapsed time formatting that shows the most relevant units:\n- Under 1 minute: `45s`\n- Under 1 hour: `5m 30s`  \n- Under 1 day: `2h 15m`\n- 1+ days: `1d 3h`\n\n## Changes\n1. **`src/services/ClockService.ts`**: Update `formatElapsedMs()` to use adaptive formatting\n   - Keep the existing function signature (takes ms, returns string)\n   - Implement unit selection logic based on total duration\n   - Show at most 2 units for readability\n\n2. **`src/ui/DetailPanel.tsx`**: Remove duplicate `formatDuration()` \n   - Import and use the shared `formatElapsedMs()` instead\n   - Ensures consistent formatting across the app\n\n## Testing\n- Verify task card timer updates correctly\n- Verify detail panel duration displays correctly\n- Check edge cases: \u003c1min, exactly 1h, multi-day sessions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T03:50:33.940037+11:00","updated_at":"2025-12-21T01:59:33.604915+11:00","closed_at":"2025-12-21T01:59:33.604917+11:00","close_reason":"Implemented using Effect's Duration.format for human-readable elapsed time (e.g., \"1h 5m 30s\")"}
{"id":"az-04d","title":"Add \"Merge to main\" action for completed worktree tasks","description":"When a task is done (manual mode, not CV mode), user should be able to press Space ‚Üí m to merge the worktree branch to main and clean up.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T21:49:14.135837+11:00","updated_at":"2025-12-16T22:21:47.442705+11:00","closed_at":"2025-12-16T22:21:47.442705+11:00"}
{"id":"az-05na","title":"add filter mode where i can filter by stuff like status, priority, session, type, etc","description":"","design":"## Filter Mode Design\n\n### Overview\nAdd a menu-based filter mode (triggered by `f` key) that allows filtering tasks by:\n- **Status**: open, in_progress, blocked, closed\n- **Priority**: P0, P1, P2, P3, P4\n- **Type**: bug, feature, task, epic, chore\n- **Session state**: idle, busy, waiting, done, error, paused\n\n### UI Pattern\nFollow the existing SortMenu pattern - a floating panel in bottom-right showing filter options with single-key toggles.\n\n### Key Decisions\n1. **Trigger**: `f` key enters filter mode\n2. **UI Style**: Menu-based (like sort mode) - more discoverable than text syntax\n3. **Persistence**: Filters persist until explicitly cleared (like search)\n4. **Fields**: Core fields only (status, priority, type, session)\n\n### Architecture\n\n#### 1. EditorService Changes\n```typescript\n// New types\ntype FilterField = \"status\" | \"priority\" | \"type\" | \"session\"\n\ninterface FilterConfig {\n  status: Set\u003cIssueStatus\u003e      // Empty = show all\n  priority: Set\u003cnumber\u003e          // Empty = show all\n  type: Set\u003cIssueType\u003e          // Empty = show all\n  session: Set\u003cSessionState\u003e     // Empty = show all\n}\n\n// New mode variant\n| { readonly _tag: \"filter\"; readonly activeField: FilterField | null }\n\n// New state\nfilterConfig: SubscriptionRef\u003cFilterConfig\u003e\n```\n\n#### 2. Keyboard Flow\n- `f` ‚Üí Enter filter mode (show menu)\n- In filter mode:\n  - `s` ‚Üí Toggle status sub-menu\n  - `p` ‚Üí Toggle priority sub-menu  \n  - `t` ‚Üí Toggle type sub-menu\n  - `S` (shift) ‚Üí Toggle session sub-menu\n  - Number keys (0-4) ‚Üí Toggle priority when in priority sub-menu\n  - Letter keys ‚Üí Toggle specific values in active sub-menu\n  - `c` ‚Üí Clear all filters\n  - `Escape` ‚Üí Exit filter mode\n\n#### 3. FilterMenu Component\nSimilar to SortMenu - positioned bottom-right, shows:\n- Current active filters (highlighted)\n- Sub-menu keys (s/p/t/S)\n- When sub-menu active, show toggle options\n\n#### 4. BoardService Integration\nExtend `filterTasks()` to apply FilterConfig alongside search query:\n```typescript\nconst filterTasks = (\n  tasks: TaskWithSession[], \n  query: string,\n  filterConfig: FilterConfig\n): TaskWithSession[]\n```\n\n#### 5. Filter Indicator\nShow active filter count in status bar: `[3 filters]`\n\n### Files to Modify\n1. `src/services/EditorService.ts` - Add filter mode and FilterConfig\n2. `src/services/keyboard/types.ts` - Add \"filter\" to KeyMode\n3. `src/services/keyboard/bindings.ts` - Add `f` binding\n4. `src/services/keyboard/InputHandlersService.ts` - Handle filter mode keys\n5. `src/services/BoardService.ts` - Extend filtering logic\n6. `src/ui/FilterMenu.tsx` - New component (like SortMenu)\n7. `src/ui/atoms/mode.ts` - Add filterConfig atom\n8. `src/ui/App.tsx` - Render FilterMenu, update status bar\n9. `docs/keybindings.md` - Document new bindings","acceptance_criteria":"- [ ] `f` key enters filter mode showing FilterMenu\n- [ ] Can filter by status (s key, then toggle specific statuses)\n- [ ] Can filter by priority (p key, then 0-4 to toggle)\n- [ ] Can filter by type (t key, then toggle specific types)\n- [ ] Can filter by session state (S key, then toggle states)\n- [ ] Multiple filters combine with AND logic\n- [ ] Filters persist until cleared (`c` key)\n- [ ] Status bar shows active filter count\n- [ ] Escape exits filter mode\n- [ ] Filtered tasks update reactively across all columns\n- [ ] Documentation updated in keybindings.md","notes":"## Implementation Complete ‚úÖ\n\n### Files Changed\n1. **src/services/EditorService.ts** - Added FilterConfig, filter mode type, all filter methods\n2. **src/services/keyboard/types.ts** - Added \"filter\" to KeyMode\n3. **src/services/keyboard/bindings.ts** - All filter keybindings (f, s, p, t, S, e, c, toggles)\n4. **src/services/keyboard/InputHandlersService.ts** - Added filter mode case\n5. **src/services/BoardService.ts** - Extended filterTasks, added isEpicChild computation\n6. **src/services/NavigationService.ts** - Updated to pass filterConfig\n7. **src/ui/FilterMenu.tsx** - New component with sub-menus and hideEpicSubtasks toggle\n8. **src/ui/atoms/mode.ts** - filterConfigAtom, activeFilterFieldAtom, enterFilterAtom\n9. **src/ui/atoms/index.ts** - Exported new atoms\n10. **src/ui/hooks/useEditorMode.ts** - Added filter state and actions\n11. **src/ui/App.tsx** - Integrated FilterMenu, updated modeDisplay\n12. **src/ui/StatusBar.tsx** - Added filter mode keybinding hints\n13. **src/ui/types.ts** - Added isEpicChild to TaskWithSession\n14. **docs/keybindings.md** - Full filter mode documentation\n\n### Features Implemented\n- **f** key enters filter mode\n- **s/p/t/S** sub-menus for status/priority/type/session\n- Toggle individual values within each field\n- **e** toggles hideEpicSubtasks (ON by default - encourages drill-down)\n- **c** clears all filters\n- Filters persist until cleared\n- Combines with text search (/)\n- Reactive updates across all columns\n\n### Type Check: PASSING ‚úÖ","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:49:34.854715+11:00","updated_at":"2025-12-19T13:51:06.436503+11:00","closed_at":"2025-12-19T13:51:06.436503+11:00","close_reason":"Implemented filter mode with FilterMenu component, keybindings for filtering by status/priority/type/session, and documented in keybindings.md","deleted_at":"2025-12-19T10:38:32.622274+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-05y","title":"Project Foundation","description":"Set up the core project infrastructure: TypeScript, Ink, CLI scaffolding, and foundational utilities.","notes":"Session 2025-12-11:\n\nEPIC PROGRESS: 3/4 tasks completed (75%)\n\nCOMPLETED CHILDREN:\n- az-ags: Project scaffolding ‚úÖ\n- az-fvj: BeadsClient Effect service ‚úÖ\n- az-kis: Utility modules ‚úÖ\n\nREMAINING:\n- az-2qy: CLI argument parsing with @effect/cli (ready to start)\n\nPHASE 1 DELIVERABLES:\n- Full project infrastructure with Bun + Effect + OpenTUI + SolidJS\n- Working CLI entry point (./bin/az.ts)\n- Core services: BeadsClient, TmuxService, TerminalService\n- Custom effect-atom SolidJS adapter (az-mq9, separate from this epic)\n\nNEXT SESSION:\n- Complete az-2qy (CLI parsing) to close this epic\n- Then move to Phase 2: TUI components (az-pza epic)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.657366+11:00","updated_at":"2025-12-12T10:24:42.833983+11:00","closed_at":"2025-12-12T10:24:42.833983+11:00"}
{"id":"az-06p","title":"TUI polish: card heights, priority labels, sticky action mode","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:23:49.590359+11:00","updated_at":"2025-12-12T10:23:55.435441+11:00","closed_at":"2025-12-12T10:23:55.435441+11:00"}
{"id":"az-09e","title":"Modularize KeyboardService into domain-specific handlers","description":"KeyboardService.ts is 1,572 lines - the largest service in the codebase.\n\nRefactor into smaller, focused modules:\n- **SessionKeyHandlers** - start/stop/pause/attach session actions\n- **NavigationKeyHandlers** - movement, selection, goto\n- **TaskKeyHandlers** - create/edit/delete/move tasks\n- **PRKeyHandlers** - PR creation, merge, cleanup\n- **ModeKeyHandlers** - mode transitions (search, command, etc.)\n\nEach module exports handler functions that KeyboardService composes.\nThis improves maintainability and makes testing individual handlers easier.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:44.99229+11:00","updated_at":"2025-12-18T02:14:02.605045+11:00","closed_at":"2025-12-17T16:54:21.233588+11:00","close_reason":"KeyboardService modularized: 1,571 ‚Üí 236 lines main file, 7 new domain-specific modules created","deleted_at":"2025-12-18T02:14:02.605045+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"chore"}
{"id":"az-0gh","title":"pretooluse hook seems to trigger before requesting permissions and other stuff","description":"so we should be able to use it to update session status in az right?","notes":"## Implementation Complete ‚úÖ\n\n### Changes Made\n\n**1. `src/cli/index.ts`** - Added `pretooluse` to VALID_HOOK_EVENTS\n- az notify now accepts pretooluse as a valid event type\n\n**2. `src/core/HookReceiver.ts`** - Updated HookEventType and mapEventToState\n- Added `pretooluse` and `permission_request` to the union type\n- Documented the event timing in comments\n- Added state mappings:\n  - `pretooluse` ‚Üí \"busy\" (Claude attempting tool)\n  - `permission_request` ‚Üí \"waiting\" (needs user approval)\n\n**3. `src/core/hooks.ts`** - Added PreToolUse hook to generateHookConfig\n- New sessions will automatically get PreToolUse hook installed\n- Fires BEFORE permission checks for immediate busy detection\n\n### State Transition Flow\n\n```\nClaude decides to use tool\n    ‚Üì\nPreToolUse fires ‚Üí \"busy\"\n    ‚Üì\nPermission system checks\n    ‚Üì\nPermissionRequest fires (if needed) ‚Üí \"waiting\"\n    ‚Üì\nUser approves ‚Üí tool executes ‚Üí \"busy\" continues\n    ‚Üì\nStop fires ‚Üí \"waiting\"\n```\n\n### Testing\n\n- Type check passes\n- Manual testing: Create new worktree, run `az install-hooks`, verify pretooluse hook in settings.local.json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:36:08.601508+11:00","updated_at":"2025-12-18T13:21:07.838832+11:00","closed_at":"2025-12-18T13:21:07.838832+11:00","close_reason":"Implemented PreToolUse hook for immediate busy detection. Also fixed permission_request mapping which was missing."}
{"id":"az-0h0","title":"TEST BEAD","description":"check bun version in a claude session made by az","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:04.88589+11:00","updated_at":"2025-12-18T14:25:09.651447+11:00","closed_at":"2025-12-18T14:25:09.65145+11:00","deleted_at":"2025-12-18T13:38:33.043454+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-0h3d","title":"Create orchestrator session template","description":"Create .claude/session-templates/orchestrator.md that injects:\n- Epic context (title, description, design, acceptance criteria)\n- Child task list with statuses\n- Coordination rules for serial subagent execution\n- Instructions to use Task tool for implementation\n- How to update beads with progress","design":"## Implementation Plan\n\n**File:** `.claude/session-templates/orchestrator.md`\n\n**Template Structure:**\n1. **Header** - Identify as orchestrator session with epic ID\n2. **Epic Context Section** - Inject epic details via mustache variables:\n   - `{{EPIC_ID}}`, `{{EPIC_TITLE}}`\n   - `{{EPIC_DESCRIPTION}}`, `{{EPIC_DESIGN}}`, `{{EPIC_ACCEPTANCE}}`\n3. **Child Tasks Table** - Formatted list showing:\n   - Task ID, title, status, priority\n   - Dependencies between children\n   - Use `{{#CHILDREN}}...{{/CHILDREN}}` block iteration\n4. **Orchestration Rules**:\n   - Spawn Task tool subagents in parallel batches\n   - Use `run_in_background: true` for parallelism\n   - Monitor with `TaskOutput` tool\n   - Update beads on completion/blockers\n5. **Workflow Instructions**:\n   - How to spawn subagents (with example)\n   - How to update beads with progress\n   - When to mark epic complete\n   - Error handling patterns\n6. **Beads Commands Reference** - Quick reference for bd CLI\n\n**Key Design Decisions:**\n- Use same mustache syntax as worker.md for consistency\n- Focus on Task tool usage patterns (different from worker template)\n- No quality-gate mention yet (az-j7qi in progress)\n- Include parallel batch spawning patterns\n\n**Variables Needed (for SessionManager):**\n- `EPIC_ID`, `EPIC_TITLE`, `EPIC_DESCRIPTION`, `EPIC_DESIGN`, `EPIC_ACCEPTANCE`\n- `CHILDREN` (array): `TASK_ID`, `TASK_TITLE`, `TASK_STATUS`, `TASK_PRIORITY`, `TASK_DESCRIPTION`, `TASK_DESIGN`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.3656+11:00","updated_at":"2025-12-19T11:53:36.033148+11:00","closed_at":"2025-12-19T11:52:04.54913+11:00","close_reason":"Created .claude/session-templates/orchestrator.md with: epic context injection (mustache variables), child task listing with status/priority/deps, Task tool subagent spawning patterns (parallel batches), TaskOutput monitoring workflow, beads CLI reference, coordination rules for parallel safety and error recovery","dependencies":[{"issue_id":"az-0h3d","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.677462+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T11:53:36.033148+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-0uey","title":"occaisional issue with space s \"worktree created but not found in list\"","description":"attached image","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:28:54.439086+11:00","updated_at":"2025-12-18T16:11:36.046616+11:00","closed_at":"2025-12-18T15:39:51.361674+11:00","close_reason":"Fixed race condition in WorktreeManager.create() by adding retry logic with Schedule. Git worktree list can sometimes miss newly created worktrees due to filesystem sync timing. Now retries up to 5 times with 100ms delays.","deleted_at":"2025-12-18T16:11:36.046616+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-1app","title":"create our own git diff tui for space f","description":"brainstorm features with me but my vision is basically just difftastic side by side, two or three modes: fzf/filetree/infinite scroll. fzf/filetree to find/filter files and an infinite scroll view (difftastic default)","design":"## DiffViewer TUI for Space+f\n\n### Overview\nFullscreen overlay that shows git diff (vs main) with three layout modes:\n1. **Split view (default)** - File picker on left (30%), diff content on right (70%)\n2. **Maximized diff** - Full-width diff view (file picker hidden)  \n3. **File picker only** - For quick file navigation\n\n### File Picker Modes (toggle with Tab)\n- **FZF mode** - Flat fuzzy-searchable list of changed files\n- **Tree mode** - Directory hierarchy view with expand/collapse\n\n### Diff Rendering\n- Shell out to `difft --display=side-by-side` per file\n- Capture ANSI output, render in scrollable OpenTUI view\n- For \"all files\" view: `GIT_EXTERNAL_DIFF=\"difft --display=side-by-side\" git diff main...HEAD`\n- Comparison target: `main...HEAD` (configurable baseBranch)\n\n### Keybindings\n| Key | Action |\n|-----|--------|\n| `Esc` | Exit to board |\n| `Tab` | Toggle fzf ‚Üî tree in file picker |\n| `j/k` | Navigate files / scroll diff |\n| `h/l` | Switch focus: file picker ‚Üî diff |\n| `Enter` | Select file ‚Üí show its diff |\n| `f` | Toggle file picker visibility (maximize diff) |\n| `/` | Search/filter mode |\n| `g/G` | Top/bottom of diff |\n| `{/}` | Previous/next file in diff |\n| `a` | Show all files diff (infinite scroll mode) |\n\n### Architecture\n```\nsrc/\n‚îú‚îÄ‚îÄ ui/\n‚îÇ   ‚îî‚îÄ‚îÄ DiffViewer/\n‚îÇ       ‚îú‚îÄ‚îÄ DiffViewer.tsx       # Main overlay component  \n‚îÇ       ‚îú‚îÄ‚îÄ FilePicker.tsx       # FZF/Tree file picker\n‚îÇ       ‚îú‚îÄ‚îÄ DiffContent.tsx      # Scrollable diff display\n‚îÇ       ‚îî‚îÄ‚îÄ types.ts             # Shared types\n‚îÇ\n‚îú‚îÄ‚îÄ services/\n‚îÇ   ‚îî‚îÄ‚îÄ DiffService.ts           # Git operations, difftastic subprocess\n```\n\n### DiffService API\n```typescript\ninterface ChangedFile {\n  path: string\n  status: \"added\" | \"modified\" | \"deleted\" | \"renamed\"\n  oldPath?: string  // for renames\n}\n\n// Get list of changed files\ngetChangedFiles(worktreePath: string, baseBranch: string): Effect\u003cChangedFile[]\u003e\n\n// Get difftastic output for single file\ngetFileDiff(worktreePath: string, baseBranch: string, filePath: string): Effect\u003cstring\u003e\n\n// Get difftastic output for all files  \ngetFullDiff(worktreePath: string, baseBranch: string): Effect\u003cstring\u003e\n```\n\n### State Management\n```typescript\ninterface DiffViewerState {\n  // Layout\n  layout: \"split\" | \"diff-only\" | \"picker-only\"\n  \n  // File picker\n  pickerMode: \"fzf\" | \"tree\"\n  files: ChangedFile[]\n  selectedIndex: number\n  filterText: string\n  \n  // Diff content\n  currentFile: string | null  // null = all files\n  diffContent: string\n  scrollOffset: number\n  \n  // Focus\n  focus: \"picker\" | \"diff\"\n}\n```\n\n### Integration Points\n- Replace current `showDiff` in PRHandlersService\n- Add DiffViewer to OverlayService stack types\n- Wire up Space+f to open overlay instead of tmux popup","acceptance_criteria":"## Acceptance Criteria\n\n### Must Have\n- [ ] Fullscreen overlay opens on Space+f (replaces lazygit popup)\n- [ ] Shows list of changed files vs main branch\n- [ ] File picker supports both FZF (flat) and Tree views, toggle with Tab\n- [ ] Selecting a file shows difftastic side-by-side output for that file\n- [ ] Can view all-files diff in infinite scroll mode\n- [ ] Proper scrolling with j/k/g/G in diff content\n- [ ] Esc exits cleanly back to board\n- [ ] Works for any task with an active worktree\n\n### Should Have  \n- [ ] Fuzzy search filtering in FZF mode (/ key)\n- [ ] Previous/next file navigation while in diff ({ and } keys)\n- [ ] Toggle file picker visibility (f key) to maximize diff\n- [ ] h/l to switch focus between panels\n\n### Nice to Have\n- [ ] Expand/collapse directories in tree mode\n- [ ] Show file status indicators (A/M/D/R) in picker\n- [ ] Remember scroll position when switching files\n- [ ] Search within diff content (/ in diff panel)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T02:47:14.538041+11:00","updated_at":"2025-12-21T03:25:46.286069+11:00"}
{"id":"az-1zd0","title":"improve claude initial prompts","description":"e.g. if the bead is not clear enough make sure the space s/S prompts say to ask questions and upgrade the bead till its clear and could be picked up by any claude session without extra research","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:57:42.883524+11:00","updated_at":"2025-12-19T02:23:16.906311+11:00","closed_at":"2025-12-19T02:23:16.906311+11:00","close_reason":"Merged to main: Improved Claude initial prompts to encourage bead self-sufficiency","deleted_at":"2025-12-19T02:15:58.662963+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-2doh","title":"merge in claude/improve-codebase-quality-tKmv7","description":"Merge the `claude/improve-codebase-quality-tKmv7` branch which contains 2 commits:\n1. `b75ffe4` - refactor: improve codebase quality\n2. `5df70e0` - refactor: move fiber tracking into HookReceiver service\n\nThese changes fix memory leaks and improve code quality.","design":"## Changes Being Merged\n\n### 1. Memory Leak Fixes (Effect.fork ‚Üí Effect.forkScoped)\n- **HookReceiver.ts**: Fix cleanup fiber that was immediately interrupted\n- **DiagnosticsService.ts**: Fix fiber status watcher that was immediately interrupted\n\n### 2. Service Pattern Fixes (effect: ‚Üí scoped:)\n- **HookReceiver**: Changed to `scoped:` since it spawns fibers via `forkScoped`\n- **DiagnosticsService**: Changed to `scoped:` since `registerFiber` uses `forkScoped`\n\n### 3. Naming Clarity\n- **EditorService.ts ‚Üí BeadEditorService.ts**: Rename to avoid confusion with other editor concepts\n- Remove legacy `EditorService` and `EditorServiceLive` aliases\n\n### 4. Code Organization\n- Move fiber registration from atoms.ts into HookReceiver service (better separation of concerns)\n- Fiber tracking now happens where the fiber is created\n\n### 5. Documentation\n- Add `scoped:` vs `effect:` guidance to CLAUDE.md with decision checklist\n\n## Implementation Plan\n\n1. Perform git merge of origin/claude/improve-codebase-quality-tKmv7\n2. Resolve any conflicts if they arise\n3. Run type-check to verify changes compile\n4. Run build to verify bundling works\n5. Commit the merge","acceptance_criteria":"- [ ] Branch successfully merged\n- [ ] No merge conflicts (or conflicts resolved)\n- [ ] `bun run type-check` passes\n- [ ] `bun run build` passes\n- [ ] Changes committed to az-2doh branch","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:38:41.602215+11:00","updated_at":"2025-12-19T00:40:33.371907+11:00","closed_at":"2025-12-19T00:40:33.371907+11:00","close_reason":"Merged claude/improve-codebase-quality-tKmv7 with conflict resolution. Fixed import paths, dynamic imports, and properly declared HookReceiver's dependency on DiagnosticsService."}
{"id":"az-2ek","title":"Add warning glyphs to TaskCard header","description":"Add tiny warning glyphs (‚ö†üîÑ) to TaskCard headerLine after session indicator. ‚ö† for context warning (\u003e70%), üîÑ for recently compacted. Space cost: 1-2 characters.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.779379+11:00","updated_at":"2025-12-12T13:25:20.429502+11:00","dependencies":[{"issue_id":"az-2ek","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.178601+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-2il","title":"Agent Mail status broadcast integration","description":"Workers broadcast status via Agent Mail for real-time TUI updates.\n\n**Events:**\n- STARTED: Worker began task\n- PROGRESS: Periodic heartbeat with context %\n- BLOCKED: Worker discovered blocker\n- COMPLETED: Worker finished task\n- ERROR: Worker encountered error\n\n**TUI subscription:**\n- Poll Agent Mail for status updates (or WebSocket if available)\n- Update TaskCard session indicators in real-time\n- Show toast for important events (blocked, error)\n\n**Depends on:** Agent Mail integration (az-l7a)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:15.170002+11:00","updated_at":"2025-12-14T02:13:25.698677+11:00","dependencies":[{"issue_id":"az-2il","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T13:29:24.916405+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-2il","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.86955+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-2m9","title":"search mode needs to accept enter/return to return to normal mode","description":"should have the selected item from search selected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:28:34.821948+11:00","updated_at":"2025-12-16T23:20:14.269865+11:00","closed_at":"2025-12-16T23:20:14.269868+11:00"}
{"id":"az-2p4","title":"the space m to merge feature should move the bead to closed too","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:41:22.254096+11:00","updated_at":"2025-12-18T02:20:57.249253+11:00","closed_at":"2025-12-18T02:20:57.249256+11:00","close_reason":"Fixed: Now commits and pushes bead close after merge to main","deleted_at":"2025-12-18T02:14:02.600677+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-2q75","title":"Add autoCompact option to SessionManager","description":"Add --auto-compact flag support to StartSessionOptions for long-running orchestrator sessions","design":"## Implementation Plan\n\n### Context\n- User has `autoCompactEnabled: false` in `~/.claude.json` (user preferences)\n- For long-running orchestrator sessions, we want auto-compact **enabled** to prevent context exhaustion\n- Claude CLI accepts `--settings '{\"autoCompactEnabled\": true}'` to override user settings\n\n### Approach: Use `--settings` CLI flag\n\nAdd `autoCompact?: boolean` to `StartSessionOptions`. When `true`, pass `--settings '{\"autoCompactEnabled\": true}'` to the Claude command.\n\n### Changes Required\n\n1. **`src/core/SessionManager.ts`**:\n   - Add `autoCompact?: boolean` to `StartSessionOptions` interface (line ~82)\n   - Destructure `autoCompact` in `start()` method (line ~391)\n   - Build `--settings` flag when `autoCompact: true` (line ~477)\n\n### Code Changes\n\n```typescript\n// In StartSessionOptions interface (around line 82):\nexport interface StartSessionOptions {\n  readonly beadId: string\n  readonly projectPath: string\n  readonly baseBranch?: string\n  readonly initialPrompt?: string\n  readonly model?: ClaudeModel\n  readonly dangerouslySkipPermissions?: boolean\n  /** Enable auto-compact for long-running sessions (default: false, uses user setting) */\n  readonly autoCompact?: boolean  // NEW\n}\n\n// In start() method, add to destructuring:\nconst { beadId, projectPath, baseBranch, initialPrompt, model, dangerouslySkipPermissions, autoCompact } = options\n\n// In Claude command building (around line 477):\nconst autoCompactFlag = autoCompact ? ` --settings '{\"autoCompactEnabled\":true}'` : \"\"\nconst claudeWithOptions = initialPrompt\n  ? `${claudeCommand}${modelFlag}${dangerousFlag}${autoCompactFlag} \"${escapeForShell(initialPrompt)}\"`\n  : `${claudeCommand}${modelFlag}${dangerousFlag}${autoCompactFlag}`\n```\n\n### Testing\n- Run type-check after changes\n- Manually verify Claude spawns with correct flags","acceptance_criteria":"- [ ] `autoCompact?: boolean` added to `StartSessionOptions` interface\n- [ ] When `autoCompact: true`, Claude is spawned with `--settings '{\"autoCompactEnabled\":true}'`\n- [ ] Type-check passes\n- [ ] Existing session spawning still works (no regression)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.247224+11:00","updated_at":"2025-12-19T14:13:39.604042+11:00","closed_at":"2025-12-19T14:13:39.604046+11:00","close_reason":"Added `autoCompact?: boolean` option to StartSessionOptions. When true, passes `--settings '{\\\"autoCompactEnabled\\\":true}'` to Claude CLI, overriding user's auto-compact setting for long-running orchestrator sessions.","dependencies":[{"issue_id":"az-2q75","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.58227+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T13:26:52.146078+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-2qy","title":"CLI argument parsing with @effect/cli","description":"Set up CLI entry point with argument parsing for the az command.","design":"- Use @effect/cli for type-safe argument parsing\n- Define Commands with Args and Options\n- Commands: az (default TUI), az start \u003cid\u003e, az attach \u003cid\u003e, az pause \u003cid\u003e, az status, az sync\n- Accept optional project path argument via Args.directory\n- Use Options for flags like --verbose, --config\n- Validate beads database exists before starting\n- Auto-generate shell completions (bash, zsh, fish)","notes":"Implemented complete CLI structure with @effect/cli:\n- Created src/cli/index.ts with all commands (default, start, attach, pause, status, sync)\n- Proper Option.Option handling for optional parameters\n- Type-safe argument parsing using Args and Options from @effect/cli\n- Integration with BeadsClient and BunContext\n- Help system auto-generates for all commands\n\nNOTE: Discovered potential issue with @effect/cli 0.72.1 where subcommands show help instead of executing. The CLI structure is correct per official docs, but runtime behavior needs investigation. Commands are properly registered (visible in help output) but not routing correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.3098+11:00","updated_at":"2025-12-11T18:03:13.670101+11:00","closed_at":"2025-12-11T18:03:13.670101+11:00","dependencies":[{"issue_id":"az-2qy","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.891408+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-2qy","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.453515+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-31h","title":"runGit doesn't extract stderr, breaking merge conflict detection","description":"The runGit helper in PRWorkflow.ts didn't extract stderr from platform errors. This caused merge conflict detection to fail because it checks e.stderr?.includes(\"CONFLICT\") which was always undefined.\n\nFixed by extracting stderr like BeadsClient does: `const stderr = \"stderr\" in error ? String(error.stderr) : String(error)`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T15:49:54.963322+11:00","updated_at":"2025-12-18T12:48:20.817252+11:00","closed_at":"2025-12-17T15:50:00.235259+11:00","close_reason":"Fixed runGit to extract stderr from platform errors, enabling proper conflict detection","deleted_at":"2025-12-18T12:48:20.817252+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"bug"}
{"id":"az-31i","title":"the claude create task feature needs work. we should use claude cli or something not a full claude ode session/instance","description":"","notes":"Analyzing current implementation and planning CLI-based approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:31.58228+11:00","updated_at":"2025-12-17T00:18:36.483483+11:00","closed_at":"2025-12-17T00:18:36.483483+11:00"}
{"id":"az-31iv","title":"when initCommands fail they say to look at diagnostics with shift-d but its actually just d","description":"","design":"**Analysis:**\nThe toast message in `SessionManager.ts:505` incorrectly says \"Press Shift+D for details\" but the actual keybinding in `src/services/keyboard/bindings.ts:200-203` is just `d` (lowercase, no shift).\n\n**Root Cause:**\nThe keybinding was likely changed at some point but the error message wasn't updated.\n\n**Fix:**\nChange line 505 in `src/core/SessionManager.ts` from:\n`Press Shift+D for details` ‚Üí `Press d for details`\n\n**Files to modify:**\n- `src/core/SessionManager.ts` (line 505)","acceptance_criteria":"- [ ] Error message says \"Press d for details\" not \"Press Shift+D for details\"\n- [ ] Type check passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:16:41.526182+11:00","updated_at":"2025-12-19T13:19:55.884127+11:00","closed_at":"2025-12-19T13:19:55.884127+11:00","close_reason":"Fixed toast message: changed 'Press Shift+D for details' to 'Press d for details' to match actual keybinding"}
{"id":"az-31ri","title":"dont import from \"node:*\"","description":"import from @effect/platform instead","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:13:35.004191+11:00","updated_at":"2025-12-18T16:24:34.410585+11:00","closed_at":"2025-12-18T16:24:34.410587+11:00","close_reason":"Removed all node:* imports. Services now use @effect/platform directly (Path.Path methods, crypto.randomUUID from Web Crypto API).","deleted_at":"2025-12-18T13:34:22.234383+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-385","title":"Epic drill-down view (focus mode for epic children)","description":"Press Enter on an epic ‚Üí switches to a focused board showing only that epic's children across status columns.\n\n**Visual:**\n```\n‚îå‚îÄ Open ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ In Progress ‚îÄ‚î¨‚îÄ Done ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ            ‚îÇ               ‚îÇ             ‚îÇ\n‚îÇ  ‚óÄ az-gds  ‚îÇ   Epic View   ‚îÇ  ‚ñà‚ñà‚ñà‚ñà‚ñë 3/5  ‚îÇ  ‚Üê Header bar\n‚îÇ            ‚îÇ               ‚îÇ             ‚îÇ\n‚îÇ  az-lqb    ‚îÇ  az-7sr ‚öô    ‚îÇ  az-aiu ‚úì   ‚îÇ\n‚îÇ  az-bjp    ‚îÇ               ‚îÇ  az-xxx ‚úì   ‚îÇ\n‚îÇ            ‚îÇ               ‚îÇ  az-yyy ‚úì   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n        [q] back   [Enter] open task\n```\n\n**Interaction:**\n- `Enter` on epic card ‚Üí enters drill-down view\n- `q` or `Escape` ‚Üí returns to main board\n- Navigation (hjkl) works normally within children\n- `Enter` on child task ‚Üí normal task actions\n\n**Implementation:**\n1. Add `drillDownEpic: string | null` to NavigationService state\n2. When set, Board filters to show only children of that epic\n3. Render epic header bar with back hint and progress\n4. `q` in drill-down clears the state, returns to main\n\n**Simpler than indentation because:**\n- No variable card heights\n- No tree-prefix rendering\n- No mixed item types in columns\n- Clean j/k navigation\n- Reuses existing Board/Column components","design":"## State Changes\n\nNavigationService:\n- Add `drillDownEpic: SubscriptionRef\u003cstring | null\u003e`\n- Add `enterDrillDown(epicId: string)` method\n- Add `exitDrillDown()` method\n\n## Atom Changes\n\n- `drillDownEpicAtom` - subscribes to navigation state\n- `filteredTasksAtom` - when drillDownEpic set, filter to children only\n- `epicHeaderAtom(epicId)` - returns epic title + progress for header\n\n## Component Changes\n\nBoard.tsx:\n- Check drillDownEpic state\n- If set, render EpicHeader + filtered children\n- If null, render normal board\n\nEpicHeader.tsx (new):\n- Shows: back arrow, epic ID, epic title, progress bar\n- Styled as top bar or overlay header\n\n## Keybinding Changes\n\nApp.tsx handleNormalMode:\n- `Enter` on epic type ‚Üí call `enterDrillDown(selectedId)`\n- `q` when in drillDown ‚Üí call `exitDrillDown()`\n\n## Progress Calculation\n\nQuery beads for children count by status:\n- Total children with parent = epicId\n- Closed children count\n- Format: `‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5` or percentage","acceptance_criteria":"- [ ] Enter on epic card opens drill-down view\n- [ ] Drill-down shows only that epic's children\n- [ ] Children displayed across normal status columns\n- [ ] Header shows epic info and progress bar\n- [ ] q or Escape returns to main board\n- [ ] hjkl navigation works in drill-down\n- [ ] Cursor position remembered when returning to main board","notes":"PR: ","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.298636+11:00","updated_at":"2025-12-19T02:10:23.189207+11:00","closed_at":"2025-12-19T02:10:23.18921+11:00","dependencies":[{"issue_id":"az-385","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.905066+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-38m","title":"can't seem to move beads with space + left/right arrow or l/h","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:27:05.835599+11:00","updated_at":"2025-12-18T12:48:20.818993+11:00","closed_at":"2025-12-17T15:35:44.455904+11:00","deleted_at":"2025-12-18T12:48:20.818993+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-3prx","title":"make space c to chat use a tmux claude session just like space s","description":"the popup is cool but prevents me from doing stuff while waiting for claude's response","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:24:21.445001+11:00","updated_at":"2025-12-19T10:34:30.145464+11:00","closed_at":"2025-12-19T10:34:30.145464+11:00","close_reason":"Implemented: Space+c now spawns a persistent tmux session (like Space+s) instead of a blocking popup. Session name is 'chat-\u003cbeadId\u003e' to distinguish from work sessions. Uses Haiku model, runs in current project directory (not worktree), and switches to the session immediately.","deleted_at":"2025-12-19T02:15:58.663928+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-3rk","title":"Add rate_limited session state","description":"Add 'rate_limited' to SessionState type and SESSION_INDICATORS map (‚è± glyph). Extend StateDetector patterns to detect rate limiting from Claude output (patterns like 'Rate limit', 'Too many requests', 'Please wait').","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.309325+11:00","updated_at":"2025-12-12T13:25:19.967333+11:00"}
{"id":"az-3rt","title":"task is stuck merging","description":"we need to be able to abort a merge and also we need to be able to attach to the merge claude session. we should re-use the current tmux session for merging if we havent already closed it.","notes":"Starting work. Issue analysis:\n\n1. When merge detects conflicts, PRWorkflow spawns Claude to resolve them\n2. There's no way to abort a merge that's stuck in conflict state\n3. No way to easily attach to the merge-resolution Claude session\n4. Task appears \"stuck\" with no recovery options\n\nPlan:\n1. Add `abortMerge` method to PRWorkflow - runs `git merge --abort`\n2. Add `Space+M` keybinding (abort merge) to prHandlers\n3. Ensure attach (`Space+a`) works for merge-resolution sessions\n4. Consider UI feedback for merge-in-progress state","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:45:11.402161+11:00","updated_at":"2025-12-18T13:34:18.518434+11:00","closed_at":"2025-12-18T13:34:18.518437+11:00","close_reason":"All requirements implemented: abortMerge() method with Space+M keybinding, attach works for merge sessions (same beadId), existing sessions are reused for merge conflict resolution.","deleted_at":"2025-12-18T12:32:12.232088+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-451","title":"Use immutable Data types in SubscriptionRef state","description":"Non-primitive state stored in SubscriptionRef should use Effect's immutable data types for proper equality and functional programming patterns.\n\n**Problems:**\n1. Objects/arrays without Data wrapping cause reference equality issues\n2. Mutable collections like `Map` don't play well with Effect's functional paradigm\n\n**Solutions:**\n\n**Data Wrapping:**\n- Use `Schema.Data` to wrap state schemas, OR\n- Manually wrap with `Data.array()` for arrays\n- Manually wrap with `Data.struct()` for objects/records\n\n**Immutable Collections:**\n- Replace `Map` with `ReadonlyRecord` (from `effect/Record`)\n- Replace `Set` with `HashSet` (from `effect/HashSet`)\n- Use `HashMap` if key hashing is needed\n\n**Specific changes:**\n- `tasksByColumn: Map\u003c...\u003e` ‚Üí `tasksByColumn: ReadonlyRecord\u003cstring, ReadonlyArray\u003cTask\u003e\u003e`\n\n**Files to audit:**\n- All services using SubscriptionRef with non-primitive state\n- Check EditorService, NavigationService, OverlayService, BeadsService, etc.","notes":"## Completed\n- ‚úÖ tasksByColumn: Map ‚Üí Record.ReadonlyRecord with emptyRecord() singleton\n- ‚úÖ jumpLabels: ReadonlyMap ‚Üí Record.ReadonlyRecord\n- ‚úÖ Created src/lib/empty.ts with singleton emptyRecord() and emptyArray()\n- ‚úÖ Updated all consumers: BoardService, KeyboardService, EditorService, atoms.ts, Board.tsx, CompactView.tsx, useEditorMode.ts, types.ts\n- ‚úÖ Board.tsx and CompactView.tsx now accept readonly TaskWithSession[] arrays\n- ‚úÖ Type errors from concurrent work FIXED in commit 092959c\n\n## Session 2025-12-15 Update\nThe type issues around readonly arrays are now resolved:\n- BoardProps.tasks: readonly TaskWithSession[]\n- CompactViewProps.tasks: readonly TaskWithSession[]\n- Column props were fixed (isActiveColumn instead of isActive, etc.)\n\n## Remaining\n- Data wrapping for non-primitive SubscriptionRef state (EditorMode, SortConfig, Overlay[], Toast[], etc.)\n- Consider using Data.struct() for cursor/position types\n- Audit all services for remaining mutable collections\n\n## Note\nThe linter (biome) auto-converts ReadonlyMap ‚Üî Record.ReadonlyRecord. Need to be consistent with Record.ReadonlyRecord and use Object.entries() for iteration.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-15T12:23:05.047807+11:00","updated_at":"2025-12-15T12:57:22.737672+11:00","closed_at":"2025-12-15T12:57:22.737672+11:00"}
{"id":"az-4nge","title":"we sometimes lose track of running dev servers","description":"use tmux as the source of truth for running dev servers maybe? add port and stuff to tmux state like we did for session status","design":"## Problem\n\nDev servers running in tmux are sometimes not shown in the Azedarach UI. This happens because the current approach stores dev server state in `.azedarach/devservers.json` and relies on syncing with tmux on startup. If Azedarach restarts unexpectedly or the JSON file gets out of sync, dev servers can become \"invisible\" even though they're still running.\n\n## Solution\n\nUse tmux user-options (`set-option -t session @option-name value`) as the **source of truth** for dev server state. This ensures:\n1. Dev server state survives Azedarach restarts\n2. No file sync issues - state lives with the tmux session itself\n3. If tmux session dies, state dies with it (no ghost entries)\n\n## Implementation Plan\n\n### 1. Add tmux user-option helpers to TmuxService\n\nAdd methods to TmuxService for getting/setting session user-options:\n```typescript\nsetUserOption: (session: string, key: string, value: string) =\u003e Effect\u003cvoid\u003e\ngetUserOption: (session: string, key: string) =\u003e Effect\u003cOption\u003cstring\u003e\u003e\n```\n\nUse tmux commands:\n- `tmux set-option -t session @azedarach-devserver-port 3000`\n- `tmux show-option -t session -v @azedarach-devserver-port`\n\n### 2. Update DevServerService to use tmux as source of truth\n\nWhen starting a dev server:\n```typescript\n// After creating tmux session, store metadata as user-options\nyield* tmux.setUserOption(sessionName, \"@azedarach-devserver-port\", String(port))\nyield* tmux.setUserOption(sessionName, \"@azedarach-devserver-status\", \"running\")\nyield* tmux.setUserOption(sessionName, \"@azedarach-devserver-started-at\", new Date().toISOString())\n```\n\nWhen recovering state on startup:\n```typescript\n// Query tmux sessions with az-dev-* prefix\n// For each, read user-options to get port/status/startedAt\n// Build state from tmux, not from JSON file\n```\n\n### 3. Remove JSON persistence for dev servers\n\nThe `.azedarach/devservers.json` file becomes unnecessary since tmux is the source of truth. Remove:\n- `loadPersistedServers()`\n- `persistServers()`\n- `devServersFilePath`\n- `PersistedDevServersSchema`\n\n### 4. Simplify health check\n\nThe health check can be simplified:\n- Just query tmux for sessions with `az-dev-*` prefix\n- Read user-options from each session\n- Update in-memory SubscriptionRef accordingly\n\n## User-Option Schema\n\nStore these options on each dev server tmux session:\n- `@azedarach-devserver-port` - The port number (e.g., \"3000\")\n- `@azedarach-devserver-status` - One of: \"starting\", \"running\", \"error\"\n- `@azedarach-devserver-bead-id` - The bead ID this dev server belongs to\n- `@azedarach-devserver-worktree-path` - Path to the worktree\n- `@azedarach-devserver-started-at` - ISO timestamp\n\n## Files to Modify\n\n1. `src/core/TmuxService.ts` - Add setUserOption/getUserOption methods\n2. `src/services/DevServerService.ts` - Rewrite to use tmux as source of truth\n\n## Testing\n\n1. Start Azedarach, start a dev server\n2. Kill Azedarach (Ctrl+C or kill the process)\n3. Restart Azedarach\n4. Verify dev server shows with correct port in StatusBar","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:21:38.086307+11:00","updated_at":"2025-12-21T03:38:09.914642+11:00","closed_at":"2025-12-21T03:38:09.914646+11:00","close_reason":"Implemented tmux as source of truth for dev server state. Dev servers now store metadata (port, status, worktree path, project path) in tmux session user-options. On startup, Azedarach discovers running dev servers by querying tmux sessions, filtered by project path for multi-project support. Removed JSON file persistence."}
{"id":"az-4r0","title":"AgentMailClient Effect service","description":"Create Effect service wrapper for Agent Mail HTTP API.\n\nDesign:\n- Define AgentMailClient as Effect.Service\n- Use @effect/platform HttpClient for requests\n- Methods:\n  - reserve(issueId): Effect\u003cReservation, ReservationError\u003e\n  - release(issueId): Effect\u003cvoid, ReleaseError\u003e\n  - ready(): Effect\u003cIssue[], AgentMailError\u003e\n  - updateStatus(issueId, status): Effect\u003cvoid, AgentMailError\u003e\n  - isAvailable(): Effect\u003cboolean, never\u003e (health check)\n- Read config from environment variables\n- Graceful degradation: return fallback when server unavailable\n- Retry logic with exponential backoff\n- Create AgentMailClientLive and AgentMailClientTest layers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.475812+11:00","updated_at":"2025-12-12T10:33:13.475812+11:00","dependencies":[{"issue_id":"az-4r0","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.800097+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-4vc","title":"paste from clipboard not working on mac still","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:25.365057+11:00","updated_at":"2025-12-18T02:14:02.602107+11:00","closed_at":"2025-12-17T16:41:03.286913+11:00","deleted_at":"2025-12-18T02:14:02.602107+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-4vp","title":"how do we install az hooks into a repo? document/improve this flow","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:22:57.513319+11:00","updated_at":"2025-12-18T10:46:02.513809+11:00","closed_at":"2025-12-18T10:39:21.455076+11:00","close_reason":"Documented and improved hook installation flow: created docs/hooks-installation.md, extracted hook generation to src/core/hooks.ts, added `az hooks install` CLI command, added PermissionRequest hook","deleted_at":"2025-12-18T10:46:02.513809+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-4w4i","title":"cross project initCommands issue","description":"when i move between projects initCommands seem to get lost\nchefy uses pnpm i not bun","design":"## Problem Analysis\n\nWhen Azedarach spawns Claude sessions for external projects (e.g., Chefy which uses pnpm), it always runs initCommands from Azedarach's own `.azedarach.json` config. This causes:\n- `bun install` to run in pnpm-based projects (wrong package manager)\n- `bd sync` to fail in projects without beads\n\nScreenshot shows: `initCommands failed for Chefy-m3sk` with `bun install` and `bd sync` failures.\n\n## Root Cause\n\nIn `SessionManager.ts:318`:\n```typescript\nconst appConfig = yield* AppConfig\nconst resolvedConfig: ResolvedConfig = appConfig.config\n```\n\nConfig is loaded once at service construction from Azedarach's root, then used for ALL sessions regardless of target project.\n\n## Solution: Load Project-Specific Config at Session Start\n\nModify SessionManager.start() to load config from the target project's path:\n\n1. **Add helper to AppConfig** - Expose a static method `loadConfigFromPath(path)` that reuses the existing loading logic\n2. **Update SessionManager.start()** - Load config from worktree.path (the target project) instead of using the global config\n3. **Merge configs** - Allow target project config to override only the worktree section (keeps Azedarach's session settings)\n\n## Implementation Plan\n\n### Step 1: Export config loading function from AppConfig\nExtract the config loading logic into a reusable function that can load from any project path.\n\n### Step 2: Modify SessionManager.start()\n```typescript\n// After worktree creation, load target project's config\nconst targetConfig = yield* loadConfigFromPath(worktree.path)\n\n// Use target project's initCommands, fall back to Azedarach's config\nconst worktreeConfig = targetConfig?.worktree ?? resolvedConfig.worktree\n```\n\n### Step 3: Handle missing configs gracefully\nIf target project has no `.azedarach.json`:\n- Use empty initCommands (don't inherit from Azedarach)\n- This is safer than running wrong commands\n\n## Files to Modify\n\n1. `src/config/AppConfig.ts` - Add loadConfigFromPath export\n2. `src/core/SessionManager.ts` - Use project-specific config in start()","notes":"üìé [mjc8m9za-p8eb.png](.beads/images/az-4w4i/mjc8m9za-p8eb.png) (clipboard, 12/19/2025, 1:15:45 PM)\n\n## Implementation Complete\n\n### Changes Made:\n\n1. **AppConfig.ts** - Added `loadWorktreeConfigFromPath(projectPath)` function\n   - Loads `.azedarach.json` or `package.json.azedarach` from any project path\n   - Returns `WorktreeConfig | null` (null if no config exists)\n   - Fully type-safe, no `as` casting\n\n2. **config/index.ts** - Exported the new function\n\n3. **SessionManager.ts** - Modified `start()` method\n   - Loads worktree config from `projectPath` (target project) instead of using global config\n   - Uses `DEFAULT_CONFIG.worktree` defaults if target has no config (empty initCommands)\n   - Session settings still come from Azedarach's config (intentional)\n\n### Behavior After Fix:\n\n- **Azedarach sessions**: Use Azedarach's `.azedarach.json` initCommands (`bun install`, etc.)\n- **Chefy sessions**: Use Chefy's `.azedarach.json` if it exists, otherwise no initCommands\n- **Any project**: Each project controls its own initCommands via its own config file\n\n### Testing:\n- Type check: ‚úÖ Passed\n- Build: ‚úÖ Passed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:15:42.682605+11:00","updated_at":"2025-12-19T13:58:27.091814+11:00","closed_at":"2025-12-19T13:58:27.091817+11:00","close_reason":"Implemented project-specific initCommands loading. SessionManager now loads worktree config from the target project path instead of using Azedarach's global config. External projects (like Chefy with pnpm) will use their own .azedarach.json if present, or no initCommands if absent."}
{"id":"az-4zq","title":"session monitoring not working. i assume due to permission denied on hooks","description":"we may need to chmod hook scripts?","notes":"Fixed. Root cause: Effect.fork() immediately interrupts child fibers when parent effect completes. Changed to Effect.forkScoped() which ties fiber lifetime to caller's scope. Also added immediate processing of pending notifications on startup. Documented fork vs forkScoped in CLAUDE.md.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:14:22.614097+11:00","updated_at":"2025-12-18T02:14:02.598172+11:00","closed_at":"2025-12-18T00:38:48.996207+11:00","close_reason":"Fixed Effect.fork‚ÜíforkScoped in HookReceiver. Documented in CLAUDE.md.","deleted_at":"2025-12-18T02:14:02.598172+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-50zf","title":"add a way to see the diff between a bead branch and main so i can code review","description":"","notes":"Using tmux popup approach (like Space+L for logs) instead of custom overlay - simpler, better scrolling, proper terminal rendering of ANSI colors from git diff","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:45:08.332767+11:00","updated_at":"2025-12-18T16:11:36.044905+11:00","closed_at":"2025-12-18T16:03:03.887758+11:00","close_reason":"Implemented Space+f keybinding to show git diff between bead branch and main in a tmux popup. Also fixed pre-existing build error by adding getWorktreePath to paths.ts.","deleted_at":"2025-12-18T16:11:36.044905+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-53o","title":"Notification system (terminal bell, system notifications)","description":"Alert user when sessions need attention.","design":"- Define NotificationService as Effect.Service\n- Methods:\n  - notify(title, body, urgency): Effect\u003cvoid, NotificationError\u003e\n  - bell(): Effect\u003cvoid\u003e // terminal bell \\x07\n- Notification backends:\n  - macOS: osascript via @effect/platform Command\n  - Cross-platform fallback: node-notifier (optional dep)\n- Use Effect.race with timeout for notification delivery\n- Notification triggers: subscribe to SessionManager PubSub\n- Configurable via Config service:\n  - enable/disable per event type\n  - sound option\n  - cooldown duration\n- Use Schedule.spaced for cooldown to prevent spam","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.717497+11:00","updated_at":"2025-12-11T14:54:42.593575+11:00","dependencies":[{"issue_id":"az-53o","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.727137+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-58v","title":"Implement issue type change in EditorService","description":"src/core/EditorService.ts line 773 has TODO:\n\"Implement type change (delete old, create new, preserve deps)\"\n\nChanging issue type (task‚Üíbug, feature‚Üíepic) requires:\n1. Capture existing dependencies\n2. Delete original issue\n3. Create new issue with same ID pattern but new type\n4. Re-link dependencies\n\nThis is a data migration operation that needs careful handling.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.827186+11:00","updated_at":"2025-12-17T15:59:44.827186+11:00"}
{"id":"az-5ck","title":"when i approve claude permissions in bead worktrees i want them to be merged into .claude/settings.json or something","description":"","notes":"Analyzed codebase. Plan: Add SessionEnd hook to sync permissions back to main project. Leverages existing WorktreeManager.deepMerge() for merging permission arrays.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:25:31.149667+11:00","updated_at":"2025-12-18T12:48:20.819589+11:00","closed_at":"2025-12-17T15:49:48.21207+11:00","close_reason":"Implemented permission sync: Added `az sync-permissions` CLI command and SessionEnd hook integration. When Claude sessions end in worktrees, any new permissions approved during the session are automatically merged back to the main project's settings.local.json.","deleted_at":"2025-12-18T12:48:20.819589+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-5ctw","title":"design how to show dependencies in epic drill down view","description":"then implement it","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:44:41.367965+11:00","updated_at":"2025-12-19T11:44:41.367965+11:00"}
{"id":"az-5jl","title":"File bug report for bd merge driver deleting beads incorrectly","description":"The `bd merge` driver uses standard 3-way merge semantics which can incorrectly delete beads.\n\n**Issue:** When a bead exists in base (ancestor) and main, but NOT in the branch being merged, the driver interprets this as \"branch deleted the bead\" and removes it. But the real scenario is often \"branch was created before this bead existed.\"\n\n**Expected behavior:** Beads should use additive merge semantics - beads are never deleted by merge, only added/updated. If a bead exists in either branch, it should appear in the result.\n\n**Workaround:** Azedarach now calls `bd sync --import-only` after merge to recover lost beads (az-mlv fix).\n\n**Suggested fix:** The merge driver should check `bead.created_at` against the branch divergence point. If the bead was created after the fork, keep it regardless of whether the branch has it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-18T02:09:27.362267+11:00","updated_at":"2025-12-18T02:09:27.362267+11:00","labels":["bd","upstream"]}
{"id":"az-5p5","title":"Add session metrics section to DetailPanel","description":"Add Session Metrics section to DetailPanel modal showing: Context % with warning indicator, session duration, estimated token count. Only visible when session is active (not idle).","notes":"## Progress\n\n### ‚úÖ Completed\n- DetailPanel UI section for metrics (lines 257-289)\n- Color-coded context % display (lavender/yellow/red thresholds)\n- Duration formatting from sessionStartedAt  \n- Token count display with K suffix\n- Visibility guard (only shows when session active)\n- Agent phase display (bonus)\n- **NEW**: BoardService now maps sessionStartedAt from SessionManager\n\n### ‚ùå Still Missing (requires az-zu3)\n- contextPercent: Needs PTY monitoring to parse Claude's status line\n- estimatedTokens: Needs PTY monitoring to parse Claude's status line\n- agentPhase: StateDetector exists but isn't wired to active monitoring\n\n### Dependency\nThis issue depends on az-zu3 (hybrid state detection) for full metrics collection.\nSession duration works NOW since SessionManager tracks startedAt.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.666185+11:00","updated_at":"2025-12-17T14:46:52.042889+11:00","closed_at":"2025-12-17T14:46:52.042889+11:00","dependencies":[{"issue_id":"az-5p5","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.146395+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-5p5","depends_on_id":"az-zu3","type":"blocks","created_at":"2025-12-17T14:44:22.017914+11:00","created_by":"daemon","metadata":"{}"}],"comments":[{"id":2,"issue_id":"az-5p5","author":"riordan","text":"UI code exists but data pipeline is missing. SessionManager doesn't collect metrics, BoardService doesn't map them. Need: 1) Data source for context%, tokens 2) SessionManager collection 3) BoardService mapping","created_at":"2025-12-17T03:41:30Z"}]}
{"id":"az-5z7z","title":"creating tasks from within epic drill down should auto create them in the epic","description":"and probably we need to spawn a claude session to setup any dependencies between it and the other epic tasks","design":"## Implementation Plan\n\n### Overview\nWhen a user creates a task while in epic drill-down mode, automatically add a parent-child dependency linking the new task to the epic.\n\n### Changes Required\n\n#### 1. Add `addDependency` method to BeadsClient (`src/core/BeadsClient.ts`)\n- New method: `addDependency(issueId, dependsOnId, type?)` \n- Calls: `bd dep add \u003cissueId\u003e \u003cdependsOnId\u003e [--type=parent-child]`\n- Default type: \"blocks\" (per CLI default), but we'll use \"parent-child\" for epic children\n\n#### 2. Modify `createBead` in TaskHandlersService (`src/services/keyboard/TaskHandlersService.ts`)\n- After successful bead creation, check if in drill-down mode via `nav.getDrillDownEpic()`\n- If drill-down epic exists, call `beadsClient.addDependency(newTaskId, epicId, \"parent-child\")`\n- Show toast indicating task was added to epic\n\n### Data Flow\n```\nUser presses 'c' in epic drill-down mode\n        ‚Üì\nTaskHandlersService.createBead()\n        ‚Üì\nBeadEditorService.createBead() returns { id, title }\n        ‚Üì\nCheck: nav.getDrillDownEpic() ‚Üí epicId or null\n        ‚Üì\nIf epicId: beadsClient.addDependency(newTaskId, epicId, \"parent-child\")\n        ‚Üì\nboard.refresh() + nav.jumpToTask(newTaskId)\n        ‚Üì\nToast: \"Created {id} (added to epic {epicId})\"\n```\n\n### Edge Cases\n- If `addDependency` fails, still succeed the creation but show warning toast\n- Epic could be deleted between drill-down entry and task creation (rare, handle gracefully)","acceptance_criteria":"- [ ] Creating a task with 'c' key while in epic drill-down automatically links it to the epic\n- [ ] The new task appears in the drill-down view immediately after creation\n- [ ] Toast message indicates the task was added to the epic\n- [ ] If not in drill-down mode, task creation works as before (no parent-child link)\n- [ ] Type-check passes (`bun run type-check`)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:39:19.433464+11:00","updated_at":"2025-12-19T15:08:10.232317+11:00","closed_at":"2025-12-19T15:08:10.232317+11:00","close_reason":"Implemented auto-add to epic feature. New tasks created with 'c' key while in epic drill-down mode are automatically linked as children of the epic via parent-child dependency."}
{"id":"az-65k","title":"Selection jumps to top of column after moving task left","description":"","notes":"Session progress (2025-12-14):\n\nROOT CAUSE ANALYSIS:\n- Navigation tracks position (columnIndex, taskIndex) not task ID\n- After moving RIGHT into empty column, taskIndex clamps to 0\n- Moving LEFT then uses stale taskIndex (0), navigating to top of column\n\nSOLUTION DESIGNED:\n1. Add `followTaskId` state to track which task to follow after moves\n2. Add useEffect watching followTaskId + tasksByColumn\n3. When data refreshes, find task by ID and navigate to its new position\n4. Update LEFT/RIGHT handlers in action mode to use setFollowTaskId()\n\nFILES TO MODIFY:\n- src/ui/App.tsx:\n  - Line 4: Add useEffect import\n  - After line 112: Add followTaskId state\n  - After navigateTo (line 206): Add useEffect for following task\n  - Lines 405-430: Update LEFT handler to use setFollowTaskId\n  - Lines 431-456: Update RIGHT handler to use setFollowTaskId\n\nFIX WAS APPLIED BUT REVERTED:\n- The fix was successfully implemented\n- A linter/formatter reverted the changes\n- Need to re-apply with proper formatting\n\nNEXT STEP:\nRe-apply the fix, ensuring it passes linting/formatting","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T17:17:04.148671+11:00","updated_at":"2025-12-14T02:13:17.044684+11:00","closed_at":"2025-12-14T02:13:17.044687+11:00","comments":[{"id":1,"issue_id":"az-65k","author":"riordan","text":"Fix was reverted by linter/formatter. Need to re-apply the followTaskId fix.","created_at":"2025-12-13T13:43:02Z"}]}
{"id":"az-66f4","title":"add ability to view running dev server","description":"","design":"## Overview\n\nAdd the ability to view (attach to) running dev server tmux sessions, and show an icon indicator on task cards for tasks with running dev servers.\n\n## Implementation Plan\n\n### Part 1: Add dev server icon indicator to TaskCard\n\n**Files to modify:**\n- `src/ui/types.ts` - Add DEV_SERVER_INDICATOR constant\n- `src/ui/TaskCard.tsx` - Display the indicator when dev server is running\n- `src/ui/atoms/devServer.ts` - Ensure we have an atom to check dev server state per task\n\n**Logic:**\n- In TaskCard, check if the current task has a running dev server (status === \"running\")\n- Display a distinct icon (e.g., üñ•Ô∏è or ‚öôÔ∏è) in the header line after other indicators\n- Use the existing `devServersAtom` to get dev server state per bead ID\n\n### Part 2: Add attach dev server action (Space+v)\n\n**Files to modify:**\n- `src/services/keyboard/DevServerHandlersService.ts` - Add `attachDevServer` handler\n- `src/services/keyboard/bindings.ts` - Add Space+v binding\n- `src/ui/ActionPalette.tsx` - Add \"View dev server\" option\n- `docs/keybindings.md` - Document the new keybinding\n\n**Logic:**\n1. Check if selected task has a running dev server (via DevServerService.getStatus)\n2. If running, use TmuxService.switchClient() to switch to the dev server tmux session\n3. Session name pattern: `az-dev-{beadId}` (already defined as DEV_SESSION_PREFIX)\n4. Show toast on error (no dev server running, session not found, etc.)\n\n### Key Design Decisions\n\n1. **Keybinding: Space+v** - \"v\" for \"view\" is intuitive, similar to how Space+a \"attaches\" to Claude sessions\n2. **Icon: üñ•Ô∏è** - Distinct from session indicators (üîµüü°‚úÖ‚ùå‚è∏Ô∏è), represents a running server\n3. **Reuse existing patterns** - Follow AttachmentService's switchClient approach for consistency\n4. **Minimal changes** - Only add what's needed, no refactoring","acceptance_criteria":"- [ ] TaskCard shows üñ•Ô∏è icon when a dev server is running for that task\n- [ ] Space+v attaches to the dev server tmux session for the selected task  \n- [ ] Toast shows error if no dev server is running\n- [ ] ActionPalette shows \"View dev server\" option when dev server is running\n- [ ] docs/keybindings.md updated with Space+v documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T19:29:50.61444+11:00","updated_at":"2025-12-20T00:23:00.782887+11:00","closed_at":"2025-12-20T00:23:00.78289+11:00"}
{"id":"az-6c5","title":"allow space S which starts a claude code instance and gets it to start working on the task","description":"e.g. prompt it with \"work on bead [bead-id]\"","notes":"Starting implementation. Approach:\n1. Add actionStartSessionWithPrompt() - starts session, waits for Claude init, sends prompt\n2. Add S-s keybinding (Shift+s) for \"start and work\"\n3. Update ActionPalette to show 'S work' option","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:26:05.162586+11:00","updated_at":"2025-12-17T00:54:24.960417+11:00","closed_at":"2025-12-17T00:54:24.960417+11:00"}
{"id":"az-6e3","title":"somehow allow starting a session via space s/S with --dangerously-skip-permissions","description":"we dont want to default to it but we should allow the user to do it somehow. not sure what the keybind should be. might need a secondary menu layer or a dialog... or might just need a new action menu keybind","notes":"Implementation plan: 1) Add dangerouslySkipPermissions to StartSessionOptions 2) Update SessionManager.start() to use the flag 3) Add new handler startSessionDangerous() 4) Add ! keybind in action mode 5) Update ActionPalette","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:40:35.565457+11:00","updated_at":"2025-12-18T12:45:17.622656+11:00","closed_at":"2025-12-18T12:45:17.622659+11:00","close_reason":"Implemented Space+! keybind to start sessions with --dangerously-skip-permissions flag","deleted_at":"2025-12-18T12:39:42.061285+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-6la","title":"Add context health border colors to TaskCard","description":"Encode context health into TaskCard border color when session is active: lavender (healthy, \u003c70%), yellow (warning, 70-90%), red (critical, \u003e90%). Requires contextPercent from TaskWithSession.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.426477+11:00","updated_at":"2025-12-12T13:25:20.07394+11:00","dependencies":[{"issue_id":"az-6la","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.111928+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-6nu","title":"help me figure out this tool use issue in claude sessions started via space s/S","description":"- it always stdouts ERROR: wrong usage\n - i have no idea what program/script logs it\n - it doesnt happen if i ctrl-a % to split and open a new claude session and tell it to type check\n - doesnt happen for read/write tool use only commands that use shell like bun run type-check etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:01:53.842983+11:00","updated_at":"2025-12-18T02:14:02.60403+11:00","closed_at":"2025-12-17T16:17:50.228619+11:00","deleted_at":"2025-12-18T02:14:02.60403+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-6t6","title":"Manual worktree cleanup action (Space+d)","description":"Add Space+d action to manually delete a worktree and its branch.\n\n**Use cases:**\n- Abandoned work that won't be merged\n- Failed PRs that need cleanup\n- Manual housekeeping\n\n**Implementation:**\n- Add to ActionPalette with state check (only available when worktree exists)\n- Confirm dialog before deletion (destructive action)\n- WorktreeManager.remove() + git branch -D\n- Update task card to remove blue dot\n- Toast notification on success/failure\n\n**Depends on:** az-yf4 (PRWorkflow) for the cleanup utility function","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T12:26:24.70141+11:00","updated_at":"2025-12-12T12:34:29.581402+11:00","dependencies":[{"issue_id":"az-6t6","depends_on_id":"az-yf4","type":"blocks","created_at":"2025-12-12T12:26:35.152751+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-711d","title":"if initCommands fail do we have some way to know about that?","description":"i think initCommands may be failing in Chefy project","design":"## Implementation Plan\n\n### Problem\nWhen `initCommands` fail during session startup (configured in `.azedarach.json`), there's no visibility:\n1. Logs go to Effect's internal logging (not visible in TUI)\n2. Session starts anyway (with `continueOnFailure: true` default)\n3. User doesn't know their environment setup may be broken\n\n### Solution\nAdd multi-layer visibility for initCommand failures:\n\n1. **DiagnosticsService Events** - Add event logging capability\n   - New `DiagnosticsEvent` type with timestamp, severity, source, message\n   - New `events: readonly DiagnosticsEvent[]` in `DiagnosticsState`\n   - New `logEvent(event)` method to record events\n   - Events visible in diagnostics overlay (Shift+D)\n\n2. **Session Warning State** - Distinguish \"started with issues\"\n   - Add `\"warning\"` to `SessionState` type in `types.ts`\n   - Update `SESSION_INDICATORS` with yellow/amber indicator for warning\n   - Session starts but visual indicator shows something is off\n\n3. **SessionManager Changes** - Capture and report failures\n   - Collect failed commands during init phase\n   - If any failures: call `DiagnosticsService.logEvent()` for each\n   - If any failures: set initial session state to \"warning\" instead of \"busy\"\n   - Return session with warning state (still starts successfully)\n\n4. **TUI Notification** - Brief flash notification\n   - Add a transient notification component to StatusBar\n   - Show \"‚ö† initCommands failed (Shift+D for details)\" briefly\n   - Auto-dismiss after 3-5 seconds\n\n### Files to Modify\n- `src/services/DiagnosticsService.ts` - Add event logging\n- `src/ui/types.ts` - Add \"warning\" state + indicator\n- `src/core/SessionManager.ts` - Capture failures, report to diagnostics, set warning state\n- `src/ui/StatusBar.tsx` - Add transient notification display\n\n### Why This Design\n- **Non-blocking**: Session still starts, user can continue\n- **Discoverable**: Yellow warning badge catches attention\n- **Debuggable**: Full details in diagnostics panel\n- **Transient notification**: Immediate feedback without modal interruption","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] When an initCommand fails, event is logged to DiagnosticsService\n- [ ] Failed initCommands appear in diagnostics overlay (Shift+D)\n- [ ] Session starts with \"warning\" state if any initCommand failed\n- [ ] TaskCard shows yellow/amber indicator for warning state\n- [ ] StatusBar shows brief notification on initCommand failure\n- [ ] Notification includes hint to check diagnostics (Shift+D)\n- [ ] Type-check passes with no errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:42:30.879303+11:00","updated_at":"2025-12-19T12:53:59.501685+11:00","closed_at":"2025-12-19T12:53:59.501685+11:00","close_reason":"Implemented multi-layer visibility for initCommand failures: warning state indicator, toast notification, diagnostics event logging, and events section in diagnostics overlay."}
{"id":"az-74sw","title":"space c is causing tmux to detach and dump me out in non tmux terminal","description":"When pressing `space c` (Chat about task with Haiku), the app calls `tmux.switchClient()` which switches the tmux client to the new chat session. This takes the user OUT of the Azedarach TUI completely and into the chat session's terminal.\n\nThe user expects to remain in the TUI while the chat session runs in the background (similar to how `space s` starts a work session but doesn't immediately switch to it).","design":"## Root Cause Analysis\n\nThe issue is in `src/services/keyboard/SessionHandlersService.ts` lines 279 and 295:\n\n```typescript\n// Line 279 - when session already exists:\nyield* tmux.switchClient(chatSessionName)\n\n// Line 295 - after creating new session:\nEffect.tap(() =\u003e tmux.switchClient(chatSessionName))\n```\n\nThe `tmux switch-client` command switches the *current* tmux client to a different session, which moves the user away from the Azedarach TUI.\n\n## Comparison with `space a` (Attach)\n\nThe `space a` action (attachExternal) uses `switchClient()` intentionally - the user wants to attach to the session and interact with it. However `space c` (chat) should probably behave differently since it's about spawning a background chat, not immediately switching to it.\n\n## Design Decision\n\nTwo options for `space c` behavior:\n\n**Option A: Match attach behavior (current)**\n- Create chat session and switch to it\n- User can return via Ctrl-a Ctrl-a\n- Downside: Unexpected UX - user is immediately ripped out of TUI\n\n**Option B: Stay in TUI, show toast to attach**\n- Create chat session in background\n- Show toast: \"Chat session started for az-xyz - press Space+a to attach\"\n- User explicitly attaches when ready\n- More consistent with `space s` (start session) which doesn't auto-attach\n\n## Implementation Plan\n\nImplement Option B:\n\n1. Remove `switchClient()` calls from `chatAboutTask()` in `SessionHandlersService.ts`\n2. Update toast messages to guide user to attach manually\n3. Consider: Should `space c` check for existing chat session and offer to attach if one exists?\n\n## Files to Modify\n\n- `src/services/keyboard/SessionHandlersService.ts` - Remove switchClient calls from chatAboutTask()","acceptance_criteria":"- [ ] `space c` creates chat session without switching to it\n- [ ] Toast message guides user to attach with `space a` or similar\n- [ ] User remains in the Azedarach TUI after pressing `space c`\n- [ ] Chat session is properly created and accessible","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:56:26.424876+11:00","updated_at":"2025-12-19T10:34:30.623063+11:00","closed_at":"2025-12-19T10:34:30.623063+11:00","close_reason":"Fixed: Removed `tmux.switchClient()` calls from `chatAboutTask()` so that pressing `space c` creates the chat session in the background without switching away from the Azedarach TUI. Toast messages now guide the user to press `Space+a` to attach when ready.","deleted_at":"2025-12-19T02:15:58.662477+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-76a","title":"session busy status even though claude has been waiting for me to press 1-3 for 2mins","description":"","notes":"**Root cause:** The `Stop` hook fires immediately when Claude finishes responding, but HookReceiver was ignoring it (returning `null` instead of transitioning to \"waiting\" state).\n\n**Primary fix (HookReceiver.ts):**\nChanged `mapEventToState(\"stop\")` from returning `null` to returning `\"waiting\"`.\n\nThe Stop hook was already correctly configured in WorktreeManager to call `az notify stop ${beadId}`, but the event was being discarded.\n\n**Secondary fix (StateDetector.ts):**\nAdded backup PTY patterns for AskUserQuestion tool output (numbered options, \"Other\" option). This provides defense-in-depth but the hook-based solution is more reliable.\n\n**Architecture note:**\n- Hook-based detection (Stop hook) is authoritative and immediate\n- PTY pattern matching is a fallback for edge cases\n- idle_prompt notification (60s timeout) is a last-resort safety net","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:17:07.106897+11:00","updated_at":"2025-12-18T10:46:02.515308+11:00","closed_at":"2025-12-18T10:24:26.792564+11:00","close_reason":"Fixed: Stop hook now correctly transitions to 'waiting' state (HookReceiver.ts). Also added PTY pattern fallbacks (StateDetector.ts).","comments":[{"id":4,"issue_id":"az-76a","author":"riordan","text":"Initial fix was incomplete - the real issue was in HookReceiver, not just StateDetector patterns","created_at":"2025-12-17T23:24:06Z"}],"deleted_at":"2025-12-18T10:46:02.515308+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-786g","title":"fix responsiveness of details panel","description":"it should go a bit wider probs\nit should scroll with ctrl-u/d and up/down if content is too long","design":"## Implementation Plan (Revised)\n\nOpenTUI has a native `\u003cscrollbox\u003e` component! This is the idiomatic solution.\n\n### 1. Width Adjustment\n- Change `minWidth` from 70 to 80\n- Change `maxWidth` from 90 to 110 (or use percentage width)\n\n### 2. Use Native `\u003cscrollbox\u003e` Component\nThe `\u003cscrollbox\u003e` from `@opentui/react` provides:\n- Built-in vertical/horizontal scrolling\n- Native keyboard handling (`handleKeyPress`)\n- Optional scrollbar rendering\n- Viewport culling for performance\n\n**Props to use:**\n- `scrollY={true}` - enable vertical scrolling\n- `focused={true}` - when detail overlay is active\n- `maxHeight` - constrain to terminal height minus chrome\n\n### 3. Keyboard Integration\nThe scrollbox has built-in keyboard handling. When `focused={true}`:\n- Arrow keys scroll content\n- The component handles `Ctrl+u/d` via its `handleKeyPress` method\n\n**Potential approach:** Get a ref to the scrollbox and call `scrollBy()` from the InputHandlersService for custom scroll amounts.\n\n### 4. Service Changes\nIn `InputHandlersService.handleDetailOverlayInput`:\n- Add `C-u` / `C-d` handlers that emit scroll commands\n- Need to communicate scroll intent from service ‚Üí component\n\n**Options for service ‚Üí component communication:**\n1. **OverlayService state** - Add `scrollOffset` to overlay state\n2. **Dedicated ScrollService** - Track scroll position per overlay\n3. **Ref-based** - Store scrollbox ref, call methods directly (not Effect-friendly)\n\nGoing with option 1: Add scroll commands to OverlayService that the DetailPanel subscribes to.\n\n### Files to modify:\n- `src/ui/DetailPanel.tsx` - Wrap content in `\u003cscrollbox\u003e`, set maxHeight\n- `src/services/keyboard/InputHandlersService.ts` - Add scroll key handlers\n- `src/services/OverlayService.ts` - Add scroll intent/offset state (minimal)\n\n### Alternative: Component-local scroll with keyboard forwarding\nIf scrollbox's built-in `handleKeyPress` works well when `focused={true}`, we may not need service changes at all - just forward the key events to the component.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:27:58.11595+11:00","updated_at":"2025-12-19T14:13:51.706767+11:00","closed_at":"2025-12-19T14:13:51.706767+11:00","close_reason":"Implemented scrollable detail panel with wider layout (80-110 chars) and Ctrl-u/d scrolling via OpenTUI scrollbox component"}
{"id":"az-7oa","title":"Add test coverage for core services","description":"Currently only FileLockManager.test.ts exists. Add tests for:\n\n**High priority (business-critical):**\n- SessionManager - lifecycle, state transitions\n- BeadsClient - CLI parsing, error handling\n- CommandQueueService - serialization, race conditions\n- StateDetector - pattern matching accuracy\n\n**Medium priority:**\n- BoardService - filtering, sorting\n- NavigationService - cursor movement, boundary handling\n- WorktreeManager - git operations\n\nUse Effect's testing utilities and TestClock for time-based tests.","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:45.163878+11:00","updated_at":"2025-12-17T15:59:45.163878+11:00"}
{"id":"az-7rj","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.\n\n## Requirements\n- User provides a description of the task/feature they want to create\n- Claude interprets the prompt and creates the appropriate bead (title, type, description, etc.)\n- The tmux session used for bead creation should persist after creation\n- This allows the user to immediately start working on the newly created bead in the same session\n\n## Use Case\nInstead of manually running `bd create`, user can describe what they need in natural language from within azedarach's TUI, and Claude handles the bead creation. The persistent session means they can seamlessly transition from \"create this task\" to \"now work on it\".","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:27:20.092741+11:00","updated_at":"2025-12-14T19:41:43.218996+11:00","closed_at":"2025-12-14T02:45:45.653563+11:00"}
{"id":"az-7she","title":"when i remove an image it should be also removed from notes","description":"","design":"## Problem\nWhen images are attached to an issue, a markdown link like `üìé [filename.png](.beads/images/az-xxx/filename.png)` is automatically added to the issue's notes field (via `linkAttachmentInNotes`). However, when the image is removed via `removeSelectedAttachment()` or `remove()`, the markdown link is NOT removed, leaving broken references in notes.\n\n## Solution\nAdd an `unlinkAttachmentFromNotes` helper function that:\n1. Reads the current issue notes\n2. Removes lines matching the pattern `üìé [filename](...)` for the removed attachment\n3. Updates the issue notes via BeadsClient\n\nCall this function from both `removeSelectedAttachment()` and `remove()` methods.\n\n## Implementation Plan\n1. Add `unlinkAttachmentFromNotes(issueId, attachment)` function near `linkAttachmentInNotes`\n2. Pattern to match: Lines starting with `üìé [${attachment.filename}]`\n3. Call from `removeSelectedAttachment()` after removing the file\n4. Call from `remove()` after removing the file\n\n## Files to Modify\n- `src/core/ImageAttachmentService.ts` - Add helper and integrate into removal methods","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T02:09:49.472426+11:00","updated_at":"2025-12-19T10:31:32.138193+11:00","closed_at":"2025-12-19T10:31:32.138193+11:00","close_reason":"Implemented unlinkAttachmentFromNotes helper that removes the üìé [filename](...) line from notes when an image is deleted. Called from both removeSelectedAttachment() and remove() methods.","deleted_at":"2025-12-19T02:15:58.65358+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-7sr","title":"Add orchestration mode ('o' from epic detail) to TUI","description":"New editor mode for orchestrating parallel workers on an epic.\n\n**Entry flow:**\n1. `Enter` on epic ‚Üí DetailPanel shows epic info + children\n2. `o` in detail overlay ‚Üí enters orchestration mode\n\n**Mode behavior:**\n- Display children as selectable list\n- Space toggles task selection (spawnable tasks only)\n- Enter confirms and triggers spawn\n- Esc returns to detail panel\n\n**Prerequisites:**\n- Epic drill-down: DetailPanel must show children when viewing an epic\n\n**UI:** Overlay-style task selector with selection count and keybinding hints.","design":"## Orchestration Mode Design (Revised)\n\n### Overview\n\nOrchestration mode is entered **from within the detail panel** when viewing an epic. This integrates naturally with the epic drill-down flow: user views epic ‚Üí sees children ‚Üí decides to spawn parallel workers.\n\n### Prerequisites\n\n**Epic drill-down in DetailPanel** must show:\n- List of child tasks (from `bd show \u003cepic-id\u003e` ‚Üí `dependents` where `dependency_type: \"parent-child\"`)\n- Child status indicators (open/in_progress/blocked/closed)\n- Session indicators for children with active sessions\n- Hint: \"Press 'o' to orchestrate\" when viewing an epic\n\n### Entry Flow\n\n```\nEnter on epic ‚Üí DetailPanel with children list\n         ‚Üì\n  Press 'o' in detail overlay\n         ‚Üì\nOrchestration overlay (replaces detail)\n         ‚Üì\nSelect tasks ‚Üí Enter ‚Üí Spawn workers\n```\n\n1. User presses `Enter` on epic task ‚Üí opens detail overlay\n2. DetailPanel shows epic info + children list\n3. User presses `o` ‚Üí `enterOrchestrate()` is triggered\n4. Validates current detail task is an epic (should always be true given UX)\n5. Loads children with session state merged\n6. Pushes orchestration overlay (or transitions detail panel mode)\n7. User selects tasks ‚Üí `Enter` confirms and triggers spawn\n\n### Mode Definition\n\nAdd new variant to `EditorMode` union in `EditorService.ts`:\n\n```typescript\n| {\n    readonly _tag: \"orchestrate\"\n    readonly epicId: string                      // The epic being orchestrated\n    readonly epicTitle: string                   // For display\n    readonly childTasks: ReadonlyArray\u003cOrchestrationTask\u003e  // Children loaded from bd\n    readonly selectedIds: ReadonlyArray\u003cstring\u003e  // Tasks selected for spawning\n    readonly focusIndex: number                  // Currently focused task in list\n  }\n\ninterface OrchestrationTask {\n  id: string\n  title: string\n  status: \"open\" | \"in_progress\" | \"blocked\" | \"closed\"\n  hasSession: boolean  // Already has active session\n}\n```\n\n### Keybindings\n\n**In detail overlay (viewing epic):**\n| Key | Action | Description |\n|-----|--------|-------------|\n| o | enterOrchestrate | Enter orchestration mode (epic only) |\n\n**In orchestrate mode:**\n| Key | Action | Description |\n|-----|--------|-------------|\n| j/‚Üì | moveDown | Move focus down in task list |\n| k/‚Üë | moveUp | Move focus up in task list |\n| Space | toggleTask | Toggle task selection (if spawnable) |\n| Enter | confirmSpawn | Confirm and trigger spawn for selected |\n| a | selectAll | Select all spawnable (open, no session) |\n| n | selectNone | Clear all selections |\n| Escape | cancel | Return to epic detail (or close overlay) |\n\n### Spawn Eligibility\n\nTasks are spawnable if:\n- `status` is `\"open\"` (not in_progress, blocked, or closed)\n- `hasSession` is `false` (no active Claude session)\n\nNon-spawnable tasks shown grayed out, cannot be selected.\n\n### UI Design\n\n**Option A: Orchestration as separate overlay**\n```\n‚îå‚îÄ Orchestrate: Epic Title ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                            ‚îÇ\n‚îÇ  [x] az-abc  Implement feature X     OPEN  ‚îÇ\n‚îÇ  [ ] az-def  Write tests for X       OPEN  ‚îÇ\n‚îÇ  --- az-ghi  Fix bug Y          IN_PROGRESS‚îÇ\n‚îÇ  --- az-jkl  Refactor Z            BLOCKED ‚îÇ\n‚îÇ                                            ‚îÇ\n‚îÇ  Selected: 1/2 spawnable                   ‚îÇ\n‚îÇ                                            ‚îÇ\n‚îÇ  Enter: Spawn  Space: Toggle  Esc: Back    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**Option B: Enhanced detail panel with mode switch**\nThe DetailPanel itself gains an \"orchestrate mode\" where children become selectable.\n- Simpler implementation (no new overlay)\n- Context preserved (epic info still visible)\n\n**Recommendation:** Option A (separate overlay) for cleaner separation of concerns.\n\n### DetailPanel Enhancement (Prerequisite)\n\nWhen viewing an epic, DetailPanel should show:\n\n```tsx\n{/* Children section - only for epics */}\n{task.issue_type === \"epic\" \u0026\u0026 children.length \u003e 0 \u0026\u0026 (\n  \u003cbox flexDirection=\"column\"\u003e\n    \u003ctext fg={theme.blue} attributes={ATTR_BOLD}\u003e\n      {`Children (${children.length}):`}\n    \u003c/text\u003e\n    {children.map((child) =\u003e (\n      \u003ctext key={child.id} fg={getChildColor(child)}\u003e\n        {`  ${child.id}  ${child.title}  [${child.status}]`}\n      \u003c/text\u003e\n    ))}\n    \u003ctext fg={theme.subtext0}\u003e\n      {\"Press 'o' to orchestrate parallel workers\"}\n    \u003c/text\u003e\n  \u003c/box\u003e\n)}\n```\n\n### BeadsClient Extension\n\nUpdate `IssueSchema` to include dependency fields:\n\n```typescript\nconst DependencyRefSchema = Schema.Struct({\n  id: Schema.String,\n  title: Schema.String,\n  status: Schema.Literal(\"open\", \"in_progress\", \"blocked\", \"closed\", \"tombstone\"),\n  dependency_type: Schema.Literal(\"blocks\", \"related\", \"parent-child\", \"discovered-from\"),\n  issue_type: Schema.Literal(\"bug\", \"feature\", \"task\", \"epic\", \"chore\").pipe(Schema.optional),\n})\n\nconst IssueSchema = Schema.Struct({\n  // ... existing fields\n  dependent_count: Schema.Number.pipe(Schema.optional),\n  dependency_count: Schema.Number.pipe(Schema.optional),\n  dependents: Schema.Array(DependencyRefSchema).pipe(Schema.optional),\n  dependencies: Schema.Array(DependencyRefSchema).pipe(Schema.optional),\n})\n```\n\nAdd method:\n```typescript\ngetEpicWithChildren: (epicId: string, cwd?: string) =\u003e\n  Effect.Effect\u003c{ epic: Issue; children: ReadonlyArray\u003cDependencyRef\u003e }, BeadsError | ParseError | NotFoundError\u003e\n```\n\n### Service Methods\n\nIn `EditorService`:\n```typescript\nenterOrchestrate: (epicId: string, epicTitle: string, children: ReadonlyArray\u003cOrchestrationTask\u003e) =\u003e\n  SubscriptionRef.set(mode, Data.struct({\n    _tag: \"orchestrate\",\n    epicId,\n    epicTitle,\n    childTasks: children,\n    selectedIds: [],\n    focusIndex: 0,\n  }))\n\norchestrateMoveDown: () =\u003e SubscriptionRef.update(mode, ...)\norchestrateMoveUp: () =\u003e SubscriptionRef.update(mode, ...)\norchestrateToggle: (taskId: string) =\u003e SubscriptionRef.update(mode, ...)\norchestrateSelectAll: () =\u003e SubscriptionRef.update(mode, ...)\norchestrateSelectNone: () =\u003e SubscriptionRef.update(mode, ...)\nexitOrchestrate: () =\u003e SubscriptionRef.set(mode, normalMode)\n```\n\n### Handler Service\n\nNew `OrchestrateHandlersService`:\n```typescript\nexport class OrchestrateHandlersService extends Effect.Service\u003c...\u003e()(..., {\n  dependencies: [EditorService, BeadsClient, BoardService, SessionService, ToastService, OverlayService],\n  effect: Effect.gen(function* () {\n    return {\n      enterFromDetail: () =\u003e Effect.gen(function* () {\n        // Get current detail overlay's task\n        const overlay = yield* overlayService.current()\n        if (overlay?._tag !== \"detail\") return\n        \n        const task = yield* boardService.getTaskById(overlay.taskId)\n        if (!task || task.issue_type !== \"epic\") {\n          yield* toast.show(\"Not an epic\", \"error\")\n          return\n        }\n        \n        const { children } = yield* beadsClient.getEpicWithChildren(task.id)\n        const withSessions = yield* mergeSessionState(children)\n        yield* editor.enterOrchestrate(task.id, task.title, withSessions)\n        // Optionally close detail overlay or keep it in background\n      }),\n      \n      confirmSpawn: () =\u003e Effect.gen(function* () {\n        const mode = yield* editor.getMode()\n        if (mode._tag !== \"orchestrate\") return\n        \n        if (mode.selectedIds.length === 0) {\n          yield* toast.show(\"No tasks selected\", \"warning\")\n          return\n        }\n        \n        const toSpawn = mode.selectedIds\n        yield* editor.exitOrchestrate()\n        yield* overlayService.clear() // Close all overlays\n        \n        // Emit spawn event (handled by az-bjp)\n        yield* toast.show(`Spawning ${toSpawn.length} sessions...`, \"info\")\n      }),\n    }\n  }),\n})\n```\n\n### StatusBar Integration\n\nWhen in orchestrate mode:\n```typescript\nMODE_KEYBINDINGS.orchestrate = [\n  { key: \"Space\", action: \"Toggle\" },\n  { key: \"Enter\", action: \"Spawn\" },\n  { key: \"a\", action: \"All\" },\n  { key: \"n\", action: \"None\" },\n  { key: \"Esc\", action: \"Back\" },\n]\n```\n\nMode display: `\"orchestrate (1/2)\"`\n\n### File Changes Required\n\n1. `src/services/EditorService.ts` - Add orchestrate mode + methods\n2. `src/core/BeadsClient.ts` - Extend schema, add getEpicWithChildren\n3. `src/services/keyboard/OrchestrateHandlersService.ts` - **NEW**\n4. `src/services/keyboard/bindings.ts` - Add `o` in detail overlay, orchestrate mode keybindings\n5. `src/services/keyboard/types.ts` - Add \"orchestrate\" to KeyMode\n6. `src/ui/StatusBar.tsx` - Add orchestrate keybinding hints\n7. `src/ui/OrchestrationOverlay.tsx` - **NEW** overlay component\n8. `src/ui/DetailPanel.tsx` - Add children section for epics\n9. `src/ui/App.tsx` - Render orchestration overlay\n10. `src/ui/atoms/mode.ts` - Add orchestrate-related atoms\n11. `src/services/OverlayService.ts` - Potentially add orchestrate overlay type (if using overlay stack)","acceptance_criteria":"## Acceptance Criteria\n\n### Prerequisites (Epic Drill-Down)\n- [ ] DetailPanel shows children list when viewing an epic\n- [ ] Children show: id, title, status\n- [ ] Children show session indicator if they have active session\n- [ ] \"Press 'o' to orchestrate\" hint visible for epics\n\n### Entry\n- [ ] `o` in detail overlay on epic enters orchestration mode\n- [ ] `o` in detail overlay on non-epic shows error toast \"Not an epic\"\n- [ ] Orchestration mode loads child tasks with session state merged\n- [ ] Child tasks display with correct status (open/in_progress/blocked/closed)\n- [ ] Tasks with active sessions marked as non-spawnable\n\n### Navigation\n- [ ] j/k moves focus through task list\n- [ ] Focus wraps at boundaries (or stops - TBD)\n- [ ] Focused task visually highlighted\n\n### Selection\n- [ ] Space toggles selection on spawnable tasks\n- [ ] Space on non-spawnable task does nothing (no error)\n- [ ] 'a' selects all spawnable tasks\n- [ ] 'n' clears all selections\n- [ ] Selection count shown in UI (\"Selected: X/Y spawnable\")\n\n### Confirmation\n- [ ] Enter with selections exits mode and emits spawn event\n- [ ] Enter with no selections shows toast \"No tasks selected\"\n- [ ] Escape returns to epic detail panel (or closes all overlays)\n\n### UI\n- [ ] Orchestration overlay displays epic title in header\n- [ ] Tasks show: selection state, ID, title, status\n- [ ] Non-spawnable tasks visually distinct (grayed/dimmed)\n- [ ] StatusBar shows orchestrate-specific keybindings\n- [ ] Mode display shows \"orchestrate (X/Y)\"\n\n### Integration\n- [ ] BeadsClient.getEpicWithChildren works correctly\n- [ ] Session state merged to determine spawnable tasks\n- [ ] Spawn event emitted for downstream handling (az-bjp)\n- [ ] No regressions to existing modes or detail panel","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:29:14.653445+11:00","updated_at":"2025-12-19T11:31:29.234844+11:00","closed_at":"2025-12-19T11:31:29.234847+11:00","dependencies":[{"issue_id":"az-7sr","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.732517+11:00","created_by":"daemon","metadata":"{}"}],"comments":[{"id":12,"issue_id":"az-7sr","author":"riordan","text":"Adding az-bjp and az-lqb implementation","created_at":"2025-12-18T23:54:01Z"}]}
{"id":"az-7vk","title":"Auto-wrap in tmux on startup","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:16:24.296316+11:00","updated_at":"2025-12-12T17:16:32.587438+11:00","closed_at":"2025-12-12T17:16:32.587438+11:00"}
{"id":"az-7y5","title":"if i /clear in the bead's space S claude session the tmux session seems to be lost in az","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:32:07.377782+11:00","updated_at":"2025-12-18T16:24:45.510128+11:00","closed_at":"2025-12-18T16:24:45.510132+11:00"}
{"id":"az-7y9","title":"worktree created but not found","description":"we may be looking in the wrong spot for worktrees sometimes. i looked in finder and the worktree existed so not sure how we failed to find it. also make sure that errors that we should via toast are also logged via Effect.logError","notes":"Fixed both issues: (1) Added Effect.logError to all toast error handlers in KeyboardService, (2) Updated WorktreeManager to use branch name as beadId (more reliable than path parsing), added path normalization to avoid symlink/trailing slash issues, added diagnostic logging when worktree not found in cache, made the fallback regex case-insensitive to support any prefix (e.g., Chefy-xxx). Also added MCP tool permissions to project settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:32:16.690535+11:00","updated_at":"2025-12-15T15:32:17.764918+11:00","closed_at":"2025-12-15T15:32:17.764918+11:00"}
{"id":"az-8axr","title":"test","description":"","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T15:30:40.337109+11:00","updated_at":"2025-12-18T15:30:50.278932+11:00","deleted_at":"2025-12-18T15:30:50.278932+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-8ep","title":"Beads sync coordination for worktrees","description":"Coordinate beads sync across main repo and worktrees.","design":"- Define BeadsSyncCoordinator as Effect.Service\n- Depends on: BeadsClient, WorktreeManager, SessionManager\n- Sync strategy:\n  1. Before task start: sync (pull latest)\n  2. Periodic sync during work (configurable interval via Schedule)\n  3. On task completion: sync (push final state)\n- Methods:\n  - syncAll(): Effect\u003cSyncResult[], BeadsError\u003e\n  - syncWorktree(path): Effect\u003cSyncResult, BeadsError\u003e\n  - startPeriodicSync(interval): Effect\u003cFiber.RuntimeFiber\u003cvoid\u003e, never\u003e\n- Use Effect.retry with exponential backoff for conflicts\n- Handle sync conflicts gracefully with Effect.catchTag\n- 's' keybinding triggers syncAll()\n- Show sync status in StatusBar via Ref\u003cSyncStatus\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.819887+11:00","updated_at":"2025-12-12T12:17:55.89465+11:00","closed_at":"2025-12-12T12:17:55.89465+11:00","dependencies":[{"issue_id":"az-8ep","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.882335+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-8ivo","title":"Add orchestrate mode atoms","description":"In src/ui/atoms/mode.ts, add:\n\n1. `isOrchestrateAtom` - derived boolean for mode check\n2. `orchestrateStateAtom` - full orchestrate mode state (or null)\n3. `orchestrateSelectedIdsAtom` - selected task IDs\n4. `orchestrateFocusIndexAtom` - current focus index\n5. `orchestrateSpawnableCountAtom` - count of spawnable tasks\n6. Action atoms for EditorService methods:\n   - `orchestrateMoveDownAtom`\n   - `orchestrateMoveUpAtom`\n   - `orchestrateToggleAtom`\n   - `orchestrateSelectAllAtom`\n   - `orchestrateSelectNoneAtom`\n   - `exitOrchestrateAtom`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:06.245377+11:00","updated_at":"2025-12-19T10:34:32.339402+11:00","closed_at":"2025-12-19T10:34:32.339402+11:00","close_reason":"Added 12 orchestrate mode atoms: isOrchestrate, orchestrateState, orchestrateSelectedIds, orchestrateFocusIndex, orchestrateSpawnableCount, and 7 action atoms for navigation and selection","dependencies":[{"issue_id":"az-8ivo","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:26.55225+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-8ivo","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:50.728533+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T02:15:58.657439+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-8mp","title":"Fix TUI height in tmux and improve session scrolling","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T00:37:17.384839+11:00","updated_at":"2025-12-14T00:37:34.04098+11:00","closed_at":"2025-12-14T00:37:34.04098+11:00"}
{"id":"az-8wyv","title":"diff view not great","description":"its not got code highlighting, +/-, etc...","design":"...","notes":"## Root Cause\nThe diff view was using `git diff --color=always` but difftastic (configured as `diff.external` in user's gitconfig) uses its own `DFT_COLOR` environment variable, not git's `--color` flag.\n\n## Solution\nAdded `DFT_COLOR=always` to the git diff command in `PRHandlersService.ts:showDiff()`.\n\nThe fix respects user's git configuration:\n- If user has difftastic as `diff.external` ‚Üí DFT_COLOR enables syntax highlighting\n- If user has delta or default git diff ‚Üí `--color=always` still works\n\n## Changes\n- `src/services/keyboard/PRHandlersService.ts`: Added `DFT_COLOR=always` environment variable to the diff command\n\n## Configuration Note\nUser's difftastic is properly configured in `~/nix/home.nix`:\n```nix\nprograms.git.difftastic = {\n  enable = true;\n  enableAsDifftool = true;\n  background = \"dark\";\n};\n```\nThis generates `diff.external = \"difft --background dark\"` in gitconfig.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T00:42:38.725574+11:00","updated_at":"2025-12-19T10:34:30.876106+11:00","closed_at":"2025-12-19T10:34:30.876106+11:00","close_reason":"Fixed: Added DFT_COLOR=always to diff command for difftastic syntax highlighting support","deleted_at":"2025-12-19T02:15:58.661968+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-8z1i","title":"add ability to preview images in tui","description":"","notes":"Research completed:\n- OpenTUI has no built-in image component (text/cell-based FrameBuffer)\n- Terminal capability detection exists for kitty_graphics and sixel\n- terminal-image npm package offers Kitty/iTerm2/Sixel + ANSI fallback\n- Will use terminal-image for cross-terminal support","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:49:35.350993+11:00","updated_at":"2025-12-18T14:42:07.981166+11:00","closed_at":"2025-12-18T14:42:07.981166+11:00","close_reason":"Implemented image preview feature with terminal-image library. Added imagePreview overlay, keyboard handling (v to preview, j/k to navigate, o to open externally), and documentation."}
{"id":"az-9870","title":"Add orchestrate mode to EditorService","description":"Add new mode variant to EditorMode union:\n\n```typescript\n| {\n    readonly _tag: \"orchestrate\"\n    readonly epicId: string\n    readonly epicTitle: string\n    readonly childTasks: ReadonlyArray\u003cOrchestrationTask\u003e\n    readonly selectedIds: ReadonlyArray\u003cstring\u003e\n    readonly focusIndex: number\n  }\n```\n\nAdd OrchestrationTask interface and service methods:\n- enterOrchestrate(epicId, epicTitle, children)\n- orchestrateMoveDown()\n- orchestrateMoveUp()\n- orchestrateToggle(taskId)\n- orchestrateSelectAll()\n- orchestrateSelectNone()\n- exitOrchestrate()\n\nAlso update getMode() to handle the new variant.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:03.493537+11:00","updated_at":"2025-12-19T10:34:31.591108+11:00","closed_at":"2025-12-19T10:34:31.591108+11:00","close_reason":"Added orchestrate mode variant to EditorMode, 7 service methods (enterOrchestrate, orchestrateMoveDown/Up, orchestrateToggle, orchestrateSelectAll/None, exitOrchestrate), plus KeyMode and StatusBar updates","dependencies":[{"issue_id":"az-9870","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:23.354103+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T02:15:58.659133+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-9an","title":"gg command should take me to top of current column not top of open column always","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:50.236333+11:00","updated_at":"2025-12-17T01:01:29.643058+11:00","closed_at":"2025-12-17T01:01:29.643058+11:00"}
{"id":"az-9b8","title":"Epic progress indicator in TaskCard","description":"Show progress bar for epic tasks: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5\n\n**Implementation:**\n- Query child task statuses\n- Calculate completed/total\n- Render as Unicode progress bar\n- Only show for issue_type=epic\n\n**Space cost:** One line, replaces description line for epics","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.040003+11:00","updated_at":"2025-12-12T13:29:15.040003+11:00","dependencies":[{"issue_id":"az-9b8","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.835556+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-9bua","title":"when az restarts we lose track of claude session status","description":"","notes":"Implemented session persistence to .azedarach/sessions.json:\n\nChanges made:\n1. SessionManager.ts: Added Schema-based persistence with Schema.HashMap + Schema.DateTimeUtc\n2. Updated Session.startedAt from Date to DateTime.Utc\n3. Added loadPersistedSessions() and persistSessions() helpers (with BunContext layer)\n4. Enhanced listActive() to recover state from persisted file\n5. Added persist calls to start(), stop(), pause(), resume(), updateState()\n6. BoardService.ts: Updated toISOString() to DateTime.formatIso()\n7. .gitignore: Added .azedarach/\n\nType-check passes. Ready for testing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:53:43.340812+11:00","updated_at":"2025-12-18T15:41:04.467691+11:00","closed_at":"2025-12-18T15:41:04.467694+11:00"}
{"id":"az-9ch","title":"Worktree init hooks (direnv, env vars, custom commands)","description":"Allow configuring commands to run when a worktree is created or session is started. Common use cases: direnv allow, setting env vars, installing deps, etc.","design":"Config structure (in future az config file):\n```yaml\nworktree:\n  init:\n    - direnv allow\n    - pnpm install\n  env:\n    CLAUDE_MODEL: opus\n    DEBUG: true\n```\n\nImplementation options:\n1. Run init commands after worktree creation in WorktreeManager\n2. Run init commands in the tmux session before claude starts\n3. Both (worktree-level vs session-level hooks)\n\nOption 2 is simpler - modify the session command:\n```\n$SHELL -c 'direnv allow \u0026\u0026 claude; exec $SHELL'\n```\n\nFor env vars, use tmux set-environment or export in the shell command.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:13:03.534484+11:00","updated_at":"2025-12-12T17:24:21.906802+11:00","closed_at":"2025-12-12T17:24:21.906802+11:00","dependencies":[{"issue_id":"az-9ch","depends_on_id":"az-pnx","type":"blocks","created_at":"2025-12-12T12:13:09.239776+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-9co","title":"bd sync needs atomic operations to prevent race conditions","description":"","notes":"## Problem\n\nMultiple bd processes (daemon, beads-mcp servers, manual bd sync) can race to update the beads-sync branch, causing data loss.\n\n## Race Scenario\n\n1. Process A reads JSONL with [issue-1, issue-2]\n2. Process B creates issue-3, exports to JSONL\n3. Process A commits its JSONL to beads-sync (missing issue-3!)\n4. Process B runs bd sync, pulls from beads-sync\n5. Process B tombstones issue-3 (sees it as \"deleted\")\n\n## Root Cause\n\n- bd sync is not atomic\n- No locking between concurrent bd processes\n- beads-sync branch can be overwritten by stale data\n\n## Proposed Fix (upstream)\n\nOption 1: Git ref transactions\n- Use git's atomic ref updates\n- bd sync should fail if beads-sync moved since last read\n\nOption 2: File-based locking\n- Acquire lock before any sync operation\n- Release after commit+push complete\n\nOption 3: CRDT-based merge\n- Instead of overwrite, use conflict-free merge\n- Tombstones require consensus, not just \"missing from one branch\"\n\n## Workaround (Azedarach)\n\n- Use FileLockManager around bd sync calls\n- Prevents races within our own operations\n- Does NOT fix races with external bd processes\n\n## Related\n\n- az-zby: bd sync incorrectly tombstones issues","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T12:55:05.604475+11:00","updated_at":"2025-12-18T12:55:05.879012+11:00","labels":["beads-upstream"]}
{"id":"az-9fhx","title":"use lazygit for space f diffing","description":"","design":"## Implementation Plan\n\nReplace the `showDiff()` method in PRHandlersService to use lazygit instead of `git diff | less`.\n\n### Changes\n1. **File**: `src/services/keyboard/PRHandlersService.ts`\n   - Modify `showDiff()` method (lines 438-476)\n   - Replace the git diff command with `lazygit status`\n   - Use `-p` flag to set worktree path\n   - Use `status` positional arg to open directly on files/diff panel\n\n### New Command\n```bash\nlazygit -p \"${worktreePath}\" status\n```\n\nThis opens lazygit:\n- In the worktree directory (`-p` flag)\n- Focused on the status/files panel (`status` arg) where diffs are visible\n- User can navigate files with j/k, view diffs with enter, stage with space\n\n### Benefits\n- Interactive file navigation\n- Can stage/unstage changes\n- View commit history\n- Much richer than plain `git diff | less`\n\n### No breaking changes\n- Still requires active session (worktree)\n- Same keybinding (Space+f)\n- Same tmux popup approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:04:48.453427+11:00","updated_at":"2025-12-21T01:57:21.101486+11:00","closed_at":"2025-12-21T01:57:21.101489+11:00","close_reason":"Implemented: Space+f now opens lazygit in a tmux popup instead of git diff | less"}
{"id":"az-9shr","title":"make space f use lazygit with fullscreen side by side difftastic diffing","description":"","design":"## Implementation Plan\n\n**Goal:** Make Space+f launch lazygit with difftastic side-by-side diffing using a temporary config.\n\n### Technical Approach\n\n1. **Create temporary lazygit config** with difftastic externalDiffCommand before launching\n2. **Pass config via `--use-config-file`** flag to lazygit\n3. **Keep 95% popup size** (user preference over true fullscreen)\n4. **Config contents:**\n   ```yaml\n   git:\n     pagers:\n       - externalDiffCommand: difft --color=always --display=side-by-side\n   gui:\n     sidePanelWidth: 0.2  # More space for side-by-side diffs\n   ```\n\n### File Changes\n\n**`src/services/keyboard/PRHandlersService.ts`** - Modify `showDiff()`:\n- Create temp config file with difftastic settings\n- Add `--use-config-file` flag to lazygit command\n- Use Effect's `@effect/platform` FileSystem for temp file creation\n\n### Dependencies\n- `difft` must be installed on user's system (will show error toast if not available)\n- lazygit 0.40.2+ required for externalDiffCommand (current: 0.57.0 ‚úì)\n\n### Acceptance Criteria\n- [ ] Space+f opens lazygit with difftastic side-by-side diffs\n- [ ] Works in worktree context\n- [ ] Temp config cleaned up after lazygit closes\n- [ ] Graceful error if difft not installed","acceptance_criteria":"- [ ] Space+f opens lazygit with difftastic side-by-side diffs\n- [ ] Syntax highlighting works in diff view\n- [ ] Works in worktree context (current task's worktree)\n- [ ] Temp config cleaned up after lazygit closes\n- [ ] Graceful error toast if difft not installed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:59:20.859821+11:00","updated_at":"2025-12-21T03:34:13.33535+11:00","closed_at":"2025-12-21T03:34:13.335354+11:00"}
{"id":"az-9yak","title":"i just ran a nix rebuild and we lost difftastic again","description":"in ~/nix i ran just rebuild and now our diff viewer is broken like it was yesterday\nwe expect full semantic diffing with nice colors but get this image","design":"...","notes":"üìé [mjc8qp91-fnec.png](.beads/images/az-9yak/mjc8qp91-fnec.png) (clipboard, 12/19/2025, 1:19:12 PM)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T13:18:54.788495+11:00","updated_at":"2025-12-19T14:13:53.762915+11:00","deleted_at":"2025-12-19T14:13:53.762915+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-a15u","title":"when i switch projects it takes a few seconds for the app to become interactable again","description":"i assume it is running a bunch of initialization stuff... not sure why its blocking though\neven if we cant improve this blocking issue we should at least indicate to the user when its ready","design":"## Root Cause Analysis\n\nThe blocking occurs in `board.refresh()` which calls `bd list --json` synchronously. This spawns a process that takes ~2-3 seconds to complete, during which the UI thread is blocked.\n\n**Flow:**\n1. User presses number key in project selector\n2. `handleProjectSelectorInput()` runs synchronously\n3. `projectService.switchProject()` - fast (SubscriptionRef update)\n4. `overlay.pop()` - fast\n5. `board.refresh()` - **BLOCKS** (calls bd CLI via Command.string)\n6. `toast.show()` - never reached until refresh completes\n\n## Implementation Plan\n\n### 1. Add loading state to BoardService\n- Add `isLoading` SubscriptionRef to track refresh state\n- Set `isLoading=true` at start of refresh, `false=at end\n- Expose via `boardIsLoadingAtom` for UI subscription\n\n### 2. Create loading indicator UI\n- Show spinner/text in StatusBar when `isLoading=true`\n- Message: \"Loading project...\" or similar\n- Non-intrusive, doesn't block interaction\n\n### 3. Make project switch non-blocking\n- In `handleProjectSelectorInput`:\n  - `overlay.pop()` first (immediate UI feedback)\n  - `board.refresh()` via `Effect.fork` (non-blocking)\n  - Toast shows after fork starts, not after completion\n- User sees old data briefly, then board updates\n\n### 4. Consider: Show stale data indicator\n- Optional: dim/gray out board while loading\n- Or show \"Refreshing...\" toast that dismisses on completion\n\n## Key Files to Modify\n- `src/services/BoardService.ts` - add isLoading state\n- `src/ui/atoms/board.ts` - add boardIsLoadingAtom\n- `src/ui/StatusBar.tsx` - show loading indicator\n- `src/services/keyboard/InputHandlersService.ts` - fork the refresh","acceptance_criteria":"- [ ] Project switching is non-blocking (UI immediately responsive)\n- [ ] Loading indicator shows while refresh is in progress\n- [ ] Board updates correctly after refresh completes\n- [ ] No visual glitches or race conditions\n- [ ] Works for both project selector and initial app load","notes":"## Implementation Complete\n\n### Changes made:\n1. **BoardService.ts** - Added `isLoading` SubscriptionRef that tracks refresh state\n   - Set to `true` at start of refresh\n   - Set to `false` via `Effect.ensuring` (always runs even on error)\n\n2. **atoms/board.ts** - Added `boardIsLoadingAtom` for React subscription\n\n3. **StatusBar.tsx** - Added loading indicator with yellow \"Loading...\" badge\n   - Shows between view mode indicator and keybindings\n   - Non-intrusive, doesn't block interaction\n\n4. **InputHandlersService.ts** - Made `handleProjectSelectorInput` non-blocking\n   - Overlay pops immediately (instant UI feedback)\n   - Initial toast: \"Switching to: {project}\"\n   - `board.refresh()` runs via `Effect.fork` (background)\n   - Completion toast: \"Loaded: {project}\"\n\n5. **atoms/project.ts** - Updated `switchProjectAtom` to be non-blocking too\n   - Same pattern as InputHandlersService for consistency\n\n### Testing:\n- Type check passes ‚úì\n- Build succeeds ‚úì\n- Manual testing needed: switch projects and verify UI responsiveness","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:03:52.269921+11:00","updated_at":"2025-12-19T11:53:36.034472+11:00","closed_at":"2025-12-19T11:24:38.432122+11:00","close_reason":"Implemented non-blocking project switching with loading indicator","deleted_at":"2025-12-19T11:53:36.034472+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-a245","title":"ignore beads changes in space f diff reader","description":"","design":"## Problem\nThe Space+f diff viewer (`showDiff` in PRHandlersService.ts:357-391) shows all file changes between a bead's branch and main, including `.beads/` directory changes. These database files are infrastructure noise that clutters the code review.\n\n## Solution\nAdd `-- ':!.beads'` pathspec exclusion to the git diff commands in `showDiff()`.\n\n## Implementation Plan\n1. Modify the `diffCommand` in `PRHandlersService.ts:showDiff()` to exclude `.beads/` from both:\n   - The `--stat` summary diff\n   - The full diff content\n\n## Changes\nSingle file change: `src/services/keyboard/PRHandlersService.ts`\n\nAdd pathspec exclusion `-- ':!.beads'` to filter out beads database changes:\n```bash\n# Before\ngit diff $MERGE_BASE --stat --color=always\ngit diff $MERGE_BASE --color=always\n\n# After  \ngit diff $MERGE_BASE --stat --color=always -- ':!.beads'\ngit diff $MERGE_BASE --color=always -- ':!.beads'\n```\n\n## Acceptance Criteria\n- [ ] Space+f diff excludes `.beads/` directory changes\n- [ ] Code changes still display correctly\n- [ ] Both `--stat` summary and full diff are filtered\n\n## Testing\n1. Start a session on a bead (creates worktree)\n2. Make some changes to beads (close/update issues)\n3. Press Space+f to view diff\n4. Verify .beads/ changes are NOT shown\n5. Verify actual code changes ARE shown","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T16:12:31.928397+11:00","updated_at":"2025-12-19T16:14:34.395768+11:00","closed_at":"2025-12-19T16:14:34.395768+11:00","close_reason":"Added ':!.beads' pathspec exclusion to both git diff commands in showDiff(), filtering out beads database changes from Space+f diff output"}
{"id":"az-a4zu","title":"while merge is in progress the confirm merge dialog should disappear","description":"When user confirms merge in the confirm dialog (presses y/Enter), the dialog stays visible during the entire merge operation because we await the merge Effect before popping the overlay.\n\n## Root Cause\nIn `InputHandlersService.handleConfirmInput()` (line 201-203):\n```typescript\nif (key === \"y\" || key === \"return\") {\n    yield* currentOverlay.onConfirm  // ‚Üê Awaits merge completion\n    yield* overlay.pop()             // ‚Üê Only then closes dialog\n}\n```\n\nThe `onConfirm` Effect runs the merge operation which can take several seconds. The dialog stays visible until it completes.","design":"...","acceptance_criteria":"- [ ] Confirm dialog disappears immediately when user presses y/Enter\n- [ ] Merge operation still runs successfully\n- [ ] Toast feedback (\"Merging...\") still appears\n- [ ] Board refreshes after merge completes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:32:09.381139+11:00","updated_at":"2025-12-19T10:27:26.813974+11:00","closed_at":"2025-12-19T10:27:26.813977+11:00","close_reason":"Implemented: reordered overlay.pop() before onConfirm in handleConfirmInput() (line 204-205) so the confirm dialog closes immediately when user confirms, providing instant UI feedback while the merge runs in background. Commit: 89de00a","deleted_at":"2025-12-19T02:06:16.692951+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-a8i","title":"StateDetector - Claude output pattern matching","description":"Detect Claude session state by monitoring PTY output and matching patterns.","design":"- Define StateDetector as Effect.Service\n- Use Stream from Effect to process PTY output\n- Pattern matching with priorities (higher priority wins)\n- Methods:\n  - detectFromOutput(chunk: string): Effect\u003cSessionState | null\u003e\n  - createOutputStream(pty): Stream\u003cSessionState, never\u003e\n- Use @effect/schema for pattern configuration validation\n- Default patterns for waiting, done, error states\n- Configurable patterns via Config service\n- Use Schedule for debouncing state changes\n- Emit state changes via PubSub","notes":"‚úÖ StateDetector service complete and tested.\n\nFiles created:\n- src/core/StateDetector.ts (main service)\n- src/core/StateDetector.example.ts (usage examples)\n\nFeatures implemented:\n‚úì SessionState type: idle | busy | waiting | done | error\n‚úì Effect.Service with Effect.Tag pattern\n‚úì detectFromChunk() - stateless pattern matching\n‚úì createDetector() - stateful detector with debouncing\n‚úì Priority-based pattern matching (waiting \u003e error \u003e done \u003e busy)\n‚úì StateDetectorLive layer (no dependencies)\n‚úì Convenience functions for easy usage\n‚úì Debouncing: busy state coalesces rapid output\n‚úì Terminal state stickiness: done/error persist until reset\n‚úì Comprehensive examples demonstrating all features\n\nPattern matching:\n- waiting: [y/n], 'Do you want to', 'Press Enter', etc.\n- error: 'Error:', 'Exception:', 'Failed:', 'ENOENT', etc.\n- done: 'Task completed', 'Successfully', 'Done.', etc.\n- busy: any non-empty output not matching above\n\nType checking: ‚úÖ No errors\nRuntime testing: ‚úÖ All examples run successfully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.92773+11:00","updated_at":"2025-12-12T01:29:02.419812+11:00","closed_at":"2025-12-12T01:29:02.419812+11:00","dependencies":[{"issue_id":"az-a8i","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.44929+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-aa2","title":"add ability to view/remove attached images","description":"","notes":"Planning implementation: Add attachment navigation within DetailPanel overlay. When viewing a task with attachments, user can press j/k to select attachments, 'o' to open in viewer, 'x' to delete. Need to: 1) Add attachment selection state to EditorService, 2) Update DetailPanel to show selection, 3) Add keybindings for detail overlay attachment interaction.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:17:59.590786+11:00","updated_at":"2025-12-18T13:46:46.034146+11:00","closed_at":"2025-12-18T13:46:46.034146+11:00","close_reason":"Fixed bug where attachments weren't loading when opening detail panel via keyboard. Moved attachment loading logic into OverlayService.push()/pop() for single source of truth.","comments":[{"id":6,"issue_id":"az-aa2","author":"riordan","text":"Found bug: attachments not loading because keyboard handler bypassed atom with attachment loading logic","created_at":"2025-12-18T02:46:19Z"}],"deleted_at":"2025-12-18T10:46:02.51473+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ags","title":"Project scaffolding with Bun, Effect, OpenTUI, and SolidJS","description":"Initialize the project with package.json, tsconfig.json (strict mode), and build tooling. Set up Ink as the TUI framework with React 18.","design":"- Use pnpm as package manager\n- **Bun runtime** (required for OpenTUI's Zig FFI)\n- TypeScript strict mode enabled\n- Effect ecosystem as core foundation:\n  - `effect` - core runtime, error handling, concurrency\n  - `@effect/platform` + `@effect/platform-bun` - Command execution, file system\n  - `@effect/cli` - CLI argument parsing\n  - `effect/Schema` - config and data validation\n  - `@effect-atom/atom` - reactive state bridging Effect to UI\n- **OpenTUI for TUI** (bleeding edge, experimental):\n  - `@opentui/core` - terminal primitives, Yoga layout\n  - `@opentui/solid` - SolidJS reconciler (actively maintained)\n  - `solid-js` - reactive UI framework\n- tsup for bundling (or Bun's bundler)\n- Create src/index.tsx entry point\n- Create bin/az.ts CLI executable\n- Set up Layer-based dependency injection from the start\n- Install Zig (required for building OpenTUI)","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- package.json with Bun runtime, Effect ecosystem, OpenTUI + SolidJS\n- tsconfig.json with strict mode, SolidJS JSX config, path aliases\n- Directory structure: src/{core,lib,ui,config}, bin/\n- bin/az.ts CLI entry point (executable, runs successfully)\n- src/index.tsx placeholder with solid-js import\n- All dependencies installed via `bun install`\n\nFILES CREATED:\n- package.json - Full dependency list for Effect + OpenTUI stack\n- tsconfig.json - Strict TS with jsx: \"react-jsx\", jsxImportSource: \"solid-js\"\n- bin/az.ts - Shebang entry point\n- src/index.tsx - Placeholder entry\n\nKEY DECISIONS:\n- Using Bun (not Node) because OpenTUI requires Bun's FFI for Zig backend\n- Using pnpm despite Bun runtime (hybrid setup works)\n- tsup for bundling (simpler than esbuild config)\n\nVERIFICATION:\n- `bun run type-check` passes\n- `./bin/az.ts` outputs \"Azedarach - TUI Kanban for Claude orchestration\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.210523+11:00","updated_at":"2025-12-11T17:27:44.457444+11:00","closed_at":"2025-12-11T17:25:13.896919+11:00","dependencies":[{"issue_id":"az-ags","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.779213+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-aiu","title":"Implement session templates for pre-planning prompts","description":"Create .claude/session-templates/ with task-type-specific CLAUDE.md templates (feature.md, bugfix.md, refactor.md, epic.md). Templates inject 'think first' planning phase. SessionManager loads appropriate template when spawning.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.891181+11:00","updated_at":"2025-12-12T13:25:20.531813+11:00"}
{"id":"az-an4s","title":"cleanup beads","description":"merge duplicates, move completed tasks out of open/in progress, improve organization (create epics, add dependencies/blocking, etc), any other cleanup you can think of","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T15:37:23.194184+11:00","updated_at":"2025-12-18T15:37:33.100308+11:00","deleted_at":"2025-12-18T15:37:33.100308+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-ap1","title":"Complete CLI commands (attach, pause, status, sync)","description":"src/cli/index.ts has 5 TODO placeholders:\n\n- **attach** (line 174): Implement session attachment via TmuxService\n- **pause** (line 201): Implement session pause\n- **status** (line 226): Display session/board status summary\n- **sync** (line 255-259): Sync worktrees (all vs current directory)\n\nCLI should be fully functional for non-TUI workflows.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:59:44.511089+11:00","updated_at":"2025-12-17T15:59:44.511089+11:00"}
{"id":"az-auzp","title":"Loading indicator flashes constantly during background polling","description":"The status bar shows \"Loading...\" every 2 seconds during background board refresh, causing visual noise.\n\n**Root cause:** BoardService sets `isLoading=true` during every background poll (every 2 seconds), making the loading indicator flash constantly.\n\n**Fix:** Debounce the loading indicator - only show it if loading takes longer than 500ms, preventing flash on quick background refreshes.\n\n**Related:** Dev server features (Space+w, port management, start/stop indicators) are tracked in az-dvsr which was reopened - that bead was designed but never implemented.","design":"## Implementation Plan\n\n### Single Change: Debounced Loading Indicator\n\n**Problem:** `BoardService.refresh()` sets `isLoading=true` immediately, then `false` after ~50-100ms when refresh completes. This causes the loading indicator to flash every 2 seconds during background polling.\n\n**Solution:** Only set `isLoading=true` after a 500ms delay. If refresh completes before 500ms, never show loading indicator.\n\n### File Changes\n\n**`src/services/BoardService.ts`** - Modify refresh() method:\n\n```typescript\n// Before (flashes on every poll):\nconst refresh = () =\u003e\n  Effect.gen(function* () {\n    yield* SubscriptionRef.set(isLoading, true)\n    // ... load data ...\n  }).pipe(Effect.ensuring(SubscriptionRef.set(isLoading, false)))\n\n// After (debounced - only shows if loading \u003e 500ms):\nconst refresh = () =\u003e\n  Effect.gen(function* () {\n    // Schedule delayed loading indicator (500ms)\n    const loadingFiber = yield* Effect.sleep(\"500 millis\").pipe(\n      Effect.tap(() =\u003e SubscriptionRef.set(isLoading, true)),\n      Effect.fork\n    )\n    \n    // Do the actual loading\n    const loadedTasks = yield* loadTasks()\n    yield* SubscriptionRef.set(tasks, loadedTasks)\n    // ... rest of refresh logic ...\n    \n    // Cancel the loading fiber if it hasn't fired yet\n    yield* Fiber.interrupt(loadingFiber)\n  }).pipe(Effect.ensuring(SubscriptionRef.set(isLoading, false)))\n```\n\n### Behavior\n\n- Quick refreshes (\u003c500ms): No loading indicator shown\n- Slow refreshes (\u003e500ms): Loading indicator appears after 500ms delay\n- Background polling: Silent (typically completes in \u003c100ms)\n- Manual refresh/initial load: Shows loading if slow\n\n### Testing\n\n1. Run `bun run dev`\n2. Observe status bar - should NOT flash \"Loading...\" every 2 seconds\n3. Simulate slow network (add `yield* Effect.sleep(\"1 second\")` to loadTasks)\n4. Verify loading indicator appears after 500ms delay","acceptance_criteria":"- [ ] Status bar does NOT flash \"Loading...\" during normal 2-second background polling\n- [ ] Loading indicator DOES appear if refresh takes longer than 500ms\n- [ ] No visual noise or flickering during normal operation","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T11:37:35.377412+11:00","updated_at":"2025-12-19T14:14:01.944036+11:00","closed_at":"2025-12-19T14:14:01.944038+11:00","close_reason":"Fixed loading indicator flash by debouncing the changes stream. Used Subscribable.make to wrap the SubscriptionRef with Stream.debounce(\"500 millis\") - now loading only shows if refresh takes \u003e500ms.","deleted_at":"2025-12-19T13:26:52.144641+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"bug"}
{"id":"az-bf8","title":"queue up commands that would conflict if run all at once","description":"e.g. space m (we shouldnt try to merge two branches at once!)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:48:33.510147+11:00","updated_at":"2025-12-17T15:51:46.00979+11:00","closed_at":"2025-12-17T15:51:46.009793+11:00"}
{"id":"az-bijh","title":"cleanup beads","description":"merge duplicates, move completed tasks out of open/in progress, improve organization (create epics, add dependencies/blocking, etc), any other cleanup you can think of","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T15:10:58.00143+11:00","updated_at":"2025-12-20T01:47:42.036119+11:00"}
{"id":"az-biza","title":"we should ensure that claude always commits changes when it says it's done","description":"","design":"## Problem\n\nClaude can say \"done\" without committing changes. Current enforcement is advisory only:\n- CLAUDE.md rule #7 says to commit\n- `bd prime` shows SESSION CLOSE PROTOCOL  \n- `/session-end` command has Phase 0 git check\n\nBut none of these are emphatic enough - Claude sometimes skips the commit step.\n\n## Solution: Stronger CLAUDE.md Prompting\n\nInstead of a blocking hook, make CLAUDE.md rule #7 much more emphatic with:\n1. Stronger language (CRITICAL, MANDATORY)\n2. Explicit checklist format\n3. Clear \"before saying done\" trigger\n4. Specific commit message guidance\n\n## Implementation Plan\n\n### 1. Strengthen CLAUDE.md rule #7\nUpdate the \"Session End - Commit Everything\" rule to be more emphatic:\n- Add CRITICAL/MANDATORY language\n- Include explicit checklist\n- Make it clear this applies when saying \"done\", \"complete\", \"finished\", etc.\n- Provide commit message templates\n\n## Files to Modify\n- MODIFY: `CLAUDE.md` (strengthen rule #7)","acceptance_criteria":"1. CLAUDE.md rule #7 is strengthened with emphatic language\n2. Rule includes explicit checklist format\n3. Rule mentions \"done\", \"complete\", \"finished\" as triggers\n4. Rule provides commit message guidance (proper message vs wip checkpoint)\n5. Rule is prominent and hard to miss","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:48:53.111348+11:00","updated_at":"2025-12-21T03:21:58.200254+11:00","closed_at":"2025-12-21T03:21:58.200254+11:00","close_reason":"Strengthened CLAUDE.md rule #7 with emphatic language, mandatory checklist, trigger phrases, and commit message guidance. Version bumped to 2.2.0."}
{"id":"az-bjp","title":"Parallel worker spawning from orchestration mode","description":"When user confirms orchestration, spawn workers in parallel.\n\n**Implementation:**\n- Use Effect.forEach with concurrency for parallel worktree creation\n- Each worker: WorktreeManager.create ‚Üí TmuxService.newSession ‚Üí inject template\n- Reserve issues via Agent Mail (if available)\n- Track all spawned workers in SessionManager\n\n**Error handling:**\n- If any spawn fails, show toast but continue with others\n- Partial success is acceptable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.790073+11:00","updated_at":"2025-12-19T10:54:57.084917+11:00","closed_at":"2025-12-19T10:54:57.084917+11:00","close_reason":"Updated confirmSpawn to inject epic context via TemplateService with graceful fallback","dependencies":[{"issue_id":"az-bjp","depends_on_id":"az-7sr","type":"blocks","created_at":"2025-12-12T13:29:24.844916+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-bjp","depends_on_id":"az-lqb","type":"blocks","created_at":"2025-12-12T13:29:24.88113+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-bjp","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.765448+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-bmpb","title":"diff command is not visible in action menu","description":"The diff command (`Space+f`) exists in keybindings and works correctly, but is not visible in the ActionPalette UI component. Users cannot discover this feature through the visual menu.\n\n## Root Cause\n- `bindings.ts:448-454`: Keybinding for `f` in action mode is defined\n- `PRHandlersService.ts:357-389`: `showDiff()` implementation works\n- `ActionPalette.tsx`: Missing `\u003cActionLine\u003e` for the `f` key\n\n## Implementation Plan\n1. Add `f` to `QUEUED_ACTIONS` set in ActionPalette.tsx (if it should be blocked when busy)\n2. Add `isAvailableByState` case for `f` - should be available when session is not idle (same as `P`, `m`, `d`)\n3. Add `\u003cActionLine keyName=\"f\" description=\"diff\" /\u003e` to the JSX, positioned logically with other Git/PR actions","design":"## Changes Required\n\n**File: `src/ui/ActionPalette.tsx`**\n\n1. Check if `f` should be added to `QUEUED_ACTIONS` - No, `showDiff` doesn't use `helpers.withQueue()`, it just opens a tmux popup. Non-blocking.\n\n2. Add case in `isAvailableByState`:\n   ```typescript\n   case \"f\": // Diff - only if session has worktree (not idle)\n     return sessionState !== \"idle\"\n   ```\n\n3. Add ActionLine in Git/PR section (before P, after the separator):\n   ```tsx\n   \u003cActionLine keyName=\"f\" description=\"diff\" /\u003e\n   \u003cActionLine keyName=\"P\" description=\"PR\" /\u003e\n   ```","acceptance_criteria":"- [ ] `f` key appears in the action palette when in action mode\n- [ ] `f` is dimmed when session state is `idle` (no worktree)\n- [ ] `f` is enabled/visible when session has a worktree (busy, paused, waiting, done, error)\n- [ ] Pressing `Space+f` still correctly opens the diff popup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:17:55.603878+11:00","updated_at":"2025-12-19T13:42:21.244438+11:00","closed_at":"2025-12-19T13:42:21.244438+11:00","close_reason":"Added `f` key to ActionPalette.tsx - both the availability check in isAvailableByState() and the visual ActionLine in the Git/PR section. The diff command is now visible and properly dimmed when no session is active."}
{"id":"az-bth","title":"can't put cursor on started task in normal mode","description":"its right above current cursor but up arrow does nothing. check az.log","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:50:52.307315+11:00","updated_at":"2025-12-15T14:07:19.991268+11:00","closed_at":"2025-12-15T14:07:19.991268+11:00"}
{"id":"az-c1tg","title":"is the system diagnostics panel up to date? is it missing some stuff?","description":"","design":"## Investigation Results\n\n**Current State:** The System Diagnostics panel exists (`DiagnosticsOverlay.tsx`) and shows:\n1. **Services** - Registered via `diagnostics.trackService(name, details)`\n2. **Long-Running Fibers** - Registered via `diagnostics.registerFiber({...})`\n\n**Currently Tracked:**\n- ‚úÖ NavigationService (via trackService)\n- ‚úÖ PTYMonitor (via trackService)\n- ‚úÖ HookReceiver Poller (via registerFiber)\n\n**Missing - Services with background fibers that SHOULD be tracked:**\n1. **ClockService** - `scheduleForked(1s)` clock tick - NOT tracked\n2. **BoardService** - `scheduleForked(2s)` beads polling - NOT tracked\n3. **VCService** - `scheduleForked(5s)` status polling - NOT tracked\n4. **ToastService** - `forkScoped` auto-expiration - NOT tracked\n5. **SessionManager** - Core service, no polling but should show health\n\n**Files to modify:**\n- `src/services/ClockService.ts` - Add trackService\n- `src/services/BoardService.ts` - Add trackService + registerFiber for poller\n- `src/core/VCService.ts` - Add trackService + registerFiber for poller\n- `src/services/ToastService.ts` - Add trackService\n- `src/core/SessionManager.ts` - Add trackService (depends on DiagnosticsService)\n\n## Implementation Plan\n1. Add DiagnosticsService as dependency to each missing service\n2. Call `trackService` with meaningful descriptions\n3. For polling fibers, call `registerFiber` to show their status\n4. Test by opening diagnostics panel (Ctrl+D) and verifying all show up","acceptance_criteria":"- [ ] ClockService registered in diagnostics with \"1s clock tick\"\n- [ ] BoardService registered with poller fiber tracked\n- [ ] VCService registered with status poller tracked\n- [ ] ToastService registered with expiration fiber tracked\n- [ ] SessionManager registered as core service\n- [ ] All services show as \"healthy\" in diagnostics panel\n- [ ] All polling fibers show as \"running\" in diagnostics panel\n- [ ] Type check passes: `bun run type-check`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:44:54.781082+11:00","updated_at":"2025-12-19T13:08:17.360312+11:00","closed_at":"2025-12-19T13:08:17.360312+11:00","close_reason":"Completed: Added all 5 missing services to DiagnosticsService. ClockService, BoardService, VCService, ToastService, and SessionManager now all appear in the System Diagnostics panel."}
{"id":"az-c1vq","title":"improve PR workflow","description":"the local dev workflow is great. space m does so much and does it well but the PR workflow is pretty barebones. in chefy i will primarily use PRs to merge work into base branch so i need to streamline it too. e.g. having claude merge base branch into worktree automatically","design":"## Implementation Plan: Improved PR Workflow\n\n### Goal\nStreamline the PR workflow to match the quality of the local merge workflow (Space+m). Three key enhancements:\n\n### 1. Enhanced PR Creation (Space+P) - Auto-resolve conflicts before PR\n**Current:** Creates PR directly, may fail if branch is behind main\n**New flow:**\n1. Check for conflicts with main (using existing `git merge-tree` approach)\n2. If conflicts: merge main into worktree ‚Üí have Claude resolve ‚Üí commit resolution\n3. If no conflicts: merge main into worktree to stay current (fast-forward)\n4. Then create PR as before\n\n**Implementation:**\n- Modify `PRWorkflow.createPR()` to call new `updateFromBase()` first\n- Reuse conflict detection from `checkMergeConflicts()`\n- Reuse conflict resolution flow from `mergeToMain()` (but merge INTO worktree, not main)\n\n### 2. New Keybinding: Space+u (Update from base)\n**Purpose:** Merge base branch (main) into worktree at any time, resolving conflicts with Claude\n\n**Flow:**\n1. Check for uncommitted changes (warn about autostash)\n2. Run `git merge main` in worktree\n3. If conflicts: prompt Claude to resolve them\n4. On success: toast \"Updated from main\"\n\n**Implementation:**\n- Add `updateFromBase()` method to `PRWorkflow`\n- Add handler in `PRHandlersService`\n- Register keybinding in `bindings.ts`\n- Add to `ActionPalette.tsx` display\n\n### 3. PR Comments on Attach\n**Purpose:** When attaching to a session that has an existing PR, fetch and show PR comments\n\n**Flow:**\n1. On session attach, check if PR exists for branch (`gh pr view`)\n2. If PR exists: fetch comments (`gh pr view --comments`)\n3. If comments exist: inject them into Claude's context with prompt to address\n\n**Implementation:**\n- Add `getPRComments()` method to `PRWorkflow`\n- Modify session attach flow in `SessionHandlersService` to check for PR comments\n- Use tmux `send-keys` to inject context (similar to how initial prompts work)\n\n---\n\n## Files to Modify\n\n1. `src/core/PRWorkflow.ts`\n   - Add `updateFromBase(options)` method\n   - Add `getPRComments(options)` method\n   - Modify `createPR()` to call `updateFromBase()` first\n\n2. `src/services/keyboard/PRHandlersService.ts`\n   - Add `updateFromBase()` handler method\n\n3. `src/services/keyboard/SessionHandlersService.ts`\n   - Modify `attach()` to check for and inject PR comments\n\n4. `src/services/keyboard/bindings.ts`\n   - Add Space+u binding for updateFromBase\n\n5. `src/ui/ActionPalette.tsx`\n   - Add \"u update\" to action display\n\n6. `docs/keybindings.md`\n   - Document new Space+u keybinding\n   - Update Space+P documentation\n\n---\n\n## Acceptance Criteria\n\n- [ ] Space+P: Automatically merges main into worktree before creating PR\n- [ ] Space+P: If conflicts exist, Claude resolves them before PR creation\n- [ ] Space+u: New keybinding to update worktree from main at any time\n- [ ] Space+u: Shows conflicts to Claude for resolution if they exist\n- [ ] Session attach: Fetches PR comments if PR exists\n- [ ] Session attach: Injects comments into Claude context with resolution prompt\n- [ ] Documentation updated for new keybinding\n- [ ] Type check passes","notes":"## Implementation Complete ‚úÖ\n\nAll acceptance criteria met:\n\n- [x] Space+P: Automatically merges main into worktree before creating PR\n- [x] Space+P: If conflicts exist, Claude resolves them before PR creation\n- [x] Space+u: New keybinding to update worktree from main at any time\n- [x] Space+u: Shows conflicts to Claude for resolution if they exist\n- [x] Session attach: Fetches PR comments if PR exists\n- [x] Session attach: Injects comments into Claude context with resolution prompt\n- [x] Documentation updated for new keybinding\n- [x] Type check passes, build succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:02:15.819171+11:00","updated_at":"2025-12-19T15:41:55.108964+11:00","closed_at":"2025-12-19T15:41:55.108964+11:00","close_reason":"Implemented: Space+u update from main, Space+P auto-sync before PR, PR comments on attach"}
{"id":"az-c7e","title":"FileLockManager - prevent concurrent file access","description":"Implement socket-based file locking to prevent multiple Claude sessions from editing the same file simultaneously.","design":"- Define FileLockManager as Effect.Service\n- Use Unix domain socket for lock coordination (via @effect/platform)\n- Lock granularity: per-file path (normalized)\n- Methods:\n  - acquireLock(path, type): Effect\u003cLock, LockError | TimeoutError\u003e\n  - releaseLock(lock): Effect\u003cvoid, never\u003e\n  - withLock(path, type, effect): Effect\u003cA, E | LockError, R\u003e // scoped\n- Lock types: exclusive (write) vs shared (read) using Semaphore\n- Use Effect.timeout for lock acquisition timeout\n- Use Effect.ensuring for automatic lock release\n- Track locks in Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n- Handle session crash cleanup via Fiber interruption\n- Consider: advisory (warn via Logger) vs enforced (block via Deferred)\n- Socket path: /tmp/azedarach-\u003cproject-hash\u003e.sock","notes":"Implemented FileLockManager service following Effect patterns:\n\nCore implementation:\n- Service defined using Effect.Tag pattern (FileLockManager)\n- Lock types: exclusive (write) vs shared (read)\n- Error types: LockError, LockTimeoutError, LockConflictError\n- Lock state tracking via Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n\nKey methods:\n- acquireLock(path, type, timeout?, sessionId?): acquires lock or waits in queue\n- releaseLock(lock): releases lock and processes wait queue\n- getLockState(path): inspection for debugging/monitoring\n- withLock(options, effect): scoped convenience function for automatic cleanup\n\nLock semantics:\n- Exclusive locks: only one holder, blocks all other locks\n- Shared locks: multiple holders allowed, blocks exclusive locks\n- Wait queue processing: FIFO with automatic grant when compatible\n\nFeatures:\n- Effect.ensuring for automatic lock release\n- Deferred + timeoutFail for timeout handling\n- Automatic wait queue cleanup on fiber interruption\n- Path normalization for consistent lock granularity\n- Project hash for socket paths: /tmp/azedarach-\u003chash\u003e.sock\n\nFiles created:\n- src/core/FileLockManager.ts (580 lines)\n- src/core/FileLockManager.example.ts (354 lines with 8 examples)\n\nType checking: CLEAN (no errors)\nFollows patterns from: TmuxService, WorktreeManager, StateDetector","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:45.033059+11:00","updated_at":"2025-12-12T10:30:40.810809+11:00","closed_at":"2025-12-12T10:30:40.810809+11:00","dependencies":[{"issue_id":"az-c7e","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.562322+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-c9y","title":"Replace verbose StatusBar stats with compact indicators","description":"Replace verbose 'Tasks: 12  Active: 3' with compact indicators '12‚öô 3‚è∏ 2‚úó'. Expand to full text on wide terminals (‚â•100 cols). Add noteworthy alerts section that appears only when sessions need attention.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.538659+11:00","updated_at":"2025-12-12T13:25:20.220062+11:00","dependencies":[{"issue_id":"az-c9y","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.209397+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-ccvg","title":"Add getEpicWithChildren method to BeadsClient","description":"Add method to BeadsClient:\n```typescript\ngetEpicWithChildren: (epicId: string, cwd?: string) =\u003e\n  Effect.Effect\u003c{ epic: Issue; children: ReadonlyArray\u003cDependencyRef\u003e }, BeadsError | ParseError | NotFoundError\u003e\n```\n\nImplementation:\n- Call `bd show \u003cepicId\u003e --json`\n- Parse with extended schema\n- Extract `dependents` filtered by `dependency_type: \"parent-child\"`\n- Return epic + children","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:02.388922+11:00","updated_at":"2025-12-19T10:34:31.353903+11:00","closed_at":"2025-12-19T10:34:31.353903+11:00","close_reason":"Added getEpicWithChildren method to BeadsClient - fetches epic and filters dependents by parent-child type","dependencies":[{"issue_id":"az-ccvg","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:22.095947+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-ccvg","depends_on_id":"az-xqvh","type":"blocks","created_at":"2025-12-19T01:43:47.801368+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T02:15:58.659705+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ce9","title":"how do we track context? do we watch this bit in claude code somehow?","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:36.741749+11:00","updated_at":"2025-12-18T01:11:36.741749+11:00"}
{"id":"az-cgf","title":"Add VC command input mode (:)","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-14T01:05:15.626687+11:00","updated_at":"2025-12-14T01:10:33.962738+11:00","closed_at":"2025-12-14T01:10:33.962738+11:00","dependencies":[{"issue_id":"az-cgf","depends_on_id":"az-f4q","type":"blocks","created_at":"2025-12-14T01:05:21.400864+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-cktn","title":"when we manually and deliberately delete a bead with space D we should immediately sync that","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:39:04.318158+11:00","updated_at":"2025-12-18T13:39:04.318158+11:00"}
{"id":"az-cl1","title":"Add concurrency limit config for parallel sessions","description":"Add configuration option to limit maximum number of parallel Claude sessions.\n\nInspiration: AutoMaker's maxConcurrency setting with canStartNewTask check.\n\nImplementation:\n1. Add maxConcurrency to config schema (default: unlimited or 5)\n2. Check limit in SessionManager before starting new session\n3. Show visual indicator when at capacity\n4. Optionally queue pending starts when limit reached\n5. Display running/max in status bar (e.g., '3/5 sessions')","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:04Z","updated_at":"2025-12-16T12:00:04Z"}
{"id":"az-cqqj","title":"still seeing sync failed","description":"failed to parse json... we already know bd sync doesnt output json and so we shouldnt json.parse sync output right?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:36:32.970544+11:00","updated_at":"2025-12-18T14:23:57.721213+11:00","closed_at":"2025-12-18T14:23:57.721217+11:00","close_reason":"Fixed: Changed sync() and syncImportOnly() to use runBdDirect() which skips the --json flag, since bd sync doesn't output JSON. Methods now return void instead of attempting to parse non-existent JSON output."}
{"id":"az-cs0","title":"when performing left/right actions keep action mode active. otherwise return to normal mode immediately","description":"currently if i space S action mode remains until the toast appears instead of returning to normal mode as soon as i press \"S\". this is just an example","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:15:17.592791+11:00","updated_at":"2025-12-17T14:15:21.967725+11:00","closed_at":"2025-12-17T14:15:21.967725+11:00"}
{"id":"az-csh","title":"when a title is too long truncate it so the text doesnt overflow","description":"","notes":"Working on adding title truncation to TaskCard.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:27:43.068828+11:00","updated_at":"2025-12-17T00:47:49.957663+11:00","closed_at":"2025-12-17T00:47:49.957663+11:00"}
{"id":"az-cxow","title":"Integrate orchestration in App.tsx","description":"Update App.tsx to render OrchestrationOverlay when in orchestrate mode:\n\n1. Import OrchestrationOverlay and orchestrate atoms\n2. Add orchestrate mode detection to render logic\n3. Render OrchestrationOverlay with props from atoms\n4. Ensure keyboard events route to orchestrate mode handlers\n\nTest the full flow:\n- Enter on epic ‚Üí detail panel\n- Press 'o' ‚Üí orchestration overlay\n- Navigate, select, confirm\n- Verify spawn toast appears","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:06.779395+11:00","updated_at":"2025-12-19T10:34:43.312283+11:00","closed_at":"2025-12-19T10:34:43.312283+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-cxow","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:27.173174+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-cxow","depends_on_id":"az-f1j7","type":"blocks","created_at":"2025-12-19T01:43:52.458704+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-cxow","depends_on_id":"az-8ivo","type":"blocks","created_at":"2025-12-19T01:43:53.055371+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-cxow","depends_on_id":"az-ek3m","type":"blocks","created_at":"2025-12-19T01:43:53.611806+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-czq","title":"Tmux popup persists after Ctrl-C when editor was opened via 'c'","description":"When user presses 'c' to create a bead via editor, a tmux popup is spawned. If user Ctrl-C's azedarach before closing the popup, the popup remains orphaned and must be manually dismissed.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.795322+11:00","updated_at":"2025-12-14T21:46:18.162342+11:00","closed_at":"2025-12-14T21:46:18.162342+11:00"}
{"id":"az-d1v","title":"look into how tools like ccmonitor keep track of token/context usage","description":"https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/tree/main\nthey may have a better way than we currently use to track context usage in a session","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T00:28:23.974311+11:00","updated_at":"2025-12-18T00:28:23.974311+11:00"}
{"id":"az-d2x6","title":"review keybind decisions","description":"see if keybinds are still good or if we need to overhaul them with more modifiers or secondary menu layers e.g. space , opens a secondary menu layer, more of the action menus could be nested like that","design":"# Keybind Review - Comprehensive Analysis\n\n## 1. Current Keybind Philosophy\n\nAzedarach follows **Helix-style modal editing** with these principles:\n\n1. **Modal isolation** - Each mode has its own keybind namespace (no cross-mode conflicts)\n2. **Single-letter mnemonics** - Actions use memorable single letters (s=start, a=attach, p=pause)\n3. **Modifier consistency** - Shift variants for \"enhanced\" actions (s=start, S=start+work)\n4. **Data-driven bindings** - All keybindings defined in `bindings.ts` with descriptions\n5. **Escape always exits** - Universal pattern across all modes\n\n## 2. Current State Assessment\n\n### Mode Inventory\n\n| Mode | Keys Used | Remaining Capacity | Status |\n|------|-----------|-------------------|--------|\n| **normal** | 18 keys | ~8 single letters | üü° Moderate |\n| **action** | 18 keys | ~8 single letters | üü° Moderate |\n| **filter** | 22 keys | Very few | üî¥ Crowded (but well-organized) |\n| **goto** | 6 keys | Many | üü¢ Comfortable |\n| **sort** | 3 keys | Many | üü¢ Comfortable |\n| **select** | 10 keys | Many | üü¢ Comfortable |\n| **orchestrate** | 8 keys | Many | üü¢ Comfortable |\n\n### What's Working Well\n\n1. **Status bar hints** - Shows context-sensitive keybinds per mode with \"? more\" overflow\n2. **Help overlay** - `?` shows grouped keybindings (though incomplete)\n3. **Mnemonic scheme** - Most keys are intuitive (s/S/! for session start variants)\n4. **Filter sub-menus** - Good pattern: s‚Üístatus, p‚Üípriority, then value toggles\n\n### Keybind Conflicts/Issues Found\n\n- **None critical** - No actual conflicts between modes\n- **Help overlay incomplete** - Missing: filter mode details, Tab, f (filter), d (diagnostics)\n- **d key overload** - Normal mode: diagnostics. Action mode: cleanup worktree. Filter mode: closed status\n\n## 3. Future Pain Points\n\n### Action Mode (Space menu) Will Hit Limits First\n\nCurrently 18 bindings. Remaining single letters: b, j, k, n, o, q, t, u, w, y, z\n\n**Likely future actions needing keys:**\n- Dependency management (add/remove deps)\n- Label management\n- Priority quick-change\n- Status quick-change (without moving columns)\n- Duplicate task\n- Archive vs delete\n\n### Filter Mode Is Already Dense\n\n22 bindings but well-organized via sub-menus. Pattern works but adding new filter dimensions (labels, assignee) would require more sub-menus.\n\n## 4. Proposed Solutions\n\n### A. Space+, Secondary Menu (Recommended)\n\nAdd `,` as a keybinding within action mode that opens a nested menu:\n\n```\nSpace ‚Üí Action Mode (primary actions)\n  ‚îú‚îÄ‚îÄ s/S/! - Session start variants\n  ‚îú‚îÄ‚îÄ a/A - Attach variants  \n  ‚îú‚îÄ‚îÄ p/r/x - Pause/Resume/Stop\n  ‚îú‚îÄ‚îÄ e/E - Edit variants\n  ‚îú‚îÄ‚îÄ h/l - Move left/right\n  ‚îú‚îÄ‚îÄ i - Attach image\n  ‚îî‚îÄ‚îÄ , ‚Üí Secondary Menu (git/PR operations)\n        ‚îú‚îÄ‚îÄ f - Show diff (was Space+f)\n        ‚îú‚îÄ‚îÄ P - Create PR (was Space+P)\n        ‚îú‚îÄ‚îÄ m - Merge to main (was Space+m)\n        ‚îú‚îÄ‚îÄ M - Abort merge (was Space+M)\n        ‚îú‚îÄ‚îÄ d - Delete worktree (was Space+d)\n        ‚îî‚îÄ‚îÄ D - Delete bead (was Space+D)\n```\n\n**Rationale:** Git/PR operations are less frequent than session management. Nesting them frees up prime keys (f, m, d, P) for future high-frequency actions.\n\n### B. Goto Mode Extensions\n\n`goto` mode has capacity. Could add:\n- `gd` ‚Üí Go to dependencies view\n- `ga` ‚Üí Go to assignee filter\n- `gt` ‚Üí Go to type filter\n\n### C. Quick-Action Keys in Normal Mode\n\nReserved letters in normal mode: b, m, n, o, p, r, s, w, x, y, z\n\nCould use for one-key shortcuts to common operations:\n- `o` ‚Üí Quick open (same as Enter?)\n- `n` ‚Üí New task (same as c?)\n- `x` ‚Üí Quick close task\n\n**Recommendation:** Don't add these yet. Keep normal mode sparse for navigation.\n\n## 5. Discoverability Assessment\n\n### Current State\n\n| Feature | Status | Notes |\n|---------|--------|-------|\n| **Status bar hints** | ‚úÖ Good | Context-sensitive, responsive width handling |\n| **Help overlay (?)** | ‚ö†Ô∏è Incomplete | Missing filter details, some actions |\n| **Mode indicators** | ‚úÖ Good | NOR/ACT/GTO/etc with colors |\n| **Action palette** | ‚úÖ Good | Shows available actions with availability |\n\n### Recommendations\n\n1. **Update HelpOverlay.tsx** - Add missing sections for filter mode, diagnostics, Tab toggle\n2. **Add \"? more\" expansion** - Pressing `?` from status bar could show full keybind list\n3. **Consider whichkey-style** - After timeout in goto/action mode, show available completions\n\n## 6. Implementation Priority\n\n1. **Low effort, high value:**\n   - Update HelpOverlay with missing keybindings\n   - Add filter mode section to help\n\n2. **Medium effort, future-proofing:**\n   - Implement Space+, secondary menu pattern\n   - Move git/PR actions there\n   - Document the pattern for future growth\n\n3. **Optional polish:**\n   - Whichkey-style popup after key timeout\n   - Configurable keybindings (user rebinding)\n\n## 7. Decision: Should We Refactor Now?\n\n**Recommendation: No immediate refactor needed.**\n\nThe current system has room to grow. The Space+, pattern should be implemented when:\n- Action mode needs \u003e3 more keybindings, OR\n- User feedback indicates discoverability issues with current action menu\n\n**Document this review** in CLAUDE.md or internal-docs for future reference.","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Review design notes and confirm alignment with project vision\n- [ ] Decide: Implement Space+, now or defer until needed?\n- [ ] If implementing: Create follow-up task for Space+, secondary menu\n- [ ] Update HelpOverlay.tsx with missing keybindings (filter mode, etc.)\n- [ ] Add this keybind philosophy to internal-docs for future reference","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:15:13.916786+11:00","updated_at":"2025-12-19T15:38:55.583242+11:00","closed_at":"2025-12-19T15:38:55.583242+11:00","close_reason":"Comprehensive keybind review completed. Documented current philosophy, identified future pain points (Action mode will hit capacity first), proposed Space+, secondary menu pattern for when needed. Quick win implemented: HelpOverlay.tsx updated with full keybinding coverage (Sort mode, Filter mode, and missing General keys added)."}
{"id":"az-d5q","title":"Help overlay with keybinding reference","description":"Contextual help overlay showing available commands.","design":"- Toggle with '?' key\n- Show all keybindings grouped by category\n- Context-aware: highlight actions valid for selected task\n- Dismiss with any key or Escape\n- Include version info","notes":"Created HelpOverlay component with Catppuccin-themed modal showing all keybindings grouped by category (Navigation, Modes, Select Mode, Action Mode, General). Added '?' keybind to App.tsx to toggle the help overlay. The overlay dismisses on any key press. Successfully type-checked with no errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.840117+11:00","updated_at":"2025-12-12T01:29:02.41928+11:00","closed_at":"2025-12-12T01:29:02.41928+11:00","dependencies":[{"issue_id":"az-d5q","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.144875+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-d8p4","title":"we should copy over .direnv to new worktrees so we dont have to wait for nix flake cache refresh","description":"","design":"## Context\nWhen Azedarach creates new git worktrees for parallel Claude sessions, the `.direnv` directory (which contains Nix flake evaluation caches) is not copied because it's gitignored. This means each new worktree must re-evaluate the flake from scratch, which can take significant time.\n\n## Implementation Plan\nAdd `.direnv` directory copying to `WorktreeManager.create()`:\n\n1. **Location**: `src/core/WorktreeManager.ts`\n2. **Add helper function** `copyDirenvCache()`:\n   - Similar pattern to existing `copyClaudeLocalSettings()`\n   - Check if source `.direnv` exists\n   - Copy entire directory recursively using `fs.copy()`\n   - Non-fatal: log warning on failure, don't block worktree creation\n\n3. **Call from create()**: After worktree is created (after line 547), call `copyDirenvCache()`\n\n## Technical Notes\n- Uses `FileSystem.copy()` from `@effect/platform` for recursive directory copy\n- Matches error handling pattern of `copyClaudeLocalSettings` (catchAll ‚Üí warning)\n- No user-facing config needed - always copy if `.direnv` exists","acceptance_criteria":"- [ ] New worktrees have `.direnv` copied from main project\n- [ ] If `.direnv` doesn't exist in source, no error occurs\n- [ ] If copy fails, worktree creation continues with warning logged\n- [ ] Type-check passes: `bun run type-check`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:43:45.268742+11:00","updated_at":"2025-12-19T12:46:53.711866+11:00","closed_at":"2025-12-19T12:46:53.711866+11:00","close_reason":"Implemented copyDirenvCache helper in WorktreeManager that copies .direnv directory to new worktrees after creation. Uses same error-handling pattern as copyClaudeLocalSettings - logs warning on failure but doesn't block worktree creation."}
{"id":"az-d8z","title":"Session Management","description":"Core orchestration layer: git worktrees, tmux sessions, Claude spawning, state detection, and file locking to prevent concurrent access.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.762911+11:00","updated_at":"2025-12-12T10:33:37.439444+11:00","closed_at":"2025-12-12T10:33:37.439444+11:00"}
{"id":"az-dhpf","title":"indicator to card if a PR exists for it","description":"and if so, space P should open the pr in your browser","design":"## Implementation Plan\n\n### Goal\nShow a üîó indicator on TaskCards when a PR exists for that task, and make Space+P open the existing PR in browser instead of creating a new one.\n\n### Architecture\n\n**PR State Tracking:**\n- Add `prInfo?: { url: string; number: number; draft: boolean }` to `TaskWithSession` type\n- Use `PRWorkflow.getPR()` in `BoardService` refresh cycle to check for PRs\n- Cache PR info per task to avoid excessive GitHub API calls\n- Refresh PR state every board refresh (2 seconds) with debouncing\n\n**UI Changes:**\n- TaskCard header line: add üîó indicator after type when `prInfo` exists\n- Show draft indicator with different color (e.g., üîó gray for draft, üîó blue for ready)\n\n**Action Changes:**\n- PRHandlersService.createPR(): \n  - First check if PR exists using `prWorkflow.getPR()`\n  - If exists ‚Üí open browser with `open \u003curl\u003e` (macOS) or show toast with URL\n  - If not ‚Üí create new PR (current behavior)\n\n### Files to Modify\n1. `src/ui/types.ts` - Add prInfo to TaskWithSession\n2. `src/services/BoardService.ts` - Fetch PR info during refresh\n3. `src/ui/TaskCard.tsx` - Display üîó indicator\n4. `src/services/keyboard/PRHandlersService.ts` - Check for existing PR\n\n### Acceptance Criteria\n- [ ] TaskCard shows üîó when PR exists for that task\n- [ ] Space+P on task with existing PR opens browser to PR page\n- [ ] Space+P on task without PR creates new PR (unchanged behavior)\n- [ ] PR state updates on board refresh (not stale)","acceptance_criteria":"- [x] TaskCard shows üîó when PR exists for that task\n- [x] Space+P on task with existing PR opens browser to PR page  \n- [x] Space+P on task without PR creates new PR (unchanged behavior)\n- [x] PR state updates on board refresh (cached per-task, refreshes when session list changes)","notes":"Implementation complete. Key files changed:\n- `src/ui/types.ts` - Added PRInfo type and prInfo field to TaskWithSession\n- `src/services/BoardService.ts` - Added PR cache and fetching in loadTasks()\n- `src/ui/TaskCard.tsx` - Shows üîó indicator in header line\n- `src/services/keyboard/PRHandlersService.ts` - Space+P checks for existing PR, opens browser if found\n- `docs/keybindings.md` - Updated documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:26:58.402898+11:00","updated_at":"2025-12-19T01:29:12.259646+11:00","closed_at":"2025-12-19T01:29:12.259649+11:00","close_reason":"Feature implemented and committed. Task cards now show üîó indicator when PR exists, and Space+P opens existing PR in browser."}
{"id":"az-dl1","title":"Add detail level toggle for cards","description":"Add toggle to switch between minimal/standard/detailed card views.\n\nInspiration: AutoMaker's three-level detail toggle.\n\nLevels:\n- Minimal: ID + title only (fits more tasks on screen)\n- Standard: Current view (ID, title, priority, status indicator)\n- Detailed: Add description preview, session metrics, context health\n\nImplementation:\n1. Add detailLevel to ViewService (minimal/standard/detailed)\n2. Add 'd' key to cycle through levels\n3. Adjust TaskCard rendering based on level\n4. Persist preference in config","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:02Z","updated_at":"2025-12-16T12:00:02Z"}
{"id":"az-dn2","title":"we keep losing beads in the tui when doing stuff like killing other bead's sessions etc","description":"the following log may be related:\ntimestamp=2025-12-16T13:19:15.063Z level=WARN fiber=#1356 message=\"Sync failed for az-31i: ParseError: Failed to parse JSON: SyntaxError: JSON Parse error: Unrecognized token '‚Üí'\"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:04.341522+11:00","updated_at":"2025-12-17T01:02:07.434596+11:00","closed_at":"2025-12-17T01:02:07.4346+11:00"}
{"id":"az-dp47","title":"Add epic drill-down to DetailPanel","description":"When DetailPanel displays an epic, show its children:\n\n1. Add atom to fetch children when detail overlay opens on an epic\n2. Display children section in DetailPanel:\n   - Header: \"Children (N):\"\n   - List: id, title, status, session indicator\n   - Hint: \"Press 'o' to orchestrate parallel workers\"\n3. Style: status-based colors, session indicators for active sessions\n\nThis is the prerequisite for orchestration mode - users need to see children before they can orchestrate them.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:02.932675+11:00","updated_at":"2025-12-19T10:34:43.283757+11:00","closed_at":"2025-12-19T10:34:43.283757+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-dp47","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:22.744482+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dp47","depends_on_id":"az-ccvg","type":"blocks","created_at":"2025-12-19T01:43:48.344657+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-dpi","title":"Integrate Agent Mail with SessionManager","description":"Wire Agent Mail into session lifecycle for automatic reservation management.\n\nDesign:\n- SessionManager.start() calls agentMail.reserve() before worktree creation\n- SessionManager.stop() calls agentMail.release() after cleanup\n- SessionManager.pause() keeps reservation but updates status\n- Add reservation info to Session type\n- Fail session start if issue already reserved by another agent\n- Handle reservation conflicts gracefully\n- Update Kanban board to show reservation status (who owns what)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.738474+11:00","updated_at":"2025-12-12T10:33:13.738474+11:00","dependencies":[{"issue_id":"az-dpi","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.870895+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dpi","depends_on_id":"az-4r0","type":"blocks","created_at":"2025-12-12T10:33:21.939099+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dpi","depends_on_id":"az-tgc","type":"blocks","created_at":"2025-12-12T10:33:21.972727+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-dqt","title":"Extend TaskWithSession type with session metrics","description":"Extend TaskWithSession interface with optional session metrics: contextPercent (0-100), sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput. This is the foundation for other session metrics features.","notes":"Session 2025-12-12: Created from Claude Code best practices research.\n\nRESEARCH CONTEXT:\n- 6 parallel research agents analyzed: Anthropic blog, Reddit, latest features, orchestration tools, CLAUDE.md patterns, real-world usage\n- Key finding: Context % monitoring is critical - users hit auto-compact (95%) unexpectedly\n- Key finding: MCP servers consume 55K-134K tokens before conversation starts\n- Design: Use progressive disclosure - border colors for at-a-glance, DetailPanel for full metrics\n\nUI DESIGN DECISIONS:\n- Border color encodes context health: lavender (\u003c70%), yellow (70-90%), red (\u003e90%)\n- Only show metrics when session is active (not idle)\n- Extend existing TaskWithSession type (no new components needed)\n\nIMPLEMENTATION NOTES:\n- Add: contextPercent, sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput\n- All fields optional (populated when session active)\n- This is foundation - unblocks az-6la, az-5p5, az-2ek, az-c9y\n\nNEXT STEP: Implement type changes in src/ui/types.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T13:25:00.109541+11:00","updated_at":"2025-12-14T00:37:36.658207+11:00","closed_at":"2025-12-13T00:58:21.053672+11:00"}
{"id":"az-dv9t","title":"read hook error","description":"Claude Code hooks call `az notify` but the `az` command isn't in /bin/sh's PATH. Error: \"Stop hook error: Failed with non-blocking status code: /bin/sh: az: command not found\". Need to use absolute path in generated hook config.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:05:15.520227+11:00","updated_at":"2025-12-20T01:46:58.532728+11:00","close_reason":"Fixed: Hook commands now use absolute path `bun run \"/abs/path/to/bin/az.ts\"` instead of `az`","comments":[{"id":9,"issue_id":"az-dv9t","author":"riordan","text":"May have misunderstood the issue - need to clarify if it's about hook failures","created_at":"2025-12-18T03:15:15Z"}],"deleted_at":"2025-12-20T01:46:58.532728+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-dvsr","title":"Dev server integration (Space+r)","description":"Add ability to spawn and manage dev servers from Azedarach.\n\n**Inspiration:** Vibe Kanban lets users launch dev servers and monitor them.\n\n**Features:**\n- Space+r in action mode to start dev server\n- Spawn in dedicated tmux pane (not session pane)\n- Parse port from output, show URL in status bar\n- Toggle to kill server\n- Auto-cleanup on exit\n\n**Command Detection (priority order):**\n1. Config override: `devServer.command` if set\n2. package.json scripts: check for `dev`, `start`, `serve`\n3. Lock file detection:\n   - bun.lockb ‚Üí `bun run dev`\n   - pnpm-lock.yaml ‚Üí `pnpm run dev`\n   - yarn.lock ‚Üí `yarn dev`\n   - package-lock.json ‚Üí `npm run dev`\n4. Fallback: `npm run dev`\n\n**Config (azedarach.json):**\n```json\n{\n  \"devServer\": {\n    \"command\": \"bun run dev:local\",\n    \"portPattern\": \"localhost:(\\\\d+)\",\n    \"cwd\": \".\"\n  }\n}\n```\n\n**Implementation:**\n- Add DevServerService to manage lifecycle\n- StatusBar shows: localhost:3000 when running\n- Space+r toggles: start if stopped, stop if running\n\n**UI:**\n- ActionPalette: \"dev server\" action\n- StatusBar: port indicator when running\n- Toast on start/stop","design":"## Revised Implementation Plan (2025-12-19)\n\n### Key Design Changes from Original\n\n1. **Worktree-scoped, not project-scoped**: Each worktree gets its own dev server with port injection\n2. **Multi-port support**: Can inject multiple env vars (PORT, VITE_PORT, VITE_SERVER_PORT, etc.)\n3. **Keybinding**: `Space+r` for dev server, `Space+R` (shifted) for resume session\n4. **tmux sessions** (not windows): Consistent with Claude/VC pattern\n\n### Architecture Overview\n\nDevServerService manages per-worktree dev server lifecycles via tmux sessions.\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DevServerService (Effect.Service)            ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ State (SubscriptionRef):                                        ‚îÇ\n‚îÇ   - servers: Map\u003cbeadId, DevServerState\u003e                        ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îÇ DevServerState:                                                 ‚îÇ\n‚îÇ   - status: \"idle\" | \"starting\" | \"running\" | \"error\"           ‚îÇ\n‚îÇ   - port: number | undefined (primary port for display)         ‚îÇ\n‚îÇ   - tmuxSession: string | undefined                             ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îÇ Methods:                                                        ‚îÇ\n‚îÇ   - toggle(beadId): start if idle, stop if running              ‚îÇ\n‚îÇ   - start(beadId, worktreePath): spawn server, poll for port    ‚îÇ\n‚îÇ   - stop(beadId): kill tmux session, update state               ‚îÇ\n‚îÇ   - getStatus(beadId): get current state                        ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Port Allocation Strategy\n\n```\naz-123 ‚Üí basePort 3001 ‚Üí PORT=3001, VITE_PORT=3001, VITE_SERVER_PORT=4001\naz-456 ‚Üí basePort 3002 ‚Üí PORT=3002, VITE_PORT=3002, VITE_SERVER_PORT=4002\naz-789 ‚Üí basePort 3003 ‚Üí PORT=3003, VITE_PORT=3003, VITE_SERVER_PORT=4003\n```\n\n- Base port starts at 3001 (reserve 3000 for main project)\n- Each worktree gets next available base port\n- Additional ports use offsets (e.g., server port = base + 1000)\n\n### Config Schema\n\n```typescript\nconst DevServerConfigSchema = Schema.Struct({\n  command: Schema.optional(Schema.String),           // Override command\n  ports: Schema.optional(Schema.Record({             // Env var ‚Üí port offset\n    key: Schema.String, \n    value: Schema.Number \n  })),\n  basePort: Schema.optional(Schema.Number),          // Starting port (default: 3001)\n  portPattern: Schema.optional(Schema.String),       // Regex for port extraction\n  cwd: Schema.optional(Schema.String),               // Working directory\n})\n\n// Example config for full-stack app:\n{\n  \"devServer\": {\n    \"command\": \"bun run dev\",\n    \"ports\": {\n      \"PORT\": 0,\n      \"VITE_PORT\": 0,\n      \"VITE_SERVER_PORT\": 1000\n    }\n  }\n}\n```\n\n### Default Behavior (no config)\n\n```typescript\nconst DEFAULTS = {\n  ports: { PORT: 0 },           // Just inject PORT\n  basePort: 3001,\n  portPattern: \"localhost:(\\\\d+)|127\\\\.0\\\\.0\\\\.1:(\\\\d+)\"\n}\n```\n\n### Keybinding Changes\n\n| Key | Mode | Action |\n|-----|------|--------|\n| `Space+r` | action | Toggle dev server (start/stop) for worktree |\n| `Space+R` | action | Resume paused session (moved from `r`) |\n\n### tmux Session Naming\n\nFormat: `az-dev-{beadId}` (e.g., `az-dev-az-123`)\n\n### StatusBar Integration\n\nWhen a bead with running dev server is selected:\n```\nDEV: localhost:3001\n```\n\nWhen starting:\n```\nDEV: starting...\n```\n\n### File Changes\n\n1. **`src/config/schema.ts`** - Add DevServerConfigSchema\n2. **`src/services/DevServerService.ts`** - NEW FILE\n3. **`src/services/keyboard/bindings.ts`** - `r`‚Üídev server, `S-r`‚Üíresume\n4. **`src/ui/atoms/runtime.ts`** - Add DevServerService.Default\n5. **`src/ui/atoms/devServer.ts`** - NEW FILE\n6. **`src/ui/StatusBar.tsx`** - Add dev server indicator\n7. **`src/ui/App.tsx`** - Wire up devServerStatusAtom\n\n### Error Handling\n\n- No worktree exists ‚Üí Toast error \"Start a session first\"\n- Command fails ‚Üí Toast error, set status to \"error\"\n- Port detection timeout ‚Üí Keep \"running\" without port display","acceptance_criteria":"### Acceptance Criteria\n\n**Functional:**\n- [ ] Space+\u003ckey\u003e in action mode toggles dev server for current project\n- [ ] Dev server runs in dedicated tmux window (not pane)\n- [ ] Window is named `az-dev-\u003cprojectName\u003e` for easy identification\n- [ ] Port is detected from output within 30 seconds\n- [ ] StatusBar shows \"DEV: localhost:3000\" when running with detected port\n- [ ] StatusBar shows \"DEV: starting...\" during startup\n- [ ] Pressing toggle again stops the server (kills tmux window)\n- [ ] Toast notification on start/stop/error\n- [ ] Multiple projects can have independent dev servers\n\n**Command Detection:**\n- [ ] Respects `devServer.command` in azedarach.json config\n- [ ] Falls back to package.json scripts (dev ‚Üí start ‚Üí serve)\n- [ ] Detects package manager from lock files\n- [ ] Uses npm as final fallback\n\n**Configuration:**\n- [ ] `devServer.command` overrides auto-detection\n- [ ] `devServer.portPattern` allows custom regex\n- [ ] `devServer.cwd` allows custom working directory\n\n**Cleanup:**\n- [ ] Dev server windows killed on Azedarach exit\n- [ ] State properly tracked if user closes window manually\n\n**Edge Cases:**\n- [ ] Works when no package.json exists (graceful error)\n- [ ] Handles port detection timeout (stays \"running\" without port)\n- [ ] Handles immediate server crash (shows error state)","notes":"PR: ","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T16:00:00+11:00","updated_at":"2025-12-19T19:24:18.771405+11:00","closed_at":"2025-12-19T19:24:18.771407+11:00","comments":[{"id":13,"issue_id":"az-dvsr","author":"riordan","text":"Feature was designed but never implemented - no DevServerService exists in codebase","created_at":"2025-12-19T00:48:53Z"}]}
{"id":"az-e0w","title":"board doesn't seem to update when i change sort mode","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T16:48:52.461805+11:00","updated_at":"2025-12-20T01:47:02.922437+11:00","deleted_at":"2025-12-20T01:47:02.922437+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-e3k","title":"do a full report on all the beads flows az uses","description":"i want to know all the ways our app connects with beads/uses the beads cli","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:14:03.324845+11:00","updated_at":"2025-12-18T10:46:02.515969+11:00","closed_at":"2025-12-18T10:19:39.166353+11:00","close_reason":"Completed full report documenting all 11 bd CLI commands, 17 integration files, and 3 architectural layers (BeadsClient facade, Effect services, UI handlers)","deleted_at":"2025-12-18T10:46:02.515969+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ee4","title":"Configuration \u0026 Polish","description":"User configuration (cosmiconfig + zod), multi-project support, help system, and final polish.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:05.070257+11:00","updated_at":"2025-12-11T14:44:05.070257+11:00"}
{"id":"az-eei","title":"creating beads with space C (capital) not working","description":"i dont see any errors in log either","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:12.469026+11:00","updated_at":"2025-12-17T01:07:50.693525+11:00","closed_at":"2025-12-17T01:07:50.693525+11:00"}
{"id":"az-eh8i","title":"help me figure out what the point of effect atom is","description":"i appreciate some of the features but i cant help but feel i should be doing all the state and state derivation in the effect services layers\nwhat are the use cases where we should do one vs the other?","design":"## Analysis Complete\n\nAfter reviewing the codebase architecture, effect-atom library, and Effect SubscriptionRef docs, here's a comprehensive answer to \"when should state/derivation be in Effect services vs effect-atom atoms?\"\n\n### TL;DR Decision Matrix\n\n| Use Case | Where | Why |\n|----------|-------|-----|\n| Core domain state | Effect Services | Testable, lifecycle-managed, business logic lives here |\n| Polling/background tasks | Effect Services | Scoped fibers, automatic cleanup |\n| React-specific derived state | Atoms (`Atom.readable`) | Parameterized derivation, cross-service composition |\n| Bridge to React | `appRuntime.subscriptionRef()` | Converts SubscriptionRef ‚Üí useAtomValue-compatible |\n| Actions (mutations) | `appRuntime.fn()` | Provides services, lifecycle, error handling |\n\n### effect-atom's Core Value Proposition\n\neffect-atom is NOT a replacement for Effect services - it's specifically a **React integration layer** that:\n\n1. **Provides a Scope for Effect execution** - `appRuntime.atom()` runs Effects with automatic cleanup when React unmounts\n2. **Bridges SubscriptionRef ‚Üí React reactivity** - `appRuntime.subscriptionRef()` subscribes to changes and triggers re-renders\n3. **Parameterized derivations** - `elapsedFormattedAtom(startedAt)` creates per-instance computation unavailable in services\n4. **Cross-service composition** - Atoms can combine data from multiple services without coupling those services\n\n### What effect-atom Does NOT Do\n\n- Doesn't manage fiber lifecycles (that's Effect + scoped services)\n- Doesn't replace SubscriptionRef for state storage (services own state)\n- Doesn't provide business logic home (that's services)\n\n### Current Architecture Is Correct\n\n```\nEffect Services (SubscriptionRef state + business logic)\n       ‚Üì subscriptionRef() bridge\neffect-atom Atoms (derivation + React integration)\n       ‚Üì useAtomValue()\nReact Components (pure render)\n```\n\n### Concrete Examples From Codebase\n\n**‚úÖ Correct: Service owns state, atom bridges to React**\n```typescript\n// Service\nexport class ClockService extends Effect.Service\u003cClockService\u003e()(...) {\n  scoped: Effect.gen(function* () {\n    const now = yield* SubscriptionRef.make\u003cDateTime.Utc\u003e(initial)\n    yield* Effect.scheduleForked(Schedule.spaced(\"1 second\"))(...)\n    return { now }\n  })\n}\n\n// Atom (bridge)\nexport const clockTickAtom = appRuntime.subscriptionRef(\n  Effect.gen(function* () {\n    const clock = yield* ClockService\n    return clock.now  // Returns the SubscriptionRef\n  })\n)\n\n// Atom (parameterized derivation)\nexport const elapsedFormattedAtom = (startedAt: string) =\u003e\n  Atom.readable((get) =\u003e {\n    const nowResult = get(clockTickAtom)\n    if (!Result.isSuccess(nowResult)) return \"00:00\"\n    return computeElapsedFormatted(startedAt, nowResult.value)\n  })\n```\n\n**Why `elapsedFormattedAtom` can't live in the service:**\n- It's parameterized by `startedAt` (different per component instance)\n- It depends on ClockService state but computation is per-consumer\n- This is the sweet spot for atoms: per-consumer derivation\n\n**‚úÖ Correct: Multi-service composition in atom**\n```typescript\nexport const focusedTaskRunningOperationAtom = Atom.readable((get) =\u003e {\n  const focusedIdResult = get(focusedTaskIdAtom)     // NavigationService\n  const stateResult = get(commandQueueStateAtom)     // CommandQueueService\n  // Compose without coupling services\n})\n```\n\n### When You COULD Move Derivation to Services\n\nFor derivations that:\n1. Are NOT parameterized (same for all consumers)\n2. Don't compose across services\n3. Are part of business logic (not presentation)\n\nExample: `filteredTasksByColumn` is computed in BoardService because it's:\n- Not parameterized\n- Core to the board model\n- Used by multiple atoms\n\n### Acceptance Criteria\n\n- [x] Document when to use services vs atoms\n- [x] Explain effect-atom's actual purpose (React integration, not state management)\n- [x] Show parameterized derivation as key atom use case\n- [x] Confirm current architecture is sound","notes":"Completed research task. The architecture is correct - effect-atom serves as a React integration layer, not a replacement for Effect services. Key insight: atoms excel at parameterized derivations and cross-service composition for UI needs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:21:15.448445+11:00","updated_at":"2025-12-18T23:53:11.436437+11:00","closed_at":"2025-12-18T23:53:11.436442+11:00","close_reason":"Documented effect-atom architecture decision. Created internal-docs/effect-atom-architecture.md with full analysis. Updated CLAUDE.md with critical rule #9 and decision matrix in State Management section."}
{"id":"az-eiwd","title":"add offline mode which disables stuff like PR creation, git push/pull etc without breaking the app","description":"Add offline mode that allows Azedarach to work without network connectivity. This is useful for:\n- Working on planes/trains without internet\n- Local-only development workflows  \n- Avoiding accidental pushes during experimentation\n\nThe feature uses granular controls so users can disable specific network operations independently.","design":"## Implementation Design\n\n### 1. Config Schema Changes (`src/config/schema.ts`)\n\nAdd granular offline controls to existing config sections:\n\n```typescript\n// GitConfigSchema additions\ngitPush: Schema.optional(Schema.Boolean),    // Enable/disable git push (default: true)\ngitFetch: Schema.optional(Schema.Boolean),   // Enable/disable git fetch/pull (default: true)\n\n// PRConfigSchema additions  \nenabled: Schema.optional(Schema.Boolean),    // Enable/disable PR creation entirely (default: true)\n\n// New BeadsSyncConfigSchema\nbeads: Schema.optional(Schema.Struct({\n  syncEnabled: Schema.optional(Schema.Boolean),  // Enable bd sync (default: true)\n}))\n\n// Network config\nnetwork: Schema.optional(Schema.Struct({\n  autoDetect: Schema.optional(Schema.Boolean),    // Auto-detect network status (default: true)\n  checkInterval: Schema.optional(Schema.Number),  // Check interval in seconds (default: 30)\n  checkHost: Schema.optional(Schema.String),      // Host to ping (default: \"github.com\")\n}))\n```\n\n### 2. NetworkService (NEW - `src/services/NetworkService.ts`)\n\nNew service to monitor network connectivity:\n\n```typescript\nexport class NetworkService extends Effect.Service\u003cNetworkService\u003e()(\"NetworkService\", {\n  scoped: Effect.gen(function* () {\n    const isOnline = yield* SubscriptionRef.make(true)\n    \n    // Poll network status every N seconds\n    yield* Effect.scheduleForked(Schedule.spaced(checkInterval))(\n      checkConnectivity.pipe(\n        Effect.flatMap(status =\u003e SubscriptionRef.set(isOnline, status))\n      )\n    )\n    \n    return { isOnline }\n  })\n}) {}\n\n// Check connectivity via DNS lookup or HTTP HEAD to github.com\nconst checkConnectivity = Effect.tryPromise(() =\u003e \n  fetch(\"https://github.com\", { method: \"HEAD\", signal: AbortSignal.timeout(5000) })\n).pipe(Effect.map(() =\u003e true), Effect.orElse(() =\u003e Effect.succeed(false)))\n```\n\n### 3. ConfigService Enhancement (`src/services/ConfigService.ts`)\n\nAdd helper methods that combine config + network status:\n\n```typescript\nisGitPushEnabled(): Effect\u003cboolean\u003e   // config.git.gitPush \u0026\u0026 networkService.isOnline\nisGitFetchEnabled(): Effect\u003cboolean\u003e  \nisPREnabled(): Effect\u003cboolean\u003e\nisBeadsSyncEnabled(): Effect\u003cboolean\u003e\n```\n\n### 4. Network Operation Guards\n\n**PRWorkflow.ts:**\n- `createPR()`: Check `isPREnabled()`, return `Option.none()` if disabled\n- `pushBranch()`: Check `isGitPushEnabled()`, skip silently if disabled\n- Push to main after merge: Check `isGitPushEnabled()`\n\n**BeadsClient.ts:**\n- `sync()`: Check `isBeadsSyncEnabled()`, return `{ pushed: 0, pulled: 0 }` if disabled\n\n**WorktreeManager.ts:**\n- Already respects `git.pushBranchOnCreate`, will also check new `git.gitPush`\n\n### 5. UI Changes\n\n**Action Menu (Space menu):**\n- PR action shows \"Create PR (disabled - offline)\" when `pr.enabled: false` OR network is down\n- Selecting it shows brief message, doesn't execute\n\n**Status Bar (optional):**\n- Could show network indicator icon when offline (üì¥ or similar)\n\n### 6. Example Config\n\n```json\n{\n  \"git\": {\n    \"gitPush\": false,\n    \"gitFetch\": true,\n    \"pushBranchOnCreate\": false\n  },\n  \"pr\": {\n    \"enabled\": false\n  },\n  \"beads\": {\n    \"syncEnabled\": false\n  },\n  \"network\": {\n    \"autoDetect\": true,\n    \"checkInterval\": 30,\n    \"checkHost\": \"github.com\"\n  }\n}\n```\n\n### Key Decisions\n- **Granular over global**: Users can disable just PR but keep beads sync\n- **Auto-detect network**: Polls github.com to detect connectivity\n- **Config overrides network**: If user sets `git.gitPush: false`, stays disabled even when online\n- **Silent skip**: Network ops just don't execute, no noise\n- **Action menu feedback**: User gets clear message when trying disabled action\n- **Backward compatible**: All new fields optional, default to enabled + auto-detect","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] `git.gitPush: false` prevents all git push operations\n- [ ] `git.gitFetch: false` prevents git fetch/pull operations  \n- [ ] `pr.enabled: false` disables PR creation\n- [ ] `beads.syncEnabled: false` disables bd sync network calls\n- [ ] Disabled actions in Space menu show \"(disabled - offline)\" suffix\n- [ ] Attempting disabled action shows informative message\n- [ ] All network operations fail gracefully (no crashes)\n- [ ] Default behavior unchanged (all enabled by default)\n- [ ] Type-check passes\n- [ ] App builds successfully","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:09:15.972805+11:00","updated_at":"2025-12-19T15:37:31.728617+11:00","closed_at":"2025-12-19T15:37:31.72862+11:00"}
{"id":"az-ek3m","title":"Add orchestrate mode keybindings","description":"In bindings.ts:\n\n1. Add \"orchestrate\" to KeyMode type in types.ts\n2. Add 'o' binding in detail overlay mode:\n   ```typescript\n   { key: \"o\", mode: \"detail\", description: \"Orchestrate\", action: orchestrateHandlers.enterFromDetail() }\n   ```\n3. Add orchestrate mode bindings:\n   - j/down: moveDown\n   - k/up: moveUp\n   - space: toggle\n   - return: confirmSpawn\n   - a: selectAll\n   - n: selectNone\n   - escape: exitOrchestrate\n\n4. Update getEffectiveMode() in InputHandlersService to return \"orchestrate\" for orchestrate mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:04.569139+11:00","updated_at":"2025-12-19T10:34:43.30364+11:00","closed_at":"2025-12-19T10:34:43.30364+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-ek3m","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:24.646113+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-ek3m","depends_on_id":"az-o72x","type":"blocks","created_at":"2025-12-19T01:43:50.107381+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-esy","title":"Implement inline attachment mode in AttachmentService","description":"src/core/AttachmentService.ts line 204 has TODO for inline attachment.\n\nCurrently only external tmux attachment works. Inline mode should:\n- Capture session output in current terminal\n- Overlay UI on top of session stream\n- Allow quick interactions without leaving TUI","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.670743+11:00","updated_at":"2025-12-17T15:59:44.670743+11:00"}
{"id":"az-et1","title":"Add elapsed timer to TaskCard","description":"Display MM:SS elapsed timer on TaskCards when session is active (busy/waiting state).\n\nInspiration: AutoMaker's CountUpTimer component.\n\nImplementation:\n1. Already have session startedAt timestamp in session metrics\n2. Add timer display component that updates every second\n3. Show on card when session state is busy or waiting\n4. Format as MM:SS (pad with zeros)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:01Z","updated_at":"2025-12-17T14:09:14.159624+11:00","closed_at":"2025-12-17T14:09:14.159624+11:00"}
{"id":"az-f1j7","title":"Create OrchestrationOverlay component","description":"New component: src/ui/OrchestrationOverlay.tsx\n\nProps: epicTitle, children, selectedIds, focusIndex\n\nUI:\n- Header with epic title\n- Task list with selection markers ([x]/[ ]/---)\n- Status column (OPEN/IN_PROGRESS/BLOCKED)\n- Focus highlight\n- Footer: \"Selected: X/Y spawnable\"\n- Keybinding hints: Enter:Spawn Space:Toggle Esc:Back\n\nStyling:\n- Spawnable tasks: normal color\n- Non-spawnable: grayed/dimmed\n- Selected: checkbox [x]\n- Focused: highlight bg","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:05.131601+11:00","updated_at":"2025-12-19T10:34:31.83202+11:00","closed_at":"2025-12-19T10:34:31.83202+11:00","close_reason":"Created OrchestrationOverlay.tsx component with task list, selection indicators, focus highlighting, and keyboard hint footer","dependencies":[{"issue_id":"az-f1j7","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:25.230451+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-f1j7","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:51.329879+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T02:15:58.658485+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-f3iw","title":"sometimes action menu command gets sent to wrong bead/worktree","description":"i just pressed space d and then y to confirm cleanup on a bead and then immediately moved my cursor and the fuckin newly cursor selected bead is the one that was cleaned up!","design":"## Root Cause Analysis\n\n**The Problem**: When user opens action menu (`Space`) and triggers cleanup (`d` + `y`), the wrong bead could get cleaned up if cursor moved between keypresses.\n\n**Investigation Findings**: Task ID was captured when action key (`d`) was pressed, not when action mode was entered (`Space`). This allowed a window where cursor could move, causing the wrong task to be targeted.\n\n## Implementation\n\n### Fix: Capture Task ID at Action Mode Entry\n\nChanged the action mode to capture the target task ID when Space is pressed:\n\n1. **EditorMode Type** (`EditorService.ts:123`):\n   ```typescript\n   | { readonly _tag: \"action\"; readonly targetTaskId: string | null }\n   ```\n\n2. **enterAction** captures task ID:\n   ```typescript\n   enterAction: (targetTaskId: string | null) =\u003e\n     SubscriptionRef.set(mode, { _tag: \"action\", targetTaskId })\n   ```\n\n3. **Space binding** gets task ID first (`bindings.ts:159-162`):\n   ```typescript\n   action: Effect.gen(function* () {\n     const taskId = yield* bc.nav.getFocusedTaskId()\n     yield* bc.editor.enterAction(taskId)\n   })\n   ```\n\n4. **New helper** `getActionTargetTask()` in KeyboardHelpersService:\n   - Returns task from captured `targetTaskId` if in action mode\n   - Falls back to current cursor for non-action-mode usage\n\n5. **Updated all action handlers** to use `getActionTargetTask()` instead of `getSelectedTask()`:\n   - PRHandlersService (cleanup, merge, PR, update from base, show diff)\n   - SessionHandlersService (start, stop, attach, pause, resume)\n   - TaskHandlersService (edit, delete, move)\n   - DevServerHandlersService (toggle, restart, attach)\n   - bindings.ts (image attach)\n\n### Diagnostic Logging\n\nAdded Effect.log calls at key points (can be removed later):\n- `[cleanup:capture]` - Task ID captured when d is pressed\n- `[cleanup:confirm]` - Confirm dialog shown\n- `[cleanup:execute]` - Cleanup actually runs\n- `[confirm:key]` - Keys received while confirm is open\n\nLogs go to `az.log` file.","acceptance_criteria":"- [x] Identify root cause: task ID captured at wrong time (action key vs mode entry)\n- [x] Add diagnostic logging to doCleanup to capture task ID at execution time\n- [x] Implement fix: capture task ID when entering action mode (Space press)\n- [ ] Test: Space+d on task A, try to press j/k, confirm - should act on task A\n- [ ] Verify no regression in normal action menu flow","notes":"Implementation complete. Needs manual testing to verify:\n1. Normal flow works (Space+action+confirm)\n2. Rapid keypresses still target correct bead\n3. Moving cursor after action key but before confirm still targets original bead","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:58:31.886682+11:00","updated_at":"2025-12-21T03:37:41.263126+11:00","closed_at":"2025-12-21T03:37:41.26313+11:00"}
{"id":"az-f4q","title":"Add auto-pilot toggle keybinding (a)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T01:05:15.523081+11:00","updated_at":"2025-12-14T01:06:38.936838+11:00","closed_at":"2025-12-14T01:06:38.936838+11:00"}
{"id":"az-fei","title":"when i search and press enter on a search result i expect to put cursor on that item in normal mode","description":"it should be scrolled into view too","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:16:12.214738+11:00","updated_at":"2025-12-18T13:18:42.942189+11:00","closed_at":"2025-12-18T13:18:42.942191+11:00","close_reason":"Added mode change watcher to NavigationService that calls ensureValidFocus() when the search query changes. This keeps focusedTaskId in sync with the filtered view, so when Enter is pressed in search mode, the cursor stays on the visible task.","deleted_at":"2025-12-18T12:25:51.509771+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-fjy","title":"add a git push keybind","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:59:10.618121+11:00","updated_at":"2025-12-17T10:32:36.837731+11:00","closed_at":"2025-12-17T10:32:36.837731+11:00"}
{"id":"az-fn1","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:19:56.843403+11:00","updated_at":"2025-12-17T00:20:45.047717+11:00"}
{"id":"az-foy","title":"Update docs from Ink to OpenTUI + React","description":"","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-12T17:16:24.188255+11:00","updated_at":"2025-12-12T17:16:32.49283+11:00","closed_at":"2025-12-12T17:16:32.49283+11:00"}
{"id":"az-fvj","title":"BeadsClient - wrapper around bd CLI","description":"Create a TypeScript wrapper around the bd CLI for reading and updating beads issues.","design":"- Define BeadsClient as Effect Service using Effect.Service\n- Use @effect/platform Command for shelling out to bd\n- Methods return Effect with typed errors:\n  - list(): Effect\u003cIssue[], BeadsError\u003e\n  - show(id): Effect\u003cIssue, BeadsError | NotFoundError\u003e\n  - update(id, fields): Effect\u003cvoid, BeadsError\u003e\n  - close(id): Effect\u003cvoid, BeadsError\u003e\n  - sync(): Effect\u003cSyncResult, BeadsError\u003e\n- Use @effect/schema for parsing bd --json output\n- Support running in different worktrees via workingDirectory option\n- Create BeadsClientLive layer with real implementation\n- Create BeadsClientTest layer for testing","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full Effect service wrapping bd CLI\n- Schema validation for Issue type\n- All major bd commands wrapped with typed errors\n\nFILES CREATED:\n- src/core/BeadsClient.ts (447 lines) - Complete service\n- src/core/BeadsClient.example.ts (152 lines) - 8 usage examples\n\nSERVICE METHODS:\n- list(filters?) - List issues with status/priority/type filters\n- show(id) - Get single issue details\n- update(id, fields) - Update status/notes/priority\n- close(id, reason?) - Close issue\n- sync() - Push/pull beads database\n- ready() - Get unblocked issues\n- search(query) - Search issues\n\nERROR TYPES:\n- BeadsError - Generic bd command failures\n- NotFoundError - Issue not found\n- ParseError - JSON/Schema validation errors\n\nLAYERS:\n- BeadsClientLive - Service only (needs BunContext)\n- BeadsClientLiveWithPlatform - Complete with platform deps (recommended)\n\nVERIFICATION:\n- Type check passes\n- Runtime test fetched 10 ready issues from actual beads database","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.409567+11:00","updated_at":"2025-12-11T17:27:44.655776+11:00","closed_at":"2025-12-11T17:25:14.06403+11:00","dependencies":[{"issue_id":"az-fvj","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.006035+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-fvj","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.575251+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-g19","title":"Terminal attachment (external and inline)","description":"Implement session attachment for manual intervention.","design":"- External (a): detect terminal emulator, open new window/tab with tmux attach\n- Ghostty: ghostty -e tmux attach-session -t \u003cid\u003e\n- iTerm: osascript to open new tab\n- Inline (A): replace TUI with session output, handle detach to return\n- Track which sessions user has attached to","notes":"Implementation complete:\n\n1. Created AttachmentService (src/core/AttachmentService.ts):\n   - External attachment via attachExternal() - opens new terminal window/tab\n   - Inline attachment stub via attachInline() - reserved for future implementation\n   - Terminal type detection (Ghostty, iTerm, Terminal.app)\n   - Attachment history tracking\n   - Proper Effect error handling with AttachmentError and SessionNotFoundError\n\n2. Updated atoms.ts:\n   - Added AttachmentService to runtime layer (appLayer)\n   - Created attachExternalEffect() and attachInlineEffect() helper functions\n   - Properly composed layers with dependencies (AttachmentService depends on TmuxService and TerminalService)\n\n3. Integrated with App.tsx keyboard handling:\n   - Added 'a' key in action mode (Space + a) for external attachment\n   - Added 'A' key in action mode (Space + A) for inline attachment (shows error for now)\n   - Session ID is constructed as 'claude-{task.id}'\n   - Error handling with console.error fallback\n\nTechnical details:\n- AttachmentService uses TmuxService for session validation and attach command generation\n- TerminalService provides terminal detection and command execution\n- External attachment opens new terminal with 'tmux attach-session -t {sessionId}'\n- Inline attachment is stubbed - future implementation will require suspending TUI renderer\n- All code passes type-check with strict TypeScript mode\n- No 'as' casts or 'any' types used\n\nUsage:\n1. Navigate to a task with hjkl\n2. Press Space to enter action mode\n3. Press 'a' to attach externally in new terminal window\n4. Press 'A' to attempt inline (will show error message)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:08.219579+11:00","updated_at":"2025-12-12T10:32:33.851115+11:00","closed_at":"2025-12-12T10:32:33.851115+11:00","dependencies":[{"issue_id":"az-g19","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.313043+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-g5nf","title":"when resolving merge conflicts show a different color of session dot","description":"or a different icon entirely","design":"## Implementation Plan\n\n**Goal**: Show a distinct conflict indicator when a worktree is in an active merge conflict state.\n\n### Approach\n- Track `hasMergeConflict` as a separate boolean flag (not a SessionState)\n- Detect via presence of MERGE_HEAD in worktree's git directory\n- Display as combination: session indicator + conflict badge (e.g., \"üîµ ‚öîÔ∏è\")\n\n### Changes Required\n\n1. **src/ui/types.ts**\n   - Add `hasMergeConflict?: boolean` to `TaskWithSession` interface\n   - Add `CONFLICT_INDICATOR` constant (e.g., \"‚öîÔ∏è\" or \"üîÄ\")\n\n2. **src/services/BoardService.ts** (or new service)\n   - Add merge conflict detection during board refresh\n   - Check for `.git/MERGE_HEAD` in each active worktree\n   - For worktrees: `\u003cworktree\u003e/.git` is a file pointing to real git dir\n\n3. **src/ui/TaskCard.tsx**\n   - Display conflict indicator after session indicator when `hasMergeConflict` is true\n   - e.g., \"az-123 [task] üîµ ‚öîÔ∏è\" (busy + has conflict)\n\n### Detection Logic\n```bash\n# In worktree, .git is a file containing \"gitdir: /path/to/real/git\"\n# Check: \u003cworktree\u003e/.git/MERGE_HEAD exists\ngit -C \u003cworktree\u003e rev-parse MERGE_HEAD 2\u003e/dev/null \u0026\u0026 echo \"conflict\"\n```\n\n### Visual Design\n- Conflict indicator: ‚öîÔ∏è (crossed swords - signals conflict)\n- Shown AFTER session indicator to maintain session visibility\n- Only shown when worktree has active merge state","acceptance_criteria":"- [ ] Tasks with active merge conflicts show ‚öîÔ∏è indicator\n- [ ] Indicator appears alongside (not replacing) session state indicator\n- [ ] Conflict state is detected by checking MERGE_HEAD in worktree\n- [ ] Indicator disappears when merge is completed or aborted\n- [ ] Works correctly for worktrees (not just main repo)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:17:16.58094+11:00","updated_at":"2025-12-19T15:31:19.187727+11:00","closed_at":"2025-12-19T15:31:19.187727+11:00","close_reason":"Implemented conflict indicator (‚öîÔ∏è) that displays alongside session state when worktree has active merge conflict. Uses git rev-parse MERGE_HEAD detection, checked in parallel during board refresh."}
{"id":"az-g7p","title":"sometimes space S/s moves the task to in progress but doesnt start a tmux session","description":"what could even cause the tmux session to not be started? check az.log maybe","notes":"Root cause identified: Action handlers in KeyboardService use Effect.tap() which fires-and-forgets the inner Effect. Need to change to Effect.flatMap() to properly await the session start.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:44:06.046821+11:00","updated_at":"2025-12-18T02:14:02.600175+11:00","closed_at":"2025-12-17T17:01:19.62138+11:00","close_reason":"Fixed: Moved bead status update from BEFORE session creation to AFTER. Previously if worktree, init commands, or tmux session creation failed, the bead would be left in \"in_progress\" state with no actual session. Now the status only updates after the session is successfully created.","deleted_at":"2025-12-18T02:14:02.600175+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-g84","title":"space c (chat with claude about task) not working","description":"it seems to start a session cause i see a blue dot in az tui but when i press space a it says it failed to attach (not found) i also think it would be better to attach inline or whatever its called in this instance (overlay tui and end on closing out) similar to the log viewer (L) keybind","notes":"Investigated the issue. Found two problems:\n\n1. Space+c starts session but doesn't auto-attach - user sees blue dot but session lookup fails on Space+a\n2. User wants inline popup attach (like Shift+L for logs) instead of external terminal\n\nSolution: Modify actionChatAboutTask to use tmux displayPopup like the log viewer, which will:\n- Start the Claude chat session\n- Immediately show it in a popup overlay\n- Auto-close popup when session ends","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:21:47.203086+11:00","updated_at":"2025-12-18T02:14:02.603071+11:00","closed_at":"2025-12-17T16:27:28.647989+11:00","deleted_at":"2025-12-18T02:14:02.603071+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-gds","title":"Subagent orchestration for parallel epic development","description":"Enable TUI to orchestrate multiple parallel Claude sessions working on related tasks (e.g., epic children). Each worker runs in its own worktree/tmux session. Coordination via Agent Mail for real-time updates, beads for persistent state.\n\n**Key Features:**\n1. Space+o on epic ‚Üí orchestration mode showing child tasks\n2. Select which tasks to parallelize\n3. Spawn workers (worktree + tmux + claude per task)\n4. Workers get injected context about epic and coordination rules\n5. Real-time progress tracking via Agent Mail status broadcasts\n6. Epic progress bar showing X/Y tasks complete\n7. Optional orchestrator Claude for planning/review phases\n\n**Architecture:**\n- TUI is external orchestrator (not a Claude subagent)\n- Workers are independent Claude sessions\n- Agent Mail handles: reservations, status, completion signals\n- Beads handles: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\n**New UI:**\n- Orchestration mode (Space+o)\n- Epic progress indicator (‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5)\n- Indented child tasks under epic\n- Worker status in session indicators\n\n**Session Templates:**\n- worker.md template with epic context injection\n- Coordination rules (stay focused, report discoveries)\n- Auto-close task on completion","notes":"Session 2025-12-12: Designed from Claude Code best practices research.\n\nRESEARCH VALIDATION:\n- Pattern confirmed: Git worktrees are de facto standard for parallel AI agents (Cursor, ccswarm, Claude-Flow all use this)\n- Key insight: TUI as external orchestrator avoids Claude subagent nesting limits\n- Agent Mail provides \u003c100ms coordination vs 2-5s git sync\n\nARCHITECTURE DECISIONS:\n- TUI spawns workers (not Claude spawning subagents) - no nesting limits\n- Each worker: worktree + tmux session + Claude instance\n- Agent Mail for: reservations, status broadcasts, completion signals  \n- Beads for: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\nUI DESIGN:\n- Space+o triggers orchestration mode on epics\n- Reuse select mode patterns for task selection\n- Progress bar: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5 format\n- Indented children under epics in board view\n\nDEPENDENCIES:\n- az-7sr (orch mode) + az-lqb (template) ‚Üí az-bjp (spawning)\n- az-l7a (Agent Mail epic) ‚Üí az-2il (status broadcasts)\n\nNEXT STEP: Implement az-7sr (orchestration mode) or az-lqb (worker template) - both are ready","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:28:50.911119+11:00","updated_at":"2025-12-12T16:35:31.355396+11:00"}
{"id":"az-ghj","title":"clean up open tasks and offer to create 5-10 new tasks based on gaps in our program/tech debt","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:59.901658+11:00","updated_at":"2025-12-18T02:14:02.605602+11:00","closed_at":"2025-12-17T16:13:04.792751+11:00","deleted_at":"2025-12-18T02:14:02.605602+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-gzgg","title":"Prompt user to configure dependencies when creating task in epic drill-down","description":"When a task is created within an epic drill-down view, the new task may have dependencies on other tasks in the same epic. Currently we only auto-link the task to the epic as a parent-child relationship, but we don't help the user establish sibling dependencies.\n\nFor example, if an epic has tasks A, B, C and the user creates task D, task D might need to depend on task B completing first. The user currently has to manually set this up after creation.","design":"## Potential Approaches\n\n### Option 1: Post-creation prompt overlay\nAfter creating the task in drill-down mode, show an overlay asking:\n- \"Does this task depend on any other tasks in this epic?\"\n- List the epic's existing children with checkboxes\n- User selects dependencies, we run `bd dep add` for each\n\n### Option 2: Spawn Claude session for dependency analysis\nMore sophisticated approach - spawn a quick Claude session that:\n1. Reads the new task's title/description\n2. Reads all sibling tasks in the epic\n3. Suggests likely dependencies based on semantic analysis\n4. User confirms/adjusts the suggestions\n\nThis would be especially useful for complex epics where dependencies aren't obvious.\n\n### Option 3: Keybinding for \"add to epic with deps\"\nAdd a separate keybinding (e.g., Shift+C) that does the enhanced flow, keeping plain 'c' simple.\n\n## Recommendation\nStart with Option 1 (simple overlay) as it's quick to implement and covers most use cases. Option 2 could be a follow-up enhancement for power users.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-19T15:10:45.058612+11:00","updated_at":"2025-12-19T15:10:45.058612+11:00","dependencies":[{"issue_id":"az-gzgg","depends_on_id":"az-5z7z","type":"discovered-from","created_at":"2025-12-19T15:10:52.889655+11:00","created_by":"daemon"}]}
{"id":"az-h3v","title":"Agent Mail server for local development","description":"Implement simple Agent Mail server for local multi-agent testing.\n\nDesign:\n- Bun HTTP server with Effect\n- In-memory reservation store (Map\u003cissueId, agentName\u003e)\n- Endpoints:\n  - POST /reserve/:issueId - acquire reservation\n  - POST /release/:issueId - release reservation\n  - GET /ready - list unreserved, unblocked issues\n  - POST /status/:issueId - update status\n  - GET /health - server health check\n- WebSocket support for real-time notifications (optional)\n- Configurable port via CLI argument\n- Graceful shutdown handling","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T10:33:13.621222+11:00","updated_at":"2025-12-12T10:33:13.621222+11:00","dependencies":[{"issue_id":"az-h3v","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.836567+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-h5gk","title":"attached images should be linked in bead description or notes","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:29:36.523901+11:00","updated_at":"2025-12-18T16:11:36.046078+11:00","closed_at":"2025-12-18T15:37:23.405149+11:00","close_reason":"Implemented automatic linking of attached images in bead notes. When an image is attached via `attachFile` or `attachFromClipboard`, a markdown-formatted link is appended to the bead's notes field with the format: üìé [filename](path) (source, timestamp). This makes attachments visible in `bd show` output and preserves them in git history.","deleted_at":"2025-12-18T16:11:36.046078+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-hdj","title":"does pty watcher handle using tmux to add windows/panels to the bead session?","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:36:14.373167+11:00","updated_at":"2025-12-18T13:18:28.637131+11:00","closed_at":"2025-12-18T13:18:28.637134+11:00","close_reason":"Investigated: PTYMonitor does NOT handle multiple windows/panes. It only captures the default pane (session:0.0). If users split panes or add windows, those are not monitored. To fix, would need to store the pane ID at session start and target it explicitly with `-t %{pane_id}` format.","deleted_at":"2025-12-18T12:39:42.061838+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-hdrt","title":"move keybind factories pattern to Effect.Service layers","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:45:18.020158+11:00","updated_at":"2025-12-18T17:21:01.651873+11:00","closed_at":"2025-12-18T17:21:01.651873+11:00","close_reason":"Moved keybind factories pattern to Effect.Service layers. Created KeyboardHelpersService, SessionHandlersService, TaskHandlersService, PRHandlersService, and InputHandlersService. Updated KeyboardService to use these new service layers. Removed old factory pattern files and HandlerContext."}
{"id":"az-hllj","title":"check codebase for dead code","description":"Audit the Azedarach codebase to identify and remove dead code - unused exports, unreferenced functions, orphaned files, and stale imports that are no longer needed.","design":"## Approach\n\nUse TypeScript compiler and static analysis to find dead code:\n\n1. **Unused Exports**: Use `ts-prune` or manual grep analysis to find exports that are never imported\n2. **Orphaned Files**: Check for .ts/.tsx files not imported anywhere\n3. **Stale Imports**: Imports that exist but whose values are never used\n4. **Unreferenced Functions**: Functions defined but never called\n\n## Tools\n- `rg` for pattern matching\n- TypeScript compiler errors (unused locals)\n- Manual cross-reference analysis\n\n## Safety\n- Verify each \"dead\" item is truly unused before removal\n- Check for dynamic imports or indirect references\n- Preserve public API surface","acceptance_criteria":"- [ ] All unused exports identified and documented\n- [ ] Orphaned files (not imported anywhere) identified\n- [ ] Dead code removed or flagged with rationale for keeping\n- [ ] `bun run type-check` passes after changes\n- [ ] `bun run build` succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:03:31.850422+11:00","updated_at":"2025-12-19T23:49:35.131302+11:00","closed_at":"2025-12-19T23:49:35.131302+11:00","close_reason":"Dead code removed: (1) src/index.tsx placeholder, (2) src/atoms/keyboardAtoms.ts duplicate, (3) unused layer exports in src/atoms/runtime.ts, (4) unused convenience functions in StateDetector.ts. Type-check and build pass."}
{"id":"az-hri","title":"Basic Kanban board component (OpenTUI + Solid)","description":"Create the main Ink-based Kanban board displaying beads issues in columns by status.","design":"- Use OpenTUI + SolidJS for components\n- App.tsx: root component, provides Effect runtime context\n- Board.tsx: horizontal flexbox layout of columns (Yoga)\n- Column.tsx: vertical list of tasks per status (open, in_progress, blocked, review, closed)\n- TaskCard.tsx: individual task with title, id, session indicator\n- Session indicators: üîµ Busy, üü° Waiting, ‚úÖ Done, ‚ùå Error, ‚è∏Ô∏è Paused\n- Use SolidJS signals for reactive state (pairs well with Effect Ref)\n- Use createResource for async data fetching from Effect services\n- Style with OpenTUI's built-in primitives (Box, Text, etc.)","notes":"Implemented basic Kanban board component with OpenTUI + SolidJS:\n\n- Created UI types (SessionState, TaskWithSession, COLUMNS, SESSION_INDICATORS)\n- TaskCard.tsx: displays individual tasks with title, ID, session indicator, priority color\n- Column.tsx: vertical list of tasks per status with header and count\n- Board.tsx: horizontal layout of columns using Yoga flexbox\n- StatusBar.tsx: bottom bar with keyboard shortcuts and stats\n- App.tsx: root component with Effect runtime, fetches tasks from BeadsClient\n- launch.tsx: TUI initialization with OpenTUI render\n\nAll components use OpenTUI primitives (box, text) with proper styling (fg/bg colors, attributes for bold, border styles). Successfully type checks with strict mode.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.662469+11:00","updated_at":"2025-12-11T18:03:13.707242+11:00","closed_at":"2025-12-11T18:03:13.707242+11:00","dependencies":[{"issue_id":"az-hri","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.667781+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-hri","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.898548+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-hri","depends_on_id":"az-fvj","type":"blocks","created_at":"2025-12-11T14:46:26.110348+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-hri","depends_on_id":"az-mq9","type":"blocks","created_at":"2025-12-11T17:10:08.980724+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-hsnx","title":"add confirm dialog to delete/cleanup actions (y/n and enter/esc)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:49:16.229704+11:00","updated_at":"2025-12-18T16:11:36.043871+11:00","closed_at":"2025-12-18T16:04:07.468433+11:00","close_reason":"Implemented confirm dialogs for Space+d (cleanup) and Space+D (delete bead) actions using existing ConfirmOverlay infrastructure","deleted_at":"2025-12-18T16:11:36.043871+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-i0d","title":"improve the initial prompt when we press space S","description":"sometimes claude gets confused and doesnt realise we are saying to work on a specific bead with that id","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:23:28.189773+11:00","updated_at":"2025-12-18T02:14:02.596918+11:00","closed_at":"2025-12-18T01:34:17.372932+11:00","close_reason":"Improved the initial prompt in Space+S to include the task title alongside the bead ID. Now sends \"work on az-xxx: \u003ctitle\u003e\" instead of just \"work on az-xxx\", giving Claude clearer context about what to work on.","deleted_at":"2025-12-18T02:14:02.596918+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-i5fb","title":"i'm going to show the project to others","description":"tell me what i should do first before opening it up as an opensource repo. e.g. check for security issues (keys), add license, credit creator of/repo of beads etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:37:44.071386+11:00","updated_at":"2025-12-19T15:11:04.204353+11:00","closed_at":"2025-12-19T15:11:04.204356+11:00"}
{"id":"az-j7qi","title":"Create quality-gate subagent definition","description":"Reusable subagent that validates epic readiness for parallel execution.\n\n**Core function:** Detect file conflicts between tasks that will run simultaneously.\n\n**Outputs:**\n- Which tasks can safely run in parallel\n- Conflict warnings (tasks touching same files)\n- Suggested groupings or reordering\n\n**Location:** .claude/agents/quality-gate.md (portable to other beads projects)","design":"## Implementation Plan\n\n### Purpose\nReusable Claude Code Task tool subagent that analyzes epic tasks for parallel execution safety.\n\n### Design Decisions (from user clarification)\n1. **File detection**: Both codebase analysis (Grep/Glob) AND parsing explicit file mentions from task metadata\n2. **Granularity**: File-level conflicts (any two tasks touching same file = conflict)\n3. **Invocation**: On-demand by orchestrator via Task tool (not pre-flight)\n\n### Agent Definition Structure\n\n**Location:** `.claude/agents/quality-gate.md`\n\n**Inputs (from orchestrator prompt):**\n- Epic ID and context\n- List of child task IDs to analyze\n\n**Analysis Steps:**\n1. For each task, gather file touchpoints via:\n   - Parse task description/design for explicit file paths\n   - Search codebase for keywords from task title (imports, references)\n   - Identify related files by pattern (e.g., \"TaskCard\" ‚Üí TaskCard.tsx, TaskCard.test.ts)\n2. Build task ‚Üí files mapping\n3. Detect overlaps (file mentioned by 2+ tasks = conflict)\n4. Group non-conflicting tasks into parallel batches\n\n**Output Format (structured for orchestrator):**\n```markdown\n## Analysis Results\n\n### Task File Mappings\n- az-xxx: [file1.ts, file2.ts]\n- az-yyy: [file3.ts]\n- az-zzz: [file1.ts, file4.ts]  ‚Üê conflicts with az-xxx\n\n### Conflicts Detected\n- az-xxx ‚Üî az-zzz: Both touch file1.ts\n\n### Recommended Parallel Batches\n**Batch 1 (can run together):** az-xxx, az-yyy\n**Batch 2 (after batch 1):** az-zzz\n\n### Confidence Notes\n- High confidence: explicit file mentions found\n- Medium: inferred from keywords\n- Low: task scope unclear, recommend serial execution\n```\n\n### Portability\n- No Azedarach-specific code - just beads CLI for reading tasks\n- Works in any beads-enabled project\n- Orchestrator just needs to pass epic ID in the prompt","acceptance_criteria":"1. Agent file exists at `.claude/agents/quality-gate.md`\n2. Agent can be invoked via Task tool with epic ID\n3. Agent uses `bd show` to read task details\n4. Agent uses Grep/Glob to identify related files\n5. Agent outputs structured parallel batch recommendations\n6. Agent identifies file-level conflicts between tasks\n7. Agent is portable (no azedarach-specific imports)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.47434+11:00","updated_at":"2025-12-19T11:53:36.030464+11:00","closed_at":"2025-12-19T11:53:29.237705+11:00","close_reason":"Created .claude/agents/quality-gate.md - a portable subagent definition for analyzing epic tasks for parallel execution safety. Agent uses file-level conflict detection via codebase analysis (rg/fd) and explicit file parsing from task metadata. Outputs structured batch recommendations for orchestrator consumption.","dependencies":[{"issue_id":"az-j7qi","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.766793+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-j7qi","depends_on_id":"az-0h3d","type":"blocks","created_at":"2025-12-19T11:14:22.034941+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T11:53:36.030464+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-j95d","title":"our settings.local.json merge feature doesnt work like i wanted","description":"It should work by merging in WorkTree settings.local.json files into main when we merge with space m. making sure to avoid duplicate settings","design":"## Problem\n\nWhen merging a worktree branch to main with `Space+m`, the `settings.local.json` file is not merged back. Claude Code adds permission grants (allowedTools, trustedPaths, etc.) to this file during sessions. These permissions are lost when the worktree is deleted after merge.\n\n## Solution\n\n1. **Create `mergeClaudeLocalSettings` function** in `src/core/hooks.ts`:\n   - Read worktree's `settings.local.json`\n   - Read main's `settings.local.json`\n   - Extract permission-related keys from worktree (NOT hooks - those are bead-specific)\n   - Deep merge with deduplication for arrays\n   - Write merged result to main's `settings.local.json`\n\n2. **Permission keys to merge**:\n   - `allowedTools` (array)\n   - `trustedPaths` (array)\n   - Other permission settings Claude may add\n\n3. **Deduplication strategy**:\n   - For arrays, deduplicate by JSON stringification (full object equality)\n   - This prevents duplicate tool/path entries\n\n4. **Integration point**:\n   - Add call to `mergeClaudeLocalSettings` in `PRWorkflow.mergeToMain`\n   - Called BEFORE worktree deletion\n   - Errors are logged but don't fail the merge (same as current settings copy behavior)\n\n## Files to modify\n\n- `src/core/hooks.ts` - Add `mergeClaudeLocalSettings` function + dedup helper\n- `src/core/PRWorkflow.ts` - Call merge function during `mergeToMain`","acceptance_criteria":"- [ ] When merging with Space+m, permission grants from worktree's settings.local.json are merged into main's settings.local.json\n- [ ] No duplicate entries in allowedTools or trustedPaths arrays after merge\n- [ ] Hook configurations are NOT merged (they are bead-specific)\n- [ ] Merge failures are logged but don't block the overall merge operation\n- [ ] Type-check passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:04:25.684598+11:00","updated_at":"2025-12-19T11:08:46.056379+11:00","closed_at":"2025-12-19T11:08:46.056379+11:00","close_reason":"Implemented mergeClaudeLocalSettings() function to merge permission grants from worktree settings.local.json back to main during Space+m merge. Deduplicates array entries and excludes bead-specific hook configs."}
{"id":"az-k5a","title":"is there a hook for when claude requests to enter plan mode","description":"if there is we should use it to update the session status\nif not we should improve our pty monitoring to pick it up","notes":"## Research Findings\n\n**Answer: No dedicated hook for plan mode entry/exit.**\n\nPlan mode is a permission system state, not a tool-based event. However, detection is possible via:\n\n### Available Options for Azedarach\n\n1. **Monitor `permission_mode` field in hooks** - All hooks receive this field:\n   - `PreToolUse`, `PostToolUse`, `PermissionRequest` all include `permission_mode: \"plan\"|\"default\"|...`\n   - Could detect mode by watching for changes in this field\n\n2. **PTY output monitoring** (current approach) - Look for plan mode indicators:\n   - Claude asking \"Would you like me to enter plan mode?\"\n   - Plan mode banner/status in terminal output\n   - ExitPlanMode tool calls\n\n3. **Transcript file parsing** - `transcript_path` in hook inputs points to conversation JSON\n\n### Recommendation for Azedarach\n\nEnhance PTY monitoring to detect:\n- Plan mode entry prompt patterns\n- `permission_mode` changes via any existing hooks we're using\n- Plan mode exit via ExitPlanMode tool detection\n\nThis is a documentation/research task - no code changes needed unless we want to implement enhanced detection.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:33:09.074229+11:00","updated_at":"2025-12-18T12:42:32.735864+11:00","closed_at":"2025-12-18T12:42:32.735864+11:00","close_reason":"Implemented plan mode detection via PTY monitoring. Added planMode as AgentPhase with detection patterns for plan mode indicators, ExitPlanMode tool, and status bar patterns.","comments":[{"id":5,"issue_id":"az-k5a","author":"riordan","text":"Implementing plan mode detection via PTY monitoring as requested","created_at":"2025-12-18T01:40:43Z"}],"deleted_at":"2025-12-18T12:39:42.059798+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-k5m","title":"Persist session state via tmux query","description":"Session state is lost on azedarach restart because SessionManager stores state in-memory Ref. Fix by querying tmux list-sessions on startup and matching session names to bead IDs.","design":"Option 1 (recommended): Query tmux as source of truth\n- On SessionManager init or listActive(), also run tmux list-sessions\n- Parse session names matching our pattern (just beadId)\n- Merge with in-memory state\n- Tmux existence = session exists, regardless of in-memory state\n\nImplementation:\n1. Add syncFromTmux() method to SessionManager\n2. Call it in listActive() before returning\n3. Or call it once on service init via Effect.sync in the Layer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:33:52.363085+11:00","updated_at":"2025-12-12T11:34:33.533566+11:00","closed_at":"2025-12-12T11:34:33.533566+11:00"}
{"id":"az-kct","title":"(deleted)","description":"","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-15T01:52:58.144161Z","updated_at":"2025-12-15T01:52:58.144161Z","deleted_at":"2025-12-15T01:52:58.144161Z","deleted_by":"riordan","delete_reason":"manual delete"}
{"id":"az-kej","title":"add a way to see the diff between a bead branch and main so i can code review","description":"","design":"## Implementation Plan: Git Diff Overlay\n\n### Overview\nAdd a \"diff\" action (Space+g) that shows git diff between the bead's branch and main in a scrollable overlay. This enables code review directly from the Azedarach TUI.\n\n### Architecture\nFollowing existing patterns:\n1. **PRWorkflow**: Add `getDiff()` method to get branch diff\n2. **OverlayService**: Add `diff` overlay type  \n3. **prHandlers**: Add `showDiff()` handler\n4. **bindings.ts**: Register `g` key in action mode\n5. **DiffOverlay**: New component to display diff with syntax coloring\n6. **useOverlays**: Add `showingDiff` flag\n7. **App.tsx**: Render DiffOverlay\n8. **ActionPalette**: Add \"diff\" action line\n\n### Key Design Decisions\n- Use `git diff main..{branch}` for the diff (shows what branch adds to main)\n- Display in tmux popup for proper scrolling and less +F style viewing\n- Key: `g` in action mode (mnemonic: \"git diff\" or \"get diff\")\n- Requires non-idle session (needs worktree to diff)\n\n### Implementation Order\n1. Add getDiff to PRWorkflow.ts\n2. Add handler in prHandlers.ts  \n3. Register keybinding in bindings.ts\n4. Add to ActionPalette.tsx\n5. Update docs/keybindings.md","notes":"Using tmux popup approach (like Space+L for logs) instead of custom overlay - simpler, better scrolling, proper terminal rendering of ANSI colors from git diff","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T02:10:27.860224+11:00","updated_at":"2025-12-18T15:45:16.418511+11:00","closed_at":"2025-12-18T02:22:52.010639+11:00","deleted_at":"2025-12-18T15:45:16.418511+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-kgq","title":"Multi-project support","description":"Monitor tasks across multiple beads-enabled projects.","design":"- az add /path/to/project: register project\n- az list: show registered projects\n- Combined view: tasks from all projects, grouped or mixed\n- Project selector/filter in TUI\n- Per-project configuration","notes":"Root cause identified: TWO issues\n1. `az add` doesn't exist as a top-level command - only `az project add`\n2. tmux wrapping applies to ALL commands, but when attaching to existing session with `-A`, the command is IGNORED - so `az add` just attaches to TUI instead of running add command\n\nFix: Only wrap in tmux for the default TUI command, not for subcommands","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T14:45:41.986553+11:00","updated_at":"2025-12-18T14:15:34.883795+11:00","closed_at":"2025-12-18T14:15:34.883797+11:00","dependencies":[{"issue_id":"az-kgq","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.274456+11:00","created_by":"daemon","metadata":"{}"}],"comments":[{"id":8,"issue_id":"az-kgq","author":"riordan","text":"CLI add command still not working - immediately exits or opens TUI instead of adding project","created_at":"2025-12-18T02:57:48Z"}]}
{"id":"az-kis","title":"Utility modules: paths, logger, tmux helpers","description":"Create foundational utility modules used throughout the codebase.","design":"- paths.ts: worktree path generation, project name extraction (pure functions)\n- logger.ts: Use Effect's built-in Logger service with custom formatting\n- tmux.ts: TmuxService as Effect.Service wrapping @effect/platform Command\n  - Methods: newSession, attachSession, sendKeys, listSessions, killSession\n  - Typed errors: TmuxNotFoundError, SessionNotFoundError\n- terminal.ts: TerminalService for detecting/launching terminal emulators\n  - Support Ghostty, iTerm, Terminal.app\n  - Returns Effect with TerminalNotFoundError","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- TmuxService Effect service\n- TerminalService Effect service\n- paths.ts pure utility functions\n\nFILES CREATED:\n- src/core/TmuxService.ts (3.6KB) - tmux session management\n- src/core/TerminalService.ts (1.8KB) - terminal detection/launching\n- src/core/paths.ts (868B) - path utilities\n- src/core/example-usage.ts (2.5KB) - usage examples\n\nTMUX SERVICE METHODS:\n- newSession(name, opts?) - Create detached session\n- killSession(name) - Kill session\n- listSessions() - List with metadata (windows, created, attached)\n- hasSession(name) - Check existence\n- sendKeys(session, keys) - Send keystrokes\n- attachCommand(session) - Get attach command string\n\nTERMINAL SERVICE METHODS:\n- detect() - Returns \"ghostty\" | \"iterm\" | \"terminal-app\" | \"unknown\"\n- openWithCommand(cmd) - Opens new terminal window with command\n\nPATH UTILITIES:\n- getProjectName(path) - Extract basename\n- getWorktreePath(projectPath, beadId) - ../ProjectName-\u003cbeadId\u003e/\n- getSessionName(beadId) - Uses bead ID directly\n- normalizePath(path) - path.resolve()\n\nVERIFICATION:\n- All files compile with TypeScript strict mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:44:26.516814+11:00","updated_at":"2025-12-11T17:27:44.742141+11:00","closed_at":"2025-12-11T17:25:14.137924+11:00","dependencies":[{"issue_id":"az-kis","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.116031+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-kis","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.747591+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-krz","title":"User documentation and guides","description":"Create comprehensive user documentation in docs/ folder covering TUI usage, keybindings, tmux integration, services architecture, and testing procedures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:43:35.93321+11:00","updated_at":"2025-12-12T10:43:42.698148+11:00","closed_at":"2025-12-12T10:43:42.698148+11:00"}
{"id":"az-kud","title":"improve tmux workflow","description":"i want to figure out a way to use az as the primary way i navigate through tmux to the right sessions.\ni am just starting to learn tmux so i may be doing thing all wrong but so far i've been pressing ctrl-a s to open the tmux session picker i guess and then navigating to az session or another session created previously by az.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:24:37.484276+11:00","updated_at":"2025-12-16T22:37:21.448766+11:00","closed_at":"2025-12-16T22:37:21.448766+11:00"}
{"id":"az-kzk","title":"Quick task creation from TUI","description":"Create new beads tasks without leaving the TUI.","design":"- 'n' key opens task creation modal\n- ink-text-input for title, description\n- Select type, priority from list\n- Optionally set dependencies\n- Calls bd create under the hood","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:42.159577+11:00","updated_at":"2025-12-12T12:20:02.57418+11:00","closed_at":"2025-12-12T12:20:02.57418+11:00","dependencies":[{"issue_id":"az-kzk","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.411847+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-l7a","title":"Agent Mail Integration for Multi-Agent Coordination","description":"Implement Agent Mail coordination layer for multi-agent beads workflows. Agent Mail reduces coordination latency from 2-5 seconds (git sync) to \u003c100ms (HTTP API), preventing work collisions when multiple Claude sessions operate simultaneously.\n\nKey benefits:\n- 20-50x faster coordination than git sync\n- Prevents duplicate work through exclusive file reservations\n- Lightweight (~50MB memory footprint)\n- Optional with graceful degradation to git-only\n\nIntegration points:\n1. Issue reservation before starting work\n2. Issue release when work completes\n3. Ready query to find unblocked, unreserved issues\n4. Status updates for real-time visibility\n\nConfiguration:\n- BEADS_AGENT_MAIL_URL: Server endpoint\n- BEADS_AGENT_NAME: Unique agent identifier\n- BEADS_PROJECT_ID: Shared namespace\n\nReference: https://github.com/steveyegge/beads/blob/main/docs/AGENT_MAIL.md","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T10:32:57.000556+11:00","updated_at":"2025-12-12T10:32:57.000556+11:00"}
{"id":"az-l7d","title":"enhance docs with all keybinds, modes, vc explainer, etc","description":"Enhanced documentation with:\\n- keybindings.md: Space+m (merge), Space+i (image attach), Image Attachment Overlay section\\n- services.md: ImageAttachmentService documentation\\n- README.md: Expanded VC Integration with architecture diagram, decision table, examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:14:45.203716+11:00","updated_at":"2025-12-17T14:14:51.661199+11:00","closed_at":"2025-12-17T14:14:51.661199+11:00"}
{"id":"az-lex","title":"setup ~/prog/Chefy with az config","description":"we need to setup chefy ready to use az with a proper config. draw inspo from this repo's config. chefy uses pnpm so pnpm i not bun i on new worktrees, it also uses direnv but should use envdev as well after direnv allow, should also use zsh, etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:46:08.985802+11:00","updated_at":"2025-12-17T15:35:21.03052+11:00","closed_at":"2025-12-17T15:35:21.030523+11:00"}
{"id":"az-lit","title":"when we create a bead we should immediately put the cursor on it","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:22:17.05286+11:00","updated_at":"2025-12-17T00:52:00.683781+11:00","closed_at":"2025-12-17T00:52:00.683781+11:00"}
{"id":"az-lj54","title":"allow configuration of base branch e.g. space f should compare base branch (may not be main)","description":"in chefy update .azedarach.json to set base branch to preview","design":"## Implementation Complete\n\n### Problem\nMultiple places hardcode \"main\" as the base branch for git operations:\n1. `PRHandlersService.showDiff()` - compares branch to \"main\"\n2. `PRWorkflow.mergeToMain()` - merges to \"main\", checks conflicts against \"main\"\n3. `PRWorkflow.checkMergeConflicts()` - uses \"main\" for merge-tree\n\n### Solution\n1. Moved `baseBranch` from `pr` section to `git` section\n2. Added **versioned schema with automatic migration** using `Schema.transform`\n3. Added `configVersion` field to track schema changes\n\n### Schema Migration Architecture\n\n```typescript\n// Version history in schema.ts:\n// - 1: Initial versioned schema (moved pr.baseBranch ‚Üí git.baseBranch)\n// - 0/undefined: Legacy unversioned configs\n\nexport const CURRENT_CONFIG_VERSION = 1\n\n// Schema.transform handles migration automatically:\nexport const AzedarachConfigSchema = Schema.transform(\n  RawConfigSchema,      // Accepts legacy format with pr.baseBranch\n  CurrentConfigSchema,  // Outputs current format with git.baseBranch\n  {\n    decode: (raw) =\u003e {\n      // Migrate pr.baseBranch ‚Üí git.baseBranch for v0 configs\n      // Pass through for v1+ configs\n    },\n    encode: (current) =\u003e ({ ...current, configVersion: CURRENT_CONFIG_VERSION })\n  }\n)\n```\n\n### Files Modified\n\n1. **`src/config/schema.ts`**\n   - Added `CURRENT_CONFIG_VERSION = 1` constant\n   - Added `LegacyPRConfigSchema` with deprecated `baseBranch`\n   - Added `RawConfigSchema` that accepts old format\n   - Added `CurrentConfigSchema` for output format\n   - Wrapped in `Schema.transform` for automatic migration\n\n2. **`src/config/defaults.ts`**\n   - Added `configVersion: 1` to `DEFAULT_CONFIG`\n   - Added `configVersion: number` to `ResolvedConfig`\n   - Added `configVersion` to `mergeWithDefaults()`\n\n3. **`src/config/AppConfig.ts`**\n   - Removed manual `migrateConfig` function\n   - Schema.transform now handles migration automatically\n   - Fully type-safe - no `as` casts or type guards needed\n\n4. **`src/services/keyboard/PRHandlersService.ts`**\n   - Uses `gitConfig.baseBranch`\n\n5. **`src/core/PRWorkflow.ts`**\n   - Uses `gitConfig.baseBranch`\n\n### Configuration\n\nNew format (v1):\n```json\n{\n  \"configVersion\": 1,\n  \"git\": {\n    \"baseBranch\": \"preview\"\n  }\n}\n```\n\nOld format (v0) still works - automatically migrated:\n```json\n{\n  \"pr\": {\n    \"baseBranch\": \"preview\"\n  }\n}\n```\n\n### Benefits of Schema-Based Migration\n\n1. **Fully type-safe** - No `as` casts, no `any`, no type guards\n2. **Declarative** - Migration logic in schema, not scattered in loading code\n3. **Versioned** - Easy to add future migrations\n4. **Bidirectional** - encode/decode for round-tripping","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:57:24.692666+11:00","updated_at":"2025-12-19T19:33:31.575116+11:00","closed_at":"2025-12-19T19:33:31.575121+11:00"}
{"id":"az-ln3v","title":"sort modes should have secondary sort layers","description":"e.g. session sort mode should use updated as a secondary layer of sorting to sort the nested and unnested","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:32:31.602591+11:00","updated_at":"2025-12-18T13:54:09.564639+11:00","closed_at":"2025-12-18T13:35:18.905254+11:00"}
{"id":"az-lolx","title":"i cannot use arrows to move cursor in epic drill down mode","description":"When in epic drill-down mode (entered by pressing Enter on an epic), arrow keys don't move the cursor because navigation operates on a different view of tasks than what's displayed.\n\n## Root Cause\n\nThere's a data mismatch between UI rendering and navigation:\n- **UI (App.tsx)**: Uses `drillDownFilteredTasksAtom` which filters to only epic children\n- **Navigation (NavigationService)**: Uses `getFilteredTasksByColumn()` which ignores drill-down mode\n\nWhen the user presses arrow keys:\n1. `NavigationService.move()` calls `getFilteredTasksByColumn()`\n2. This returns ALL tasks (not just drill-down children)\n3. Navigation finds the cursor at position X in the full task list\n4. But the UI only shows drill-down children, so position X doesn't correspond to the visible tasks\n5. Navigation appears broken because cursor movement is calculated against invisible tasks\n\n## Reproduction\n1. Create an epic with child tasks\n2. Press Enter on the epic to enter drill-down mode\n3. Try using arrow keys (j/k/h/l or up/down/left/right)\n4. Observe: cursor doesn't move as expected","design":"...","acceptance_criteria":"- [ ] Arrow keys (j/k/h/l and up/down/left/right) work in epic drill-down mode\n- [ ] Navigation respects the drill-down filter (only navigates among visible children)\n- [ ] Exit drill-down (q or Escape) restores normal navigation\n- [ ] Search mode within drill-down also works correctly","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T01:56:14.951559+11:00","updated_at":"2025-12-19T02:23:16.631627+11:00","closed_at":"2025-12-19T02:23:16.631627+11:00","close_reason":"Merged to main: Fixed arrow key navigation in epic drill-down mode by filtering navigation to only visible children","deleted_at":"2025-12-19T02:15:58.656033+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"bug"}
{"id":"az-losz","title":"issue with a partial success on space S","description":"i guess we need to make it atomic/roll back on partial success?","notes":"## Analysis\n\nThe `SessionManager.start` method has a non-atomic sequence of operations:\n\n1. Create worktree (idempotent ‚úì)\n2. Run init commands (can fail, has config for continueOnFailure ‚úì)  \n3. Create tmux session with Claude ‚Üê RESOURCE 1\n4. Update bead status to `in_progress` ‚Üê RESOURCE 2\n5. Store session in registry ‚Üê can fail after resources created\n6. Publish state change ‚Üê can fail after resources created\n\n**Problem:** If step 5 or 6 fails after steps 3-4, we have:\n- A running tmux session with Claude (orphaned)\n- Bead marked as `in_progress` with no session tracking\n\n## Solution Implemented\n\nUsed `Effect.acquireUseRelease` treating BOTH tmux and bead status as \"resources\":\n\n```typescript\nEffect.acquireUseRelease(\n  // ACQUIRE: Create tmux + update bead status (both are resources)\n  Effect.gen(function* () {\n    let createdNewSession = false\n    let updatedBeadStatus = false\n\n    if (!hasSession) {\n      yield* tmuxService.newSession(...)\n      createdNewSession = true\n    }\n    if (needsStatusUpdate) {\n      yield* beadsClient.update(beadId, { status: \"in_progress\" })\n      updatedBeadStatus = true\n    }\n    return { createdNewSession, updatedBeadStatus }\n  }),\n\n  // USE: Register in memory + publish event\n  () =\u003e Effect.gen(function* () {\n    yield* Ref.update(sessionsRef, ...)\n    yield* publishStateChange(beadId, \"idle\", \"busy\")\n    return sessionObj\n  }),\n\n  // RELEASE: Rollback BOTH on failure\n  (acquired, exit) =\u003e\n    Exit.isFailure(exit)\n      ? Effect.gen(function* () {\n          if (acquired.createdNewSession) {\n            yield* tmuxService.killSession(tmuxSessionName)\n          }\n          if (acquired.updatedBeadStatus) {\n            yield* beadsClient.update(beadId, { status: \"open\" })\n          }\n        })\n      : Effect.void,\n)\n```\n\n**Key benefits:**\n- Interrupt-safe: rollback runs even on fiber interruption\n- Tracks all state changes: both tmux and bead status\n- Selective rollback: only reverts what was actually changed\n- Idiomatic Effect pattern: proper resource management","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:21:13.743895+11:00","updated_at":"2025-12-18T13:54:02.410611+11:00","close_reason":"Complete fix: SessionManager.start now uses acquireUseRelease to rollback BOTH tmux session AND bead status on partial failure.","comments":[{"id":7,"issue_id":"az-losz","author":"riordan","text":"Extending fix to also rollback bead status","created_at":"2025-12-18T02:47:29Z"}],"deleted_at":"2025-12-18T13:54:02.410611+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-lqb","title":"Worker session template with epic context injection","description":"Create worker.md session template that injects:\n- Task title, description, design\n- Parent epic context (title, design, goals)\n- Coordination rules (stay focused, report discoveries)\n- bd commands for status updates\n\n**Template variables:** $TASK_ID, $TASK_TITLE, $EPIC_ID, $EPIC_TITLE, $EPIC_DESIGN\n\n**Location:** .claude/session-templates/worker.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.913748+11:00","updated_at":"2025-12-19T10:54:56.992854+11:00","closed_at":"2025-12-19T10:54:56.992854+11:00","close_reason":"Created worker.md template with Mustache-style variable substitution and TemplateService for loading/rendering","dependencies":[{"issue_id":"az-lqb","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.80298+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-lsi","title":"figure out whats next with our claude status hook system","description":"","notes":"Starting implementation of Option 1: Integrate Claude Code's native hooks (Notification, Stop, SessionEnd) for authoritative state detection in spawned worktrees.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:54.252353+11:00","updated_at":"2025-12-17T11:17:26.126289+11:00","closed_at":"2025-12-17T11:17:26.126292+11:00"}
{"id":"az-m176","title":"Add orchestrate mode to StatusBar","description":"In StatusBar.tsx, add keybindings for orchestrate mode:\n\n```typescript\nMODE_KEYBINDINGS.orchestrate = [\n  { key: \"Space\", action: \"Toggle\" },\n  { key: \"Enter\", action: \"Spawn\" },\n  { key: \"a\", action: \"All\" },\n  { key: \"n\", action: \"None\" },\n  { key: \"Esc\", action: \"Back\" },\n]\n```\n\nMode display should show: \"orchestrate (X/Y)\" where X is selected count and Y is spawnable count.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:05.683144+11:00","updated_at":"2025-12-19T10:34:32.09255+11:00","closed_at":"2025-12-19T10:34:32.09255+11:00","close_reason":"Completed during Wave 1 - orchestrate keybindings added to MODE_KEYBINDINGS in StatusBar.tsx","dependencies":[{"issue_id":"az-m176","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:25.881296+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-m176","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:51.910544+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T02:15:58.657983+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-m9vt","title":"after space m completes run type-check and fix and fix and fix any issues with a claude session","description":"","design":"## Implementation (Final)\n\nMade post-merge validation configurable via `.azedarach.json` instead of hardcoded:\n\n### Config Schema (`merge` section in .azedarach.json)\n```json\n{\n  \"merge\": {\n    \"validateCommands\": [\"bun run type-check\"],\n    \"fixCommand\": \"bun run fix\",\n    \"maxFixAttempts\": 2,\n    \"startClaudeOnFailure\": true\n  }\n}\n```\n\n### Behavior\n- **No validation by default** - must be explicitly configured\n- Runs all `validateCommands` in sequence after merge\n- If validation fails and `fixCommand` is set, runs fix up to `maxFixAttempts` times\n- If still failing and `startClaudeOnFailure` is true, starts Claude session\n- Blocks merge completion until validation passes\n\n### Files Changed\n- `src/config/schema.ts` - Added MergeConfigSchema\n- `src/config/defaults.ts` - Added merge defaults (empty by default)\n- `src/config/AppConfig.ts` - Added getMergeConfig()\n- `src/core/PRWorkflow.ts` - Refactored to use config instead of hardcoded commands\n- `.azedarach.json` - Added merge config for this project","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:17.498656+11:00","updated_at":"2025-12-19T10:34:32.605035+11:00","closed_at":"2025-12-19T10:34:32.605035+11:00","close_reason":"Implemented automatic type-check and fix after Space+m merge:\n- Added runTypeCheck and runFix helper functions in PRWorkflow.ts\n- Added TypeCheckError error type for type-check failures\n- Added step 7.5 in mergeToMain that runs type-check after merge\n- Auto-runs fix up to 2 times if type-check fails\n- If still failing, starts Claude session to fix errors\n- Added TypeCheckError to ErrorFormatter for user-friendly messages","comments":[{"id":11,"issue_id":"az-m9vt","author":"riordan","text":"Misunderstood task - need to implement automatic type-check/fix in the merge action code, not manually run it","created_at":"2025-12-18T14:55:02Z"}],"deleted_at":"2025-12-19T02:15:58.656791+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-md0x","title":"Add Claude Orchestrate option to orchestration UI","description":"In OrchestrationOverlay or via new entry point:\n- Add \"Claude Orchestrate\" option alongside manual selection\n- Spawns orchestrator session with:\n  - autoCompact: true\n  - orchestrator template\n  - No initial task selection (orchestrator decides)","design":"...","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.59242+11:00","updated_at":"2025-12-20T00:33:12.299787+11:00","dependencies":[{"issue_id":"az-md0x","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.855953+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-md0x","depends_on_id":"az-2q75","type":"blocks","created_at":"2025-12-19T11:14:22.125985+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-md0x","depends_on_id":"az-0h3d","type":"blocks","created_at":"2025-12-19T11:14:22.221409+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-md0x","depends_on_id":"az-j7qi","type":"blocks","created_at":"2025-12-19T11:14:22.31572+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-mj5","title":"Add structured logging with Effect Logger","description":"Add comprehensive logging for debugging and observability:\n\n**Implementation:**\n- Use Effect's Logger service with structured JSON output\n- Add log levels: debug, info, warn, error\n- Log file output option (--log-file flag)\n- Key events to log:\n  - Session lifecycle (start, stop, state changes)\n  - Beads operations (create, update, sync)\n  - Git operations (worktree, merge, PR)\n  - Keyboard actions (for debugging keybinding issues)\n  - Error conditions with context\n\n**Config:**\n- LOG_LEVEL env var (default: info)\n- --verbose flag for debug output\n- Timestamp and source service in each log entry","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:59:45.524867+11:00","updated_at":"2025-12-19T10:36:12.501117+11:00","deleted_at":"2025-12-19T10:36:12.501117+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"feature"}
{"id":"az-mlv","title":"when i press space m on beads that are in closed column but have tmux session running they seem to merge ok but the beads disappear from closed","description":"no idea where they disappear to","design":"## Root Cause\n\nThe `bd merge` driver uses standard 3-way merge semantics:\n- If a bead exists in base (ancestor) and main, but NOT in branch\n- Merge interprets this as \"branch deleted the bead\"\n- Result: bead is removed from main, marked as tombstone in DB\n\n## Why Branch Has Missing Beads\n\nWorktree's .beads/issues.jsonl becomes incomplete due to:\n1. Worktree created from older main (before bead existed)\n2. bd sync failures that don't import all beads\n3. Conflict resolution that drops beads\n\n## Proposed Fix\n\nAdd `bd sync --import-only` call in main AFTER the git merge to recover any beads that were incorrectly removed by the merge driver. This ensures the main database re-imports from the merged JSONL.","notes":"Root cause found: PRWorkflow.mergeToMain calls `beadsClient.sync(worktree.path)` without `--from-main` flag. Comment says --from-main but code doesn't use it. Fix: add syncFromMain method to BeadsClient and use it in merge workflow.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:11:43.179532+11:00","updated_at":"2025-12-18T02:14:02.598659+11:00","closed_at":"2025-12-18T02:01:50.13422+11:00","close_reason":"Fixed: Added syncImportOnly after git merge in PRWorkflow.mergeToMain to recover beads that may be incorrectly removed by the bd merge driver's 3-way merge semantics","deleted_at":"2025-12-18T02:14:02.598659+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-moj","title":"State transition hooks system","description":"Pluggable hook system for state transition events.","design":"- Define HookRegistry as Effect.Service\n- Hook types as tagged union: onWaiting | onDone | onError | onPaused\n- Built-in hooks: NotificationHook, PRCreationHook, BeadsSyncHook\n- Methods:\n  - register(hookType, handler): Effect\u003cvoid\u003e\n  - trigger(hookType, context): Effect\u003cvoid\u003e\n- Use PubSub subscription for event-driven hooks\n- Hook handlers are Effects with typed context:\n  - HookContext = { task: Issue, session: Session, worktree: Worktree }\n- Use Effect.forEach with { concurrency: \"unbounded\" } for parallel hooks\n- User-configurable hooks via Config (shell commands)\n- Use Effect.catchAll for error isolation between hooks","notes":"Implemented state transition hooks system with the following components:\n\n**Core Services:**\n- `HookRegistry` (src/core/HookRegistry.ts): Main service for hook registration/triggering with Effect.Service pattern\n- `HookOrchestrator` (src/core/HookOrchestrator.ts): Wires HookRegistry to SessionManager's PubSub, registers user shell hooks from config\n\n**Built-in Hooks:**\n- `BuiltInHooks` (src/hooks/BuiltInHooks.ts): Registers NotificationHook, PRCreationHook, BeadsSyncHook\n\n**Configuration:**\n- Added `hooks` section to config schema (schema.ts, defaults.ts)\n- User can define shell commands for each event type: onWaiting, onDone, onError, onPaused\n- Shell hooks receive context via environment variables: HOOK_TASK_ID, HOOK_TASK_TITLE, etc.\n- Can disable built-in hooks with `hooks.disableBuiltIn: true`\n\n**Key Design:**\n- Hook types as tagged union: \"onWaiting\" | \"onDone\" | \"onError\" | \"onPaused\"\n- HookContext: { task, session, worktree, stateChange }\n- Parallel execution with Effect.forEach({ concurrency: \"unbounded\" })\n- Error isolation via Effect.catchAll per hook\n- PubSub subscription for event monitoring\n\nAll types pass strict TypeScript checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.613629+11:00","updated_at":"2025-12-17T00:46:56.514818+11:00","closed_at":"2025-12-17T00:46:56.514818+11:00","dependencies":[{"issue_id":"az-moj","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.589726+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-moj","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.411943+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-mq9","title":"Create effect-atom SolidJS adapter","description":"Create a SolidJS adapter for effect-atom since only React and Vue adapters exist. This bridges Effect services to SolidJS's reactive system.","design":"- Create src/lib/effect-atom-solid/ adapter (or separate package later)\n- Core primitives to implement:\n  - `useAtomValue(atom)` ‚Üí uses SolidJS `from()` or `createSignal` + subscription\n  - `useAtomSet(atom)` ‚Üí returns setter function\n  - `useAtom(atom)` ‚Üí returns [Accessor, Setter] tuple\n  - `useAtomMount(atom)` ‚Üí lifecycle via `onMount`/`onCleanup`\n  - `createAtomResource(atom)` ‚Üí bridges to SolidJS `createResource` for Suspense\n- Use `RegistryContext` via SolidJS `createContext`/`useContext`\n- Leverage SolidJS's `from()` utility for external subscriptions\n- Pattern: subscribe to Atom changes, update SolidJS signal\n- Consider contributing back to tim-smart/effect-atom","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full SolidJS adapter for @effect-atom/atom\n- Implements all core hooks matching React adapter API\n\nFILES CREATED:\n- src/lib/effect-atom-solid/hooks.ts - useAtomValue, useAtomSet, useAtom, useAtomMount, useAtomRefresh\n- src/lib/effect-atom-solid/Provider.tsx - AtomProvider with registry options\n- src/lib/effect-atom-solid/index.ts - Barrel exports\n- src/lib/effect-atom-solid/example.tsx - Working counter example\n- src/lib/effect-atom-solid/README.md - Full documentation\n\nKEY DECISIONS:\n- Used createSignal + subscription pattern (SolidJS equivalent of useSyncExternalStore)\n- Values returned as Accessor\u003cT\u003e (must call: count()) per SolidJS conventions\n- Default scheduler: queueMicrotask (not React Scheduler)\n- Used onCleanup for automatic subscription cleanup\n\nPOTENTIAL CONTRIBUTION:\n- This adapter could be contributed back to tim-smart/effect-atom\n- API surface mirrors @effect-atom/atom-react for easy migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:10:02.323692+11:00","updated_at":"2025-12-11T17:27:44.548067+11:00","closed_at":"2025-12-11T17:25:13.974746+11:00","dependencies":[{"issue_id":"az-mq9","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T17:10:08.844553+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-mq9","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T17:10:08.914278+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-mxk2","title":"when attaching with space a we should optionally merge in latest base branch","description":"we should detect if necessary and if so we show the dialog, if not we just attach as usual, the merge should attempt automatically and if it fails/has conflicts then we should run a claude session to resolve it just like with space m action. questions?","design":"## Implementation Plan\n\n### Overview\nWhen user presses Space+a to attach to a session, detect if the worktree branch is behind main. If behind, show a confirmation dialog and auto-merge main into the branch before attaching. If merge has conflicts, spawn Claude to resolve them (matching Space+m behavior).\n\n### Flow\n```\nSpace+a pressed\n    ‚îÇ\n    ‚ñº\nCheck if worktree branch is behind main\n(git rev-list --count main..HEAD vs HEAD..main)\n    ‚îÇ\n    ‚îú‚îÄ Not behind ‚Üí Attach immediately (current behavior)\n    ‚îÇ\n    ‚îî‚îÄ Behind by N commits ‚Üí\n        ‚îÇ\n        ‚ñº\n    Show confirmation dialog:\n    \"Branch is N commits behind main. Merge latest?\"\n    [Merge \u0026 Attach] [Skip \u0026 Attach] [Cancel]\n        ‚îÇ\n        ‚îú‚îÄ Skip ‚Üí Attach immediately\n        ‚îú‚îÄ Cancel ‚Üí Return to board\n        ‚îî‚îÄ Merge \u0026 Attach ‚Üí\n            ‚îÇ\n            ‚ñº\n        Auto-stash uncommitted changes (if any)\n            ‚îÇ\n            ‚ñº\n        Check for conflicts (git merge-tree --write-tree)\n            ‚îÇ\n            ‚îú‚îÄ No conflicts ‚Üí git merge main, pop stash, attach\n            ‚îÇ\n            ‚îî‚îÄ Conflicts detected ‚Üí\n                ‚îÇ\n                ‚ñº\n            Start actual merge (git merge main) to create conflict markers\n            Spawn Claude session with conflict resolution prompt\n            Return error: \"Conflicts detected. Claude session started. Retry after resolution.\"\n```\n\n### Key Components\n\n**1. New function: `checkBranchBehindMain()`** in PRWorkflow.ts\n- Uses `git rev-list --count HEAD..main` to count commits branch is behind\n- Returns `{ behind: number, ahead: number }` for informational display\n\n**2. Modify `SessionHandlersService.attachExternal()`** (bindings.ts:374-379)\n- Before attaching, call new `prWorkflow.checkBranchBehindMain()`\n- If behind \u003e 0, show confirmation dialog\n- Dialog options: \"Merge \u0026 Attach\", \"Skip \u0026 Attach\", \"Cancel\"\n\n**3. New function: `mergeMainIntoBranch()`** in PRWorkflow.ts\n- Reuse existing `checkMergeConflicts()` logic\n- Auto-stash uncommitted changes before merge\n- If clean merge: `git merge main --no-edit`, pop stash\n- If conflicts: same flow as Space+m - spawn Claude with conflict resolution prompt\n\n**4. Update attach flow in SessionHandlersService**\n- On \"Merge \u0026 Attach\": call mergeMainIntoBranch(), then attach\n- On \"Skip \u0026 Attach\": attach immediately\n- On \"Cancel\": exit to normal mode\n\n### Files to Modify\n1. `src/core/PRWorkflow.ts` - Add checkBranchBehindMain(), mergeMainIntoBranch()\n2. `src/services/keyboard/SessionHandlersService.ts` - Modify attachExternal handler\n3. `src/services/keyboard/bindings.ts` - May need to adjust action binding\n\n### Reusable Patterns\n- Conflict detection: reuse `checkMergeConflicts()` from PRWorkflow.ts:1079-1164\n- Claude spawn for conflicts: reuse pattern from PRWorkflow.ts:804-823\n- Stash handling: reuse pattern from Space+m uncommitted changes flow\n\n### Acceptance Criteria\n- [ ] Space+a detects when branch is behind main\n- [ ] Shows dialog with merge/skip/cancel options when behind\n- [ ] Auto-stash handles uncommitted changes safely\n- [ ] Clean merge auto-attaches to session\n- [ ] Conflicted merge spawns Claude session for resolution\n- [ ] Skip option attaches without merging\n- [ ] Not-behind branches attach immediately (no dialog)","acceptance_criteria":"- Space+a detects when branch is behind main\n- Shows dialog with merge/skip/cancel options when behind\n- Auto-stash handles uncommitted changes safely  \n- Clean merge auto-attaches to session\n- Conflicted merge spawns Claude session for resolution\n- Skip option attaches without merging\n- Not-behind branches attach immediately (no dialog)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T16:20:58.987524+11:00","updated_at":"2025-12-20T03:16:22.975311+11:00","closed_at":"2025-12-20T03:16:22.975314+11:00"}
{"id":"az-n6k","title":"i seem to only be able to space m merge to main one bead and then i have to restart az","description":"after one the next time i space m a different bead it does nothing","notes":"Root cause: `Effect.fork` in CommandQueueService.processNext was creating fibers tied to the parent scope. When processNext returned, the scope closed and interrupted the forked fiber before it could clean up (set running = null). This left the queue in a stuck state where `running !== null` blocked subsequent operations.\n\nFix: \n1. Changed service from `effect:` to `scoped:` to get a layer-level Scope\n2. Captured scope at construction: `const serviceScope = yield* Effect.scope`\n3. Changed `Effect.fork` to `Effect.forkIn(effect, serviceScope)`\n\nThis ensures command fibers:\n- Aren't interrupted when processNext returns (outlive parent)\n- Get cleaned up when app shuts down (not daemon fibers)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:32:43.637796+11:00","updated_at":"2025-12-18T02:14:02.601165+11:00","closed_at":"2025-12-17T17:12:59.43952+11:00","close_reason":"Fixed by using scoped service and Effect.forkIn to properly manage fiber lifecycle","deleted_at":"2025-12-18T02:14:02.601165+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ni9g","title":"space D should also run cleanup like space d if required","description":"When deleting a bead with Space+D, if the bead has an active session/worktree, the worktree should be cleaned up first (deleting the git worktree and branch). This mirrors the behavior of space+d (cleanup) but as a prerequisite to deletion.\n\nWithout this, deleting a bead with an active session leaves orphaned worktrees in the filesystem.","design":"## Architecture Pattern\n\nBoth Space+d (cleanup) and Space+D (delete) should use a **shared Effect service method** for the core cleanup operation.\n\n### Reusable Service Method\n- `PRWorkflow.cleanup({ beadId, projectPath, closeBead? })` - Core cleanup logic\n- Handles: worktree deletion, branch removal, git state cleanup\n- Can be parameterized to optionally close the bead after cleanup\n\n### Orchestration Pattern\n\n**Space+d (cleanup handler):**\n```\nUser presses Space+d\n  ‚Üí cleanup() handler in prHandlers.ts\n    ‚Üí Validates session is active\n    ‚Üí Calls prWorkflow.cleanup({ closeBead: true })\n    ‚Üí Closes the bead (marks status)\n```\n\n**Space+D (delete handler):**\n```\nUser presses Space+D\n  ‚Üí deleteBead() handler in taskHandlers.ts\n    ‚Üí If session is active:\n      ‚Üí Calls prWorkflow.cleanup({ closeBead: false })\n      ‚Üí Catches errors as best-effort (logs warning)\n    ‚Üí Calls beadsClient.delete(beadId)\n    ‚Üí Deletes bead from database\n```\n\n### Design Rationale\n- **DRY**: Cleanup logic lives in one place (PRWorkflow service)\n- **Composability**: Both handlers reuse the same cleanup operation\n- **Fail-safe**: Delete continues even if cleanup fails (prevents orphaned beads)\n- **Clear intent**: Each handler orchestrates the cleanup ‚Üí next operation flow","acceptance_criteria":"‚úÖ Both Space+d and Space+D use shared `PRWorkflow.cleanup()` method\n‚úÖ Cleanup is extracted to Effect service (not duplicated in handlers)\n‚úÖ Space+D orchestrates cleanup before bead deletion\n‚úÖ Cleanup failures in delete are best-effort (logged but don't block deletion)\n‚úÖ The pattern is documented in design notes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:03:36.08385+11:00","updated_at":"2025-12-18T15:06:08.552048+11:00","closed_at":"2025-12-18T15:06:08.552053+11:00","close_reason":"Work completed and merged to main (commit a0cf409)"}
{"id":"az-nk1","title":"Add number keys 1-9 for quick session attach","description":"Allow pressing 1-9 keys in normal mode to quickly attach to running sessions.\n\nInspiration: AutoMaker uses 1-9, 0 to view output for first 10 in-progress cards.\n\nImplementation:\n1. In normal mode, number keys 1-9 attach to nth running session\n2. Sessions ordered by: busy first, then waiting, then by start time\n3. Show number indicators on cards when sessions are running\n4. 0 could attach to 10th session or be used for other purpose","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T12:00:03Z","updated_at":"2025-12-16T12:00:03Z"}
{"id":"az-nqo","title":"Complete SessionService implementation (spawn/attach/onComplete)","description":"SessionService is a thin facade that consolidates scattered session logic in KeyboardService into a reusable API layer.\n\n**Current State (Duplicated):**\n- `spawn()` logic: KeyboardService lines 362-369 (Space+s) and 388-401 (Space+i) both call sessionManager.start()\n- `attach()` logic: KeyboardService line 443 (Space+a) calls attachmentService.attachExternal()\n- `onComplete()` logic: **MISSING** ‚Äî no PR workflow automation exists\n\n**Refactoring Goals:**\n1. Extract `spawn()` ‚Üí consolidate both keybinding paths into SessionService.spawn()\n2. Extract `attach()` ‚Üí consolidate Space+a/Space+o paths into SessionService.attach()  \n3. Implement `onComplete()` ‚Üí wire PRWorkflow for automatic PR creation + board updates (NEW)\n4. Update KeyboardService to delegate to SessionService instead of direct core service calls\n\n**Benefit:** Single source of truth for session operations, enables auto-PR workflow, cleaner architecture (UI routing vs business logic separation).","design":"## Architecture: SessionService Facade Pattern\n\n```\nKeyboardService (UI event routing)\n    ‚Üì delegates\nSessionService (consolidated API)  ‚Üê NEW facade layer\n    ‚Üì delegates\nCore Services:\n  - SessionManager.start()\n  - AttachmentService.attachExternal()\n  - PRWorkflow.createPR()\n  - TmuxService (session attachment)\n  - BeadsClient (board updates)\n```\n\n**SessionService responsibilities:**\n- Expose spawn(taskId), attach(taskId), onComplete(taskId) as Effect-returning methods\n- Depend on ToastService + NavigationService for UI feedback\n- Delegate actual work to core services\n- Consolidate error handling \u0026 logging","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T15:59:44.332899+11:00","updated_at":"2025-12-18T02:21:09.519077+11:00","closed_at":"2025-12-18T02:21:09.519079+11:00","close_reason":"Implemented SessionService facade with spawn(), attach(), onComplete() methods. KeyboardService now delegates to SessionService for all session operations.","deleted_at":"2025-12-18T02:14:02.596252+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-nzvz","title":"space f is not working. should see colourfull difftastic output","description":"","design":"## Root Cause\nThe `showDiff` function (Space+f) used `git diff main...HEAD` which only shows *committed* changes. When work was only staged (not committed), the diff appeared empty.\n\n## Fix\nChanged `main...HEAD` to `main` in the diff command:\n- `main...HEAD` = commits since branching (excludes uncommitted work)\n- `main` = full diff between main and working tree (includes committed + staged + unstaged)\n\n## Changes\n- `src/services/keyboard/PRHandlersService.ts:379` - Changed diff command to use `main` instead of `main...HEAD`\n- Also removed `+Gg` from less options (was unnecessary)","notes":"üìé [mjcaysaw-91oq.png](.beads/images/az-nzvz/mjcaysaw-91oq.png) (clipboard, 12/19/2025, 2:21:28 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:21:26.408124+11:00","updated_at":"2025-12-19T14:57:35.804222+11:00","closed_at":"2025-12-19T14:57:35.804225+11:00"}
{"id":"az-o5a","title":"Complete KeyboardService migration - replace App.tsx inline handlers","description":"Finish the half-completed migration from inline useKeyboard handlers in App.tsx to the data-driven KeyboardService + useKeyboardBridge pattern.","notes":"## Session Progress (2025-12-15)\n\n### Completed\n- Phase 1: NavigationService methods added (halfPageDown, halfPageUp, goToFirst, goToLast, goToFirstColumn, goToLastColumn, jumpToEnd)\n- Layer composition in atoms.ts restructured to support NavigationService ‚Üí BoardService dependency\n- KeyboardService rewritten with all modes and ~60 keybindings\n- **Fixed type errors** by:\n  1. Removing explicit `Effect.Effect\u003cvoid\u003e` return types from helper functions (let TS infer)\n  2. Updated `Keybinding` interface to allow `BeadsError` and `KeybindingDeps` (CommandExecutor | FileSystem)\n  3. Removed explicit return type from `handleKey` method\n- **Extended BeadsClient** to support all bd CLI fields:\n  - `update()`: Added title, description, design, acceptance, assignee, estimate, labels\n  - `create()`: Added design, acceptance, assignee, estimate, labels\n- **Refactored BeadEditorService** to use BeadsClient instead of running bd commands directly\n- **MAJOR: ID-based cursor navigation** - Changed cursor from index-based {columnIndex, taskIndex} to focusedTaskId: string | null\n  - Eliminates sync issues between UI and services\n  - NavigationService now uses EditorService for search/sort config\n  - Navigation operations find current position in filtered view, calculate new position, store new task ID\n- **Single data source** - App.tsx now uses boardTasksAtom from BoardService instead of separate tasksAtom\n  - When board.refresh() is called, UI updates automatically\n- **Skip empty columns** - Left/right navigation skips empty columns to find next non-empty one\n- **Cursor safety** - After deleting a bead, nav.initialize() moves cursor to valid task\n- **az-451 Data.struct refactor** - SubscriptionRef state now uses Data.struct() for structural equality:\n  - EditorService: EditorMode variants + SortConfig\n  - OverlayService: Overlay objects + emptyArray() singleton\n  - ToastService: Toast objects + emptyArray() singleton\n  - Created src/lib/empty.ts with singleton emptyRecord()/emptyArray()\n\n### Status: TYPE-CHECK PASSES ‚úì\n\n### Files Modified This Session\n- src/services/NavigationService.ts - Complete rewrite for ID-based cursor\n- src/services/KeyboardService.ts - Updated getSelectedTask to use focusedTaskId\n- src/services/BoardService.ts - Added getFilteredTasksByColumn, getFilteredTaskAt, Map‚ÜíRecord\n- src/services/EditorService.ts - Data.struct() wrapping for EditorMode/SortConfig\n- src/services/OverlayService.ts - Data.struct() wrapping + emptyArray()\n- src/services/ToastService.ts - Data.struct() wrapping + emptyArray()\n- src/ui/App.tsx - Use boardTasksAtom, call refreshBoard on mount\n- src/ui/atoms.ts - Removed cursorAtom, added initializeNavigationAtom, refreshBoardAtom\n- src/ui/hooks/useNavigation.ts - Derives position from focusedTaskId locally\n- src/ui/Board.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/ui/CompactView.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/lib/empty.ts - NEW: singleton emptyRecord()/emptyArray()\n\n### Remaining Work\n1. Wire useKeyboardBridge into App.tsx (handleKeyAtom already connected)\n2. Remove any remaining inline handlers from App.tsx\n3. Test all keybindings thoroughly\n4. Consider removing debug logging from KeyboardService\n\n### Recent Commits\n- eccbe28 - refactor: Add Data.struct wrapping to SubscriptionRef state\n- 19beb0a - feat: Add singleton empty collection utilities\n- 092959c - refactor: ID-based cursor navigation and single data source","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T00:43:39.319315+11:00","updated_at":"2025-12-15T13:36:38.73138+11:00","closed_at":"2025-12-15T13:36:38.73138+11:00"}
{"id":"az-o5m9","title":"merged tasks are being left in in-progress status","description":"","notes":"Root cause identified: In mergeToMain(), the bead is closed (step 10) AFTER the git push (step 9). This means the closed status is never pushed to remote. The fix is to either: (1) move the close before the push, or (2) do an additional sync+push after closing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:06:11.946082+11:00","updated_at":"2025-12-18T13:14:25.570421+11:00","closed_at":"2025-12-18T13:14:25.570421+11:00","close_reason":"Fixed by moving bead close before git push in mergeToMain() and cleanup(), and adding bd sync after close to persist the status change to JSONL and commit it to git."}
{"id":"az-o72x","title":"Create OrchestrateHandlersService","description":"New service: src/services/keyboard/OrchestrateHandlersService.ts\n\nMethods:\n- `enterFromDetail()`: Get current detail overlay task, validate epic, load children with session state, call editor.enterOrchestrate()\n- `confirmSpawn()`: Get selected IDs from mode, validate non-empty, exit mode, emit spawn event, show toast\n\nDependencies: EditorService, BeadsClient, BoardService, SessionService, ToastService, OverlayService\n\nAdd to layer in service index.","notes":"üìé [mjbktf29-tf9a.png](.beads/images/az-o72x/mjbktf29-tf9a.png) (clipboard, 12/19/2025, 2:09:27 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:03.999509+11:00","updated_at":"2025-12-19T10:34:43.294016+11:00","closed_at":"2025-12-19T10:34:43.294016+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-o72x","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:23.992297+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-o72x","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:48.908342+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-o72x","depends_on_id":"az-ccvg","type":"blocks","created_at":"2025-12-19T01:43:49.461104+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-odr","title":"Fix Space+m merge workflow to prevent merge conflicts","description":"The Space+m (merge to main) workflow has repeatedly failed to prevent merge conflicts from reaching the main branch. This has happened multiple times, requiring manual conflict resolution.\n\n## Root Cause Analysis\nThe current `checkMergeConflicts` in PRWorkflow.ts only does a file-level overlap check (files modified on both branches). This doesn't catch actual content conflicts - Git only discovers those during the merge attempt.\n\n## What's Happening Now\n1. `checkMergeConflicts` compares file lists between branches\n2. If files overlap, shows a confirmation dialog\n3. User confirms (or no overlap detected), merge proceeds\n4. Git attempts merge and finds actual conflicts\n5. Conflicts land on main branch\n\n## Expected Behavior\nThe merge should NEVER introduce conflicts to main. If conflicts exist, they should be resolved in the worktree BEFORE the merge to main happens.\n\n## Proposed Solution\n1. **Perform a test merge first** - In the worktree, do `git fetch origin main \u0026\u0026 git merge --no-commit origin/main`\n2. **Check for conflicts** - If conflicts occur, abort the test merge and report them\n3. **Only proceed if clean** - If test merge succeeds, then push to main\n4. **Auto-abort on conflict** - If test merge has conflicts, abort it (`git merge --abort`) and show which files conflict\n\nThis ensures main always stays clean.","design":"## Implementation Plan\n\n### 1. Update PRWorkflow.checkMergeConflicts\nInstead of file list comparison, perform an actual test merge:\n\n```typescript\ncheckMergeConflicts = ({ beadId, projectPath }) =\u003e\n  Effect.gen(function* () {\n    const worktreePath = yield* getWorktreePath(beadId, projectPath)\n    \n    // Fetch latest main\n    yield* gitInWorktree(worktreePath, [\"fetch\", \"origin\", \"main\"])\n    \n    // Try merge with --no-commit to test\n    const result = yield* gitInWorktree(worktreePath, \n      [\"merge\", \"--no-commit\", \"--no-ff\", \"origin/main\"]\n    ).pipe(Effect.either)\n    \n    if (Either.isLeft(result)) {\n      // Get conflict list\n      const conflicts = yield* gitInWorktree(worktreePath, \n        [\"diff\", \"--name-only\", \"--diff-filter=U\"]\n      )\n      // Abort the test merge\n      yield* gitInWorktree(worktreePath, [\"merge\", \"--abort\"])\n      \n      return {\n        hasConflictRisk: true,\n        conflictingFiles: conflicts.split('\\n').filter(Boolean),\n        canAutoMerge: false\n      }\n    }\n    \n    // Clean test merge succeeded - abort it (we'll do real merge after)\n    yield* gitInWorktree(worktreePath, [\"merge\", \"--abort\"])\n    return { hasConflictRisk: false, conflictingFiles: [], canAutoMerge: true }\n  })\n```\n\n### 2. Update mergeToMain flow\n- If `checkMergeConflicts` shows conflicts, DO NOT proceed\n- Instead of confirmation dialog, show error with conflict file list\n- User must resolve conflicts manually in worktree first\n\n### 3. Files to modify\n- `src/core/PRWorkflow.ts` - Update checkMergeConflicts and mergeToMain\n- `src/services/keyboard/prHandlers.ts` - Update actionMergeToMain error handling","acceptance_criteria":"- [ ] Space+m always checks for actual conflicts before merging\n- [ ] If conflicts exist, merge is blocked (not just warned)\n- [ ] Error message shows which files conflict\n- [ ] Test merge is always aborted, never leaves worktree dirty\n- [ ] Clean merges proceed without extra confirmation\n- [ ] Main branch never has unresolved conflicts after Space+m","status":"closed","priority":1,"issue_type":"bug","assignee":"claude","created_at":"2025-12-17T17:00:52.211803+11:00","updated_at":"2025-12-18T02:14:02.594699+11:00","closed_at":"2025-12-18T02:10:35.262268+11:00","close_reason":"Complete: Space+m now (1) checks for actual conflicts via git merge-tree, (2) offers Claude-assisted resolution if conflicts detected, (3) only merges to main when clean. Main branch is protected from unresolved conflicts.","labels":["bug-fix","merge","workflow"],"comments":[{"id":3,"issue_id":"az-odr","author":"riordan","text":"Adding Claude-assisted conflict resolution feature","created_at":"2025-12-17T15:10:29Z"}],"deleted_at":"2025-12-18T02:14:02.594699+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"bug"}
{"id":"az-ofl","title":"have to allow claude permissions again in every worktree","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:26:49.402571+11:00","updated_at":"2025-12-15T10:58:08.359395+11:00","closed_at":"2025-12-15T10:58:08.359395+11:00"}
{"id":"az-om3","title":"WorktreeManager - git worktree lifecycle","description":"Manage git worktree creation, tracking, and cleanup for isolated task execution.","design":"- Define WorktreeManager as Effect.Service\n- Use @effect/platform Command for git operations (or simple-git if needed)\n- Naming: ../ProjectName-\u003cbead-id\u003e/\n- Methods return Effect with typed errors:\n  - create(beadId, baseBranch): Effect\u003cWorktree, GitError\u003e\n  - remove(beadId): Effect\u003cvoid, GitError | WorktreeNotFoundError\u003e\n  - list(): Effect\u003cWorktree[], GitError\u003e\n  - exists(beadId): Effect\u003cboolean, GitError\u003e\n- Use Effect.acquireRelease for cleanup guarantees\n- Track active worktrees in Ref\n- Handle epic vs task worktree sharing logic\n- Create WorktreeManagerLive and WorktreeManagerTest layers","notes":"Implemented WorktreeManager Effect service with:\n- Service interface with create, remove, list, exists, get methods\n- Error types: GitError, WorktreeNotFoundError, WorktreeExistsError, NotAGitRepoError\n- Idempotent create operation (safe to call multiple times)\n- Ref-based state tracking for active worktrees\n- Parses git worktree list --porcelain output\n- acquireRelease pattern via acquireWorktree for cleanup guarantees\n- Convenience functions for all operations\n- WorktreeManagerLive and WorktreeManagerLiveWithPlatform layers\n- Comprehensive example file with 7 usage patterns\n- Follows BeadsClient and TmuxService patterns\n- All type checks pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.585679+11:00","updated_at":"2025-12-11T18:03:13.741817+11:00","closed_at":"2025-12-11T18:03:13.741817+11:00","dependencies":[{"issue_id":"az-om3","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.224593+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-p4ds","title":"merging with space m doesnt always move bead to closed STILL","description":"we have tried to fix this twice already. please figure it out once and for all","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:41:56.573516+11:00","updated_at":"2025-12-18T16:11:36.045541+11:00","closed_at":"2025-12-18T16:11:29.944746+11:00","close_reason":"Fixed: BeadsClient now uses ProjectService.getCurrentPath() as default cwd, ensuring bd commands operate on correct database. Added projectPath to all update calls in PRWorkflow merge operations.","deleted_at":"2025-12-18T16:11:36.045541+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-p4wy","title":"add indication of git status in bead/worktree","description":"so in kanban card header we can see if the worktree is behind in commits and/or has uncommitted changes\nwould be cool to be able to see +- as a configurable option too","design":"## Implementation Plan\n\n### Goal\nAdd git status indicators to TaskCard headers for tasks with active sessions, showing:\n- `‚ÜìN` - commits behind the base branch (configurable, defaults to \"main\")\n- `‚óè` - uncommitted changes (dirty worktree)\n- `+X/-Y` - line changes (configurable option, off by default)\n\n### Architecture Decision\nUse the existing polling pattern in BoardService (2-second refresh cycle) to collect git status alongside merge conflict detection. This keeps git operations centralized and avoids per-card polling.\n\n### Components to Modify\n\n#### 1. Config Schema (`src/config/schema.ts`)\nAdd git status configuration:\n```typescript\ngitStatus: {\n  baseBranch: string  // defaults to \"main\"\n  showLineChanges: boolean  // +X/-Y stats, defaults to false\n}\n```\n\n#### 2. UI Types (`src/ui/types.ts`)\nExtend `TaskWithSession` interface:\n```typescript\n// Git status for worktree (only populated for active sessions)\ngitBehindCount?: number      // commits behind base branch\nhasUncommittedChanges?: boolean  // dirty worktree\ngitAdditions?: number        // lines added (if showLineChanges enabled)\ngitDeletions?: number        // lines deleted (if showLineChanges enabled)\n```\n\n#### 3. BoardService (`src/services/BoardService.ts`)\nAdd git status check alongside existing `checkMergeConflict`:\n- `checkGitStatus(worktreePath, baseBranch, showLineChanges)` - returns git status info\n- Call during task loading for active sessions only\n- Uses `git rev-list` for behind count, `git status --porcelain` for dirty check\n- Uses `git diff --stat` for line changes (when enabled)\n\n#### 4. TaskCard (`src/ui/TaskCard.tsx`)\nAdd indicators to header line after existing indicators:\n- Git behind: `‚Üì3` (yellow when behind)\n- Dirty: `‚óè` (red dot)\n- Line changes: `+42/-15` (green/red, only if configured)\n\n### Git Commands\n```bash\n# Behind count: how many commits we're behind the base branch\ngit rev-list --count HEAD..origin/main\n\n# Dirty check (has uncommitted changes)\ngit status --porcelain  # non-empty = dirty\n\n# Line stats (when showLineChanges enabled)\ngit diff --stat HEAD  # parse for insertions/deletions\n```\n\n### Performance Considerations\n- Git operations run only for active sessions (not all tasks)\n- Leverages existing 2-second polling cycle\n- Git commands are fast (\u003c50ms each) and run in parallel\n- Could add caching if needed, but likely unnecessary given scope","acceptance_criteria":"1. TaskCard header shows `‚ÜìN` indicator when worktree is behind base branch\n2. TaskCard header shows `‚óè` (red) when worktree has uncommitted changes\n3. `+X/-Y` line stats shown when configured (off by default)\n4. Base branch is configurable in project config (defaults to \"main\")\n5. Indicators only appear for tasks with active sessions (has worktree)\n6. No performance regression - git checks run in parallel during existing polling cycle\n7. Type-safe: all new fields properly typed in TaskWithSession","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T03:33:32.965755+11:00","updated_at":"2025-12-21T03:36:43.293504+11:00"}
{"id":"az-ph1","title":"Add agent phase detection and display","description":"Detect and display Claude agent phases (Planning/Action/Verification) on TaskCards. Parse Claude output patterns to identify current phase and show visual indicator.\n\nInspiration: AutoMaker shows phase status on cards with Planning ‚Üí Action ‚Üí Verification workflow.\n\nImplementation:\n1. Extend StateDetector to detect phase transitions from output patterns\n2. Add phase field to session state (idle/planning/implementing/testing/done)\n3. Display phase badge/indicator on TaskCard when session is active\n4. Update phase in real-time as output is parsed","notes":"Explored codebase. Key files:\n- StateDetector.ts: Pattern-based detection, returns SessionState (idle/busy/waiting/done/error)\n- types.ts: SessionState, SessionMetrics, TaskWithSession, SESSION_INDICATORS\n- TaskCard.tsx: Shows indicator from SESSION_INDICATORS, has header line with id/type/indicator\n- DetailPanel.tsx: Shows session metrics when active\n\nImplementation plan:\n1. Add AgentPhase type and PHASE_INDICATORS to types.ts\n2. Add agentPhase field to SessionMetrics interface\n3. Extend StateDetector with phase detection patterns\n4. Update TaskCard to show phase indicator\n5. Update DetailPanel to show phase in metrics section","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T12:00:00Z","updated_at":"2025-12-17T17:22:20.767381+11:00","closed_at":"2025-12-17T17:22:20.767385+11:00"}
{"id":"az-pn6","title":"StatusBar component","description":"Bottom status bar showing available actions and system status.","design":"- Fixed position at bottom\n- Show available keybindings for current context\n- Show connection status, sync status\n- Show count of running sessions\n- Responsive to terminal width","notes":"Enhanced StatusBar component with:\n1. Connection/sync status indicator (‚óè connected, ‚óã disconnected) using theme colors\n2. Responsive terminal width handling - hides keybinds \u003c100 cols, mode display \u003c80 cols, selected count \u003c60 cols\n3. Project name 'azedarach' displayed on left with bold styling\n4. Improved visual hierarchy using Catppuccin theme colors (green for connected, overlay0 for disconnected)\n5. Added optional 'connected' prop to StatusBarProps (defaults to true)\n6. Type-safe implementation - pnpm type-check passes with no errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:07.987695+11:00","updated_at":"2025-12-12T01:29:02.416939+11:00","closed_at":"2025-12-12T01:29:02.416939+11:00","dependencies":[{"issue_id":"az-pn6","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.038999+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-pnx","title":"Configuration system with @effect/schema and Effect Config","description":"User configuration loading and validation.","design":"- Use Effect's built-in Config module for configuration\n- Use @effect/schema for config file validation (replaces zod)\n- Define ConfigSchema with Schema.Struct for type-safe config\n- Config sections: terminal, worktree, session, completion, notifications, patterns\n- Support multiple sources via Config.withDefault and Config.nested:\n  - Environment variables (AZEDARACH_*)\n  - Config files (.azedarach.json, .azedarachrc)\n  - package.json \"azedarach\" key\n- Create ConfigLive layer that loads and validates config\n- Sensible defaults for all options via Schema.withDefault","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.673276+11:00","updated_at":"2025-12-12T17:24:13.126088+11:00","closed_at":"2025-12-12T17:24:13.126088+11:00","dependencies":[{"issue_id":"az-pnx","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.015922+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-pza","title":"TUI \u0026 Interaction","description":"Ink-based terminal UI: Kanban board, keyboard navigation, session attachment, and user interaction flows.","notes":"Session 2025-12-12:\n\nEPIC PROGRESS: 6/7 tasks completed (86%)\n\nCOMPLETED CHILDREN:\n- az-hri: Basic Kanban board ‚úÖ\n- az-mq9: effect-atom SolidJS adapter ‚úÖ\n- az-t4t: Keyboard navigation (Helix-style) ‚úÖ\n- az-pn6: StatusBar component ‚úÖ\n- az-g19: Terminal attachment (external) ‚úÖ\n- az-srh: Detail view panel ‚úÖ\n\nREMAINING:\n- az-stv: Task actions (start/attach/pause/resume) - NOW UNBLOCKED\n  - Depends on SessionManager (az-xi5) which is now complete\n  - This is the final task to wire session lifecycle to TUI\n\nPHASE 2 STATUS:\nTUI is fully functional with all navigation, selection, task movement, and viewing features. Only session lifecycle integration remains.\n\nNEXT SESSION:\n- Complete az-stv to close this epic\n- Wire SessionManager.start/stop/pause/resume to keyboard actions\n- Add visual feedback for session states in TaskCard","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.871997+11:00","updated_at":"2025-12-12T10:54:04.23523+11:00","closed_at":"2025-12-12T10:54:04.23523+11:00"}
{"id":"az-q5c","title":"Test bead for output check","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:23:49.203815+11:00","updated_at":"2025-12-15T01:24:28.486686+11:00","closed_at":"2025-12-15T01:24:28.486686+11:00"}
{"id":"az-qmg","title":"instead of using an extra line to underline column headers just use underlined ascii characters maybe?","description":"","notes":"Starting work - will use text underline attribute instead of separate line","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T12:57:11.332088+11:00","updated_at":"2025-12-17T00:44:19.692037+11:00","closed_at":"2025-12-17T00:44:19.692037+11:00"}
{"id":"az-qmo","title":"Add stop session action (Space+x)","description":"No way to stop/kill a running session from the TUI. Need Space+x to kill tmux session and mark task as idle.","design":"- Add stopSessionAtom using runtime.fn calling SessionManager.stop\n- Wire Space+x in action mode to call stopSession(task.id)\n- Confirm before stopping? Or just stop immediately\n- Show success toast 'Stopped session for {id}'\n- Refresh tasks after stop","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:42:23.169998+11:00","updated_at":"2025-12-12T11:43:10.52549+11:00","closed_at":"2025-12-12T11:43:10.52549+11:00"}
{"id":"az-r9u","title":"looks like there is hidden bead that doesnt quite fit in the screen","description":"our screen size calc must be off","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:26:58.321424+11:00","updated_at":"2025-12-16T21:36:22.5216+11:00","closed_at":"2025-12-16T21:36:22.5216+11:00"}
{"id":"az-re74","title":"we need to copy .direnv not just when creating sessions for claude but also for diffing etc","description":"","design":"...","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:34.817831+11:00","updated_at":"2025-12-19T14:13:45.741312+11:00","closed_at":"2025-12-19T14:13:45.741314+11:00"}
{"id":"az-riua","title":"i just tried to create a bead in non default project but it got created in az project (default)","description":"","notes":"FIX ACTUALLY IMPLEMENTED NOW:\n\nRoot cause: BeadsClient methods used cwd parameter directly. When not provided, bd ran in process.cwd() (where az was launched) instead of the currently selected project.\n\nFix applied:\n1. Added ProjectService as dependency to BeadsClient\n2. Created getEffectiveCwd() helper that returns explicit cwd OR current project path from ProjectService  \n3. Updated ALL BeadsClient methods (list, show, update, close, sync, syncImportOnly, recoverTombstones, ready, search, create, delete) to use getEffectiveCwd()\n\nNow when you switch projects in the TUI, bd commands execute in the correct project directory.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T14:34:45.119326+11:00","updated_at":"2025-12-18T16:24:50.296416+11:00","closed_at":"2025-12-18T16:24:50.29642+11:00","deleted_at":"2025-12-18T15:09:33.893295+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-rk6i","title":"something went wrong with space r dev server in ~/prog/Chefy","description":"When using Space+r to start a dev server in a worktree, the NX project fails with \"Failed to process project graph\" because node_modules doesn't exist in the worktree.\n\n**Root Cause:** Git worktrees share `.git` but NOT `node_modules/`. Each worktree needs its own `pnpm install` before the dev server can run.\n\n**Evidence:** User manually ran `pnpm i \u0026\u0026 pnpm dev` in the tmux session and it worked fine.","design":"## Implementation Plan\n\n### Solution: Auto-install dependencies before starting dev server\n\nIn `DevServerService.ts`, before running the dev command:\n\n1. **Check if node_modules exists** in the worktree\n2. **If missing, run package manager install** (`pnpm install`, `npm install`, etc.)\n3. **Show progress** via toast notification (\"Installing dependencies...\")\n4. **Then proceed** with the normal dev server startup\n\n### Code Changes\n\n**File:** `src/services/DevServerService.ts`\n\nAdd a new helper function:\n```typescript\nconst ensureDependencies = (worktreePath: string): Effect.Effect\u003cvoid, DevServerError, CommandExecutor.CommandExecutor\u003e =\u003e\n  Effect.gen(function* () {\n    const nodeModulesPath = pathService.join(worktreePath, \"node_modules\")\n    const exists = yield* fs.exists(nodeModulesPath).pipe(Effect.catchAll(() =\u003e Effect.succeed(false)))\n    \n    if (!exists) {\n      yield* Effect.log(`node_modules not found in ${worktreePath}, installing dependencies...`)\n      const pm = yield* detectPackageManager(worktreePath)\n      const installCmd = pm === \"bun\" ? \"bun install\" : `${pm} install`\n      \n      // Run install in the worktree directory\n      yield* runInstallCommand(worktreePath, installCmd)\n    }\n  })\n```\n\nCall `ensureDependencies(worktreePath)` in both `start()` and `toggle()` methods, right after verifying the worktree exists.\n\n### Alternative Considered\n\nCould add a separate \"install dependencies\" action (Space+i), but auto-install is better UX - users expect Space+r to \"just work\".","acceptance_criteria":"- [ ] Space+r on a fresh worktree automatically runs `pnpm install` (or npm/yarn/bun) first\n- [ ] Toast shows \"Installing dependencies...\" while install runs\n- [ ] After install completes, dev server starts normally\n- [ ] If install fails, show error toast with details\n- [ ] Works with all package managers (pnpm, npm, yarn, bun)","notes":"## Implementation Complete ‚úÖ\n\n### Root Cause\nWhen using Space+r to start a dev server in an 11-hour-old worktree, dependencies had drifted since session creation. The initCommands (including `pnpm install`) only ran at session start (Space+s), not when the dev server started (Space+r).\n\n### Solution\nDevServerService now runs initCommands before starting the dev server, ensuring dependencies are synced even if they changed since session creation.\n\n### Changes Made\n1. **Created `src/core/initCommands.ts`** - Reusable helper for running worktree init commands\n2. **Updated `DevServerService.start()` and `toggle()`** - Now run initCommands before starting dev server\n3. **Created `src/core/WorktreeSessionService.ts`** - Generic tmux session service for future use\n4. **Renamed `SessionManager` ‚Üí `ClaudeSessionManager`** - Clearer name for Claude-specific session management\n5. **Fixed error handling in keyboard bindings** - Dev server errors now show toast instead of propagating\n\n### Testing\n- ‚úÖ Type-check passes\n- ‚úÖ Build passes\n\n### Future Improvement\nClaudeSessionManager and DevServerService could be refactored to use WorktreeSessionService to reduce code duplication.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T00:25:00.079304+11:00","updated_at":"2025-12-20T03:19:19.344939+11:00","closed_at":"2025-12-20T03:19:19.344942+11:00"}
{"id":"az-rmz1","title":"goto word (gw) not going to the right task","description":"i pressed ak and it didnt go to ak","design":"## Root Cause\n\nThe `computeJumpLabels()` function in `InputHandlersService.ts` uses `board.getTasksByColumn()` which returns:\n- **Unsorted** tasks (ignores sortConfig)\n- **Unfiltered** tasks (ignores search query)\n- **Record\u003cstring, Task[]\u003e** keyed by status string\n\nBut the UI renders using `filteredTasksByColumn` (via `drillDownFilteredTasksAtom`) which:\n- Applies search filtering\n- Applies sorting\n- Applies drill-down epic filtering\n- Returns `TaskWithSession[][]` indexed by column position\n\nThis mismatch means the label `ak` might be assigned to task X in `computeJumpLabels`, but task Y is visually in that position in the rendered board.\n\n## Implementation Plan\n\n1. **Modify `computeJumpLabels()` in `InputHandlersService.ts`**:\n   - Get search query and sortConfig from EditorService\n   - Use `board.getFilteredTasksByColumn(searchQuery, sortConfig)` instead of `board.getTasksByColumn()`\n   - Apply drill-down filtering (check NavigationService for drillDownChildIds)\n   - Iterate the array directly by index (no longer keyed by status string)\n\n2. **Code changes**:\n   - Change `tasksByColumn[col.status]` to `tasksByColumn[colIdx]`\n   - Add EditorService and NavigationService dependency usage\n   - Add drill-down child filtering to match what UI renders\n\n## Files to Modify\n\n- `src/services/keyboard/InputHandlersService.ts` (computeJumpLabels function, lines 580-611)","notes":"üìé [mjbktzs7-qh5v.png](.beads/images/az-rmz1/mjbktzs7-qh5v.png) (clipboard, 12/19/2025, 2:09:54 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T02:09:11.966491+11:00","updated_at":"2025-12-19T10:31:32.356707+11:00","closed_at":"2025-12-19T10:31:32.356707+11:00","close_reason":"Fixed computeJumpLabels to use filtered/sorted tasks matching what the board displays. The bug was that it used getTasksByColumn() (unsorted, unfiltered Record) instead of getFilteredTasksByColumn() with drill-down filtering applied.","deleted_at":"2025-12-19T02:15:58.655309+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-s1n","title":"add a pre tool use hook to prevent type casting like we have in ~/prog/Chefy","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:45:55.42323+11:00","updated_at":"2025-12-18T02:14:02.599709+11:00","closed_at":"2025-12-17T17:08:36.020343+11:00","close_reason":"Added pre-edit-type-safety.cjs hook that blocks Edit/Write operations containing type casting anti-patterns (as Type, as any, : any). Hook is registered in settings.json under PreToolUse.","deleted_at":"2025-12-18T02:14:02.599709+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-shf","title":"when a bead action is occurring such as space S, disable further actions from being taken on that bead until its idle again","description":"","notes":"Starting implementation. Strategy:\n1. Create taskQueueInfoAtom for reactive queue state\n2. Add isBusy check to ActionPalette isAvailable()\n3. Add busy guard to handlers that use withQueue\n4. Show running operation label in toast when blocked","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:04:50.355647+11:00","updated_at":"2025-12-18T02:14:02.603551+11:00","closed_at":"2025-12-17T17:30:22.984791+11:00","close_reason":"Implemented bead action busy guard:\n\n1. Added `checkBusy()` helper to HandlerContext - checks if task has running operation, shows toast if busy\n2. Applied guard to all queued handlers: startSession, startSessionWithPrompt, stopSession, createPR, mergeToMain, cleanup\n3. ActionPalette now dims queued actions when busy and shows \"‚è≥ {operation}...\" indicator\n4. Created focusedTaskRunningOperationAtom for reactive UI updates\n\nUsers now see clear feedback when actions are blocked and cannot trigger duplicate operations on the same bead.","deleted_at":"2025-12-18T02:14:02.603551+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-shv","title":"Error toast notifications in TUI","description":"Show dismissible error toasts when actions fail (e.g., attach to non-existent session, start on non-idle task). Currently errors only go to console.error which users don't see.","design":"- Toast component: fixed position, auto-dismiss after 5s or on keypress\n- Error state atom: Array\u003c{id, message, timestamp}\u003e\n- Show in StatusBar area or floating overlay\n- Red background with error icon\n- Queue multiple errors, show oldest first","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T10:59:23.087691+11:00","updated_at":"2025-12-12T11:07:55.898746+11:00","closed_at":"2025-12-12T11:07:55.898746+11:00"}
{"id":"az-srh","title":"Detail view for selected task","description":"Expandable detail panel showing full task information.","design":"- Toggle with Enter or Tab on selected task\n- Show: title, description, design notes, acceptance criteria\n- Show: dependencies, PR link if exists\n- Show: recent session output (last N lines)\n- Show: available actions for current state","notes":"Implementation complete. Created DetailPanel.tsx component that shows full task details in a modal overlay. Added Enter key handler in normal mode to toggle the detail view. Updated HelpOverlay to document the Enter key. Component displays: task ID, type, priority, status, session state, description, design notes, notes, timestamps, and available actions based on task state. Follows same overlay pattern as HelpOverlay with semi-transparent background and centered box using Catppuccin theme colors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:08.103114+11:00","updated_at":"2025-12-12T10:32:33.95362+11:00","closed_at":"2025-12-12T10:32:33.95362+11:00","dependencies":[{"issue_id":"az-srh","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.178011+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-ssm","title":"i tried az in Chefy and for some reason the cursor got lost after i sorted by updated","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:49:22.39364+11:00","updated_at":"2025-12-15T14:06:56.110719+11:00","closed_at":"2025-12-15T14:06:56.110719+11:00"}
{"id":"az-stv","title":"Task actions: start, attach, pause, resume","description":"Implement keyboard shortcuts for task lifecycle actions.","design":"- Enter: start task (create worktree, spawn Claude)\n- a: attach to running session (opens external terminal)\n- A: attach inline (TUI shows session output)\n- p: pause session (interrupt, WIP commit)\n- r: resume paused session\n- Validate action is valid for current task state","notes":"Session 2025-12-12:\n\nNOW UNBLOCKED - All dependencies completed:\n- az-xi5 (SessionManager): ‚úÖ Closed - full orchestration service\n- az-t4t (Keyboard navigation): ‚úÖ Closed - Helix-style modal keybindings\n\nIMPLEMENTATION PLAN:\n1. Wire SessionManager to Action mode commands:\n   - Space+s: SessionManager.start() - create worktree + spawn Claude\n   - Space+a: Already done (AttachmentService.attachExternal)\n   - Space+p: SessionManager.pause() - Ctrl+C + WIP commit\n   - Space+r: SessionManager.resume() - reattach to paused session\n\n2. Update TaskCard to show live session state:\n   - Use SessionManager.subscribeToStateChanges() PubSub\n   - Update sessionState in TaskWithSession reactively\n   - Already have session indicators: üîµüü°‚úÖ‚ùå‚è∏Ô∏è\n\n3. Validate action availability:\n   - 's' only on idle tasks\n   - 'a' only on busy/waiting tasks\n   - 'p' only on busy tasks\n   - 'r' only on paused tasks\n\nDEPENDENCIES NOW MET:\n- SessionManager: src/core/SessionManager.ts\n- WorktreeManager: src/core/WorktreeManager.ts\n- TmuxService: src/core/TmuxService.ts\n- StateDetector: src/core/StateDetector.ts\n\nFILES TO MODIFY:\n- src/ui/App.tsx - Add action handlers for s/p/r\n- src/ui/atoms.ts - Add session lifecycle effects\n- src/ui/TaskCard.tsx - May need state subscription","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.880144+11:00","updated_at":"2025-12-12T10:53:49.478801+11:00","closed_at":"2025-12-12T10:53:49.478801+11:00","dependencies":[{"issue_id":"az-stv","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.920801+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-stv","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.054522+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-stv","depends_on_id":"az-t4t","type":"blocks","created_at":"2025-12-11T14:46:28.161361+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-t14x","title":"epic drill down bug","description":"as soon as i pressed enter on an epic this error appeared","design":"## Root Cause (Verified via Source Code)\n\nThe issue was **nested `\u003ctext\u003e` elements**, caused by a misunderstanding of OpenTUI's component hierarchy.\n\n### OpenTUI Component Types:\n- `\u003ctext\u003e` ‚Üí `TextRenderable` (container component)\n- `\u003cspan\u003e` ‚Üí `SpanRenderable` ‚Üí `TextNodeRenderable` (inline text node)\n\n### Why Nested `\u003ctext\u003e` Fails:\n`TextRenderable.add()` only accepts: `TextNodeRenderable | StyledText | string`\n\nWhen you write `\u003ctext\u003e\u003ctext\u003e...\u003c/text\u003e\u003c/text\u003e`:\n- Inner `\u003ctext\u003e` creates a `TextRenderable`\n- Parent's `add()` rejects it (wrong type!)\n\n### Correct Patterns:\n\n**Option 1: Use `\u003cspan\u003e` for nested styling**\n```tsx\n\u003ctext fg={theme.gray}\u003e\n    \u003cspan fg={theme.blue}\u003e‚Üí\u003c/span\u003e Back\n\u003c/text\u003e\n```\n\n**Option 2: Use `\u003cbox flexDirection=\"row\"\u003e` with sibling `\u003ctext\u003e`**\n```tsx\n\u003cbox flexDirection=\"row\"\u003e\n    \u003ctext fg={theme.blue}\u003e‚Üí\u003c/text\u003e\n    \u003ctext fg={theme.gray}\u003e Back\u003c/text\u003e\n\u003c/box\u003e\n```\n\n## Fix Applied\nUsed Option 2 (`\u003cbox\u003e` with siblings) for both the back hint and progress sections.\n\n## Documentation\nAdded rule #10 to CLAUDE.md explaining OpenTUI text nesting constraints.\n\n## Files Changed\n- `src/ui/EpicHeader.tsx` - Flatten nested `\u003ctext\u003e` using `\u003cbox flexDirection=\"row\"\u003e`\n- `CLAUDE.md` - Added rule #10 documenting OpenTUI text nesting","notes":"üìé [mjbjp6e6-bkdv.png](.beads/images/az-t14x/mjbjp6e6-bkdv.png) (clipboard, 12/19/2025, 1:38:10 AM)\nüìé [mjbjxvwp-8ur6.png](.beads/images/az-t14x/mjbjxvwp-8ur6.png) (clipboard, 12/19/2025, 1:44:56 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:38:08.065373+11:00","updated_at":"2025-12-19T02:23:16.769431+11:00","closed_at":"2025-12-19T02:23:16.769431+11:00","close_reason":"Merged to main: Fixed nested text element error in EpicHeader by using box layout with sibling text elements","deleted_at":"2025-12-19T02:15:58.661233+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-t47j","title":"add a space [something] command to break up a task into an epic","description":"make the tasks parallizable as possible, etc","design":"## Implementation Plan: Space+b \"Break into Epic\" Command\n\n### Overview\nAdd a `Space+b` keybinding that converts a task into an epic and uses Claude AI to suggest parallelizable child tasks.\n\n### Architecture\n\n**Key Decision: Convert In-Place**\n- Original task becomes the epic (type changes from task ‚Üí epic)\n- Title and description are preserved\n- Uses Claude to analyze the task and suggest child tasks for parallelization\n\n**Flow:**\n1. User selects a task and presses `Space+b`\n2. Validate: task must not already be an epic\n3. Overlay shows loading state while Claude analyzes\n4. Claude suggests child tasks with titles and brief descriptions\n5. User confirms/edits suggestions\n6. On confirm:\n   - Update original task's type to \"epic\"\n   - Create each child task via BeadsClient.create()\n   - Link children to epic via addDependency(child, epic, \"parent-child\")\n   - Refresh board, enter drill-down view for the new epic\n\n### Components to Create/Modify\n\n1. **New Overlay Type** (`OverlayService.ts`)\n   - Add `breakIntoEpic` overlay variant with state for AI suggestions\n\n2. **New Overlay Component** (`src/ui/BreakIntoEpicOverlay.tsx`)\n   - Shows task title being converted\n   - Loading state while Claude analyzes\n   - Editable list of suggested child tasks\n   - Confirm/Cancel buttons\n\n3. **New Handler Service** (`src/services/keyboard/EpicHandlersService.ts`)\n   - `breakIntoEpic()` - orchestrates the conversion\n   - Uses Claude to analyze task and suggest subtasks\n\n4. **Claude Integration** (use existing patterns or create)\n   - Prompt Claude with task title + description\n   - Request: suggest parallelizable subtasks\n   - Parse response into structured task list\n\n5. **Keybinding** (`bindings.ts`)\n   - Add `{ key: \"b\", mode: \"action\", ... }` for break into epic\n\n6. **ActionPalette Update** (`ActionPalette.tsx`)\n   - Add \"b\" action line\n   - Only available when selected task is not an epic\n\n### Parallelization Notes\n- Claude suggestion + user confirmation happens in overlay (blocking interaction)\n- Child task creation can be parallelized with `Effect.all(tasks.map(...))`\n- Board refresh happens once after all children created\n\n### Testing\n- Verify only non-epic tasks show action available\n- Verify Claude suggestions are reasonable\n- Verify children are correctly linked to epic\n- Verify drill-down shows new children","notes":"## Implementation Complete\n\n### Files Modified\n- `src/services/OverlayService.ts` - Added `breakIntoEpic` overlay type and `SuggestedChildTask` interface\n- `src/ui/hooks/useOverlays.ts` - Added `showBreakIntoEpic` helper and `showingBreakIntoEpic` flag\n- `src/ui/atoms/overlay.ts` - Added `breakIntoEpic` to pushOverlayAtom type union\n- `src/ui/atoms/task.ts` - Added `fetchBreakIntoEpicSuggestionsAtom` and `executeBreakIntoEpicAtom`\n- `src/ui/atoms/index.ts` - Exported new atoms\n- `src/ui/BreakIntoEpicOverlay.tsx` - New overlay component for Claude-powered task breakdown\n- `src/services/keyboard/bindings.ts` - Added Space+b keybinding\n- `src/ui/ActionPalette.tsx` - Added 'b' action to palette\n- `src/ui/App.tsx` - Wired up overlay rendering and keyboard bypass\n\n### User Flow\n1. Select a non-epic task\n2. Press Space to enter action mode\n3. Press 'b' to break into epic\n4. Claude analyzes task and suggests parallelizable child tasks\n5. Review suggestions (j/k to navigate)\n6. Press Enter to confirm or Esc to cancel\n7. Child tasks are created and linked via parent-child dependency\n8. Board refreshes and enters drill-down view for the new epic\n\n### Key Decisions\n- Used Claude Haiku model for speed (30s timeout)\n- Child tasks created in parallel via `Effect.all({ concurrency: \"unbounded\" })`\n- Parent task retains original type (bd doesn't support type changes); children linked via parent-child dependency\n- Overlay handles its own keyboard input (standard pattern)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T17:19:48.668591+11:00","updated_at":"2025-12-21T01:49:50.778666+11:00","closed_at":"2025-12-21T01:49:50.778666+11:00","close_reason":"Implemented Space+b command that uses Claude AI to break a task into an epic with parallelizable child tasks. Build and type-check pass."}
{"id":"az-t4t","title":"Keyboard navigation (vim-style)","description":"Implement vim-style keyboard navigation for the Kanban board.","design":"- Use OpenTUI's input handling (onKeyPress or similar)\n- SolidJS signals for tracking selection state:\n  - selectedColumn: Accessor\u003cnumber\u003e\n  - selectedTask: Accessor\u003cnumber\u003e\n- h/‚Üê, l/‚Üí: navigate columns (setSelectedColumn)\n- j/‚Üì, k/‚Üë: navigate tasks within column (setSelectedTask)\n- Visual highlight via conditional styling\n- Wrap navigation at boundaries (or stop)\n- Create useKeyboardNavigation hook for reusability","notes":"Session 2025-12-11 (evening):\n\nCOMPLETED:\n- Full Helix-style modal keybinding system implemented\n- Normal mode: hjkl navigation, g‚Üígoto, v‚Üíselect, Space‚Üíaction menu\n- Goto mode: gw shows 2-char jump labels (home row keys), gg/ge first/last, gh/gl column ends\n- Select mode: multi-selection via Space toggle, hjkl navigation\n- Action mode: h/l moves task(s) to adjacent column (updates status via bd CLI)\n- Ctrl-d/Ctrl-u half-page scrolling\n- Catppuccin Mocha theme colors\n- Virtual scrolling: columns show maxVisible tasks based on terminal height\n- StatusBar shows mode (NOR/SEL/GTO/ACT) with contextual keybind hints\n\nFILES MODIFIED:\n- src/ui/types.ts - Added EditorMode, GotoSubMode, JumpTarget types, generateJumpLabels()\n- src/ui/App.tsx - Full modal state machine, keyboard handling, terminal height calculation\n- src/ui/Board.tsx - Added activeTaskIndex, terminalHeight props\n- src/ui/Column.tsx - Virtual scrolling with scroll indicators\n- src/ui/TaskCard.tsx - Simplified to avoid OpenTUI fragment bugs\n- src/ui/StatusBar.tsx - Mode indicator + contextual keybinds per mode\n- src/ui/theme.ts - Catppuccin Mocha color palette\n- src/ui/atoms.ts - moveTaskEffect, moveTasksEffect for task movement\n- README.md - Comprehensive Helix-style keybinding documentation\n\nISSUES FIXED:\n- client.ready() only returned open/unblocked tasks - changed to client.list()\n- OpenTUI JSX fragments caused rendering corruption - use single text elements\n- Column overflow - implemented virtual scrolling\n\nREMAINING:\n- Some minor rendering artifacts in first column (title-only cards occasionally)\n- Action mode only implements h/l (move) - s/a/p/r/d/P not yet implemented\n\nNEXT STEPS:\n- Could close this bead - core vim-style navigation is complete\n- Action mode commands (start session, attach, etc.) belong in az-stv (Task actions)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.772639+11:00","updated_at":"2025-12-11T23:49:35.046226+11:00","closed_at":"2025-12-11T23:49:35.046226+11:00","dependencies":[{"issue_id":"az-t4t","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.800764+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-t4t","depends_on_id":"az-hri","type":"blocks","created_at":"2025-12-11T14:46:26.269114+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-tgc","title":"Agent Mail configuration and environment","description":"Add configuration support for Agent Mail settings.\n\nDesign:\n- Environment variables:\n  - BEADS_AGENT_MAIL_URL (optional)\n  - BEADS_AGENT_NAME (defaults to hostname or generated)\n  - BEADS_PROJECT_ID (defaults to git remote or project path hash)\n- Config service using @effect/platform Config\n- Validation with @effect/schema\n- Auto-detect if Agent Mail server is available\n- CLI flag --agent-mail-url to override\n- Show Agent Mail status in TUI StatusBar","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.864792+11:00","updated_at":"2025-12-12T10:33:13.864792+11:00","dependencies":[{"issue_id":"az-tgc","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.905172+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-tgj","title":"Shift-D delete bead not working - reports \"no worktree to delete\"","description":"When pressing Space -\u003e Shift-D to delete a bead, the wrong action fires. The keyboard library reports event.name as lowercase even when shift is held, so case \"D\" never matches - it falls through to case \"d\" (cleanup worktree).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.746846+11:00","updated_at":"2025-12-14T21:43:51.026071+11:00","closed_at":"2025-12-14T21:43:51.026071+11:00"}
{"id":"az-tsf","title":"sometimes i have to bd init when i create a worktree and attach to the session with az","description":"i assume its to do with the fact the new session has to wait for direnv (with flake) to setup the env. maybe we need to increase a timeout somewhere?","notes":"Root cause identified: tmux session uses `bash -c` which bypasses direnv shell hooks. Fix: wrap claude command with `direnv exec .` to explicitly load environment before starting Claude.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:01:38.873045+11:00","updated_at":"2025-12-16T22:11:39.827838+11:00","closed_at":"2025-12-16T22:11:39.827838+11:00"}
{"id":"az-tx5","title":"where are merged beads going? after space m they disappear","description":"","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-17T17:28:25.188775+11:00","updated_at":"2025-12-19T10:36:07.922514+11:00","deleted_at":"2025-12-19T10:36:07.922514+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-tz9","title":"when an operation is happening on a bead such as a merge we should show an indication on board","description":"e.g. show a loading spinner on the bead card itself (top right maybe)","notes":"Implemented operation indicators on task cards.\n\nChanges:\n1. Added `taskRunningOperationAtom(taskId)` in atoms.ts - parameterized atom that subscribes to CommandQueueService state for any task\n2. Updated TaskCard.tsx to show operation indicators (‚è≥ for merge/create-pr, üßπ for cleanup, ‚ö° for start, ‚èπÔ∏è for stop)\n3. Updated CompactView.tsx with same indicator support for compact mode\n\nThe indicators appear in the header line after session/phase indicators when an async operation is running on the bead.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:42:47.237644+11:00","updated_at":"2025-12-18T13:18:36.213579+11:00","closed_at":"2025-12-18T13:18:36.213582+11:00","close_reason":"Implemented operation indicators on task cards - shows when merge, cleanup, start, stop operations are running","deleted_at":"2025-12-18T12:39:42.060737+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-u9t","title":"when i start a session it moves in the list","description":"when i press space s to start a tmux session for a bead it moves in the list due to sorting i guess and sometimes this moves it out of view","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:25:41.450657+11:00","updated_at":"2025-12-16T21:29:29.243055+11:00","closed_at":"2025-12-16T21:29:29.243055+11:00"}
{"id":"az-ufgi","title":"i dont see o as an option in normal mode bottom bar in epic drill down","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:39:43.508204+11:00","updated_at":"2025-12-19T11:39:43.508204+11:00"}
{"id":"az-uiid","title":"make sure processes like space m merge are uninterruptible so that pressing q to close awaits them","description":"","design":"## Problem\n\nWhen the user presses `q` to quit while a merge operation (Space+m) is running, the app calls `process.exit(0)` immediately. This can interrupt the merge mid-execution, leaving the git repository in an inconsistent state.\n\n## Current Architecture\n\n1. **Quit handler** (`src/services/keyboard/bindings.ts:179-191`):\n   - Checks if in drill-down mode (exits drill-down instead)\n   - Otherwise calls `process.exit(0)` immediately\n   - **No check for running operations**\n\n2. **CommandQueueService** (`src/services/CommandQueueService.ts`):\n   - Manages per-task FIFO command queues\n   - Has `isBusy(taskId)` to check if a single task has running operations\n   - Uses `Effect.forkIn(fiber, serviceScope)` so fibers live for service lifetime\n   - **Missing**: Global `isAnyBusy()` to check across all tasks\n\n3. **Merge operation** (`src/services/keyboard/PRHandlersService.ts`):\n   - Enqueues via `helpers.withQueue(beadId, \"merge\", ...)`\n   - Runs as a queued Effect, can take several minutes\n\n## Implementation Plan\n\n### Step 1: Add `isAnyBusy()` to CommandQueueService\n\nAdd a new method that iterates all task queues and returns true if ANY has running/queued commands:\n\n```typescript\nisAnyBusy: (): Effect.Effect\u003cboolean, never, never\u003e =\u003e\n  Effect.gen(function* () {\n    const state = yield* SubscriptionRef.get(stateRef)\n    return HashMap.reduce(state, false, (acc, taskState) =\u003e\n      acc || taskState.running !== null || taskState.queue.length \u003e 0\n    )\n  }),\n```\n\n### Step 2: Modify quit handler to await running operations\n\nChange the `q` binding to:\n1. Check `CommandQueueService.isAnyBusy()`\n2. If busy, show a toast notification explaining what's running\n3. Set a \"pending quit\" flag and return (don't exit yet)\n4. When all operations complete, the app will exit\n\nOR simpler approach:\n1. Check `isAnyBusy()`\n2. If busy, show toast \"Cannot quit while operations are running\" and block quit\n3. User must wait for operation to complete or can force-quit with Ctrl+C\n\n### Step 3: Add convenience function\n\nExport `isAnyBusy` as a convenience function like existing `getQueueInfo`.\n\n## Files to Modify\n\n1. `src/services/CommandQueueService.ts` - Add `isAnyBusy()` method\n2. `src/services/keyboard/bindings.ts` - Update quit handler to check busy state\n\n## Testing\n\n1. Start a merge operation (Space+m)\n2. While merge is running, press `q`\n3. Expected: Toast shows \"Operation in progress\", quit is blocked\n4. After merge completes, press `q` again\n5. Expected: App exits normally","acceptance_criteria":"- [ ] Pressing `q` while a merge (or other queued operation) is running shows a toast notification\n- [ ] App does NOT exit while operations are running\n- [ ] App exits normally when no operations are running\n- [ ] Ctrl+C still provides a force-quit escape hatch (existing behavior)\n- [ ] The running operation label is shown in the toast (e.g., \"merge\" or \"cleanup\")","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:58:23.547877+11:00","updated_at":"2025-12-19T15:09:22.314387+11:00","closed_at":"2025-12-19T15:09:22.314389+11:00"}
{"id":"az-ulwr","title":"when i move between projects i want the last cursor position, filters, etc all saved","description":"so if i go back to a project i want to see the exact same setup as when i left (aside from if beads and tmux changed due to progress made)","design":"## Implementation Plan: Per-Project UI State Persistence\n\n### Goal\nWhen switching between projects, save and restore the full UI state (cursor position, filters, sort config, view mode) so users return to exactly where they left off.\n\n### Storage Location\nPer-project directory: `\u003cproject-path\u003e/.azedarach/state.json`\n\n**Rationale**: Keeps project-specific state with the project. State travels with the project if moved/cloned.\n\n### State to Persist (per project)\n```typescript\ninterface ProjectUIState {\n  focusedTaskId: string | null      // Cursor position\n  filterConfig: FilterConfig        // Status/priority/type/session filters\n  sortConfig: SortConfig            // Sort field and direction  \n  viewMode: ViewMode                // \"kanban\" | \"compact\"\n  savedAt: string                   // ISO timestamp\n}\n```\n\n### Save Trigger\nOn project switch only (when leaving a project).\n\n### Implementation Steps\n\n#### 1. Create ProjectStateService (new service)\n- **File**: `src/services/ProjectStateService.ts`\n- **Responsibilities**:\n  - `saveState(projectPath, state)` - Write state to `\u003cprojectPath\u003e/.azedarach/state.json`\n  - `loadState(projectPath)` - Read and parse state file, return defaults if missing/invalid\n  - Schema validation using Effect Schema\n- **Error handling**: Silently fall back to defaults on read errors (missing file, invalid JSON)\n\n#### 2. Modify ProjectService.switchProject()\n- Before switching: Collect current UI state from EditorService, NavigationService, ViewService\n- Call `ProjectStateService.saveState(currentProject.path, uiState)`\n- After switching: Load new project's state via `ProjectStateService.loadState(newProject.path)`\n- Apply loaded state to EditorService, NavigationService, ViewService\n\n#### 3. Add State Restoration Methods\n- **EditorService**: Add `restoreState(sortConfig, filterConfig)` method\n- **NavigationService**: Add `restoreState(focusedTaskId)` method (already has `setFocusedTask`)\n- **ViewService**: Add `restoreState(viewMode)` method (already has `setViewMode`)\n\n#### 4. Handle Edge Cases\n- **Missing state file**: Use defaults (first task, no filters, session sort desc, kanban view)\n- **Invalid focusedTaskId**: The existing `ensureValidFocus()` already handles this - if the saved task ID doesn't exist in the board, it falls back to first task\n- **First launch**: No state file exists, gracefully use defaults\n- **Drill-down state**: NOT persisted (ephemeral by nature - would need to validate epic still exists)\n\n### File Changes Summary\n1. **New**: `src/services/ProjectStateService.ts` - State persistence logic\n2. **Modify**: `src/services/ProjectService.ts` - Add save/restore calls to `switchProject()`\n3. **Modify**: `src/services/EditorService.ts` - Add `restoreState()` method\n4. **Modify**: `src/ui/atoms/runtime.ts` - Add ProjectStateService to layer\n\n### Schema Definition\n```typescript\nconst ProjectUIStateSchema = Schema.Struct({\n  focusedTaskId: Schema.NullOr(Schema.String),\n  filterConfig: FilterConfigSchema, // Reuse from EditorService\n  sortConfig: SortConfigSchema,     // Reuse from EditorService\n  viewMode: Schema.Literal(\"kanban\", \"compact\"),\n  savedAt: Schema.String,\n})\n```\n\n### Testing Approach\n1. Switch from Project A to B ‚Üí verify A's state saved to `.azedarach/state.json`\n2. Switch back to A ‚Üí verify UI state restored\n3. Delete state file ‚Üí verify graceful fallback to defaults\n4. Corrupt state file ‚Üí verify fallback without crash","notes":"**Bug Fix (2025-12-21)**: Initial implementation only added save/restore to `switchProjectAtom`, but the actual keyboard-triggered project switch in `InputHandlersService` was bypassing this atom and calling `ProjectService.switchProject()` directly. Fixed by adding save/restore logic directly to `InputHandlersService.handleProjectSelectorInput()`.\n\nFiles modified in fix:\n- `src/services/keyboard/InputHandlersService.ts` - Added ProjectStateService and ViewService dependencies, implemented save/restore","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:32:44.866933+11:00","updated_at":"2025-12-21T02:46:40.689761+11:00","closed_at":"2025-12-21T02:46:40.689761+11:00","close_reason":"Fixed keyboard handler bypass - state now saves/restores correctly via InputHandlersService","comments":[{"id":14,"issue_id":"az-ulwr","author":"riordan","text":"Bug fix needed - keyboard handler was bypassing the atom","created_at":"2025-12-20T15:46:23Z"}]}
{"id":"az-use","title":"bd sync doesnt have a json output. need to parse it differently","description":"sync failed for [bd id] -\u003e not valid json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:25:05.897274+11:00","updated_at":"2025-12-18T02:14:02.601632+11:00","closed_at":"2025-12-17T16:53:52.433345+11:00","close_reason":"Fixed by parsing human-readable output since bd sync --json doesn't work. Changed sync() to accept {cwd, fromMain} options. Updated all callers to use fromMain:true for worktrees.","deleted_at":"2025-12-18T02:14:02.601632+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-uxz","title":"Action palette overlay for Space menu","description":"Action mode keybindings are getting crowded in the status bar. Create a proper floating action palette that appears when Space is pressed, showing all available actions with descriptions.","design":"- Floating box overlay (like HelpOverlay)\n- Show action, keybind, and short description\n- Gray out unavailable actions based on task state\n- e.g., 'Start' grayed if session already running\n- Dismiss on Esc or action execution\n- Consider grouping: Session (s/a/p/r/x), Move (h/l), etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:00:26.143992+11:00","updated_at":"2025-12-12T12:16:53.933473+11:00","closed_at":"2025-12-12T12:16:53.933473+11:00"}
{"id":"az-v0xk","title":"space c to chat isnt spawning a tmux session the same way as space s/S","description":"i saw a success toast but no indication of active session on the card and space a fails","design":"Space+c (chat) now uses the same SessionManager.start() method as Space+S, but with model='haiku'. This means:\n1. Creates a worktree (same as work sessions)\n2. Tracked in SessionManager (visible on card, attachable)\n3. Uses Haiku model for cheaper/faster discussion\n4. Can seamlessly transition to implementation since you're already in a worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:42:07.57381+11:00","updated_at":"2025-12-19T10:34:30.380941+11:00","closed_at":"2025-12-19T10:34:30.380941+11:00","close_reason":"Chat (Space+c) now creates worktrees and uses SessionManager.start() with model=haiku. Sessions are tracked, visible on cards, and attachable. Seamless transition from chat to implementation.","comments":[{"id":10,"issue_id":"az-v0xk","author":"riordan","text":"Design changed: chat now creates worktrees like Space+S. Need to verify changes.","created_at":"2025-12-18T05:53:56Z"}],"deleted_at":"2025-12-19T02:15:58.66345+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-v2ql","title":"ensure cwd is correctly passed down or retrieved via ProjectService at every point","description":"e.g. using space c to chat checks beads in the process.cwd instead of the project cwd still","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:22:54.126139+11:00","updated_at":"2025-12-19T10:34:29.909492+11:00","closed_at":"2025-12-19T10:34:29.909492+11:00","close_reason":"Fixed all process.cwd() usages to use ProjectService for correct cwd handling. Key changes:\n- TmuxService.displayPopup now accepts optional `cwd` parameter\n- chatAboutTask passes project path to tmux popup\n- taskHandlers.ts deleteBead gets projectPath from ctx.getProjectPath()\n- bindings.ts log viewer gets projectPath dynamically\n- prHandlers.ts abortMerge gets projectPath correctly\n- ImageAttachmentService refactored to get project path via ProjectService (added dependency)\n- SessionManager refactored with ProjectService dependency and getEffectiveProjectPath helper\n- listActive() now accepts optional projectPath parameter","deleted_at":"2025-12-19T02:15:58.664421+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-v6h","title":"use effect STM or something to enforce atomic operations where possible","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:43:45.048239+11:00","updated_at":"2025-12-17T15:43:45.048239+11:00"}
{"id":"az-vcxc","title":"why is there a number beside the dev server icon","description":"","design":"## Root Cause\n\nThe dev server indicator emoji `üñ•Ô∏è` (DESKTOP COMPUTER) contains a Unicode variation selector `U+FE0F` that renders poorly in many terminals:\n- The variation selector shows as vertical lines `||`\n- The base emoji renders smaller than expected\n- Combined effect: `üñ•Ô∏è||` instead of a clean icon\n\n## Solution\n\nChanged from `üñ•Ô∏è` (U+1F5A5 + U+FE0F) to `üíª` (U+1F4BB) which:\n- Is a single Unicode code point with no variation selector\n- Renders consistently across terminals\n- Semantically similar (computer = dev server)","notes":"Fixed by changing DEV_SERVER_INDICATOR from üñ•Ô∏è to üíª in src/ui/types.ts\n\nThe issue was that the desktop computer emoji has a variation selector (U+FE0F) appended which doesn't render properly in terminals, causing the small icon + vertical lines artifact.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T02:15:19.799683+11:00","updated_at":"2025-12-20T04:27:20.640203+11:00","closed_at":"2025-12-20T04:27:20.640207+11:00","close_reason":"Fixed by changing DEV_SERVER_INDICATOR from üñ•Ô∏è (U+1F5A5 + U+FE0F) to üíª (U+1F4BB). The variation selector was causing terminal rendering issues."}
{"id":"az-vm5l","title":"space s/S/! on a bead that already has a worktree should not fail","description":"instead of erroring cause the worktree already exists, warn that worktree already existst and continue using that worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:18:03.403552+11:00","updated_at":"2025-12-18T16:24:57.065914+11:00","closed_at":"2025-12-18T16:24:57.065916+11:00","close_reason":"Implemented: WorktreeManager.create now checks if the branch already exists and uses `git worktree add \u003cpath\u003e \u003cbranch\u003e` instead of `git worktree add -b` when appropriate. This prevents the 'branch already exists' error when pressing space s/S/! on a bead that already has a worktree or has a leftover branch from a previous session.","deleted_at":"2025-12-18T13:54:09.566645+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-vn0","title":"i just ended a session and then all beads with active sessions disappeared from the board","description":"i used space x to end the session and after quitting az and restarting it the beads that disappeared are still not back","notes":"## Investigation (2025-12-15)\n\n### Analysis\n\nInvestigated the bug where beads with active sessions disappeared after ending a session with Space+x.\n\n**Key findings:**\n1. Beads ARE present in the database (verified with `bd list` - 76 beads, 26 open, 1 in_progress)\n2. The `SessionManager.stop()` function only removes session tracking, doesn't modify beads\n3. The `bd sync` operation syncs changes FROM worktrees but shouldn't delete beads\n\n**Possible causes identified:**\n1. Error in `BoardService.refresh()` scheduled task causing stale/empty data\n2. Mismatch between session tracking and bead data after sync\n3. Transient issue that's difficult to reproduce\n\n**Root cause could not be definitively identified** - the code looks correct and beads exist in the database.\n\n### Fixes Applied\n\nAdded diagnostic logging to help identify the issue if it recurs:\n\n1. **BoardService.ts**: Added error logging for scheduled refresh failures\n2. **SessionManager.ts**: Added logging around session stop operations:\n   - Log when stopping session\n   - Log when sync completes/fails\n   - Log final session state\n3. **BoardService.ts**: Added warning log when task counts seem inconsistent (0 beads or session mismatch)\n\n### How to Diagnose in Future\n\nIf the bug recurs, check `az.log` for:\n- \"BoardService refresh failed\" - indicates data loading error\n- \"Stopping session for\" / \"Session stopped for\" - tracks session lifecycle\n- \"Sync failed for\" - indicates beads sync issues\n- \"Task load: X beads, Y active sessions\" - tracks data counts\n\n### Status\n\nClosing as \"cannot reproduce\" with diagnostic logging added. The logging will help identify the root cause if the issue occurs again.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:40:32.916186+11:00","updated_at":"2025-12-16T17:16:31.935474+11:00","closed_at":"2025-12-16T17:16:31.935474+11:00"}
{"id":"az-voa","title":"i dont like ctrl-a A as a way to return to az, come up with a better global key command","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T10:08:08.210971+11:00","updated_at":"2025-12-17T10:48:27.086814+11:00","closed_at":"2025-12-17T10:48:27.086814+11:00"}
{"id":"az-vpj","title":"make sure we warn the user if space m will cause conflicts and they can press y/n to proceed or cancel","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:26.919959+11:00","updated_at":"2025-12-17T01:09:17.730326+11:00","closed_at":"2025-12-17T01:09:17.730326+11:00"}
{"id":"az-vpz","title":"Migrate state management to Effect-atom native patterns","description":"Refactor current state management to use Effect-atom native patterns for better integration with the Effect ecosystem. This includes:\n\n- Audit current state management approach\n- Identify candidates for migration to effect-atom\n- Implement atomic state with proper Effect integration\n- Ensure reactive updates flow through the TUI correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T10:32:35.479946+11:00","updated_at":"2025-12-15T12:42:24.805977+11:00","closed_at":"2025-12-15T12:42:24.80598+11:00"}
{"id":"az-vx2","title":"Add debug overlay (d key) showing service state","description":"Developer tool for debugging state issues:\n\n**Debug overlay shows:**\n- Current mode (EditorService)\n- Cursor position and focused task ID (NavigationService)  \n- Active sessions with states (SessionManager)\n- Command queue status (CommandQueueService)\n- Filter/sort settings (BoardService)\n- Recent errors/warnings\n\n**Toggle with 'd' key in normal mode**\n- Semi-transparent overlay on right side\n- Auto-refreshes every 500ms\n- Useful for debugging state sync issues like az-vn0 (disappearing tasks)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:59:45.895225+11:00","updated_at":"2025-12-18T02:14:02.60623+11:00","closed_at":"2025-12-17T17:06:44.78128+11:00","close_reason":"Implemented debug overlay with 'd' key toggle showing mode, navigation, board, session, and command queue state","deleted_at":"2025-12-18T02:14:02.60623+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"feature"}
{"id":"az-w2m","title":"up/down arrow should wrap around the current column when at the bottom/top not move to next column","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:54:54.218653+11:00","updated_at":"2025-12-18T02:14:02.599141+11:00","closed_at":"2025-12-17T17:02:47.827581+11:00","close_reason":"Implemented wrap-around navigation for up/down keys within columns","deleted_at":"2025-12-18T02:14:02.599141+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-w75","title":"pressing down at the bottom of a column in tui should wrap to the top of that column not the next column","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:28:56.744822+11:00","updated_at":"2025-12-18T13:54:09.567596+11:00","closed_at":"2025-12-17T16:33:22.358329+11:00"}
{"id":"az-w9g9","title":"i want to change space m to merge into main but not cleanup otherwise","description":"sometimes i need to use this flow: be space m, test in main dev server, iterate in same claude session, space m again, its done? then space d to cleanup\nit should no longer mess with closing beads or ending sessions","design":"## Implementation Plan\n\n**Goal:** Change Space+m to merge into main but NOT cleanup (no worktree deletion, no branch deletion, no bead closing, keep session running).\n\n**Current behavior (Space+m):**\n1. Stop session ‚ùå (we want to keep it running)\n2. Commit uncommitted changes in worktree ‚úÖ\n3. Merge branch to main (with conflict handling) ‚úÖ\n4. Sync beads ‚úÖ\n5. Remove worktree ‚ùå\n6. Delete local branch ‚ùå\n7. Close bead ‚ùå\n8. Push to origin ‚úÖ\n\n**New behavior (Space+m):**\n1. Keep session running (don't stop) ‚úÖ\n2. Commit uncommitted changes in worktree ‚úÖ\n3. Merge branch to main (with conflict handling) ‚úÖ\n4. Sync beads ‚úÖ\n5. Push to origin ‚úÖ\n6. **DO NOT**: remove worktree, delete branch, close bead\n\n**Changes needed:**\n\n1. **PRWorkflow.ts** - Add new method `mergeToMainOnly`:\n   - Similar to `mergeToMain` but without cleanup steps\n   - Skip: sessionManager.stop(), worktreeManager.remove(), branch deletion, bead closing\n   - Keep: git merge, beads sync, push to origin\n\n2. **PRHandlersService.ts** - Update `mergeToMain` handler:\n   - Call `prWorkflow.mergeToMainOnly()` instead of `prWorkflow.mergeToMain()`\n\n**User workflow after this change:**\n- Space+m: merge to main, stay in worktree, keep iterating\n- Space+m again: merge latest changes to main\n- Space+d: cleanup when done (existing behavior)\n\n**Alternative approach (simpler):**\n- Just pass `closeBead: false` to existing mergeToMain and skip cleanup steps\n- But current mergeToMain always deletes worktree, so we need to add a `keepWorktree` option\n\n**Chosen approach:** Add `keepWorktree: boolean` option to MergeToMainOptions, defaulting to true (new behavior). This is less code duplication than a new method.","acceptance_criteria":"- [ ] Space+m merges branch to main without deleting worktree\n- [ ] Space+m keeps Claude session running (no stop)\n- [ ] Space+m does NOT close the bead\n- [ ] Space+m does NOT delete the local branch\n- [ ] Space+d still works for full cleanup (worktree + branch + bead close)\n- [ ] Can iterate: Space+m, make changes, Space+m again, Space+d to finish\n- [ ] Beads sync still runs after merge\n- [ ] Push to origin still happens after merge","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-20T01:28:03.733199+11:00","updated_at":"2025-12-20T01:35:02.493532+11:00"}
{"id":"az-wiu","title":"Eliminate React hooks in favor of Effect services (audit \u0026 migrate)","description":"Per az-x4e, 9 files still use React hooks (useEffect/useMemo/useState):\n\n- src/ui/App.tsx\n- src/ui/Board.tsx\n- src/ui/Column.tsx\n- src/ui/CompactView.tsx\n- src/ui/Toast.tsx\n- src/ui/DetailPanel.tsx\n- src/ui/CreateTaskPrompt.tsx\n- src/ui/ClaudeCreatePrompt.tsx\n- src/index.tsx\n\n**Audit each file** to determine:\n1. What state/effects can move to Effect services\n2. What computation can move to atoms\n3. What's truly local UI state (may be acceptable)\n\nDocument findings and create migration plan. This task is the audit; az-x4e is the execution.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T15:59:45.338873+11:00","updated_at":"2025-12-17T15:59:45.338873+11:00"}
{"id":"az-wn3o","title":"Claude-orchestrated epic mode (subagent approach)","description":"Claude orchestrates an epic using parallel Task tool subagents.\n\n**Entry:** Space+O on epic ‚Üí \"Claude Orchestrate\" option\n\n**Flow:**\n1. Spawn orchestrator with auto-compact enabled\n2. Quality gate identifies safe parallel groupings\n3. Orchestrator spawns subagent batches, monitors progress\n4. Updates beads on completion/blockers\n\n**Stretch:** Configurable subagents vs external sessions (az-zg9j)","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-19T11:09:41.316984+11:00","updated_at":"2025-12-19T11:15:56.423972+11:00","dependencies":[{"issue_id":"az-wn3o","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-19T11:14:30.801875+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-wot","title":"image paste from clipboard not working still on mac","description":"no logs, no toast, just nothing happens when i press p with a image in clipboard","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:12:34.022384+11:00","updated_at":"2025-12-18T02:14:02.597438+11:00","closed_at":"2025-12-18T01:36:22.272642+11:00","close_reason":"Fixed: ImageAttachmentService state was not being initialized when overlay opened via keybinding. Handler now auto-initializes state from overlay if needed, and added user feedback when clipboard support unavailable.","deleted_at":"2025-12-18T02:14:02.597438+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-wxvn","title":"why is bd sync failing in initCommands?","description":"","design":"## Root Cause Analysis\n\n**Error**: `bd sync` (and all bd commands) fail with:\n```\nError: failed to open database: failed to initialize schema: sqlite3: SQL logic error: no such column: thread_id\n```\n\n### Investigation Findings\n\n1. **Version Mismatch**: The beads CLI is v0.30.5 (dev) but the database metadata shows `bd_version|0.30.1`\n\n2. **Missing Column**: The `dependencies` table is missing `thread_id` column:\n   - Current schema has: `issue_id, depends_on_id, type, created_at, created_by`\n   - New schema expects: + `thread_id TEXT DEFAULT ''`\n\n3. **Migration Bug**: Migration 020_edge_consolidation.go expects `thread_id` to exist during schema initialization, but doesn't properly add it first. This breaks all bd commands, including `bd migrate`.\n\n4. **Workaround**: `bd list --no-db` works because it bypasses SQLite entirely and reads from JSONL.\n\n### Why This Affects Azedarach\n\n- `.azedarach.json` has `initCommands: [\"direnv allow\", \"bun install\", \"bd sync\"]`\n- Worktrees run `bd sync` after creation\n- `bd sync` fails ‚Üí session starts with warning state\n- This is a **beads upstream bug**, not an Azedarach bug\n\n### Solution Options\n\n1. **Immediate workaround (Azedarach)**: Remove `bd sync` from initCommands OR use `bd sync --no-db`\n2. **Proper fix (beads)**: Fix the migration to add the column before referencing it\n3. **Manual fix**: `sqlite3 .beads/beads.db \"ALTER TABLE dependencies ADD COLUMN thread_id TEXT DEFAULT ''\"`","notes":"üìé [mjc92kmr-m2gt.png](.beads/images/az-wxvn/mjc92kmr-m2gt.png) (clipboard, 12/19/2025, 1:28:25 PM)\n\n### Investigation Steps Completed\n1. Read attached screenshot showing diagnostics panel with initCommands failure\n2. Ran `bd sync` manually - confirmed same error\n3. Checked beads version: 0.30.5 (dev) from nix flake\n4. Compared db schema - dependencies table missing `thread_id`\n5. Found migration 020_edge_consolidation.go adds thread_id\n6. Confirmed `--no-db` mode works as workaround\n7. Fixed by: manually adding column to main db, then deleting worktree's empty db so it recreates from JSONL\n\n### Confirmed: This is a beads upstream bug\nThe migration system should handle older databases gracefully but instead crashes.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:28:23.212365+11:00","updated_at":"2025-12-19T14:15:10.68206+11:00","closed_at":"2025-12-19T14:15:10.682065+11:00","close_reason":"Investigation complete. Root cause: beads upstream migration bug where v0.30.5 expects `thread_id` in dependencies table but migration 020 fails on older dbs. Fixed by manually adding the column with: `sqlite3 .beads/beads.db \"ALTER TABLE dependencies ADD COLUMN thread_id TEXT DEFAULT ''\"`. Also fixed Chefy db."}
{"id":"az-x4e","title":"avoid useEffect, useMemo, useState, etc.","description":"switch from react hooks such as those in the title to fully encapsulating state mgmt in effect services","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:24:52.577357+11:00","updated_at":"2025-12-17T15:03:52.386143+11:00","dependencies":[{"issue_id":"az-x4e","depends_on_id":"az-wiu","type":"blocks","created_at":"2025-12-17T15:59:52.10568+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-x4os","title":"Investigate if we can speed up .envrc (flake.nix i think takes the time)","description":"Investigate direnv/.envrc loading time - user suspects flake.nix evaluation is slow.","design":"## Investigation Findings\n\n### Current Setup\n- **nix-direnv 3.1.0** is properly installed (via home-manager)\n- **Caching works**: `~/.config/direnv/lib/hm-nix-direnv.sh` provides intelligent caching\n\n### Performance Measurements\n| Scenario | Time |\n|----------|------|\n| Cache renewal | ~11 seconds |\n| Cached load | ~0.3 seconds |\n\n### Root Cause Analysis\nThe 11-second delay happens when nix-direnv **renews the cache**. This runs:\n1. `nix print-dev-env` - evaluates flake and builds dev shell\n2. `nix flake archive` - GC roots for flake inputs\n\nCache is invalidated when ANY of these files change:\n- `flake.nix`\n- `flake.lock`\n- `~/.direnvrc`\n- `~/.config/direnv/direnvrc`\n\n### What's Already Optimized\n1. ‚úÖ nix-direnv caching (avoids re-evaluation on every shell)\n2. ‚úÖ flake.lock pins inputs (avoids network fetches)\n3. ‚úÖ Simple devShell (only essential packages)\n\n### Potential Optimizations\n\n**A. Enable Nix daemon mode** (if not already)\n```bash\n# Check if nix daemon is running\nlaunchctl list | grep nix\n```\nDaemon mode shares build cache across users/sessions.\n\n**B. Use nix-community/nix-index-database for faster package lookups**\nCurrently not relevant as we're not doing package searches.\n\n**C. Consider devenv.sh instead of raw nix flakes**\ndevenv has faster caching and simpler syntax, but adds dependency.\n\n**D. Profile what's slow in the flake**\n```bash\ntime nix eval .#devShells.aarch64-darwin.default --json\n```\n\n### Conclusion\n**The setup is already well-optimized.** The 11-second delay is inherent to Nix flake evaluation when the cache needs renewal. This only happens when:\n- flake.nix/flake.lock changes\n- First shell in a worktree (no .direnv cache)\n- Nix store garbage collection removes cached derivations\n\n**Recommendation**: No changes needed. The 0.3s cached load time is excellent.\nIf user wants sub-second cold start, would need to abandon Nix for simpler tooling.","acceptance_criteria":"- [x] Document current performance (cold vs cached)\n- [x] Identify root cause of slow loads\n- [x] Determine if nix-direnv caching is working\n- [x] Evaluate optimization options\n- [x] Make recommendation","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-12-19T12:41:03.080068+11:00","updated_at":"2025-12-19T12:45:57.492013+11:00","closed_at":"2025-12-19T12:45:57.492013+11:00","close_reason":"Investigation complete: .envrc load time is already optimized. Cached loads take 0.3s (excellent). The 11s delay only occurs during cache renewal (flake.nix/lock changes, new worktrees, or post-GC). nix-direnv 3.1.0 is properly configured via home-manager. No changes recommended."}
{"id":"az-xi5","title":"SessionManager - Claude session orchestration","description":"Core orchestration: spawn Claude in tmux sessions, manage lifecycle, coordinate with worktrees.","design":"- Define SessionManager as Effect.Service\n- Depends on: WorktreeManager, TmuxService, BeadsClient, StateDetector, FileLockManager\n- Methods return Effect with typed errors:\n  - start(beadId): Effect\u003cSession, SessionError | WorktreeError\u003e\n  - stop(beadId): Effect\u003cvoid, SessionError\u003e\n  - pause(beadId): Effect\u003cvoid, SessionError\u003e // Ctrl+C, WIP commit\n  - resume(beadId): Effect\u003cvoid, SessionError\u003e\n  - getState(beadId): Effect\u003cSessionState, SessionError\u003e\n  - listActive(): Effect\u003cSession[], never\u003e\n- Use Effect.gen for orchestration flow\n- Use PubSub for state change events\n- Track sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- Create SessionManagerLive layer that composes dependencies","notes":"Implemented SessionManager service in src/core/SessionManager.ts following Effect service pattern.\n\nKey implementation details:\n- Service interface with 7 methods: start, stop, pause, resume, getState, listActive, updateState, subscribeToStateChanges\n- Uses Effect.gen pattern for orchestration\n- Composes WorktreeManager, TmuxService, BeadsClient, and StateDetector services\n- Tracks sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- PubSub for state change events\n- SessionManagerLive layer with all dependencies included\n- All methods require CommandExecutor in context (provided by BunContext layer)\n- Type-safe error handling with typed error unions\n- Comprehensive JSDoc documentation\n\nThe start() method creates worktree, spawns tmux session, and launches Claude.\nThe pause() method sends Ctrl+C and creates WIP commit.\nThe stop() method kills tmux session.\n\nAll types pass strict TypeScript checking (pnpm type-check).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.82144+11:00","updated_at":"2025-12-12T10:32:34.049829+11:00","closed_at":"2025-12-12T10:32:34.049829+11:00","dependencies":[{"issue_id":"az-xi5","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.3385+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-xi5","depends_on_id":"az-om3","type":"blocks","created_at":"2025-12-11T14:46:26.452316+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-xi5","depends_on_id":"az-kis","type":"blocks","created_at":"2025-12-11T14:46:26.845057+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-xi5","depends_on_id":"az-a8i","type":"blocks","created_at":"2025-12-11T14:46:27.560945+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-xmj","title":"something is wrong with create task with claude STILL","description":"redesign the feature from the ground up cause we have tried to fix it 3 times already","notes":"Starting redesign with \"Direct bd create\" approach: Claude extracts structured data (title/type/priority) from natural language, then we call bd create directly. No more Claude CLI tool execution.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:05.459264+11:00","updated_at":"2025-12-18T02:14:02.602606+11:00","closed_at":"2025-12-17T17:23:32.780765+11:00","close_reason":"Redesigned \"Create Task with Claude\" feature using two-phase approach: (1) Claude extracts structured JSON data from natural language, (2) BeadsClient.create() is called directly. This eliminates the unreliable CLI tool execution and output parsing.","deleted_at":"2025-12-18T02:14:02.602606+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-xoz","title":"fix action mode delete bead keybind","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:25:22.242622+11:00","updated_at":"2025-12-15T01:37:29.061321+11:00","closed_at":"2025-12-15T01:37:29.061321+11:00"}
{"id":"az-xqc2","title":"Check for uncommitted changes before Space+m merge to prevent autostash conflicts","description":"When `merge.autostash=true` is configured in git, uncommitted changes get stashed before merge and auto-popped after. If the stash pop conflicts with merged content, you get a stash conflict that the current `checkMergeConflicts()` (git merge-tree) can't detect.\n\nAdd a pre-merge check in the Space+m handler to detect uncommitted changes and warn the user before proceeding.","design":"1. Before calling `checkMergeConflicts()`, run `git status --porcelain` in the worktree\n2. If there are uncommitted changes (modified/added/deleted files), show a confirmation dialog:\n   - \"Uncommitted changes detected in worktree. With autostash enabled, these may conflict after merge. Commit changes first?\"\n   - Options: \"Commit \u0026 Merge\" / \"Merge Anyway\" / \"Cancel\"\n3. \"Commit \u0026 Merge\" option: stage all + commit with message like \"WIP: uncommitted changes before merge\" then proceed\n4. \"Merge Anyway\" lets user proceed at their own risk\n\nAlternative: Just block merge if uncommitted changes exist and show toast \"Commit changes before merging\"","acceptance_criteria":"- [ ] Space+m checks for uncommitted changes in worktree before merge\n- [ ] Shows warning/confirmation if uncommitted changes exist\n- [ ] Prevents autostash conflict scenario\n- [ ] Test with `merge.autostash=true` configured","status":"closed","priority":2,"issue_type":"feature","assignee":"claude","created_at":"2025-12-18T16:14:34.913357+11:00","updated_at":"2025-12-19T10:34:29.667417+11:00","closed_at":"2025-12-19T10:34:29.667417+11:00","close_reason":"Implemented uncommitted changes check before Space+m merge. Shows confirmation dialog when uncommitted changes detected in worktree, preventing autostash conflicts.","deleted_at":"2025-12-19T02:15:58.66494+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"feature"}
{"id":"az-xqvh","title":"Extend BeadsClient schema with dependency fields","description":"Update IssueSchema in BeadsClient.ts to include:\n- `dependent_count: Schema.Number.pipe(Schema.optional)`\n- `dependency_count: Schema.Number.pipe(Schema.optional)`\n- `dependents: Schema.Array(DependencyRefSchema).pipe(Schema.optional)`\n- `dependencies: Schema.Array(DependencyRefSchema).pipe(Schema.optional)`\n\nCreate DependencyRefSchema with: id, title, status, dependency_type, issue_type (optional)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:01.855608+11:00","updated_at":"2025-12-19T10:34:31.113453+11:00","closed_at":"2025-12-19T10:34:31.113453+11:00","close_reason":"Added DependencyRefSchema and dependency fields (dependent_count, dependency_count, dependents, dependencies) to IssueSchema","dependencies":[{"issue_id":"az-xqvh","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:21.510037+11:00","created_by":"daemon","metadata":"{}"}],"deleted_at":"2025-12-19T02:15:58.660189+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-xw8","title":"Generate hooks config when spawning sessions","description":"SessionManager generates .claude/hooks.json in worktree when spawning sessions. Hooks auto-sync beads on Stop event and update issue notes. Pure bash-based automation without MCP overhead.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:25:00.000819+11:00","updated_at":"2025-12-12T13:25:20.656259+11:00","dependencies":[{"issue_id":"az-xw8","depends_on_id":"az-aiu","type":"blocks","created_at":"2025-12-12T13:25:32.748995+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-y6n","title":"up arrow in compact view moves a whole page up not a single task up","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:08:27.533042+11:00","updated_at":"2025-12-17T10:27:38.776467+11:00","closed_at":"2025-12-17T10:27:38.776471+11:00"}
{"id":"az-ybu6","title":"when space a detects updates in base branch it should say the base branch name","description":"currently it says hardcoded (i assume) main. i hope it uses the configured base branch and not main right?","design":"## Analysis\n\nThe issue is that when `Space+a` detects that a worktree branch is behind the base branch, the UI shows \"main\" hardcoded in multiple places instead of using the configured `git.baseBranch` value.\n\n**Good news**: The code already DOES use the configured `baseBranch` for the actual git operations! The variable is read from config at:\n- `PRWorkflow.ts:682` - `const baseBranch = gitConfig.baseBranch` \n- Used correctly in: merge operations, diff commands, fetch operations\n\n**The problem**: UI messages and overlay text are hardcoded to say \"main\":\n\n### Files to change:\n\n1. **`src/ui/MergeChoiceOverlay.tsx`** (lines 67, 88):\n   - Title: \"Branch Behind Main\" ‚Üí use dynamic baseBranch\n   - Option text: \"(pull latest main into branch)\" ‚Üí use dynamic baseBranch\n\n2. **`src/services/keyboard/SessionHandlersService.ts`** (line 371):\n   - Toast: \"Merging main into branch...\" ‚Üí use dynamic baseBranch\n\n3. **`src/services/keyboard/PRHandlersService.ts`** (lines 131, 137, 171):\n   - Toast: \"Updating from main...\" ‚Üí use dynamic baseBranch\n   - Toast: \"Updated from main\" ‚Üí use dynamic baseBranch  \n   - Toast: \"Syncing with main before PR...\" ‚Üí use dynamic baseBranch\n\n4. **`src/core/PRWorkflow.ts`** (lines 1570, 1583, 1593):\n   - `checkBranchBehindMain` method uses hardcoded \"main\" in git rev-list commands\n   - Method name itself says \"Main\" but should be \"Base\"\n   - Also `mergeMainIntoBranch` has similar issues (lines 1612, 1650, etc.)\n\n## Implementation Plan\n\n1. **PRHandlersService**: Already has `gitConfig.baseBranch` available - just use it in toast messages\n\n2. **SessionHandlersService**: Need to get `gitConfig` from `AppConfig` service (already injected) and use it\n\n3. **PRWorkflow**: The `checkBranchBehindMain` and `mergeMainIntoBranch` methods use hardcoded \"main\" - should use `baseBranch` variable that's already defined at service level\n\n4. **MergeChoiceOverlay**: This is trickier - the component receives `commitsBehind` but not the branch name. Need to either:\n   - Pass `baseBranch` through the overlay props\n   - Or create an atom that exposes the configured base branch\n\nApproach: Extend the `mergeChoice` overlay type to include `baseBranch` field, then pass it from SessionHandlersService when pushing the overlay.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T04:22:17.539974+11:00","updated_at":"2025-12-21T01:19:35.491174+11:00","closed_at":"2025-12-21T01:19:35.491178+11:00","close_reason":"Fixed: UI now displays configured git.baseBranch instead of hardcoded 'main' in all merge-related messages and overlays"}
{"id":"az-yf4","title":"PRWorkflow - automated GitHub PR creation","description":"Automate PR creation when tasks complete using gh CLI.\n\nDesign:\n- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, WorktreeManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n\nMethods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n  - cleanup(beadId): Effect\u003cvoid, GitError\u003e -- NEW\n\nWorkflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n\nPR body template includes bead description, acceptance criteria.\nLink PR back to bead via bd update --notes.\nUse Effect.retry with Schedule for transient failures.\n\n**Cleanup after merge:**\n  1. Ensure session is stopped\n  2. WorktreeManager.remove() - delete worktree directory\n  3. git push origin --delete \u003cbranch\u003e - delete remote branch\n  4. git branch -D \u003cbranch\u003e - delete local branch\n  5. bd close \u003cbeadId\u003e - mark task complete\n\nThis cleanup function will also be exposed for manual use (az-6t6).","design":"- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n- Methods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n- Workflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n- PR body template includes bead description, acceptance criteria\n- Link PR back to bead via bd update --notes\n- Use Effect.retry with Schedule for transient failures","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.509773+11:00","updated_at":"2025-12-12T12:30:29.541722+11:00","closed_at":"2025-12-12T12:30:29.541722+11:00","dependencies":[{"issue_id":"az-yf4","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.444969+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-yf4","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.29207+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-yhc4","title":"space m should inform the user if there are uncommitted changes (other than beads)","description":"* in the worktree","design":"## Design\n\n### Current Behavior\n- `Space+m` (merge to main) calls `PRWorkflow.checkUncommittedChanges()` before merging\n- This returns ALL uncommitted files from `git status --porcelain`\n- If any uncommitted files exist, a confirmation dialog is shown warning about autostash risks\n\n### Problem\n- Beads files (`.beads/issues.jsonl`, etc.) are frequently modified during normal operation\n- These changes are expected and handled separately via `bd sync`\n- Users get warnings about beads changes even when there are no actual code changes\n\n### Solution\nModify `PRWorkflow.checkUncommittedChanges()` to filter out beads-related files:\n\n1. **Filter logic**: Exclude files matching `.beads/**` from the changed files list\n2. **Return separate counts**: Return both `hasUncommittedChanges` (non-beads) and full list for transparency\n3. **UI message**: When only beads files are uncommitted, don't show the warning\n\n### Implementation Steps\n1. In `PRWorkflow.checkUncommittedChanges()`:\n   - After parsing `git status --porcelain` output\n   - Filter out files starting with `.beads/`\n   - Return filtered result for `hasUncommittedChanges` check\n\n2. In `PRHandlersService.mergeToMain()`:\n   - The existing logic already handles the result correctly\n   - No changes needed - the filtered results will automatically not trigger the warning\n\n### Files to Modify\n- `src/core/PRWorkflow.ts` - `checkUncommittedChanges()` method (lines ~1333-1366)","acceptance_criteria":"- [ ] `Space+m` does NOT warn when only `.beads/` files are uncommitted\n- [ ] `Space+m` still warns when actual code files are uncommitted\n- [ ] The warning message still shows the uncommitted non-beads files accurately\n- [ ] Beads sync operations are unaffected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:38:49.204913+11:00","updated_at":"2025-12-21T03:21:53.404365+11:00","closed_at":"2025-12-21T03:21:53.404365+11:00","close_reason":"Implemented filter to exclude .beads/ files from uncommitted changes check in Space+m merge workflow"}
{"id":"az-ykth","title":"add tmux hotkey that switches between dev server and claude tmux sessions in same worktree","description":"a global tmux hotkey like we did ctrl a a","design":"## Design: Tmux Claude/Dev Server Toggle Hotkey\n\n### Overview\nAdd a global tmux hotkey (`Ctrl-a Tab`) that switches between a Claude session and its corresponding dev server session in the same worktree.\n\n### Session Naming Convention (existing)\n- Claude sessions: `\u003cbeadId\u003e` (e.g., `az-ykth`)\n- Dev server sessions: `az-dev-\u003cbeadId\u003e` (e.g., `az-dev-az-ykth`)\n\n### Implementation Approach\n\n**1. Toggle Logic (inline shell script)**\nThe keybinding runs a shell script that:\n1. Gets current session name via `tmux display-message -p '#S'`\n2. Determines if we're in a Claude session or dev server session\n3. Computes the target session name\n4. Checks if target session exists\n5. Either switches to it or displays a message\n\n```bash\n# Pseudocode\ncurrent=$(tmux display-message -p '#S')\nif [[ $current == az-dev-* ]]; then\n  # In dev server ‚Üí switch to Claude\n  target=\"${current#az-dev-}\"\nelse\n  # In Claude ‚Üí switch to dev server\n  target=\"az-dev-$current\"\nfi\n\nif tmux has-session -t \"$target\" 2\u003e/dev/null; then\n  tmux switch-client -t \"$target\"\nelse\n  tmux display-message \"No matching session: $target\"\nfi\n```\n\n**2. Auto-injection Location**\nInject the keybinding in `TmuxService.newSession()` after creating the session, using:\n```bash\ntmux bind-key -T prefix Tab run-shell '\u003ctoggle-script\u003e'\n```\n\nThe `-T prefix` ensures it's bound under the prefix key (Ctrl-a).\n\n**3. Fallback Behavior**\n- If target session doesn't exist: Show tmux message \"No dev server running\" or \"No Claude session\"\n- Auto-starting dev server is complex (requires knowing project path) - defer to v2\n\n### Files to Modify\n1. `src/core/TmuxService.ts` - Add keybinding injection in `newSession()`\n2. `docs/tmux-config.md` - Document the new hotkey\n\n### Why This Approach\n- **Stateless**: The toggle logic doesn't require any state - just session naming conventions\n- **Universal**: Works from any tmux client attached to these sessions\n- **Simple**: Single keybinding, no external scripts to install\n- **Idempotent**: Safe to call multiple times (just sets the same binding)","acceptance_criteria":"- [ ] `Ctrl-a Tab` toggles between Claude session (e.g., `az-ykth`) and its dev server (`az-dev-az-ykth`)\n- [ ] Works from both Claude and dev server sessions\n- [ ] Shows informative message when target session doesn't exist\n- [ ] Keybinding is auto-installed when sessions are created\n- [ ] Documentation updated in tmux-config.md","notes":"## Implementation Complete\n\n### Changes Made\n1. **TmuxService.ts** (line 52-70): Added keybinding injection in `newSession()` that binds `Ctrl-a Tab` to a shell script that toggles between Claude and dev server sessions\n\n2. **tmux-config.md**: Added new hotkey to the cheatsheet and workflow tips section\n\n3. **keybindings.md**: Updated tmux navigation section with the new toggle and navigation flow\n\n### How It Works\n- Session naming convention: Claude uses `\u003cbeadId\u003e`, dev server uses `az-dev-\u003cbeadId\u003e`\n- The toggle script detects which session type you're in and computes the counterpart\n- If target exists: switches to it via `tmux switch-client`\n- If target doesn't exist: shows helpful message like \"No dev server (Space+r to start)\"\n\n### Testing\n- Type-check passes\n- Build succeeds\n- Manual testing needed: start a Claude session, start a dev server, try `Ctrl-a Tab`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T04:19:18.631478+11:00","updated_at":"2025-12-20T04:29:47.489907+11:00","closed_at":"2025-12-20T04:29:47.489907+11:00","close_reason":"Implemented Ctrl-a Tab toggle between Claude and dev server sessions. Changes in TmuxService.ts inject the keybinding when sessions are created. Documentation updated in tmux-config.md and keybindings.md."}
{"id":"az-yv6x","title":"show current project name somewhere","description":"Display the current project name in the StatusBar so users always know which project they're working on.\n\nContext: The StatusBar currently shows \"azedarach\" (the app name) on the left side. We need to also show the currently selected project name from ProjectService.","design":"**Location**: StatusBar left side, after the app name \"azedarach\"\n\n**Display format**: `azedarach ‚Ä¢ project-name` (using a separator)\n- Uses the existing `currentProjectAtom` to get the project name\n- Falls back gracefully if no project is selected (shows nothing extra)\n- Subtle styling to distinguish from app name (dimmer color like subtext0)\n\n**Implementation**:\n1. Add `projectName` prop to StatusBarProps (optional string)\n2. Render project name after \"azedarach\" with a separator\n3. Update App.tsx to pass currentProject?.name to StatusBar\n\n**Files to modify**:\n- `src/ui/StatusBar.tsx` - Add projectName prop and render logic\n- `src/ui/App.tsx` - Pass projectName from currentProjectAtom","acceptance_criteria":"- [ ] Project name visible in status bar when a project is selected\n- [ ] No extra text when no project is selected\n- [ ] Updates reactively when switching projects (via ProjectSelector)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:35:35.266129+11:00","updated_at":"2025-12-19T12:38:47.476303+11:00","closed_at":"2025-12-19T12:38:47.476303+11:00","close_reason":"Implemented: Project name now displays in StatusBar left side, replacing 'azedarach' when a project is selected. Falls back to 'azedarach' when no project. Updates reactively via currentProjectAtom."}
{"id":"az-z0u","title":"test","description":"","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-17T00:22:01.980663+11:00","updated_at":"2025-12-17T00:22:19.310023+11:00","deleted_at":"2025-12-17T00:22:19.310023+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-z4n","title":"Improve error messages with actionable guidance","description":"Current errors may be cryptic. Enhance error handling:\n\n**Error categories:**\n- Git errors ‚Üí Suggest git commands to fix (merge conflicts, dirty worktree)\n- Beads errors ‚Üí Guide to bd commands or sync issues\n- Tmux errors ‚Üí Check tmux installation, session conflicts\n- PR errors ‚Üí GitHub auth issues, branch protection rules\n\n**Implementation:**\n- Create ErrorFormatter service\n- Map error types to user-friendly messages\n- Include \"Try:\" suggestions with specific commands\n- Show in Toast with longer duration for errors\n- Option to copy error details to clipboard","notes":"Implementation complete:\\n\\n**Created ErrorFormatter service (src/services/ErrorFormatter.ts):**\\n- Registry of 30+ error formatters for all tagged error types\\n- Pattern matching within formatters for sub-cases (merge conflicts, auth issues, network errors)\\n- User-friendly messages with actionable \\\"Try:\\\" suggestions\\n- Exports: format(), formatForToast(), logFormatted(), ErrorFormatter service\\n\\n**Updated KeyboardService:**\\n- showErrorToast() now uses formatForToast() for rich error messages\\n- Merge error handling uses formatForToast()\\n\\n**Updated atoms.ts:**\\n- Task creation error uses formatForToast()\\n\\n**Updated Toast component:**\\n- Multi-line message support (for error + suggestion)\\n- Error toasts now last 8 seconds (vs 5 for info/success)\\n- Wider max width (70 chars) to accommodate suggestions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:59:45.712759+11:00","updated_at":"2025-12-18T02:14:02.604498+11:00","closed_at":"2025-12-17T16:28:45.033741+11:00","deleted_at":"2025-12-18T02:14:02.604498+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"feature"}
{"id":"az-z5n","title":"i feel like any beads that have a tmux session should be in progress","description":"currently you can have tmux sessions running on open/closed beads","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:35:21.548241+11:00","updated_at":"2025-12-16T22:04:52.421753+11:00","closed_at":"2025-12-16T22:04:52.421753+11:00"}
{"id":"az-zby","title":"bd sync incorrectly tombstones issues that exist in JSONL","description":"When running `bd sync`, issues that exist in both the JSONL (from git) and the local database are incorrectly tombstoned instead of being reconciled.\n\n**Symptoms:**\n- After `bd sync`, issues disappear from the TUI/CLI\n- Database shows issues as `status='tombstone'` \n- JSONL file still contains the issues with valid status (open/closed)\n- No entries in deletions.jsonl for these tombstoned issues\n\n**Root cause hypothesis:**\nThe sync merge logic treats \"issue in JSONL but state differs from DB\" as \"deleted\" rather than \"updated from another branch\". This particularly affects issues merged from worktree branches.\n\n**Workaround:**\nManual SQL recovery to restore status from JSONL:\n```sql\nUPDATE issues SET status='\u003cjsonl_status\u003e', closed_at='\u003cjsonl_closed_at\u003e' WHERE id='\u003cid\u003e';\n```\n\n**Affected:** 21 issues in one incident (2025-12-18)","notes":"**Additional finding (2025-12-18):**\n\n`bd sync --import-only` does NOT recover tombstoned issues. It says \"8 skipped\" for issues that are tombstoned in the database but have valid status in JSONL.\n\nThe import logic appears to skip any issue that already exists in the DB, regardless of whether it's tombstoned. It should compare the JSONL status against DB status and update if JSONL has a non-tombstone status.\n\n**Affected code path:**\n- Azedarach's PRWorkflow.ts:724 calls `syncImportOnly` after git merge\n- This call is silently failing to recover tombstoned issues\n- The `Effect.catchAll(() =\u003e Effect.void)` means failures are swallowed\n\n**The fix should be in beads' import logic** - when importing from JSONL:\n1. If JSONL status is valid (not tombstone) AND DB status is tombstone\n2. Update DB to match JSONL status (un-tombstone the issue)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T02:12:15.839482+11:00","updated_at":"2025-12-18T02:16:18.616471+11:00","labels":["beads-upstream","data-loss"]}
{"id":"az-zg9j","title":"Stretch: configurable subagents vs external sessions","description":"Future enhancement: make it configurable whether orchestrator uses Task tool subagents or spawns external Claude Code sessions for true parallelism","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-19T11:14:04.695528+11:00","updated_at":"2025-12-19T11:14:04.695528+11:00","dependencies":[{"issue_id":"az-zg9j","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.945128+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-zg9j","depends_on_id":"az-md0x","type":"blocks","created_at":"2025-12-19T11:14:22.411606+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-zqi","title":"Full bead editor (Space+e)","description":"Open selected bead in $EDITOR with structured markdown format. Parse on save, validate structure, discard if invalid, update via bd CLI if valid.","design":"Format:\n```markdown\n# {id}: {title}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nType:     {type}        (read-only)\nPriority: {P0-P4}\nStatus:   {status}\nAssignee: {assignee}\nLabels:   {comma-separated}\nEstimate: {minutes}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Description\n\n{description}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Design\n\n{design}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Notes\n\n{notes}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Acceptance Criteria\n\n{acceptance}\n```\n\nValidation:\n- Header must match `# {id}: {title}`\n- Separator lines: 20+ ‚îÄ chars\n- Priority: P0-P4\n- Status: open|in_progress|blocked|closed\n- Section headers required\n\nFlow:\n1. Space+e ‚Üí write /tmp/azedarach-{id}.md\n2. Spawn $EDITOR (blocking)\n3. Parse markdown on return\n4. Validate ‚Üí show error toast if invalid\n5. Diff against original ‚Üí bd update changed fields\n6. Refresh tasksAtom","notes":"Type change handling:\nIf user changes Type: field (e.g., task ‚Üí epic), the editor must:\n1. Detect type changed during parse\n2. bd create --type=newType with all other fields ‚Üí get new ID\n3. Copy dependencies: bd dep add new-id (for each dep)\n4. bd delete old-id\n5. Navigate TUI to new bead\n\nThis is necessary because bd update cannot change issue_type after creation.\n\nFormat is Azedarach-owned since bd has no full-bead format - only per-field edit (bd edit --notes) or CLI flags (bd update --notes='...').","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:59:31.596266+11:00","updated_at":"2025-12-12T12:20:24.690791+11:00","closed_at":"2025-12-12T12:20:24.690791+11:00","dependencies":[{"issue_id":"az-zqi","depends_on_id":"az-shv","type":"blocks","created_at":"2025-12-12T10:59:35.281709+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-zu3","title":"Implement hybrid state detection: native hooks + PTY monitoring","description":"Design and implement a hybrid state detection system that combines Claude Code's native hooks (authoritative state) with PTY output monitoring (supplementary signals).\n\n## Architecture\n- Native hooks (idle_prompt, stop, session_end) provide authoritative state transitions\n- PTY stream provides error pattern detection and \"busy\" feedback\n- State aggregator reconciles signals into final state\n\n## Benefits\n- Authoritative state from hooks\n- Graceful degradation if hooks fail\n- Error detection via PTY patterns\n- Future-proof as Claude adds more hooks\n\n## Depends on\n- az-lsi (native hook integration - provides foundation)","notes":"## Implementation Plan Approved\n\n### Approach\n- Full PTYMonitor service (separate scoped service)\n- Full state detection (busy, error, done using existing StateDetector patterns)\n- Hooks take priority (2s window after hook fires)\n- 500ms polling interval\n\n### Files to Modify\n1. `src/core/TmuxService.ts` - Add `capturePane` method\n2. `src/core/PTYMonitor.ts` - Create new service (~180 lines)\n3. `src/ui/atoms.ts` - Wire PTYMonitor, update session atoms\n4. `src/services/BoardService.ts` - Integrate metrics into loadTasks\n\n### Types Already Exist\n- SessionMetrics, AgentPhase, TaskWithSession in src/ui/types.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T01:04:40.22594+11:00","updated_at":"2025-12-17T16:45:38.912457+11:00","closed_at":"2025-12-17T16:45:38.912457+11:00","close_reason":"Implemented hybrid state detection with PTYMonitor service. Added: TmuxService.capturePane, PTYMonitor service (token extraction, session registration, hook priority, 500ms polling), BoardService integration for metrics, atoms wiring for reactive UI updates. Fixed unrelated CLI import type error.","dependencies":[{"issue_id":"az-zu3","depends_on_id":"az-lsi","type":"blocks","created_at":"2025-12-17T01:04:47.033729+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-zv6","title":"Automation \u0026 Workflows","description":"Automated workflows: PR creation, state transition hooks, notifications, and beads sync coordination.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:04.97152+11:00","updated_at":"2025-12-11T14:44:04.97152+11:00"}
