{"id":"az-010","title":"[Deleted]","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-17T03:55:46.593449Z","updated_at":"2025-12-17T14:56:41.393066+11:00","deleted_at":"2025-12-17T03:55:46.593449Z","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-01oo","title":"use better formatting for elapsed time. e.g. hours, days etc not just minutes","design":"## Problem\nCurrent elapsed time shows as `MM:SS` (e.g., \"61:05\"), which becomes hard to read for longer sessions and doesn't show days/hours clearly.\n\n## Solution\nImplement adaptive elapsed time formatting that shows the most relevant units:\n- Under 1 minute: `45s`\n- Under 1 hour: `5m 30s`  \n- Under 1 day: `2h 15m`\n- 1+ days: `1d 3h`\n\n## Changes\n1. **`src/services/ClockService.ts`**: Update `formatElapsedMs()` to use adaptive formatting\n   - Keep the existing function signature (takes ms, returns string)\n   - Implement unit selection logic based on total duration\n   - Show at most 2 units for readability\n\n2. **`src/ui/DetailPanel.tsx`**: Remove duplicate `formatDuration()` \n   - Import and use the shared `formatElapsedMs()` instead\n   - Ensures consistent formatting across the app\n\n## Testing\n- Verify task card timer updates correctly\n- Verify detail panel duration displays correctly\n- Check edge cases: \u003c1min, exactly 1h, multi-day sessions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T03:50:33.940037+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T01:59:33.604917+11:00","close_reason":"Implemented using Effect's Duration.format for human-readable elapsed time (e.g., \"1h 5m 30s\")","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-04d","title":"Add \"Merge to main\" action for completed worktree tasks","description":"When a task is done (manual mode, not CV mode), user should be able to press Space ‚Üí m to merge the worktree branch to main and clean up.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T21:49:14.135837+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T22:21:47.442705+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-05na","title":"add filter mode where i can filter by stuff like status, priority, session, type, etc","design":"## Filter Mode Design\n\n### Overview\nAdd a menu-based filter mode (triggered by `f` key) that allows filtering tasks by:\n- **Status**: open, in_progress, blocked, closed\n- **Priority**: P0, P1, P2, P3, P4\n- **Type**: bug, feature, task, epic, chore\n- **Session state**: idle, busy, waiting, done, error, paused\n\n### UI Pattern\nFollow the existing SortMenu pattern - a floating panel in bottom-right showing filter options with single-key toggles.\n\n### Key Decisions\n1. **Trigger**: `f` key enters filter mode\n2. **UI Style**: Menu-based (like sort mode) - more discoverable than text syntax\n3. **Persistence**: Filters persist until explicitly cleared (like search)\n4. **Fields**: Core fields only (status, priority, type, session)\n\n### Architecture\n\n#### 1. EditorService Changes\n```typescript\n// New types\ntype FilterField = \"status\" | \"priority\" | \"type\" | \"session\"\n\ninterface FilterConfig {\n  status: Set\u003cIssueStatus\u003e      // Empty = show all\n  priority: Set\u003cnumber\u003e          // Empty = show all\n  type: Set\u003cIssueType\u003e          // Empty = show all\n  session: Set\u003cSessionState\u003e     // Empty = show all\n}\n\n// New mode variant\n| { readonly _tag: \"filter\"; readonly activeField: FilterField | null }\n\n// New state\nfilterConfig: SubscriptionRef\u003cFilterConfig\u003e\n```\n\n#### 2. Keyboard Flow\n- `f` ‚Üí Enter filter mode (show menu)\n- In filter mode:\n  - `s` ‚Üí Toggle status sub-menu\n  - `p` ‚Üí Toggle priority sub-menu  \n  - `t` ‚Üí Toggle type sub-menu\n  - `S` (shift) ‚Üí Toggle session sub-menu\n  - Number keys (0-4) ‚Üí Toggle priority when in priority sub-menu\n  - Letter keys ‚Üí Toggle specific values in active sub-menu\n  - `c` ‚Üí Clear all filters\n  - `Escape` ‚Üí Exit filter mode\n\n#### 3. FilterMenu Component\nSimilar to SortMenu - positioned bottom-right, shows:\n- Current active filters (highlighted)\n- Sub-menu keys (s/p/t/S)\n- When sub-menu active, show toggle options\n\n#### 4. BoardService Integration\nExtend `filterTasks()` to apply FilterConfig alongside search query:\n```typescript\nconst filterTasks = (\n  tasks: TaskWithSession[], \n  query: string,\n  filterConfig: FilterConfig\n): TaskWithSession[]\n```\n\n#### 5. Filter Indicator\nShow active filter count in status bar: `[3 filters]`\n\n### Files to Modify\n1. `src/services/EditorService.ts` - Add filter mode and FilterConfig\n2. `src/services/keyboard/types.ts` - Add \"filter\" to KeyMode\n3. `src/services/keyboard/bindings.ts` - Add `f` binding\n4. `src/services/keyboard/InputHandlersService.ts` - Handle filter mode keys\n5. `src/services/BoardService.ts` - Extend filtering logic\n6. `src/ui/FilterMenu.tsx` - New component (like SortMenu)\n7. `src/ui/atoms/mode.ts` - Add filterConfig atom\n8. `src/ui/App.tsx` - Render FilterMenu, update status bar\n9. `docs/keybindings.md` - Document new bindings","acceptance_criteria":"- [ ] `f` key enters filter mode showing FilterMenu\n- [ ] Can filter by status (s key, then toggle specific statuses)\n- [ ] Can filter by priority (p key, then 0-4 to toggle)\n- [ ] Can filter by type (t key, then toggle specific types)\n- [ ] Can filter by session state (S key, then toggle states)\n- [ ] Multiple filters combine with AND logic\n- [ ] Filters persist until cleared (`c` key)\n- [ ] Status bar shows active filter count\n- [ ] Escape exits filter mode\n- [ ] Filtered tasks update reactively across all columns\n- [ ] Documentation updated in keybindings.md","notes":"## Implementation Complete ‚úÖ\n\n### Files Changed\n1. **src/services/EditorService.ts** - Added FilterConfig, filter mode type, all filter methods\n2. **src/services/keyboard/types.ts** - Added \"filter\" to KeyMode\n3. **src/services/keyboard/bindings.ts** - All filter keybindings (f, s, p, t, S, e, c, toggles)\n4. **src/services/keyboard/InputHandlersService.ts** - Added filter mode case\n5. **src/services/BoardService.ts** - Extended filterTasks, added isEpicChild computation\n6. **src/services/NavigationService.ts** - Updated to pass filterConfig\n7. **src/ui/FilterMenu.tsx** - New component with sub-menus and hideEpicSubtasks toggle\n8. **src/ui/atoms/mode.ts** - filterConfigAtom, activeFilterFieldAtom, enterFilterAtom\n9. **src/ui/atoms/index.ts** - Exported new atoms\n10. **src/ui/hooks/useEditorMode.ts** - Added filter state and actions\n11. **src/ui/App.tsx** - Integrated FilterMenu, updated modeDisplay\n12. **src/ui/StatusBar.tsx** - Added filter mode keybinding hints\n13. **src/ui/types.ts** - Added isEpicChild to TaskWithSession\n14. **docs/keybindings.md** - Full filter mode documentation\n\n### Features Implemented\n- **f** key enters filter mode\n- **s/p/t/S** sub-menus for status/priority/type/session\n- Toggle individual values within each field\n- **e** toggles hideEpicSubtasks (ON by default - encourages drill-down)\n- **c** clears all filters\n- Filters persist until cleared\n- Combines with text search (/)\n- Reactive updates across all columns\n\n### Type Check: PASSING ‚úÖ","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:49:34.854715+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T13:51:06.436503+11:00","close_reason":"Implemented filter mode with FilterMenu component, keybindings for filtering by status/priority/type/session, and documented in keybindings.md","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-05y","title":"Project Foundation","description":"Set up the core project infrastructure: TypeScript, Ink, CLI scaffolding, and foundational utilities.","notes":"Session 2025-12-11:\n\nEPIC PROGRESS: 3/4 tasks completed (75%)\n\nCOMPLETED CHILDREN:\n- az-ags: Project scaffolding ‚úÖ\n- az-fvj: BeadsClient Effect service ‚úÖ\n- az-kis: Utility modules ‚úÖ\n\nREMAINING:\n- az-2qy: CLI argument parsing with @effect/cli (ready to start)\n\nPHASE 1 DELIVERABLES:\n- Full project infrastructure with Bun + Effect + OpenTUI + SolidJS\n- Working CLI entry point (./bin/az.ts)\n- Core services: BeadsClient, TmuxService, TerminalService\n- Custom effect-atom SolidJS adapter (az-mq9, separate from this epic)\n\nNEXT SESSION:\n- Complete az-2qy (CLI parsing) to close this epic\n- Then move to Phase 2: TUI components (az-pza epic)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.657366+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:24:42.833983+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"az-06p","title":"TUI polish: card heights, priority labels, sticky action mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:23:49.590359+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:23:55.435441+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-09e","title":"Modularize KeyboardService into domain-specific handlers","description":"KeyboardService.ts is 1,572 lines - the largest service in the codebase.\n\nRefactor into smaller, focused modules:\n- **SessionKeyHandlers** - start/stop/pause/attach session actions\n- **NavigationKeyHandlers** - movement, selection, goto\n- **TaskKeyHandlers** - create/edit/delete/move tasks\n- **PRKeyHandlers** - PR creation, merge, cleanup\n- **ModeKeyHandlers** - mode transitions (search, command, etc.)\n\nEach module exports handler functions that KeyboardService composes.\nThis improves maintainability and makes testing individual handlers easier.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:44.99229+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:54:21.233588+11:00","close_reason":"KeyboardService modularized: 1,571 ‚Üí 236 lines main file, 7 new domain-specific modules created","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"az-09xq","title":"Migrate layout to flexbox using stickers library","description":"Replace manual height/width calculations with stickers flexbox. Current code has manual calculations in model.go for board view, compact view, status bar placement, and column rendering. Stickers provides CSS-like flexbox for bubbletea that handles responsive layouts automatically.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T00:58:57.826471+11:00","updated_at":"2026-01-05T01:02:29.30826+11:00","closed_at":"2026-01-05T01:02:29.30826+11:00","close_reason":"Migrated main layout to use stickers flexbox. Replaced manual height calculations with flexbox.Row/Cell API. All tests pass."}
{"id":"az-0gh","title":"pretooluse hook seems to trigger before requesting permissions and other stuff","description":"so we should be able to use it to update session status in az right?","notes":"## Implementation Complete ‚úÖ\n\n### Changes Made\n\n**1. `src/cli/index.ts`** - Added `pretooluse` to VALID_HOOK_EVENTS\n- az notify now accepts pretooluse as a valid event type\n\n**2. `src/core/HookReceiver.ts`** - Updated HookEventType and mapEventToState\n- Added `pretooluse` and `permission_request` to the union type\n- Documented the event timing in comments\n- Added state mappings:\n  - `pretooluse` ‚Üí \"busy\" (Claude attempting tool)\n  - `permission_request` ‚Üí \"waiting\" (needs user approval)\n\n**3. `src/core/hooks.ts`** - Added PreToolUse hook to generateHookConfig\n- New sessions will automatically get PreToolUse hook installed\n- Fires BEFORE permission checks for immediate busy detection\n\n### State Transition Flow\n\n```\nClaude decides to use tool\n    ‚Üì\nPreToolUse fires ‚Üí \"busy\"\n    ‚Üì\nPermission system checks\n    ‚Üì\nPermissionRequest fires (if needed) ‚Üí \"waiting\"\n    ‚Üì\nUser approves ‚Üí tool executes ‚Üí \"busy\" continues\n    ‚Üì\nStop fires ‚Üí \"waiting\"\n```\n\n### Testing\n\n- Type check passes\n- Manual testing: Create new worktree, run `az install-hooks`, verify pretooluse hook in settings.local.json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:36:08.601508+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:21:07.838832+11:00","close_reason":"Implemented PreToolUse hook for immediate busy detection. Also fixed permission_request mapping which was missing.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-0h0","title":"TEST BEAD","description":"check bun version in a claude session made by az","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:04.88589+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T14:25:09.65145+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-0h3d","title":"Create orchestrator session template","description":"Create .claude/session-templates/orchestrator.md that injects:\n- Epic context (title, description, design, acceptance criteria)\n- Child task list with statuses\n- Coordination rules for serial subagent execution\n- Instructions to use Task tool for implementation\n- How to update beads with progress","design":"## Implementation Plan\n\n**File:** `.claude/session-templates/orchestrator.md`\n\n**Template Structure:**\n1. **Header** - Identify as orchestrator session with epic ID\n2. **Epic Context Section** - Inject epic details via mustache variables:\n   - `{{EPIC_ID}}`, `{{EPIC_TITLE}}`\n   - `{{EPIC_DESCRIPTION}}`, `{{EPIC_DESIGN}}`, `{{EPIC_ACCEPTANCE}}`\n3. **Child Tasks Table** - Formatted list showing:\n   - Task ID, title, status, priority\n   - Dependencies between children\n   - Use `{{#CHILDREN}}...{{/CHILDREN}}` block iteration\n4. **Orchestration Rules**:\n   - Spawn Task tool subagents in parallel batches\n   - Use `run_in_background: true` for parallelism\n   - Monitor with `TaskOutput` tool\n   - Update beads on completion/blockers\n5. **Workflow Instructions**:\n   - How to spawn subagents (with example)\n   - How to update beads with progress\n   - When to mark epic complete\n   - Error handling patterns\n6. **Beads Commands Reference** - Quick reference for bd CLI\n\n**Key Design Decisions:**\n- Use same mustache syntax as worker.md for consistency\n- Focus on Task tool usage patterns (different from worker template)\n- No quality-gate mention yet (az-j7qi in progress)\n- Include parallel batch spawning patterns\n\n**Variables Needed (for SessionManager):**\n- `EPIC_ID`, `EPIC_TITLE`, `EPIC_DESCRIPTION`, `EPIC_DESIGN`, `EPIC_ACCEPTANCE`\n- `CHILDREN` (array): `TASK_ID`, `TASK_TITLE`, `TASK_STATUS`, `TASK_PRIORITY`, `TASK_DESCRIPTION`, `TASK_DESIGN`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.3656+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T11:52:04.54913+11:00","close_reason":"Created .claude/session-templates/orchestrator.md with: epic context injection (mustache variables), child task listing with status/priority/deps, Task tool subagent spawning patterns (parallel batches), TaskOutput monitoring workflow, beads CLI reference, coordination rules for parallel safety and error recovery","dependencies":[{"issue_id":"az-0h3d","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.677462+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-0n59","title":"Migrate board view to use bubbletea components (list, textarea, viewport)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:18:29.827422+11:00","updated_at":"2026-01-05T02:22:53.343866+11:00","closed_at":"2026-01-05T02:22:53.343866+11:00","close_reason":"Migrated board view to use bubbletea list components. Created TaskItem and TaskItemDelegate in taskitem.go. Updated board.go to use list.Model for each column with proper variable-height item support. Removed Padding(0,1) from StatusBar style to reduce vertical space.","dependencies":[{"issue_id":"az-0n59","depends_on_id":"az-by4t","type":"discovered-from","created_at":"2026-01-05T02:18:35.382499+11:00","created_by":"riordan"}]}
{"id":"az-0uey","title":"occaisional issue with space s \"worktree created but not found in list\"","description":"attached image","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:28:54.439086+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T15:39:51.361674+11:00","close_reason":"Fixed race condition in WorktreeManager.create() by adding retry logic with Schedule. Git worktree list can sometimes miss newly created worktrees due to filesystem sync timing. Now retries up to 5 times with 100ms delays.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-0y87","title":"use prompt injection instead of making the prompt \"use bd show to get the task details\"","description":"so fully inject the bead contents instead of them having to use bd show","design":"## Implementation Plan\n\n### Problem\nThe current prompt tells Claude to run `bd show ${task.id}` to get the full bead context. This requires an extra tool call and adds latency.\n\n### Solution\nInject the full bead contents directly into the initial prompt. The `task` object (type `TaskWithSession extends Issue`) already contains all the fields we need:\n- `description` - task description\n- `design` - design notes  \n- `acceptance` - acceptance criteria\n- `notes` - general notes\n- `dependencies` / `dependents` - blocking info\n\n### Changes Required\n\n**File: `src/services/keyboard/SessionHandlersService.ts`**\n\n1. **`startSessionWithPrompt()` (lines 131-138)**: Modify the prompt construction to:\n   - Include `task.description` if present\n   - Include `task.design` if present\n   - Include `task.acceptance` if present\n   - Include dependency/blocker info if present\n   - Remove the \"Run `bd show`\" instruction\n\n2. **`startSessionDangerous()` (lines 201-208)**: Apply same changes (duplicated prompt)\n\n3. **`chatAboutTask()` (lines 262-275)**: Update chat prompt similarly\n\n### Prompt Structure (after change)\n\n```\nwork on bead ${task.id} (${task.issue_type}): ${task.title}\n\n[Description section if present]\n[Design Notes section if present]\n[Acceptance Criteria section if present]\n[Dependencies section if blockers exist]\n\nBefore starting implementation:\n1. If ANYTHING is unclear or underspecified, ASK ME questions before proceeding\n2. Update the bead with your implementation plan using `bd update ${task.id} --design=\"...\"`\n\nGoal: Make this bead self-sufficient so any future session could pick it up.\n```\n\n### Benefits\n- No extra `bd show` tool call needed\n- Claude has immediate context on session start\n- Consistent with worker.md template pattern\n- Faster session startup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T03:46:12.071611+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T18:20:33.215188+11:00","close_reason":"Implemented prompt injection for bead context. Now injects description, design notes, acceptance criteria, and blockers directly into initial prompts for startSessionWithPrompt(), startSessionDangerous(), and chatAboutTask(). No longer requires Claude to run `bd show` to get task details.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-1app","title":"create our own git diff tui for space f","description":"brainstorm features with me but my vision is basically just difftastic side by side, two or three modes: fzf/filetree/infinite scroll. fzf/filetree to find/filter files and an infinite scroll view (difftastic default)","design":"## DiffViewer TUI for Space+f\n\n### Overview\nFullscreen overlay that shows git diff (vs main) with three layout modes:\n1. **Split view (default)** - File picker on left (30%), diff content on right (70%)\n2. **Maximized diff** - Full-width diff view (file picker hidden)  \n3. **File picker only** - For quick file navigation\n\n### File Picker Modes (toggle with Tab)\n- **FZF mode** - Flat fuzzy-searchable list of changed files\n- **Tree mode** - Directory hierarchy view with expand/collapse\n\n### Diff Rendering\n- Shell out to `difft --display=side-by-side` per file\n- Capture ANSI output, render in scrollable OpenTUI view\n- For \"all files\" view: `GIT_EXTERNAL_DIFF=\"difft --display=side-by-side\" git diff main...HEAD`\n- Comparison target: `main...HEAD` (configurable baseBranch)\n\n### Keybindings\n| Key | Action |\n|-----|--------|\n| `Esc` | Exit to board |\n| `Tab` | Toggle fzf ‚Üî tree in file picker |\n| `j/k` | Navigate files / scroll diff |\n| `h/l` | Switch focus: file picker ‚Üî diff |\n| `Enter` | Select file ‚Üí show its diff |\n| `f` | Toggle file picker visibility (maximize diff) |\n| `/` | Search/filter mode |\n| `g/G` | Top/bottom of diff |\n| `{/}` | Previous/next file in diff |\n| `a` | Show all files diff (infinite scroll mode) |\n\n### Architecture\n```\nsrc/\n‚îú‚îÄ‚îÄ ui/\n‚îÇ   ‚îî‚îÄ‚îÄ DiffViewer/\n‚îÇ       ‚îú‚îÄ‚îÄ DiffViewer.tsx       # Main overlay component  \n‚îÇ       ‚îú‚îÄ‚îÄ FilePicker.tsx       # FZF/Tree file picker\n‚îÇ       ‚îú‚îÄ‚îÄ DiffContent.tsx      # Scrollable diff display\n‚îÇ       ‚îî‚îÄ‚îÄ types.ts             # Shared types\n‚îÇ\n‚îú‚îÄ‚îÄ services/\n‚îÇ   ‚îî‚îÄ‚îÄ DiffService.ts           # Git operations, difftastic subprocess\n```\n\n### DiffService API\n```typescript\ninterface ChangedFile {\n  path: string\n  status: \"added\" | \"modified\" | \"deleted\" | \"renamed\"\n  oldPath?: string  // for renames\n}\n\n// Get list of changed files\ngetChangedFiles(worktreePath: string, baseBranch: string): Effect\u003cChangedFile[]\u003e\n\n// Get difftastic output for single file\ngetFileDiff(worktreePath: string, baseBranch: string, filePath: string): Effect\u003cstring\u003e\n\n// Get difftastic output for all files  \ngetFullDiff(worktreePath: string, baseBranch: string): Effect\u003cstring\u003e\n```\n\n### State Management\n```typescript\ninterface DiffViewerState {\n  // Layout\n  layout: \"split\" | \"diff-only\" | \"picker-only\"\n  \n  // File picker\n  pickerMode: \"fzf\" | \"tree\"\n  files: ChangedFile[]\n  selectedIndex: number\n  filterText: string\n  \n  // Diff content\n  currentFile: string | null  // null = all files\n  diffContent: string\n  scrollOffset: number\n  \n  // Focus\n  focus: \"picker\" | \"diff\"\n}\n```\n\n### Integration Points\n- Replace current `showDiff` in PRHandlersService\n- Add DiffViewer to OverlayService stack types\n- Wire up Space+f to open overlay instead of tmux popup","acceptance_criteria":"## Acceptance Criteria\n\n### Must Have\n- [ ] Fullscreen overlay opens on Space+f (replaces lazygit popup)\n- [ ] Shows list of changed files vs main branch\n- [ ] File picker supports both FZF (flat) and Tree views, toggle with Tab\n- [ ] Selecting a file shows difftastic side-by-side output for that file\n- [ ] Can view all-files diff in infinite scroll mode\n- [ ] Proper scrolling with j/k/g/G in diff content\n- [ ] Esc exits cleanly back to board\n- [ ] Works for any task with an active worktree\n\n### Should Have  \n- [ ] Fuzzy search filtering in FZF mode (/ key)\n- [ ] Previous/next file navigation while in diff ({ and } keys)\n- [ ] Toggle file picker visibility (f key) to maximize diff\n- [ ] h/l to switch focus between panels\n\n### Nice to Have\n- [ ] Expand/collapse directories in tree mode\n- [ ] Show file status indicators (A/M/D/R) in picker\n- [ ] Remember scroll position when switching files\n- [ ] Search within diff content (/ in diff panel)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:47:14.538041+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T23:26:04.09691+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-1lu4","title":"setup ~/prog/Chefy with az devServer config","description":"need VITE_PORT=3000 and VITE_SERVER_PORT=8080 i think","design":"## Implementation Plan\n\nAdd `devServer` section to ~/prog/Chefy/.azedarach.json with port configuration for Vite:\n\n```json\n\"devServer\": {\n  \"ports\": {\n    \"web\": { \"default\": 3000, \"aliases\": [\"VITE_PORT\"] },\n    \"server\": { \"default\": 8080, \"aliases\": [\"VITE_SERVER_PORT\"] }\n  }\n}\n```\n\n### How Azedarach DevServer Works\n\nWhen you press `Space+d` on a bead in Azedarach to start a dev server:\n\n1. **Port Allocation**: DevServerService allocates ports sequentially to avoid conflicts\n   - First worktree gets 3000/8080\n   - Second worktree gets 3001/8081, etc.\n\n2. **Environment Injection**: The configured aliases are set as environment variables\n   - `VITE_PORT=3000` and `VITE_SERVER_PORT=8080`\n\n3. **Command Detection**: Auto-detects `pnpm run dev` from package.json\n\n4. **tmux Session**: Runs in its own tmux session (`az-dev-\u003cbeadId\u003e`)\n\nThis enables parallel dev servers for multiple worktrees without port conflicts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:24:08.797637+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T20:43:16.682304+11:00","close_reason":"Added devServer config to ~/prog/Chefy/.azedarach.json with VITE_PORT=3000 and VITE_SERVER_PORT=8080","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-1w6h","title":"space f diff is not using configured base branch!","description":"## Problem\n\nThe `Space+f` diff command (and other PR-related commands) use `gitConfig.baseBranch` which is captured **once at service construction time** in `PRHandlersService.ts` (line 64):\n\n```typescript\nconst gitConfig = yield* appConfig.getGitConfig()\n```\n\nThis means when:\n1. A user switches projects with `gp` (project selector)\n2. The new project has a different `git.baseBranch` in its `.azedarach.json` (e.g., `develop` instead of `main`)\n\n...the diff still compares against the **old** project's base branch.\n\n## Root Cause\n\nEffect services capture dependencies at construction time. Since `PRHandlersService` grabs `gitConfig` once during initialization, it doesn't update when `AppConfig.config` (a `SubscriptionRef`) changes.\n\n## Affected Locations in PRHandlersService.ts\n\nAll 5 uses of `gitConfig.baseBranch`:\n- Line 147: `Updating from ${gitConfig.baseBranch}...` (toast in updateFromBase)\n- Line 153: `Updated from ${gitConfig.baseBranch}` (success toast)\n- Line 187: `Syncing with ${gitConfig.baseBranch} before PR...` (toast in createPR)\n- Line 478: `createDiffCommand(gitConfig.baseBranch)` (showDiff)\n- Line 481: `title: \\` diff: ${task.id} vs ${gitConfig.baseBranch} \\`` (popup title)","design":"## Solution\n\nInstead of capturing `gitConfig` once at construction time, call `appConfig.getGitConfig()` **fresh** inside each handler method.\n\n### Pattern Change\n\n**Before (stale):**\n```typescript\neffect: Effect.gen(function* () {\n  const appConfig = yield* AppConfig\n  const gitConfig = yield* appConfig.getGitConfig()  // ‚ùå Captured once\n  \n  const showDiff = () =\u003e\n    Effect.gen(function* () {\n      yield* tmux.displayPopup({\n        command: createDiffCommand(gitConfig.baseBranch),  // ‚ùå Uses stale value\n      })\n    })\n})\n```\n\n**After (fresh):**\n```typescript\neffect: Effect.gen(function* () {\n  const appConfig = yield* AppConfig  // Keep appConfig ref\n  // DON'T capture gitConfig here\n  \n  const showDiff = () =\u003e\n    Effect.gen(function* () {\n      const gitConfig = yield* appConfig.getGitConfig()  // ‚úÖ Fresh per call\n      yield* tmux.displayPopup({\n        command: createDiffCommand(gitConfig.baseBranch),  // ‚úÖ Current value\n      })\n    })\n})\n```\n\n### Files to Modify\n\n1. **`src/services/keyboard/PRHandlersService.ts`**\n   - Remove line 64: `const gitConfig = yield* appConfig.getGitConfig()`\n   - In `updateFromBase()`: Add `const gitConfig = yield* appConfig.getGitConfig()` at start\n   - In `createPR()`: Add `const gitConfig = yield* appConfig.getGitConfig()` at start\n   - In `showDiff()`: Add `const gitConfig = yield* appConfig.getGitConfig()` at start","acceptance_criteria":"- [ ] `Space+f` uses the current project's configured `git.baseBranch`, not stale value\n- [ ] `Space+u` (update from base) uses current project's base branch in toast messages\n- [ ] `Space+P` (create PR) uses current project's base branch when syncing before PR\n- [ ] Switching projects with `gp` causes subsequent diff/PR operations to use new project's config\n- [ ] Type check passes: `bun run type-check`\n- [ ] Build succeeds: `bun run build`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T03:44:56.029026+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T16:47:26.82613+11:00","close_reason":"Fixed by fetching gitConfig fresh in each handler method instead of at service construction time. This ensures Space+f, Space+u, and Space+P use the current project's configured git.baseBranch when projects are switched via gp.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-1zd0","title":"improve claude initial prompts","description":"e.g. if the bead is not clear enough make sure the space s/S prompts say to ask questions and upgrade the bead till its clear and could be picked up by any claude session without extra research","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:57:42.883524+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T02:23:16.906311+11:00","close_reason":"Merged to main: Improved Claude initial prompts to encourage bead self-sufficiency","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-25ph","title":"toggling any dev server needs to come with all PORT envs for all servers","description":"so when i toggle Chefy's web server it should grab a port for the server server too and set that env var in the web server. if i then toggle server server we use both the same env vars as the web server","design":"## Problem\nWhen toggling a dev server (e.g., \"web\"), only that server's port env vars are set (e.g., VITE_PORT=5173). But the web server may need to know the API server's port to configure API URLs.\n\n## Solution\nChange port allocation to be **per-bead** rather than **per-server**:\n\n1. **First server for a bead**: Allocate ALL ports from ALL configured servers and store them\n2. **Subsequent servers**: Reuse the same port allocations from the first server\n\n## Implementation\n\n### 1. Add bead-level port allocation tracking\nStore allocated ports per-bead in a new Ref:\n```typescript\n// Map from beadId -\u003e { envVar -\u003e allocatedPort }\nconst beadPortsRef = yield* Ref.make\u003cMap\u003cstring, Record\u003cstring, number\u003e\u003e\u003e(new Map())\n```\n\n### 2. Modify `getPortEnv` to work at bead level\n```typescript\nconst getOrAllocateBeadPorts = (beadId: string, allServers: Record\u003cstring, ServerConfig\u003e) =\u003e\n  Effect.gen(function* () {\n    const existing = yield* Ref.get(beadPortsRef)\n    if (existing.has(beadId)) {\n      return existing.get(beadId)!\n    }\n    \n    // First server for this bead - allocate ALL ports from ALL servers\n    const ports: Record\u003cstring, number\u003e = {}\n    const beadServers = yield* getBeadServers(beadId)\n    const offset = HashMap.size(HashMap.filter(beadServers, s =\u003e s.status === \"running\"))\n    \n    for (const serverConfig of Object.values(allServers)) {\n      for (const [envVar, basePort] of Object.entries(serverConfig.ports ?? {})) {\n        if (!ports[envVar]) {\n          ports[envVar] = yield* allocatePort(basePort + offset)\n        }\n      }\n    }\n    \n    yield* Ref.update(beadPortsRef, m =\u003e new Map(m).set(beadId, ports))\n    return ports\n  })\n```\n\n### 3. Update `start()` to use bead-level ports\n```typescript\n// In start():\nconst allServerConfigs = config.servers ?? {}\nconst beadPorts = yield* getOrAllocateBeadPorts(beadId, allServerConfigs)\n\n// Build env string with ALL ports\nconst envStr = Object.entries(beadPorts)\n  .map(([k, v]) =\u003e `${k}=${v}`)\n  .join(\" \")\n\n// Primary port is still this server's first port\nconst thisPorts = srvConfig.ports ?? {}\nconst primary = beadPorts[Object.keys(thisPorts)[0]] ?? 3000\n```\n\n### 4. Update `stop()` to release ports only when last server stops\n```typescript\n// In stop():\nconst remainingServers = HashMap.filter(beadServers, s =\u003e \n  s.name !== name \u0026\u0026 s.status === \"running\"\n)\nif (HashMap.size(remainingServers) === 0) {\n  // Last server stopping - release all bead ports\n  const beadPorts = yield* Ref.get(beadPortsRef)\n  for (const port of Object.values(beadPorts.get(beadId) ?? {})) {\n    yield* releasePort(port)\n  }\n  yield* Ref.update(beadPortsRef, m =\u003e { m.delete(beadId); return m })\n}\n```\n\n### 5. Handle discovery on startup\nWhen discovering existing servers, reconstruct beadPortsRef from their stored ports.\n\n## Files to modify\n- `src/services/DevServerService.ts` - Core logic changes\n\n## Edge cases\n- Two servers with same env var name ‚Üí first one wins (deduplicated)\n- Server stops then restarts ‚Üí reuses same bead ports if other servers still running\n- All servers stop ‚Üí ports released, next start gets fresh allocation","notes":"üìé [mjj85j35-tbcz.png](.beads/images/az-25ph/mjj85j35-tbcz.png) (clipboard, 12/24/2025, 10:37:07 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:37:04.237362+11:00","updated_at":"2025-12-29T15:05:23.67676+11:00","closed_at":"2025-12-29T15:05:23.676763+11:00"}
{"id":"az-29ey","title":"add more cli commands so that ai can do stuff like restart dev servers","design":"## CLI Commands for Dev Server Control\n\n### Commands to implement:\n- `az dev start \u003cbead-id\u003e [--server=\u003cname\u003e]` - Start dev server (default: 'default')\n- `az dev stop \u003cbead-id\u003e [--server=\u003cname\u003e]` - Stop dev server\n- `az dev restart \u003cbead-id\u003e [--server=\u003cname\u003e]` - Stop + start (atomic restart)\n- `az dev status \u003cbead-id\u003e` - Show all servers for a bead with status/port/uptime\n- `az dev list` - Show all running dev servers across all beads\n\n### Design decisions:\n1. All commands go through DevServerService to maintain state consistency\n2. Default server name is 'default' (matches DevServerService.DEFAULT_SERVER_NAME)\n3. Support `--json` flag for machine-readable output (AI parsing)\n4. Use existing Layer composition pattern from other CLI commands\n5. status/list show: server name, status, port, bead-id, uptime\n\n### Implementation:\n1. Add dev command handlers in src/cli/index.ts\n2. Create parent command `az dev` with subcommands\n3. Wire up DevServerService via Layer.provideMerge pattern\n4. Add to CLI_SUBCOMMANDS in bin/az.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T11:52:26.448429+11:00","updated_at":"2025-12-29T15:19:47.913945+11:00","closed_at":"2025-12-29T15:19:47.913945+11:00","close_reason":"Added dev server CLI commands: az dev start/stop/restart/status/list. Commands sync state via tmux metadata to keep TUI consistent."}
{"id":"az-2ck1","title":"inject permisson to view az images, use az cli, anything else? when we inject claude hooks","design":"## Implementation Plan\n\n### Goal\nWhen Azedarach spawns Claude sessions in worktrees, inject essential permissions so sessions can work smoothly without manual approval prompts.\n\n### Permissions to Inject\n1. **Read(\"//**/.beads/images/**\")** - View bead-attached images\n2. **Bash(az:*)** - Use all az CLI commands (dev, notify, etc.)\n3. **Bash(bd:*)** - Use beads CLI for issue management\n\n### Implementation Location\nModify `src/core/hooks.ts`:\n- Add a new `generatePermissions()` function that returns the permissions object\n- Update `generateHookConfig()` to include permissions alongside hooks\n\n### Why This Approach\n- Keeps all worktree injection config in one place (hooks.ts)\n- The WorktreeManager already merges hook config into settings.local.json\n- Permissions structure mirrors what .claude/settings.json uses\n\n### Testing\n- Create a worktree and verify settings.local.json includes the permissions\n- Start a session and confirm no permission prompts for az/bd commands","notes":"üìé [mjt969yr-2rlf.png](.beads/images/az-2ck1/mjt969yr-2rlf.png) (clipboard, 12/31/2025, 11:03:23 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T10:35:01.665548+11:00","updated_at":"2025-12-31T11:04:26.610738+11:00","closed_at":"2025-12-31T11:04:26.610738+11:00","close_reason":"Implemented permission injection for worktree sessions. Added WORKTREE_PERMISSIONS constant and spread it into generateHookConfig() so spawned Claude sessions automatically have access to: Read(//**/.beads/images/**) for viewing bead images, Bash(bd:*) for beads CLI, and Bash(az:*) for az CLI."}
{"id":"az-2d6r","title":"LustreTUI - OpenTUI-style TUI framework for Gleam","description":"Build a Gleam TUI framework modeled after OpenTUI (github.com/sst/opentui) that uses Lustre for the declarative layer.\n\n## Why\n- Shore has limitations: no hex colors, Row layout divides width equally (breaks inline text), Fill sizing issues\n- OpenTUI's architecture is clean and proven (used by opencode, terminaldotshop)\n- Lustre is Gleam's mature TEA framework - perfect for the declarative adapter\n\n## Architecture\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    lustre_tui                                ‚îÇ  ‚Üê Lustre reconciler + runtime\n‚îÇ  Element types ‚îÇ Reconciler ‚îÇ Runtime loop                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                    tui_core                                  ‚îÇ  ‚Üê Pure Gleam primitives\n‚îÇ  Color ‚îÇ Text ‚îÇ FrameBuffer ‚îÇ Renderables ‚îÇ Layout ‚îÇ Border‚îÇ\n‚îÇ  Renderer ‚îÇ Input ‚îÇ Resize                                   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Build Order (Dependency Graph)\n```\nPhase 0 - Research Spikes (parallelize):\n  az-lvah: Etch library evaluation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n  az-9gxm: Gleam FFI patterns (parallel)    ‚îú‚îÄ‚îÄ‚îê\n  az-a0g1: Unicode width research ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n                                               ‚îÇ\nPhase 0.5 - Decision Checkpoint:               ‚îÇ\n  az-kwwr: Finalize architecture ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n    ‚Üì blocks\n    \nPhase 1 - Foundation (blocked by checkpoint):\n  az-hkfa: Color utilities (P0)\n  az-ebxf: Text utilities (P1)\n  az-zh3y: Input handling (P2)\n  \nPhase 2 - Core:\n  az-xe2h: FrameBuffer ‚Üê‚îÄ‚îÄ Color\n  az-ud48: Renderables ‚Üê‚îÄ‚îÄ FrameBuffer, Text\n  az-kmuk: Borders ‚Üê‚îÄ‚îÄ FrameBuffer, Color\n  az-otrx: Terminal resize ‚Üê‚îÄ‚îÄ Input\n  \nPhase 3 - Layout \u0026 Rendering:\n  az-se6w: Layout engine ‚Üê‚îÄ‚îÄ Renderables\n  az-5xza: Renderer ‚Üê‚îÄ‚îÄ Layout, Borders\n  \nPhase 4 - Lustre Integration:\n  az-uwcd: Element types ‚Üê‚îÄ‚îÄ Renderables\n  az-7tzh: Reconciler ‚Üê‚îÄ‚îÄ Element types\n  az-d19m: Runtime ‚Üê‚îÄ‚îÄ Reconciler, Renderer, Input, Resize\n  \nPhase 5 - Validation \u0026 Migration:\n  az-8zkp: Demo app ‚Üê‚îÄ‚îÄ Runtime\n  az-lyq4: Port Azedarach ‚Üê‚îÄ‚îÄ Demo\n```\n\n## Task Summary (17 MVP tasks + 3 deferred)\n\n### Phase 0 - Research Spikes\n| ID | Task | Priority | Blocks |\n|----|------|----------|--------|\n| az-lvah | Etch library evaluation | P0 | Decision |\n| az-9gxm | Gleam FFI patterns | P0 | Decision |\n| az-a0g1 | Unicode width research | P0 | Decision |\n\n### Phase 0.5 - Decision Checkpoint\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-kwwr | Finalize tui_core architecture | P0 | All spikes |\n\n### Phase 1-2 - Foundation \u0026 Core\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-hkfa | Color utilities | P0 | Decision checkpoint |\n| az-ebxf | Text utilities | P1 | Decision checkpoint |\n| az-zh3y | Input handling | P2 | Decision checkpoint |\n| az-xe2h | FrameBuffer | P1 | Color |\n| az-ud48 | Renderable types | P1 | FrameBuffer, Text |\n| az-kmuk | Border drawing | P2 | FrameBuffer, Color |\n| az-otrx | Terminal resize | P1 | Input |\n\n### Phase 3-4 - Layout \u0026 Integration\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-se6w | Layout engine | P1 | Renderables |\n| az-5xza | Renderer | P1 | Layout, Borders |\n| az-uwcd | Element types | P2 | Renderables |\n| az-7tzh | Reconciler | P2 | Elements |\n| az-d19m | Runtime | P2 | Reconciler, Renderer, Input, Resize |\n\n### Phase 5 - Validation\n| ID | Task | Priority | Blocked By |\n|----|------|----------|------------|\n| az-8zkp | Demo app | P3 | Runtime |\n| az-lyq4 | Port Azedarach | P3 | Demo |\n\n## Deferred/Future Work (Post-MVP)\n\nThese features are tracked as P4 issues, blocked by their dependencies:\n\n| ID | Feature | Blocked By | Rationale |\n|----|---------|------------|-----------|\n| az-wwui | Mouse events | Runtime (az-d19m) | Keyboard navigation sufficient for MVP |\n| az-vw20 | Scroll containers | Layout (az-se6w) | Kanban columns are fixed height |\n| az-2iv8 | Focus management | Runtime (az-d19m) | No form inputs in MVP |\n\n## Reference\n- OpenTUI source: https://github.com/sst/opentui\n- Etch (Gleam terminal backend): https://github.com/bananaofhappiness/etch\n- Lustre: https://github.com/lustre-labs/lustre","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-28T11:25:31.045025+11:00","updated_at":"2025-12-28T12:13:22.857101+11:00","labels":["framework","gleam","lustre","tui"]}
{"id":"az-2dkm","title":"issue with space S on existing worktree","description":"it just doesnt start a session despite that success toast","design":"## Root Cause\n\nWhen `Space+S` is pressed on a task with an existing worktree (orphaned - worktree exists but no tmux session), the `ClaudeSessionManager.start()` method returns early at lines 451-456:\n\n```typescript\nconst existingSession = HashMap.get(sessions, beadId)\n\nif (existingSession._tag === \"Some\") {\n    return existingSession.value  // \u003c-- BUG: Returns stale session!\n}\n```\n\nThe session is in memory with `state: \"idle\"` because:\n1. User previously started a session (registered in memory + sessions.json)\n2. Tmux session was killed/died\n3. TmuxSessionMonitor detected it was gone\n4. Called `updateStateFromTmux(beadId, \"idle\", ...)` which updated state to \"idle\" but kept the session in memory\n5. When user presses Space+S, `start()` finds this stale session and returns early WITHOUT creating a new tmux session\n\n## Solution\n\nIn `TmuxSessionMonitor.ts`, when a session goes \"idle\" (tmux process ended), we should **remove it from memory** rather than just updating its state. The session is still persisted on disk for recovery, but the in-memory HashMap should only contain ACTIVE sessions.\n\n**File:** `src/core/TmuxSessionMonitor.ts` (lines 358-373)\n\nCurrently when a session disappears, it calls:\n```typescript\nyield* handler({\n    beadId,\n    status: \"idle\",\n    sessionName: prevState.sessionName,\n    createdAt: 0,\n    worktreePath: null,\n    projectPath: null,\n})\n```\n\nThe handler (`updateStateFromTmux`) then updates the session to idle. Instead, we need to:\n\n1. In `ClaudeSessionManager.updateStateFromTmux()`, when status is \"idle\", REMOVE the session from memory instead of updating it\n2. The session stays in sessions.json for recovery/reference, but won't block `start()` from creating a new tmux session\n\n**Alternative approach (simpler):**\n\nFix `ClaudeSessionManager.start()` to check if the existing session has an ACTIVE tmux process:\n- If `existingSession.state === \"idle\"`, don't return early - create a new session\n- Only return early if `existingSession.state` indicates an active session (busy, waiting, initializing)\n\n## Implementation\n\nOption A (recommended - cleaner semantics):\n1. In `updateStateFromTmux`, when status is \"idle\", call `HashMap.remove()` instead of updating\n2. This means sessionsRef only contains sessions with live tmux processes\n\nOption B (safer - minimal changes):\n1. In `start()`, change the early return condition:\n   ```typescript\n   if (existingSession._tag === \"Some\" \u0026\u0026 existingSession.value.state !== \"idle\") {\n       return existingSession.value\n   }\n   ```\n2. If session exists but is idle, continue with session creation (will update the stale entry)\n\nI'll implement Option B as it's safer and handles edge cases better (the idle session entry gets properly updated rather than orphaned).","notes":"üìé [mjs25px4-tuu2.png](.beads/images/az-2dkm/mjs25px4-tuu2.png) (clipboard, 12/30/2025, 2:59:13 PM)\nüìé [mjs263ji-yowk.png](.beads/images/az-2dkm/mjs263ji-yowk.png) (clipboard, 12/30/2025, 2:59:31 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:59:10.017913+11:00","updated_at":"2025-12-30T15:24:31.956058+11:00","closed_at":"2025-12-30T15:24:31.956058+11:00","close_reason":"Fixed by adding state check in ClaudeSessionManager.start(). Now only returns early for active sessions (state !== \"idle\"), allowing fresh tmux sessions to be created when resuming work on orphaned worktrees."}
{"id":"az-2doh","title":"merge in claude/improve-codebase-quality-tKmv7","description":"Merge the `claude/improve-codebase-quality-tKmv7` branch which contains 2 commits:\n1. `b75ffe4` - refactor: improve codebase quality\n2. `5df70e0` - refactor: move fiber tracking into HookReceiver service\n\nThese changes fix memory leaks and improve code quality.","design":"## Changes Being Merged\n\n### 1. Memory Leak Fixes (Effect.fork ‚Üí Effect.forkScoped)\n- **HookReceiver.ts**: Fix cleanup fiber that was immediately interrupted\n- **DiagnosticsService.ts**: Fix fiber status watcher that was immediately interrupted\n\n### 2. Service Pattern Fixes (effect: ‚Üí scoped:)\n- **HookReceiver**: Changed to `scoped:` since it spawns fibers via `forkScoped`\n- **DiagnosticsService**: Changed to `scoped:` since `registerFiber` uses `forkScoped`\n\n### 3. Naming Clarity\n- **EditorService.ts ‚Üí BeadEditorService.ts**: Rename to avoid confusion with other editor concepts\n- Remove legacy `EditorService` and `EditorServiceLive` aliases\n\n### 4. Code Organization\n- Move fiber registration from atoms.ts into HookReceiver service (better separation of concerns)\n- Fiber tracking now happens where the fiber is created\n\n### 5. Documentation\n- Add `scoped:` vs `effect:` guidance to CLAUDE.md with decision checklist\n\n## Implementation Plan\n\n1. Perform git merge of origin/claude/improve-codebase-quality-tKmv7\n2. Resolve any conflicts if they arise\n3. Run type-check to verify changes compile\n4. Run build to verify bundling works\n5. Commit the merge","acceptance_criteria":"- [ ] Branch successfully merged\n- [ ] No merge conflicts (or conflicts resolved)\n- [ ] `bun run type-check` passes\n- [ ] `bun run build` passes\n- [ ] Changes committed to az-2doh branch","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:38:41.602215+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T00:40:33.371907+11:00","close_reason":"Merged claude/improve-codebase-quality-tKmv7 with conflict resolution. Fixed import paths, dynamic imports, and properly declared HookReceiver's dependency on DiagnosticsService.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-2ek","title":"Add warning glyphs to TaskCard header","description":"Add tiny warning glyphs (‚ö†üîÑ) to TaskCard headerLine after session indicator. ‚ö† for context warning (\u003e70%), üîÑ for recently compacted. Space cost: 1-2 characters.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.779379+11:00","updated_at":"2025-12-12T13:25:20.429502+11:00","dependencies":[{"issue_id":"az-2ek","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.178601+11:00","created_by":"daemon"}]}
{"id":"az-2il","title":"Agent Mail status broadcast integration","description":"Workers broadcast status via Agent Mail for real-time TUI updates.\n\n**Events:**\n- STARTED: Worker began task\n- PROGRESS: Periodic heartbeat with context %\n- BLOCKED: Worker discovered blocker\n- COMPLETED: Worker finished task\n- ERROR: Worker encountered error\n\n**TUI subscription:**\n- Poll Agent Mail for status updates (or WebSocket if available)\n- Update TaskCard session indicators in real-time\n- Show toast for important events (blocked, error)\n\n**Depends on:** Agent Mail integration (az-l7a)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:15.170002+11:00","updated_at":"2025-12-14T02:13:25.698677+11:00","dependencies":[{"issue_id":"az-2il","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T13:29:24.916405+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-2il","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.86955+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-2iv8","title":"Focus management for input elements","description":"**Status:** Deferred to post-MVP\n\n## Overview\nAdd focus management for interactive elements (text inputs, buttons, etc.).\n\n## Features\n- Focus state tracking (which element is focused)\n- Tab/Shift+Tab navigation between focusable elements\n- Focus ring styling (visual indicator of focused element)\n- Focus events (onFocus, onBlur handlers)\n\n## API Addition\n```gleam\n// Attributes\nfn focusable() -\u003e Attribute(msg)\nfn autofocus() -\u003e Attribute(msg)\nfn on_focus(msg: msg) -\u003e Attribute(msg)\nfn on_blur(msg: msg) -\u003e Attribute(msg)\nfn tab_index(index: Int) -\u003e Attribute(msg)\n\n// In Runtime or a FocusManager service\nfn focus(element_id: String) -\u003e Effect(msg)\nfn blur() -\u003e Effect(msg)\nfn get_focused() -\u003e Option(String)\n```\n\n## Complexity\nMedium. Requires:\n- Element ID system (for focus targeting)\n- Focus order calculation (tab index + DOM order)\n- Keyboard event routing (Tab, Shift+Tab)\n- Style modifications for focused state\n\n## Dependencies\n- Input elements must exist first (text input, button)\n- Currently no input elements are planned for MVP\n\n## Why Deferred\nAzedarach MVP uses global keyboard shortcuts, not focusable form elements. No text inputs or buttons requiring focus.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T12:07:34.567029+11:00","updated_at":"2025-12-28T12:07:34.567029+11:00","labels":["deferred","gleam","input","lustre-tui"],"dependencies":[{"issue_id":"az-2iv8","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T12:07:48.85588+11:00","created_by":"daemon"},{"issue_id":"az-2iv8","depends_on_id":"az-d19m","type":"blocks","created_at":"2025-12-28T12:07:49.074529+11:00","created_by":"daemon"}]}
{"id":"az-2m5v","title":"add configurable injection of pre compact hook that updates/creates beads to keep context","design":"## Implementation Plan\n\n### Goal\nAdd a configurable PreCompact hook that updates beads with session progress before Claude compacts context. This ensures session state survives auto-compaction.\n\n### Config Change\nAdd `hooks` section to the session config schema:\n\n```typescript\nconst HooksConfigSchema = Schema.Struct({\n  preCompact: Schema.optional(Schema.Struct({\n    enabled: Schema.optional(Schema.Boolean), // default: true\n  })),\n})\n```\n\nAdd to SessionConfigSchema or as separate top-level `hooks` section.\n\n### Files to Modify\n\n1. **src/config/schema.ts**\n   - Add HooksConfigSchema with preCompact.enabled\n   - Export HooksConfig type\n\n2. **src/config/defaults.ts**\n   - Add default: { hooks: { preCompact: { enabled: true } } }\n\n3. **src/core/hooks.ts**\n   - Modify generateHookConfig() to accept config option\n   - Add PreCompact hook when enabled\n   - Hook command: \\\"/path/to/az-pre-compact.sh\\\" \u003cbead-id\u003e\n\n4. **bin/az-pre-compact.sh** (NEW)\n   - Read bead ID from args\n   - Get recent context from transcript_path (via stdin JSON)\n   - Call bd update \u003cbead-id\u003e --notes=\\\"...\\\" with session summary\n   - Output reminder to Claude about updating beads\n\n5. **src/core/WorktreeManager.ts**\n   - Pass hooks config to generateHookConfig()\n\n### PreCompact Hook Behavior\n- Receives JSON via stdin: { session_id, transcript_path, trigger, ... }\n- Updates the bead with session notes using bd update\n- Outputs a reminder that Claude will see before compaction\n- Exit 0 to allow compaction to proceed\n\n### Data Flow\n1. User's context gets full ‚Üí Claude triggers auto-compact\n2. PreCompact hook fires with bead ID\n3. Script reads recent transcript, summarizes work\n4. Updates bead: bd update az-xxx --notes=\\\"Session checkpoint: ...\\\"\n5. Script outputs: \\\"‚úì Bead az-xxx updated with session progress\\\"\n6. Compact proceeds, bead preserves context\n","notes":"## Implementation Complete\n\n### What was done\n\nAdded configurable PreCompact hook injection to Azedarach-spawned sessions.\n\n### Files Modified\n\n1. **src/config/schema.ts**\n   - Added HooksConfigSchema with preCompact.enabled option\n   - Updated RawConfigSchema and CurrentConfigSchema to include hooks\n   - Added to migration function and type exports\n\n2. **src/config/defaults.ts**\n   - Added hooks.preCompact.enabled default (true)\n   - Updated ResolvedConfig interface\n   - Updated mergeWithDefaults function\n\n3. **src/config/index.ts**\n   - Exported HooksConfig type\n\n4. **src/config/AppConfig.ts**\n   - Added getHooksConfig() method to interface and implementation\n\n5. **bin/az-pre-compact.sh** (NEW)\n   - PreCompact hook script that outputs reminder text\n   - Fires before context compaction\n   - Outputs \u003csystem-reminder\u003e reminding Claude to update beads\n\n6. **src/core/hooks.ts**\n   - Added buildPreCompactCommand helper\n   - Added HookConfigOptions interface\n   - Updated generateHookConfig to accept options\n   - Added PreCompact hook when enabled\n\n7. **src/core/WorktreeManager.ts**\n   - Added preCompactEnabled to CreateWorktreeOptions\n   - Updated copyClaudeLocalSettings to accept hook options\n   - Passes preCompactEnabled through to generateHookConfig\n\n8. **src/core/ClaudeSessionManager.ts**\n   - Gets hooks config from appConfig\n   - Passes preCompactEnabled to worktreeManager.create\n\n### How it works\n\n1. User config (.azedarach.json):\n   ```json\n   { \"hooks\": { \"preCompact\": { \"enabled\": false } } }\n   ```\n   (Defaults to enabled if not specified)\n\n2. When worktree is created, settings.local.json gets PreCompact hook:\n   ```json\n   \"PreCompact\": [{ \"hooks\": [{ \"type\": \"command\", \"command\": \"az-pre-compact.sh \u003cbeadId\u003e\" }] }]\n   ```\n\n3. Before context compaction, hook outputs reminder text that Claude sees\n\n### Testing\n\n- Type-check passes\n- Script is executable\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T10:52:42.662278+11:00","updated_at":"2026-01-04T12:53:07.880002+11:00","closed_at":"2026-01-04T12:53:07.880006+11:00"}
{"id":"az-2m9","title":"search mode needs to accept enter/return to return to normal mode","description":"should have the selected item from search selected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:28:34.821948+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T23:20:14.269868+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-2p4","title":"the space m to merge feature should move the bead to closed too","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:41:22.254096+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T02:20:57.249256+11:00","close_reason":"Fixed: Now commits and pushes bead close after merge to main","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-2q75","title":"Add autoCompact option to SessionManager","description":"Add --auto-compact flag support to StartSessionOptions for long-running orchestrator sessions","design":"## Implementation Plan\n\n### Context\n- User has `autoCompactEnabled: false` in `~/.claude.json` (user preferences)\n- For long-running orchestrator sessions, we want auto-compact **enabled** to prevent context exhaustion\n- Claude CLI accepts `--settings '{\"autoCompactEnabled\": true}'` to override user settings\n\n### Approach: Use `--settings` CLI flag\n\nAdd `autoCompact?: boolean` to `StartSessionOptions`. When `true`, pass `--settings '{\"autoCompactEnabled\": true}'` to the Claude command.\n\n### Changes Required\n\n1. **`src/core/SessionManager.ts`**:\n   - Add `autoCompact?: boolean` to `StartSessionOptions` interface (line ~82)\n   - Destructure `autoCompact` in `start()` method (line ~391)\n   - Build `--settings` flag when `autoCompact: true` (line ~477)\n\n### Code Changes\n\n```typescript\n// In StartSessionOptions interface (around line 82):\nexport interface StartSessionOptions {\n  readonly beadId: string\n  readonly projectPath: string\n  readonly baseBranch?: string\n  readonly initialPrompt?: string\n  readonly model?: ClaudeModel\n  readonly dangerouslySkipPermissions?: boolean\n  /** Enable auto-compact for long-running sessions (default: false, uses user setting) */\n  readonly autoCompact?: boolean  // NEW\n}\n\n// In start() method, add to destructuring:\nconst { beadId, projectPath, baseBranch, initialPrompt, model, dangerouslySkipPermissions, autoCompact } = options\n\n// In Claude command building (around line 477):\nconst autoCompactFlag = autoCompact ? ` --settings '{\"autoCompactEnabled\":true}'` : \"\"\nconst claudeWithOptions = initialPrompt\n  ? `${claudeCommand}${modelFlag}${dangerousFlag}${autoCompactFlag} \"${escapeForShell(initialPrompt)}\"`\n  : `${claudeCommand}${modelFlag}${dangerousFlag}${autoCompactFlag}`\n```\n\n### Testing\n- Run type-check after changes\n- Manually verify Claude spawns with correct flags","acceptance_criteria":"- [ ] `autoCompact?: boolean` added to `StartSessionOptions` interface\n- [ ] When `autoCompact: true`, Claude is spawned with `--settings '{\"autoCompactEnabled\":true}'`\n- [ ] Type-check passes\n- [ ] Existing session spawning still works (no regression)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.247224+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T14:13:39.604046+11:00","close_reason":"Added `autoCompact?: boolean` option to StartSessionOptions. When true, passes `--settings '{\\\"autoCompactEnabled\\\":true}'` to Claude CLI, overriding user's auto-compact setting for long-running orchestrator sessions.","dependencies":[{"issue_id":"az-2q75","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.58227+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-2qy","title":"CLI argument parsing with @effect/cli","description":"Set up CLI entry point with argument parsing for the az command.","design":"- Use @effect/cli for type-safe argument parsing\n- Define Commands with Args and Options\n- Commands: az (default TUI), az start \u003cid\u003e, az attach \u003cid\u003e, az pause \u003cid\u003e, az status, az sync\n- Accept optional project path argument via Args.directory\n- Use Options for flags like --verbose, --config\n- Validate beads database exists before starting\n- Auto-generate shell completions (bash, zsh, fish)","notes":"Implemented complete CLI structure with @effect/cli:\n- Created src/cli/index.ts with all commands (default, start, attach, pause, status, sync)\n- Proper Option.Option handling for optional parameters\n- Type-safe argument parsing using Args and Options from @effect/cli\n- Integration with BeadsClient and BunContext\n- Help system auto-generates for all commands\n\nNOTE: Discovered potential issue with @effect/cli 0.72.1 where subcommands show help instead of executing. The CLI structure is correct per official docs, but runtime behavior needs investigation. Commands are properly registered (visible in help output) but not routing correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.3098+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T18:03:13.670101+11:00","dependencies":[{"issue_id":"az-2qy","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.891408+11:00","created_by":"daemon"},{"issue_id":"az-2qy","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.453515+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-31h","title":"runGit doesn't extract stderr, breaking merge conflict detection","description":"The runGit helper in PRWorkflow.ts didn't extract stderr from platform errors. This caused merge conflict detection to fail because it checks e.stderr?.includes(\"CONFLICT\") which was always undefined.\n\nFixed by extracting stderr like BeadsClient does: `const stderr = \"stderr\" in error ? String(error.stderr) : String(error)`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T15:49:54.963322+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T15:50:00.235259+11:00","close_reason":"Fixed runGit to extract stderr from platform errors, enabling proper conflict detection","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-31i","title":"the claude create task feature needs work. we should use claude cli or something not a full claude ode session/instance","notes":"Analyzing current implementation and planning CLI-based approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:31.58228+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T00:18:36.483483+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-31iv","title":"when initCommands fail they say to look at diagnostics with shift-d but its actually just d","design":"**Analysis:**\nThe toast message in `SessionManager.ts:505` incorrectly says \"Press Shift+D for details\" but the actual keybinding in `src/services/keyboard/bindings.ts:200-203` is just `d` (lowercase, no shift).\n\n**Root Cause:**\nThe keybinding was likely changed at some point but the error message wasn't updated.\n\n**Fix:**\nChange line 505 in `src/core/SessionManager.ts` from:\n`Press Shift+D for details` ‚Üí `Press d for details`\n\n**Files to modify:**\n- `src/core/SessionManager.ts` (line 505)","acceptance_criteria":"- [ ] Error message says \"Press d for details\" not \"Press Shift+D for details\"\n- [ ] Type check passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:16:41.526182+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T13:19:55.884127+11:00","close_reason":"Fixed toast message: changed 'Press Shift+D for details' to 'Press d for details' to match actual keybinding","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-31ri","title":"dont import from \"node:*\"","description":"import from @effect/platform instead","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:13:35.004191+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:24:34.410587+11:00","close_reason":"Removed all node:* imports. Services now use @effect/platform directly (Path.Path methods, crypto.randomUUID from Web Crypto API).","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-385","title":"Epic drill-down view (focus mode for epic children)","description":"Press Enter on an epic ‚Üí switches to a focused board showing only that epic's children across status columns.\n\n**Visual:**\n```\n‚îå‚îÄ Open ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ In Progress ‚îÄ‚î¨‚îÄ Done ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ            ‚îÇ               ‚îÇ             ‚îÇ\n‚îÇ  ‚óÄ az-gds  ‚îÇ   Epic View   ‚îÇ  ‚ñà‚ñà‚ñà‚ñà‚ñë 3/5  ‚îÇ  ‚Üê Header bar\n‚îÇ            ‚îÇ               ‚îÇ             ‚îÇ\n‚îÇ  az-lqb    ‚îÇ  az-7sr ‚öô    ‚îÇ  az-aiu ‚úì   ‚îÇ\n‚îÇ  az-bjp    ‚îÇ               ‚îÇ  az-xxx ‚úì   ‚îÇ\n‚îÇ            ‚îÇ               ‚îÇ  az-yyy ‚úì   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n        [q] back   [Enter] open task\n```\n\n**Interaction:**\n- `Enter` on epic card ‚Üí enters drill-down view\n- `q` or `Escape` ‚Üí returns to main board\n- Navigation (hjkl) works normally within children\n- `Enter` on child task ‚Üí normal task actions\n\n**Implementation:**\n1. Add `drillDownEpic: string | null` to NavigationService state\n2. When set, Board filters to show only children of that epic\n3. Render epic header bar with back hint and progress\n4. `q` in drill-down clears the state, returns to main\n\n**Simpler than indentation because:**\n- No variable card heights\n- No tree-prefix rendering\n- No mixed item types in columns\n- Clean j/k navigation\n- Reuses existing Board/Column components","design":"## State Changes\n\nNavigationService:\n- Add `drillDownEpic: SubscriptionRef\u003cstring | null\u003e`\n- Add `enterDrillDown(epicId: string)` method\n- Add `exitDrillDown()` method\n\n## Atom Changes\n\n- `drillDownEpicAtom` - subscribes to navigation state\n- `filteredTasksAtom` - when drillDownEpic set, filter to children only\n- `epicHeaderAtom(epicId)` - returns epic title + progress for header\n\n## Component Changes\n\nBoard.tsx:\n- Check drillDownEpic state\n- If set, render EpicHeader + filtered children\n- If null, render normal board\n\nEpicHeader.tsx (new):\n- Shows: back arrow, epic ID, epic title, progress bar\n- Styled as top bar or overlay header\n\n## Keybinding Changes\n\nApp.tsx handleNormalMode:\n- `Enter` on epic type ‚Üí call `enterDrillDown(selectedId)`\n- `q` when in drillDown ‚Üí call `exitDrillDown()`\n\n## Progress Calculation\n\nQuery beads for children count by status:\n- Total children with parent = epicId\n- Closed children count\n- Format: `‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5` or percentage","acceptance_criteria":"- [ ] Enter on epic card opens drill-down view\n- [ ] Drill-down shows only that epic's children\n- [ ] Children displayed across normal status columns\n- [ ] Header shows epic info and progress bar\n- [ ] q or Escape returns to main board\n- [ ] hjkl navigation works in drill-down\n- [ ] Cursor position remembered when returning to main board","notes":"PR: ","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.298636+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T02:10:23.18921+11:00","dependencies":[{"issue_id":"az-385","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.905066+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-38m","title":"can't seem to move beads with space + left/right arrow or l/h","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:27:05.835599+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T15:35:44.455904+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-3k2l","title":"add a icon to the header of a task when there is an active PR","design":"## Implementation Design\n\n### Goal\nShow a visual indicator (üîó) in TaskCard headers when a task has an associated PR, and provide quick access to open the PR in browser.\n\n### Approach: Parse notes field (minimal changes)\n\nPR URLs are stored in the `notes` field with format `PR: https://github.com/...`. We'll:\n1. Parse notes with regex to detect PR presence\n2. Show icon in header line\n3. Add action to open PR in browser\n\n**Why this approach:**\n- No GitHub API calls (fast, no rate limiting)\n- Follows existing indicator patterns in TaskCard\n- Minimal code changes\n\n### Changes Required\n\n**1. src/ui/types.ts**\n- Add `PR_INDICATOR = \"üîó\"` constant\n\n**2. src/ui/TaskCard.tsx**\n- Add helper function: `extractPRUrl(notes?: string): string | undefined`\n  - Uses regex: `PR:\\s*(https://[^\\s]+)`\n  - Returns first match or undefined\n- Add `hasPR` boolean based on notes field\n- Append `PR_INDICATOR` to header line after operation indicators, before attachments\n\n**3. src/ui/ActionPalette.tsx**\n- Add new action `o` (Open PR) that:\n  - Only available when task has PR URL in notes\n  - Opens URL in default browser via `open` command\n- Add to actions list with label \"Open PR\"\n\n**4. src/ui/atoms/pr.ts** (or new file)\n- Add `openPRInBrowserAtom` that:\n  - Extracts PR URL from task notes\n  - Shells out to `open \u003curl\u003e` (macOS) / `xdg-open` (Linux)\n\n**5. src/ui/App.tsx**\n- Wire up 'o' key in action mode to trigger openPRInBrowser\n\n### PR Detection Logic\n\n```typescript\nconst PR_URL_PATTERN = /PR:\\s*(https:\\/\\/[^\\s]+)/i\n\nexport const extractPRUrl = (notes?: string): string | undefined =\u003e {\n  if (!notes) return undefined\n  const match = notes.match(PR_URL_PATTERN)\n  return match?.[1]\n}\n```\n\n### Icon Position in Header\n\n```\n[P1] [az-xxx] [task] [üîµ] [‚öîÔ∏è] [üìã] [üíª] [‚è≥] [üîó] [üìé2] [*]\n ^     ^       ^      ^     ^     ^     ^     ^    ^     ^    ^\n |     |       |      |     |     |     |     |    |     |    multiSelect\n |     |       |      |     |     |     |     |    |     attachments\n |     |       |      |     |     |     |     |    PR (NEW)\n |     |       |      |     |     |     |     operation\n |     |       |      |     |     |     devServer\n |     |       |      |     |     phase\n |     |       |      |     conflict\n |     |       |      session\n |     |       type\n |     id\n priority\n```\n\n### Testing\n- Create a task, start session, create PR with `P` action\n- Verify üîó icon appears in header\n- Press `o` in action mode to open PR in browser\n- Verify action is disabled when no PR exists","acceptance_criteria":"- [ ] üîó icon appears in TaskCard header when task has PR URL in notes\n- [ ] Icon positioned after operation indicators, before attachments\n- [ ] 'o' action in ActionPalette opens PR in browser (when available)\n- [ ] 'o' action disabled/hidden when task has no PR\n- [ ] Works with existing PR creation flow (PR: URL format in notes)\n- [ ] No performance regression (no API calls, just regex parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:29:08.934201+11:00","updated_at":"2025-12-29T15:05:38.050429+11:00","closed_at":"2025-12-29T15:05:38.050432+11:00"}
{"id":"az-3prx","title":"make space c to chat use a tmux claude session just like space s","description":"the popup is cool but prevents me from doing stuff while waiting for claude's response","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:24:21.445001+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:30.145464+11:00","close_reason":"Implemented: Space+c now spawns a persistent tmux session (like Space+s) instead of a blocking popup. Session name is 'chat-\u003cbeadId\u003e' to distinguish from work sessions. Uses Haiku model, runs in current project directory (not worktree), and switches to the session immediately.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-3r4m","title":"refactor ai context","description":"update all context stuch as CLAUDE.md, skills, AGENTS.md etc so that its aware we have the bun version and the go version in this repo. also reorganize our apps so that the bun app is in a bun-opentui folder similar to how the go-bubbletea app is in its own folder","design":"\nPrevious work completed phases 1-8:\n‚úì Phase 1-8: Reorganized codebase, created app-specific CLAUDE.md files, added skills\n\nNew work (follow-up):\n‚úì Split TDD skill into language-specific skills:\n  - Created .claude/skills/effect/effect-testing.skill.md (TypeScript/Effect TDD)\n  - Created .claude/skills/go/go-testing.skill.md (Go TDD with table-driven tests)\n  - Removed generic .claude/skills/workflow/tdd-workflow.skill.md\n  - Updated skill-rules.json (also fixed pre-existing JSON syntax error)\n  - Updated skills README.md with new directory structure\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T12:16:45.892414+11:00","updated_at":"2026-01-04T13:41:38.418493+11:00","closed_at":"2026-01-04T13:41:38.418496+11:00"}
{"id":"az-3rk","title":"Add rate_limited session state","description":"Add 'rate_limited' to SessionState type and SESSION_INDICATORS map (‚è± glyph). Extend StateDetector patterns to detect rate limiting from Claude output (patterns like 'Rate limit', 'Too many requests', 'Please wait').","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.309325+11:00","updated_at":"2025-12-12T13:25:19.967333+11:00"}
{"id":"az-3rt","title":"task is stuck merging","description":"we need to be able to abort a merge and also we need to be able to attach to the merge claude session. we should re-use the current tmux session for merging if we havent already closed it.","notes":"Starting work. Issue analysis:\n\n1. When merge detects conflicts, PRWorkflow spawns Claude to resolve them\n2. There's no way to abort a merge that's stuck in conflict state\n3. No way to easily attach to the merge-resolution Claude session\n4. Task appears \"stuck\" with no recovery options\n\nPlan:\n1. Add `abortMerge` method to PRWorkflow - runs `git merge --abort`\n2. Add `Space+M` keybinding (abort merge) to prHandlers\n3. Ensure attach (`Space+a`) works for merge-resolution sessions\n4. Consider UI feedback for merge-in-progress state","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:45:11.402161+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:34:18.518437+11:00","close_reason":"All requirements implemented: abortMerge() method with Space+M keybinding, attach works for merge sessions (same beadId), existing sessions are reused for merge conflict resolution.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-451","title":"Use immutable Data types in SubscriptionRef state","description":"Non-primitive state stored in SubscriptionRef should use Effect's immutable data types for proper equality and functional programming patterns.\n\n**Problems:**\n1. Objects/arrays without Data wrapping cause reference equality issues\n2. Mutable collections like `Map` don't play well with Effect's functional paradigm\n\n**Solutions:**\n\n**Data Wrapping:**\n- Use `Schema.Data` to wrap state schemas, OR\n- Manually wrap with `Data.array()` for arrays\n- Manually wrap with `Data.struct()` for objects/records\n\n**Immutable Collections:**\n- Replace `Map` with `ReadonlyRecord` (from `effect/Record`)\n- Replace `Set` with `HashSet` (from `effect/HashSet`)\n- Use `HashMap` if key hashing is needed\n\n**Specific changes:**\n- `tasksByColumn: Map\u003c...\u003e` ‚Üí `tasksByColumn: ReadonlyRecord\u003cstring, ReadonlyArray\u003cTask\u003e\u003e`\n\n**Files to audit:**\n- All services using SubscriptionRef with non-primitive state\n- Check EditorService, NavigationService, OverlayService, BeadsService, etc.","notes":"## Completed\n- ‚úÖ tasksByColumn: Map ‚Üí Record.ReadonlyRecord with emptyRecord() singleton\n- ‚úÖ jumpLabels: ReadonlyMap ‚Üí Record.ReadonlyRecord\n- ‚úÖ Created src/lib/empty.ts with singleton emptyRecord() and emptyArray()\n- ‚úÖ Updated all consumers: BoardService, KeyboardService, EditorService, atoms.ts, Board.tsx, CompactView.tsx, useEditorMode.ts, types.ts\n- ‚úÖ Board.tsx and CompactView.tsx now accept readonly TaskWithSession[] arrays\n- ‚úÖ Type errors from concurrent work FIXED in commit 092959c\n\n## Session 2025-12-15 Update\nThe type issues around readonly arrays are now resolved:\n- BoardProps.tasks: readonly TaskWithSession[]\n- CompactViewProps.tasks: readonly TaskWithSession[]\n- Column props were fixed (isActiveColumn instead of isActive, etc.)\n\n## Remaining\n- Data wrapping for non-primitive SubscriptionRef state (EditorMode, SortConfig, Overlay[], Toast[], etc.)\n- Consider using Data.struct() for cursor/position types\n- Audit all services for remaining mutable collections\n\n## Note\nThe linter (biome) auto-converts ReadonlyMap ‚Üî Record.ReadonlyRecord. Need to be consistent with Record.ReadonlyRecord and use Object.entries() for iteration.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-15T12:23:05.047807+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T12:57:22.737672+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"az-46ed","title":"Implement Molecule system with TOML templates","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T00:40:46.79086+11:00","updated_at":"2026-01-05T00:40:46.79086+11:00"}
{"id":"az-4anv","title":"allow specifying model such as github copilot gemini flash preview (opencode)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:15:15.29937+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-22T12:57:56.370302+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-4bah","title":"did we add a ui config menu?","description":"if not can we add it please?\ni want to be able to configure everything within our tui","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:23:27.707065+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-24T00:39:45.406799+11:00","close_reason":"Implemented interactive Settings menu with boolean/enum toggling and raw JSON editing with validation.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-4ghj","title":"add way to merge a bead into another bead (git wise)","description":"i have bead A with some work that i dont want to merge to base or create a pr for, i want to merge to another bead's branch/worktree (even if it doesnt exist yet)\ni can technically do this by making the bead a child of an epic but this is not always ergonomic","design":"## Feature: Merge Bead Into Another Bead\n\n### Overview\nAllow users to merge bead A's git branch into bead B's branch without going through main or creating a PR. This consolidates work when you realize exploratory work belongs with other work.\n\n### Behavior\n- **Merge direction**: A's commits merge INTO B's branch (B gets A's commits)\n- **Source bead (A)**: Closed after successful merge\n- **Source worktree**: Kept (for reference/manual cleanup)\n- **Target bead (B)**: Must exist in tracker; if no branch/worktree exists, create it first\n- **Conflicts**: Same UX as current merge conflicts (spawn Claude in merge window)\n\n### UI Flow\n1. User selects source bead A on board\n2. Press `Space` ‚Üí action menu ‚Üí `m` (Merge into another bead)\n3. Enter \"mergeSelect\" mode:\n   - Source bead A highlighted distinctly (e.g., different border/color)\n   - Cursor can navigate freely to any other bead\n   - Status bar: \"Select target bead (Space to merge, Esc to cancel)\"\n4. User navigates to target bead B, presses `Space`\n5. Execute merge:\n   - If B has no branch: create branch/worktree for B\n   - Check conflicts via `git merge-tree`\n   - If conflicts: start merge, spawn Claude in B's merge window\n   - If clean: merge A into B, sync beads, close A\n6. Show toast: \"Merged az-xxxx into az-yyyy\" or error message\n7. Return to normal mode\n\n### Implementation Tasks\n\n#### 1. EditorService: Add mergeSelect mode\n- New mode variant: `{ _tag: \"mergeSelect\", sourceBeadId: string }`\n- Track which bead initiated the merge\n\n#### 2. PRWorkflow: Add mergeBeadIntoBead method\n```typescript\nmergeBeadIntoBead(options: {\n  sourceBeadId: string\n  targetBeadId: string\n}): Effect\u003cvoid, MergeError | WorktreeError | BeadsError\u003e\n```\nSteps:\n1. Validate source has commits (git rev-list)\n2. Ensure target branch/worktree exists (create if needed)\n3. In target worktree: `git fetch origin \u003csource-branch\u003e`\n4. Check conflicts: `git merge-tree --write-tree`\n5. If conflicts: start merge in target, spawn Claude\n6. If clean: `git merge --no-ff \u003csource-branch\u003e`\n7. Sync beads (with exclusive lock)\n8. Close source bead via bd\n\n#### 3. Keyboard handlers: mergeSelect mode\n- `h/j/k/l`: Navigate board (same as normal)\n- `Space`: Confirm selection, execute merge\n- `Esc`: Cancel, return to normal mode\n- Disable other actions in this mode\n\n#### 4. Action menu: Add merge option\n- In action menu, add `m` key: \"Merge into another bead\"\n- Only show if current bead has commits (branch exists)\n\n#### 5. Visual feedback\n- Source bead: distinct highlight (border color or icon)\n- Target selection: normal cursor highlight\n- Status bar: context-aware message\n- Toast on completion/error\n\n### Edge Cases\n- Source has no commits: disable action / show error\n- Target is same as source: show error \"Cannot merge into self\"\n- Target is source's parent epic: works fine (same as normal child‚Üíepic merge)\n- Target is in same column (e.g., both open): valid, just merge\n- Merge conflicts: Claude resolves in target's merge window, user retries\n\n### Files to Modify\n- `src/services/EditorService.ts` - add mergeSelect mode\n- `src/core/PRWorkflow.ts` - add mergeBeadIntoBead method\n- `src/services/keyboard/ActionMenuService.ts` - add merge action\n- `src/services/keyboard/handlers.ts` - add mergeSelect handlers\n- `src/ui/App.tsx` - render mergeSelect mode state\n- `src/ui/TaskCard.tsx` - highlight source bead\n- `src/ui/StatusBar.tsx` - show merge mode message\n- `docs/keybindings.md` - document new keybinding","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T00:52:11.746656+11:00","updated_at":"2025-12-30T10:56:50.317263+11:00","closed_at":"2025-12-30T10:56:50.317263+11:00","close_reason":"Added missing keybindings to HelpOverlay: 'b' for merge bead into another, 'u' for update from main, fixed 'r'/'R' confusion (r=dev server, R=resume), added dev server and Helix keybindings","comments":[{"id":15,"issue_id":"az-4ghj","author":"riordan","text":"Help overlay missing the 'b' keybinding for \"Merge bead into...\" - feature implemented but not discoverable","created_at":"2025-12-29T23:55:31Z"}]}
{"id":"az-4mqg","title":"in remote workflowMode i need a way to compile an epic's work into one PR","description":"i dont want to create a PR per epic task against base branch\nso maybe we enable the merge flow for this but where base branch for epic children is the epic branch","design":"## Epic-Consolidated PR Workflow\n\n### Problem\nIn remote workflowMode, each task creates its own PR against main. For epics with multiple child tasks, this creates PR sprawl. We need a way to consolidate an epic's work into a single PR.\n\n### Solution: Context-Aware Branch Targeting\n\nWhen a bead has a `parent-child` dependency to an epic:\n1. **Worktree Creation**: Branch from epic branch (not main)\n2. **Space+m (Merge)**: Merge to epic branch (not main)\n3. **Space+P (PR)**: Create PR targeting epic branch (not main)\n\nFor epics themselves (or tasks without epic parent):\n- Behavior unchanged: target main branch\n\n### Implementation Plan\n\n#### 1. Add `getParentEpic()` helper to BeadsClient\n- Given a beadId, find its parent epic via `parent-child` dependency\n- Return `Option\u003cBeadInfo\u003e` (None if no epic parent)\n\n#### 2. Add `getEffectiveBaseBranch()` to AppConfig or PRWorkflow\n- If bead has parent epic ‚Üí return epic branch name (e.g., `az-epic`)\n- Otherwise ‚Üí return configured baseBranch (e.g., `main`)\n- Respects workflowMode for origin/ prefix\n\n#### 3. Modify WorktreeManager/ClaudeSessionManager\n- When creating worktree for child task, use epic branch as start point\n- `git worktree add -b {childId} {path} {epicBranch}`\n- **If epic branch doesn't exist**: Auto-create epic worktree first, then create child worktree\n\n#### 4. Modify PRWorkflow.createPR()\n- Use `getEffectiveBaseBranch()` for `--base` flag\n- PR from child branch ‚Üí epic branch\n\n#### 5. Modify PRWorkflow.mergeToMain()\n- Rename or generalize to `mergeToTarget()`\n- Use `getEffectiveBaseBranch()` as merge target\n- When merging epic ‚Üí main: auto-close all child beads\n\n#### 6. Update UI/StatusBar\n- Show effective target branch in status (helpful for users to see \"‚Üí az-epic\" vs \"‚Üí main\")\n\n### Edge Cases\n\n1. **Epic branch doesn't exist yet**: Auto-create epic worktree/branch from main, then branch child from it\n2. **Child of non-existent epic**: Error gracefully, fall back to main\n3. **Nested epics**: Support N levels by walking parent chain to find root epic, OR limit to 1 level\n4. **Multiple parents**: If task has multiple epic parents, use first one (or error)\n\n### Testing Checklist\n- [ ] Create epic, spawn session ‚Üí worktree branches from main\n- [ ] Create child task of epic ‚Üí worktree branches from epic branch\n- [ ] Space+m on child ‚Üí merges to epic branch\n- [ ] Space+P on child ‚Üí PR targets epic branch\n- [ ] Space+m on epic ‚Üí merges to main, closes children\n- [ ] Space+P on epic ‚Üí PR targets main\n- [ ] Child spawned before epic ‚Üí auto-creates epic branch\n\n### Acceptance Criteria\n- [ ] Child tasks automatically target their parent epic's branch\n- [ ] Epic merges to main consolidate all child work\n- [ ] Works in both workflowMode: origin and local\n- [ ] UI shows effective merge target","acceptance_criteria":"- [x] Child tasks automatically target their parent epic's branch for worktree creation\n- [x] Child tasks create PRs targeting epic branch (not main) \n- [x] Child tasks merge to epic branch via Space+m (not main)\n- [x] Epic merges to main consolidate all child work\n- [x] When epic merges to main with closeBead=true, all children are auto-closed\n- [x] DiffViewer shows correct base branch (epic branch for children)\n- [x] If child spawned before epic, epic worktree is auto-created first\n- [x] Works in both workflowMode: origin and local\n- [x] Type-check and build pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T17:20:49.005057+11:00","updated_at":"2025-12-30T00:04:49.632078+11:00","closed_at":"2025-12-30T00:04:49.632078+11:00","close_reason":"Implemented context-aware branch targeting for epic-consolidated PRs"}
{"id":"az-4nge","title":"we sometimes lose track of running dev servers","description":"use tmux as the source of truth for running dev servers maybe? add port and stuff to tmux state like we did for session status","design":"## Problem\n\nDev servers running in tmux are sometimes not shown in the Azedarach UI. This happens because the current approach stores dev server state in `.azedarach/devservers.json` and relies on syncing with tmux on startup. If Azedarach restarts unexpectedly or the JSON file gets out of sync, dev servers can become \"invisible\" even though they're still running.\n\n## Solution\n\nUse tmux user-options (`set-option -t session @option-name value`) as the **source of truth** for dev server state. This ensures:\n1. Dev server state survives Azedarach restarts\n2. No file sync issues - state lives with the tmux session itself\n3. If tmux session dies, state dies with it (no ghost entries)\n\n## Implementation Plan\n\n### 1. Add tmux user-option helpers to TmuxService\n\nAdd methods to TmuxService for getting/setting session user-options:\n```typescript\nsetUserOption: (session: string, key: string, value: string) =\u003e Effect\u003cvoid\u003e\ngetUserOption: (session: string, key: string) =\u003e Effect\u003cOption\u003cstring\u003e\u003e\n```\n\nUse tmux commands:\n- `tmux set-option -t session @azedarach-devserver-port 3000`\n- `tmux show-option -t session -v @azedarach-devserver-port`\n\n### 2. Update DevServerService to use tmux as source of truth\n\nWhen starting a dev server:\n```typescript\n// After creating tmux session, store metadata as user-options\nyield* tmux.setUserOption(sessionName, \"@azedarach-devserver-port\", String(port))\nyield* tmux.setUserOption(sessionName, \"@azedarach-devserver-status\", \"running\")\nyield* tmux.setUserOption(sessionName, \"@azedarach-devserver-started-at\", new Date().toISOString())\n```\n\nWhen recovering state on startup:\n```typescript\n// Query tmux sessions with az-dev-* prefix\n// For each, read user-options to get port/status/startedAt\n// Build state from tmux, not from JSON file\n```\n\n### 3. Remove JSON persistence for dev servers\n\nThe `.azedarach/devservers.json` file becomes unnecessary since tmux is the source of truth. Remove:\n- `loadPersistedServers()`\n- `persistServers()`\n- `devServersFilePath`\n- `PersistedDevServersSchema`\n\n### 4. Simplify health check\n\nThe health check can be simplified:\n- Just query tmux for sessions with `az-dev-*` prefix\n- Read user-options from each session\n- Update in-memory SubscriptionRef accordingly\n\n## User-Option Schema\n\nStore these options on each dev server tmux session:\n- `@azedarach-devserver-port` - The port number (e.g., \"3000\")\n- `@azedarach-devserver-status` - One of: \"starting\", \"running\", \"error\"\n- `@azedarach-devserver-bead-id` - The bead ID this dev server belongs to\n- `@azedarach-devserver-worktree-path` - Path to the worktree\n- `@azedarach-devserver-started-at` - ISO timestamp\n\n## Files to Modify\n\n1. `src/core/TmuxService.ts` - Add setUserOption/getUserOption methods\n2. `src/services/DevServerService.ts` - Rewrite to use tmux as source of truth\n\n## Testing\n\n1. Start Azedarach, start a dev server\n2. Kill Azedarach (Ctrl+C or kill the process)\n3. Restart Azedarach\n4. Verify dev server shows with correct port in StatusBar","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:21:38.086307+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-22T12:58:16.35268+11:00","close_reason":"Fixed with worktree-aware project detection + periodic re-discovery polling","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-4r0","title":"AgentMailClient Effect service","description":"Create Effect service wrapper for Agent Mail HTTP API.\n\nDesign:\n- Define AgentMailClient as Effect.Service\n- Use @effect/platform HttpClient for requests\n- Methods:\n  - reserve(issueId): Effect\u003cReservation, ReservationError\u003e\n  - release(issueId): Effect\u003cvoid, ReleaseError\u003e\n  - ready(): Effect\u003cIssue[], AgentMailError\u003e\n  - updateStatus(issueId, status): Effect\u003cvoid, AgentMailError\u003e\n  - isAvailable(): Effect\u003cboolean, never\u003e (health check)\n- Read config from environment variables\n- Graceful degradation: return fallback when server unavailable\n- Retry logic with exponential backoff\n- Create AgentMailClientLive and AgentMailClientTest layers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.475812+11:00","updated_at":"2025-12-12T10:33:13.475812+11:00","dependencies":[{"issue_id":"az-4r0","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.800097+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-4r05","title":"all epic bead git tasks should operate against the epic parent as the base branch","description":"first find all git ops that may happen in epic drill down, then figure out if we do it right (against epic base) or not. then fix ones that are wrong","design":"## Problem\n\nWhen working on epic children in drill-down mode, several toast messages and one git operation incorrectly reference `gitConfig.baseBranch` (typically \"main\") instead of the effective base branch (the parent epic's branch).\n\nThe underlying git operations are correct - they use `getBeadBaseBranch()` which properly returns the parent epic's branch for children. But the UI messaging is misleading.\n\n## Files to Fix\n\n### 1. PRHandlersService.ts (lines 144, 150, 197)\n**Issue**: Toast messages show `gitConfig.baseBranch` instead of effective base branch\n\n**Fix**: Call `prWorkflow.getEffectiveBaseBranchForBead()` before showing toasts to get the correct branch name.\n\n### 2. BoardService.ts (line 711)\n**Issue**: `refreshGitStats()` uses `gitConfig.baseBranch` for all tasks instead of using `task.parentEpicId` for epic children\n\n**Fix**: Use `task.parentEpicId ?? baseBranch` for each task, same pattern as `loadTasks()` at line 532.\n\n### 3. SessionHandlersService.ts (line 417)\n**Issue**: Error fallback in `attachExternal` uses `gitConfig.baseBranch` as default\n\n**Fix**: Query parent epic for the fallback case to maintain consistency.\n\n## Implementation Approach\n\nEach fix is small and isolated - just replacing hardcoded `gitConfig.baseBranch` with the effective base branch. The infrastructure already exists via `getBeadBaseBranch()` and `getEffectiveBaseBranchForBead()`.\n\n## Acceptance Criteria\n- [ ] Toast messages in PRHandlersService show correct base branch for epic children\n- [ ] refreshGitStats uses correct base branch for epic children  \n- [ ] attachExternal fallback uses correct base branch\n- [ ] Type-check passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:21:00.440976+11:00","updated_at":"2025-12-30T21:32:05.999164+11:00","closed_at":"2025-12-30T21:32:05.999167+11:00","close_reason":"Fixed all git operations to use effective base branch in epic drill-down mode. Toast messages now correctly show parent epic branch for children. BoardService refreshGitStats now uses correct base branch for git diff calculations."}
{"id":"az-4vc","title":"paste from clipboard not working on mac still","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:25.365057+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:41:03.286913+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-4vp","title":"how do we install az hooks into a repo? document/improve this flow","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:22:57.513319+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T10:39:21.455076+11:00","close_reason":"Documented and improved hook installation flow: created docs/hooks-installation.md, extracted hook generation to src/core/hooks.ts, added `az hooks install` CLI command, added PermissionRequest hook","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-4w4i","title":"cross project initCommands issue","description":"when i move between projects initCommands seem to get lost\nchefy uses pnpm i not bun","design":"## Problem Analysis\n\nWhen Azedarach spawns Claude sessions for external projects (e.g., Chefy which uses pnpm), it always runs initCommands from Azedarach's own `.azedarach.json` config. This causes:\n- `bun install` to run in pnpm-based projects (wrong package manager)\n- `bd sync` to fail in projects without beads\n\nScreenshot shows: `initCommands failed for Chefy-m3sk` with `bun install` and `bd sync` failures.\n\n## Root Cause\n\nIn `SessionManager.ts:318`:\n```typescript\nconst appConfig = yield* AppConfig\nconst resolvedConfig: ResolvedConfig = appConfig.config\n```\n\nConfig is loaded once at service construction from Azedarach's root, then used for ALL sessions regardless of target project.\n\n## Solution: Load Project-Specific Config at Session Start\n\nModify SessionManager.start() to load config from the target project's path:\n\n1. **Add helper to AppConfig** - Expose a static method `loadConfigFromPath(path)` that reuses the existing loading logic\n2. **Update SessionManager.start()** - Load config from worktree.path (the target project) instead of using the global config\n3. **Merge configs** - Allow target project config to override only the worktree section (keeps Azedarach's session settings)\n\n## Implementation Plan\n\n### Step 1: Export config loading function from AppConfig\nExtract the config loading logic into a reusable function that can load from any project path.\n\n### Step 2: Modify SessionManager.start()\n```typescript\n// After worktree creation, load target project's config\nconst targetConfig = yield* loadConfigFromPath(worktree.path)\n\n// Use target project's initCommands, fall back to Azedarach's config\nconst worktreeConfig = targetConfig?.worktree ?? resolvedConfig.worktree\n```\n\n### Step 3: Handle missing configs gracefully\nIf target project has no `.azedarach.json`:\n- Use empty initCommands (don't inherit from Azedarach)\n- This is safer than running wrong commands\n\n## Files to Modify\n\n1. `src/config/AppConfig.ts` - Add loadConfigFromPath export\n2. `src/core/SessionManager.ts` - Use project-specific config in start()","notes":"üìé [mjc8m9za-p8eb.png](.beads/images/az-4w4i/mjc8m9za-p8eb.png) (clipboard, 12/19/2025, 1:15:45 PM)\n\n## Implementation Complete\n\n### Changes Made:\n\n1. **AppConfig.ts** - Added `loadWorktreeConfigFromPath(projectPath)` function\n   - Loads `.azedarach.json` or `package.json.azedarach` from any project path\n   - Returns `WorktreeConfig | null` (null if no config exists)\n   - Fully type-safe, no `as` casting\n\n2. **config/index.ts** - Exported the new function\n\n3. **SessionManager.ts** - Modified `start()` method\n   - Loads worktree config from `projectPath` (target project) instead of using global config\n   - Uses `DEFAULT_CONFIG.worktree` defaults if target has no config (empty initCommands)\n   - Session settings still come from Azedarach's config (intentional)\n\n### Behavior After Fix:\n\n- **Azedarach sessions**: Use Azedarach's `.azedarach.json` initCommands (`bun install`, etc.)\n- **Chefy sessions**: Use Chefy's `.azedarach.json` if it exists, otherwise no initCommands\n- **Any project**: Each project controls its own initCommands via its own config file\n\n### Testing:\n- Type check: ‚úÖ Passed\n- Build: ‚úÖ Passed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:15:42.682605+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T13:58:27.091817+11:00","close_reason":"Implemented project-specific initCommands loading. SessionManager now loads worktree config from the target project path instead of using Azedarach's global config. External projects (like Chefy with pnpm) will use their own .azedarach.json if present, or no initCommands if absent.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-4zq","title":"session monitoring not working. i assume due to permission denied on hooks","description":"we may need to chmod hook scripts?","notes":"Fixed. Root cause: Effect.fork() immediately interrupts child fibers when parent effect completes. Changed to Effect.forkScoped() which ties fiber lifetime to caller's scope. Also added immediate processing of pending notifications on startup. Documented fork vs forkScoped in CLAUDE.md.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:14:22.614097+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T00:38:48.996207+11:00","close_reason":"Fixed Effect.fork‚ÜíforkScoped in HookReceiver. Documented in CLAUDE.md.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-50zf","title":"add a way to see the diff between a bead branch and main so i can code review","notes":"Using tmux popup approach (like Space+L for logs) instead of custom overlay - simpler, better scrolling, proper terminal rendering of ANSI colors from git diff","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:45:08.332767+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:03:03.887758+11:00","close_reason":"Implemented Space+f keybinding to show git diff between bead branch and main in a tmux popup. Also fixed pre-existing build error by adding getWorktreePath to paths.ts.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-519a","title":"sometimes az loses track of sessions like the one in the image","description":"the one in the image DOES have a tmux session thats running claude","design":"## Root Cause Analysis\n\nThe issue was a race condition in session recovery where `TmuxSessionMonitor` would detect sessions and call `updateStateFromTmux()`, but if the session wasn't already registered in `sessionsRef`, the update would **fail silently** with a `SessionNotFoundError` that gets swallowed.\n\n**Flow that caused the bug:**\n1. `TmuxSessionMonitor.start()` polls tmux sessions and reads `@az_status`\n2. For each session, handler calls `manager.updateStateFromTmux(beadId, status)`\n3. If session isn't in `sessionsRef`, it throws `SessionNotFoundError`\n4. Error is caught and swallowed by `.pipe(Effect.catchAll(() =\u003e Effect.void))`\n5. Session never gets added ‚Üí UI shows task as \"idle\"\n\n**Why it happened on startup:**\n- `BoardService.listActive()` also recovers orphaned sessions, but there's a race\n- If `TmuxSessionMonitor` runs before `listActive()` completes, sessions are missed\n- Sessions started from worktrees or manually outside Azedarach always fail\n\n## Implementation\n\nModified `updateStateFromTmux` to accept optional session metadata:\n- If session doesn't exist BUT metadata is provided ‚Üí create orphaned session\n- Log recovery event for debugging\n- Persist recovered session to disk\n- Publish state change event (idle ‚Üí current state)\n\nUpdated handler in `session.ts` to pass full `SessionStateUpdate` metadata including:\n- `sessionName`: tmux session name\n- `createdAt`: unix timestamp\n- `worktreePath`: from `@az_worktree` option\n- `projectPath`: from `@az_project` option\n\nThis ensures ANY tmux session matching the bead naming pattern gets recovered automatically when detected by the monitor.","notes":"Implementation complete. Key changes:\n\n1. `src/core/ClaudeSessionManager.ts`:\n   - Extended `updateStateFromTmux` signature to accept `sessionMeta`\n   - When session not found but meta provided, creates orphaned session\n   - Uses metadata for worktreePath/projectPath with sensible fallbacks\n\n2. `src/ui/atoms/session.ts`:\n   - Updated handler to pass full update metadata to `updateStateFromTmux`\n\nBuild passes. Type check has pre-existing errors unrelated to this change.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T15:19:00.677143+11:00","updated_at":"2025-12-29T18:06:43.223042+11:00","closed_at":"2025-12-29T18:06:43.223044+11:00","close_reason":"Fixed silent failure in session recovery. updateStateFromTmux now creates orphaned sessions when metadata is provided, ensuring all tmux sessions matching bead naming pattern are recovered automatically."}
{"id":"az-53o","title":"Notification system (terminal bell, system notifications)","description":"Alert user when sessions need attention.","design":"- Define NotificationService as Effect.Service\n- Methods:\n  - notify(title, body, urgency): Effect\u003cvoid, NotificationError\u003e\n  - bell(): Effect\u003cvoid\u003e // terminal bell \\x07\n- Notification backends:\n  - macOS: osascript via @effect/platform Command\n  - Cross-platform fallback: node-notifier (optional dep)\n- Use Effect.race with timeout for notification delivery\n- Notification triggers: subscribe to SessionManager PubSub\n- Configurable via Config service:\n  - enable/disable per event type\n  - sound option\n  - cooldown duration\n- Use Schedule.spaced for cooldown to prevent spam","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.717497+11:00","updated_at":"2025-12-11T14:54:42.593575+11:00","dependencies":[{"issue_id":"az-53o","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.727137+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-58v","title":"Implement issue type change in EditorService","description":"src/core/EditorService.ts line 773 has TODO:\n\"Implement type change (delete old, create new, preserve deps)\"\n\nChanging issue type (task‚Üíbug, feature‚Üíepic) requires:\n1. Capture existing dependencies\n2. Delete original issue\n3. Create new issue with same ID pattern but new type\n4. Re-link dependencies\n\nThis is a data migration operation that needs careful handling.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.827186+11:00","updated_at":"2025-12-17T15:59:44.827186+11:00"}
{"id":"az-5ck","title":"when i approve claude permissions in bead worktrees i want them to be merged into .claude/settings.json or something","notes":"Analyzed codebase. Plan: Add SessionEnd hook to sync permissions back to main project. Leverages existing WorktreeManager.deepMerge() for merging permission arrays.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:25:31.149667+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T15:49:48.21207+11:00","close_reason":"Implemented permission sync: Added `az sync-permissions` CLI command and SessionEnd hook integration. When Claude sessions end in worktrees, any new permissions approved during the session are automatically merged back to the main project's settings.local.json.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-5ctw","title":"design how to show dependencies in epic drill down view","description":"then implement it","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:44:41.367965+11:00","updated_at":"2025-12-19T11:44:41.367965+11:00"}
{"id":"az-5jl","title":"File bug report for bd merge driver deleting beads incorrectly","description":"The `bd merge` driver uses standard 3-way merge semantics which can incorrectly delete beads.\n\n**Issue:** When a bead exists in base (ancestor) and main, but NOT in the branch being merged, the driver interprets this as \"branch deleted the bead\" and removes it. But the real scenario is often \"branch was created before this bead existed.\"\n\n**Expected behavior:** Beads should use additive merge semantics - beads are never deleted by merge, only added/updated. If a bead exists in either branch, it should appear in the result.\n\n**Workaround:** Azedarach now calls `bd sync --import-only` after merge to recover lost beads (az-mlv fix).\n\n**Suggested fix:** The merge driver should check `bead.created_at` against the branch divergence point. If the bead was created after the fork, keep it regardless of whether the branch has it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-18T02:09:27.362267+11:00","updated_at":"2025-12-18T02:09:27.362267+11:00","labels":["bd","upstream"]}
{"id":"az-5p5","title":"Add session metrics section to DetailPanel","description":"Add Session Metrics section to DetailPanel modal showing: Context % with warning indicator, session duration, estimated token count. Only visible when session is active (not idle).","notes":"## Progress\n\n### ‚úÖ Completed\n- DetailPanel UI section for metrics (lines 257-289)\n- Color-coded context % display (lavender/yellow/red thresholds)\n- Duration formatting from sessionStartedAt  \n- Token count display with K suffix\n- Visibility guard (only shows when session active)\n- Agent phase display (bonus)\n- **NEW**: BoardService now maps sessionStartedAt from SessionManager\n\n### ‚ùå Still Missing (requires az-zu3)\n- contextPercent: Needs PTY monitoring to parse Claude's status line\n- estimatedTokens: Needs PTY monitoring to parse Claude's status line\n- agentPhase: StateDetector exists but isn't wired to active monitoring\n\n### Dependency\nThis issue depends on az-zu3 (hybrid state detection) for full metrics collection.\nSession duration works NOW since SessionManager tracks startedAt.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.666185+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T14:46:52.042889+11:00","dependencies":[{"issue_id":"az-5p5","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.146395+11:00","created_by":"daemon"},{"issue_id":"az-5p5","depends_on_id":"az-zu3","type":"blocks","created_at":"2025-12-17T14:44:22.017914+11:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"az-5p5","author":"riordan","text":"UI code exists but data pipeline is missing. SessionManager doesn't collect metrics, BoardService doesn't map them. Need: 1) Data source for context%, tokens 2) SessionManager collection 3) BoardService mapping","created_at":"2025-12-17T03:41:30Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-5xza","title":"tui_core: Renderer - terminal output with ANSI escape codes","description":"Render FrameBuffer to terminal using ANSI escape codes.\n\n## What\n- Convert Colors (from az-hkfa) to ANSI escape sequences\n- Diff current vs previous FrameBuffer, only emit changes (optimization)\n- Handle cursor positioning, clearing, alt screen buffer\n\n## API (Gleam)\n```gleam\ntype Renderer {\n  Renderer(\n    prev_buffer: Option(FrameBuffer),\n    stdout: Fd,  // or however Gleam handles stdout\n    alt_screen: Bool,\n    cursor_visible: Bool,\n  )\n}\n\nfn new() -\u003e Renderer\nfn render(renderer: Renderer, fb: FrameBuffer) -\u003e Renderer  // Returns updated renderer with prev state\nfn enter_alt_screen(renderer: Renderer) -\u003e Renderer\nfn exit_alt_screen(renderer: Renderer) -\u003e Renderer\nfn show_cursor(renderer: Renderer) -\u003e Renderer\nfn hide_cursor(renderer: Renderer) -\u003e Renderer\nfn move_cursor(renderer: Renderer, x: Int, y: Int) -\u003e Renderer\nfn clear_screen(renderer: Renderer) -\u003e Renderer\nfn flush(renderer: Renderer) -\u003e Renderer\n```\n\n## Rendering Strategy\n```\n1. Compare new FrameBuffer to prev_buffer\n2. For each changed cell:\n   - Move cursor if not adjacent to last write\n   - Set colors/attributes if changed\n   - Write character\n3. Store new buffer as prev for next diff\n4. Flush output\n```\n\n## ANSI Escape Sequences\n```\n\\\\x1b[H          - Move cursor to home (0,0)\n\\\\x1b[{y};{x}H   - Move cursor to position\n\\\\x1b[38;2;R;G;Bm - Set foreground RGB (true color)\n\\\\x1b[48;2;R;G;Bm - Set background RGB (true color)\n\\\\x1b[0m         - Reset all attributes\n\\\\x1b[?1049h     - Enter alt screen\n\\\\x1b[?1049l     - Exit alt screen\n\\\\x1b[?25h      - Show cursor\n\\\\x1b[?25l      - Hide cursor\n```\n\n## Dependencies\n- az-xe2h: FrameBuffer (what we render)\n- az-hkfa: Color (for ANSI conversion)\n- az-se6w: Layout (provides laid-out content to render)\n- az-kmuk: Borders (border drawing during render)\n\n## Reference\n- OpenTUI CliRenderer: packages/core/src/cli-renderer.ts\n\n## Acceptance Criteria\n- [ ] Render FrameBuffer to terminal correctly\n- [ ] Efficient diffing (only redraw changed cells)\n- [ ] Alt screen buffer works (clean enter/exit)\n- [ ] Cursor visibility control works\n- [ ] No visual artifacts or flicker\n- [ ] True color (24-bit) output works","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:26:07.647035+11:00","updated_at":"2025-12-28T11:35:21.612104+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-5xza","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.658778+11:00","created_by":"daemon"},{"issue_id":"az-5xza","depends_on_id":"az-xe2h","type":"blocks","created_at":"2025-12-28T11:26:28.695953+11:00","created_by":"daemon"},{"issue_id":"az-5xza","depends_on_id":"az-se6w","type":"blocks","created_at":"2025-12-28T11:33:58.495698+11:00","created_by":"daemon"},{"issue_id":"az-5xza","depends_on_id":"az-kmuk","type":"blocks","created_at":"2025-12-28T11:33:58.572521+11:00","created_by":"daemon"}]}
{"id":"az-5z7z","title":"creating tasks from within epic drill down should auto create them in the epic","description":"and probably we need to spawn a claude session to setup any dependencies between it and the other epic tasks","design":"## Implementation Plan\n\n### Overview\nWhen a user creates a task while in epic drill-down mode, automatically add a parent-child dependency linking the new task to the epic.\n\n### Changes Required\n\n#### 1. Add `addDependency` method to BeadsClient (`src/core/BeadsClient.ts`)\n- New method: `addDependency(issueId, dependsOnId, type?)` \n- Calls: `bd dep add \u003cissueId\u003e \u003cdependsOnId\u003e [--type=parent-child]`\n- Default type: \"blocks\" (per CLI default), but we'll use \"parent-child\" for epic children\n\n#### 2. Modify `createBead` in TaskHandlersService (`src/services/keyboard/TaskHandlersService.ts`)\n- After successful bead creation, check if in drill-down mode via `nav.getDrillDownEpic()`\n- If drill-down epic exists, call `beadsClient.addDependency(newTaskId, epicId, \"parent-child\")`\n- Show toast indicating task was added to epic\n\n### Data Flow\n```\nUser presses 'c' in epic drill-down mode\n        ‚Üì\nTaskHandlersService.createBead()\n        ‚Üì\nBeadEditorService.createBead() returns { id, title }\n        ‚Üì\nCheck: nav.getDrillDownEpic() ‚Üí epicId or null\n        ‚Üì\nIf epicId: beadsClient.addDependency(newTaskId, epicId, \"parent-child\")\n        ‚Üì\nboard.refresh() + nav.jumpToTask(newTaskId)\n        ‚Üì\nToast: \"Created {id} (added to epic {epicId})\"\n```\n\n### Edge Cases\n- If `addDependency` fails, still succeed the creation but show warning toast\n- Epic could be deleted between drill-down entry and task creation (rare, handle gracefully)","acceptance_criteria":"- [ ] Creating a task with 'c' key while in epic drill-down automatically links it to the epic\n- [ ] The new task appears in the drill-down view immediately after creation\n- [ ] Toast message indicates the task was added to the epic\n- [ ] If not in drill-down mode, task creation works as before (no parent-child link)\n- [ ] Type-check passes (`bun run type-check`)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:39:19.433464+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:08:10.232317+11:00","close_reason":"Implemented auto-add to epic feature. New tasks created with 'c' key while in epic drill-down mode are automatically linked as children of the epic via parent-child dependency.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-65k","title":"Selection jumps to top of column after moving task left","notes":"Session progress (2025-12-14):\n\nROOT CAUSE ANALYSIS:\n- Navigation tracks position (columnIndex, taskIndex) not task ID\n- After moving RIGHT into empty column, taskIndex clamps to 0\n- Moving LEFT then uses stale taskIndex (0), navigating to top of column\n\nSOLUTION DESIGNED:\n1. Add `followTaskId` state to track which task to follow after moves\n2. Add useEffect watching followTaskId + tasksByColumn\n3. When data refreshes, find task by ID and navigate to its new position\n4. Update LEFT/RIGHT handlers in action mode to use setFollowTaskId()\n\nFILES TO MODIFY:\n- src/ui/App.tsx:\n  - Line 4: Add useEffect import\n  - After line 112: Add followTaskId state\n  - After navigateTo (line 206): Add useEffect for following task\n  - Lines 405-430: Update LEFT handler to use setFollowTaskId\n  - Lines 431-456: Update RIGHT handler to use setFollowTaskId\n\nFIX WAS APPLIED BUT REVERTED:\n- The fix was successfully implemented\n- A linter/formatter reverted the changes\n- Need to re-apply with proper formatting\n\nNEXT STEP:\nRe-apply the fix, ensuring it passes linting/formatting","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T17:17:04.148671+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T02:13:17.044687+11:00","comments":[{"id":1,"issue_id":"az-65k","author":"riordan","text":"Fix was reverted by linter/formatter. Need to re-apply the followTaskId fix.","created_at":"2025-12-13T13:43:02Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-66f4","title":"add ability to view running dev server","design":"## Overview\n\nAdd the ability to view (attach to) running dev server tmux sessions, and show an icon indicator on task cards for tasks with running dev servers.\n\n## Implementation Plan\n\n### Part 1: Add dev server icon indicator to TaskCard\n\n**Files to modify:**\n- `src/ui/types.ts` - Add DEV_SERVER_INDICATOR constant\n- `src/ui/TaskCard.tsx` - Display the indicator when dev server is running\n- `src/ui/atoms/devServer.ts` - Ensure we have an atom to check dev server state per task\n\n**Logic:**\n- In TaskCard, check if the current task has a running dev server (status === \"running\")\n- Display a distinct icon (e.g., üñ•Ô∏è or ‚öôÔ∏è) in the header line after other indicators\n- Use the existing `devServersAtom` to get dev server state per bead ID\n\n### Part 2: Add attach dev server action (Space+v)\n\n**Files to modify:**\n- `src/services/keyboard/DevServerHandlersService.ts` - Add `attachDevServer` handler\n- `src/services/keyboard/bindings.ts` - Add Space+v binding\n- `src/ui/ActionPalette.tsx` - Add \"View dev server\" option\n- `docs/keybindings.md` - Document the new keybinding\n\n**Logic:**\n1. Check if selected task has a running dev server (via DevServerService.getStatus)\n2. If running, use TmuxService.switchClient() to switch to the dev server tmux session\n3. Session name pattern: `az-dev-{beadId}` (already defined as DEV_SESSION_PREFIX)\n4. Show toast on error (no dev server running, session not found, etc.)\n\n### Key Design Decisions\n\n1. **Keybinding: Space+v** - \"v\" for \"view\" is intuitive, similar to how Space+a \"attaches\" to Claude sessions\n2. **Icon: üñ•Ô∏è** - Distinct from session indicators (üîµüü°‚úÖ‚ùå‚è∏Ô∏è), represents a running server\n3. **Reuse existing patterns** - Follow AttachmentService's switchClient approach for consistency\n4. **Minimal changes** - Only add what's needed, no refactoring","acceptance_criteria":"- [ ] TaskCard shows üñ•Ô∏è icon when a dev server is running for that task\n- [ ] Space+v attaches to the dev server tmux session for the selected task  \n- [ ] Toast shows error if no dev server is running\n- [ ] ActionPalette shows \"View dev server\" option when dev server is running\n- [ ] docs/keybindings.md updated with Space+v documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T19:29:50.61444+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-20T00:23:00.78289+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-67fc","title":"Overhaul Background Ops System for Project-Independent Execution","description":"## Problem Statement\n\nThe **CommandQueueService** and **MutationQueue** have a critical bug: operations can execute against the **wrong project** if the user switches projects while ops are queued.\n\n### Root Cause: Inconsistent Context Capture\n\n**CommandQueueService ops** (merge, cleanup, start session, create PR, etc.):\n- Some capture `projectPath` BEFORE queueing ‚úÖ\n- Others query `projectService.getCurrentPath()` INSIDE the queued effect ‚ùå\n\n**MutationQueue ops** (Move, Update, Delete):\n- NEVER capture project context\n- All call `beadsClient.update/delete()` which queries `projectService.getCurrentPath()` at execution time ‚ùå\n\n### The Race Condition\n\n```\nTime 0: User on Project A triggers Move (task ‚Üí in_progress)\nTime 1: Mutation added to queue (no projectPath captured)  \nTime 2: User switches to Project B\nTime 3: Queue processes mutation, beadsClient calls getCurrentPath() ‚Üí returns B\nTime 4: bd update runs with cwd=B, targets wrong .beads database üí•\n```\n\n### Evidence from Code\n\n**Buggy - late-bound context:**\n- `PRHandlersService.ts:77` - `doMerge()` queries `getProjectPath()` inside effect\n- `PRHandlersService.ts:150` - `updateFromBase()` same issue\n- `PRHandlersService.ts:555` - `abortMerge()` same issue\n- `MutationQueue.ts:96` - `beadsClient.update()` uses live projectService\n- `BeadsClient.ts:581-582` - `getEffectiveCwd()` queries `projectService.getCurrentPath()`\n\n**Correct - early-bound context:**\n- `SessionHandlersService.ts:94` - captures projectPath BEFORE `withQueue`\n- `PRHandlersService.ts:235-241` - captures projectPath BEFORE `withQueue`\n\n## Goals\n\n1. **Correctness** - Ops ALWAYS target the project they were submitted from\n2. **Visibility** - See what's queued/running per project\n3. **Speed** - Show cached project state immediately on switch, update in background\n4. **Independence** - Ops run to completion even if project changes\n\n## User Flow: Project Switch Mid-Op\n\n**Desired behavior:**\n1. User on Project A, triggers merge for az-123\n2. Merge starts (takes 30+ seconds for git ops)\n3. User switches to Project B (wants to check something)\n4. UI immediately shows Project B's cached tasks\n5. Background: Merge continues against Project A\n6. Merge completes ‚Üí az-123 (in Project A) updated\n7. If user switches back to A, they see the completed merge\n\n**Current behavior:**\n1-3. Same\n4. If merge effect runs NOW, it queries current project ‚Üí gets B\n5. Merge runs against Project B's .beads database üí•\n6. Either wrong task updated, or error if task ID doesn't exist\n\n## Technical Requirements\n\n### 1. OpContext Capture at Submission\nEvery queued op must capture:\n```typescript\ninterface OpContext {\n  projectPath: string      // Which project this op targets\n  submittedAt: Date        // When op was submitted\n}\n```\n\n### 2. BeadsClient Enhancement\nEnsure explicit cwd is used for ALL operations:\n```typescript\n// Current: defaults to live project\nbeadsClient.update(id, fields)\n\n// All calls should explicitly pass cwd\nbeadsClient.update(id, fields, context.projectPath)\n```\n\n### 3. MutationQueue Context\nEach mutation must carry its target project:\n```typescript\ntype Mutation = {\n  _tag: \"Move\"\n  id: string\n  status: ColumnStatus\n  projectPath: string  // ‚Üê ADD THIS\n  rollback: Effect\u003cvoid\u003e\n}\n```\n\n### 4. Project-Keyed Caching\nShow cached state immediately on project switch:\n```typescript\nprojectBoards: Map\u003cprojectPath, {\n  tasks: TaskWithSession[]\n  lastRefreshed: Date\n  refreshInProgress: boolean\n}\u003e\n```","design":"## Solution Architecture\n\n### Phase 1: Fix the Bug (Immediate)\n\n**1.1 Standardize context capture pattern**\n\nAll operations must capture projectPath BEFORE queueing:\n```typescript\n// PRHandlersService.ts - doMerge (and similar)\nconst doMerge = (beadId: string, targetBranch: string) =\u003e\n  Effect.gen(function* () {\n    // Capture BEFORE entering the queue\n    const projectPath = yield* helpers.getProjectPath()\n    \n    yield* helpers.withQueue(\n      beadId,\n      \"merge\",\n      // Effect uses captured projectPath, not live query\n      prWorkflow.mergeToMain({ beadId, projectPath })\n    )\n  })\n```\n\n**1.2 Add projectPath to MutationQueue**\n\n```typescript\n// MutationQueue.ts\nexport type Mutation = {\n  _tag: \"Move\"\n  id: string\n  status: ColumnStatus\n  projectPath: string  // Captured at submission\n  rollback: Effect\u003cvoid\u003e\n}\n\n// Pass to beadsClient\nconst executeMutation = (mutation: Mutation) =\u003e {\n  switch (mutation._tag) {\n    case \"Move\":\n      return beadsClient.update(mutation.id, \n        { status: mutation.status }, \n        mutation.projectPath  // Use captured path\n      )\n  }\n}\n```\n\n### Phase 2: Per-Project Board Cache\n\n**2.1 Project-keyed board state**\n\n```typescript\ninterface ProjectBoardState {\n  tasks: TaskWithSession[]\n  lastRefreshed: DateTime\n  isRefreshing: boolean\n}\n\n// In BoardService\nprojectBoards: SubscriptionRef\u003cMap\u003cstring, ProjectBoardState\u003e\u003e\n```\n\n**2.2 Instant project switch**\n```typescript\nconst switchProject = (newPath: string) =\u003e\n  Effect.gen(function* () {\n    // 1. Update current project immediately\n    yield* projectService.setCurrentPath(newPath)\n    \n    // 2. Show cached state (even if stale)\n    const cached = yield* getCachedBoard(newPath)\n    if (cached) {\n      yield* setActiveBoard(cached.tasks)\n    }\n    \n    // 3. Trigger background refresh (don't await)\n    yield* refreshBoard(newPath).pipe(Effect.forkDaemon)\n  })\n```\n\n### Phase 3: Unified Progress View\n\n**3.1 Extend queues with project context**\n\n```typescript\ninterface QueuedCommand {\n  id: string\n  taskId: string\n  projectPath: string  // Which project this targets\n  label: string\n  queuedAt: Date\n}\n```\n\n**3.2 Progress atoms per project**\n\n```typescript\n// Show ops for current project only\nconst currentProjectOpsAtom = Atom.readable((get) =\u003e {\n  const currentProject = get(currentProjectAtom)\n  const allOps = get(allOpsAtom)\n  return allOps.filter(op =\u003e op.projectPath === currentProject)\n})\n```","acceptance_criteria":"- [ ] Ops ALWAYS target the project they were submitted from (no wrong-project bugs)\n- [ ] MutationQueue captures projectPath at mutation creation time\n- [ ] CommandQueueService ops consistently capture context before queueing\n- [ ] Project switch shows cached state immediately (no loading spinner)\n- [ ] Background refresh updates cache without blocking UI\n- [ ] Progress view shows running ops with their target project\n- [ ] Ops from \"old\" project complete correctly after switch","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-01T22:06:08.707118+11:00","updated_at":"2026-01-01T22:18:50.230935+11:00"}
{"id":"az-6c5","title":"allow space S which starts a claude code instance and gets it to start working on the task","description":"e.g. prompt it with \"work on bead [bead-id]\"","notes":"Starting implementation. Approach:\n1. Add actionStartSessionWithPrompt() - starts session, waits for Claude init, sends prompt\n2. Add S-s keybinding (Shift+s) for \"start and work\"\n3. Update ActionPalette to show 'S work' option","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:26:05.162586+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T00:54:24.960417+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-6e3","title":"somehow allow starting a session via space s/S with --dangerously-skip-permissions","description":"we dont want to default to it but we should allow the user to do it somehow. not sure what the keybind should be. might need a secondary menu layer or a dialog... or might just need a new action menu keybind","notes":"Implementation plan: 1) Add dangerouslySkipPermissions to StartSessionOptions 2) Update SessionManager.start() to use the flag 3) Add new handler startSessionDangerous() 4) Add ! keybind in action mode 5) Update ActionPalette","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:40:35.565457+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T12:45:17.622659+11:00","close_reason":"Implemented Space+! keybind to start sessions with --dangerously-skip-permissions flag","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-6la","title":"Add context health border colors to TaskCard","description":"Encode context health into TaskCard border color when session is active: lavender (healthy, \u003c70%), yellow (warning, 70-90%), red (critical, \u003e90%). Requires contextPercent from TaskWithSession.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.426477+11:00","updated_at":"2025-12-12T13:25:20.07394+11:00","dependencies":[{"issue_id":"az-6la","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.111928+11:00","created_by":"daemon"}]}
{"id":"az-6nu","title":"help me figure out this tool use issue in claude sessions started via space s/S","description":"- it always stdouts ERROR: wrong usage\n - i have no idea what program/script logs it\n - it doesnt happen if i ctrl-a % to split and open a new claude session and tell it to type check\n - doesnt happen for read/write tool use only commands that use shell like bun run type-check etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:01:53.842983+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:17:50.228619+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-6rkz","title":"Design Convoy UI overlay with progress visualization","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T00:40:27.686609+11:00","updated_at":"2026-01-05T00:40:27.686609+11:00"}
{"id":"az-6t6","title":"Manual worktree cleanup action (Space+d)","description":"Add Space+d action to manually delete a worktree and its branch.\n\n**Use cases:**\n- Abandoned work that won't be merged\n- Failed PRs that need cleanup\n- Manual housekeeping\n\n**Implementation:**\n- Add to ActionPalette with state check (only available when worktree exists)\n- Confirm dialog before deletion (destructive action)\n- WorktreeManager.remove() + git branch -D\n- Update task card to remove blue dot\n- Toast notification on success/failure\n\n**Depends on:** [deleted:az-yf4] (PRWorkflow) for the cleanup utility function","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T12:26:24.70141+11:00","updated_at":"2025-12-28T11:48:04.451447+11:00","dependencies":[{"issue_id":"az-6t6","depends_on_id":"az-yf4","type":"blocks","created_at":"2025-12-12T12:26:35.152751+11:00","created_by":"daemon"}]}
{"id":"az-711d","title":"if initCommands fail do we have some way to know about that?","description":"i think initCommands may be failing in Chefy project","design":"## Implementation Plan\n\n### Problem\nWhen `initCommands` fail during session startup (configured in `.azedarach.json`), there's no visibility:\n1. Logs go to Effect's internal logging (not visible in TUI)\n2. Session starts anyway (with `continueOnFailure: true` default)\n3. User doesn't know their environment setup may be broken\n\n### Solution\nAdd multi-layer visibility for initCommand failures:\n\n1. **DiagnosticsService Events** - Add event logging capability\n   - New `DiagnosticsEvent` type with timestamp, severity, source, message\n   - New `events: readonly DiagnosticsEvent[]` in `DiagnosticsState`\n   - New `logEvent(event)` method to record events\n   - Events visible in diagnostics overlay (Shift+D)\n\n2. **Session Warning State** - Distinguish \"started with issues\"\n   - Add `\"warning\"` to `SessionState` type in `types.ts`\n   - Update `SESSION_INDICATORS` with yellow/amber indicator for warning\n   - Session starts but visual indicator shows something is off\n\n3. **SessionManager Changes** - Capture and report failures\n   - Collect failed commands during init phase\n   - If any failures: call `DiagnosticsService.logEvent()` for each\n   - If any failures: set initial session state to \"warning\" instead of \"busy\"\n   - Return session with warning state (still starts successfully)\n\n4. **TUI Notification** - Brief flash notification\n   - Add a transient notification component to StatusBar\n   - Show \"‚ö† initCommands failed (Shift+D for details)\" briefly\n   - Auto-dismiss after 3-5 seconds\n\n### Files to Modify\n- `src/services/DiagnosticsService.ts` - Add event logging\n- `src/ui/types.ts` - Add \"warning\" state + indicator\n- `src/core/SessionManager.ts` - Capture failures, report to diagnostics, set warning state\n- `src/ui/StatusBar.tsx` - Add transient notification display\n\n### Why This Design\n- **Non-blocking**: Session still starts, user can continue\n- **Discoverable**: Yellow warning badge catches attention\n- **Debuggable**: Full details in diagnostics panel\n- **Transient notification**: Immediate feedback without modal interruption","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] When an initCommand fails, event is logged to DiagnosticsService\n- [ ] Failed initCommands appear in diagnostics overlay (Shift+D)\n- [ ] Session starts with \"warning\" state if any initCommand failed\n- [ ] TaskCard shows yellow/amber indicator for warning state\n- [ ] StatusBar shows brief notification on initCommand failure\n- [ ] Notification includes hint to check diagnostics (Shift+D)\n- [ ] Type-check passes with no errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:42:30.879303+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T12:53:59.501685+11:00","close_reason":"Implemented multi-layer visibility for initCommand failures: warning state indicator, toast notification, diagnostics event logging, and events section in diagnostics overlay.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-716y","title":"in epic drill down if a new bead is added to the epic i have to re-enter the epic drill down to see em","design":"## Problem\nWhen in epic drill-down mode, newly added epic children don't appear until re-entering drill-down. The drillDownChildIds and drillDownChildDetails SubscriptionRefs are populated ONCE at entry time (bindings.ts:268-294) and never updated.\n\n## Root Cause\n1. `drillDownChildIds` set once from `getEpicChildren()` at entry\n2. `drillDownChildDetails` fetched once for phase computation\n3. BoardService polling (5s) updates `board.tasks` with new children\n4. But drill-down filter still uses stale childIds set - filters out new tasks\n\n## Solution\nAdd a method `refreshDrillDown()` to NavigationService that:\n1. Re-fetches epic children from BeadsClient\n2. Updates drillDownChildIds with new children\n3. Fetches Issue details for new children only (incremental)\n4. Merges into drillDownChildDetails\n\nThen hook it into the BoardService refresh cycle:\n- After loadTasks() completes, check if in drill-down mode\n- If so, call nav.refreshDrillDown(currentEpicId)\n- This ensures drill-down state stays in sync with board state\n\n## Files to Modify\n1. `src/services/NavigationService.ts` - Add `refreshDrillDown(epicId)` method\n2. `src/services/BoardService.ts` - Call refreshDrillDown after loadTasks when in drill-down\n\n## Acceptance Criteria\n- [ ] New epic children appear in drill-down within 5 seconds (next poll)\n- [ ] Dependency phases recomputed for new children\n- [ ] No performance regression (incremental detail fetch)","acceptance_criteria":"- [x] New epic children appear in drill-down within 5 seconds (next poll)\n- [x] Dependency phases recomputed for new children\n- [x] No performance regression (incremental detail fetch)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T11:20:07.73304+11:00","updated_at":"2026-01-04T12:53:06.693835+11:00","closed_at":"2026-01-04T12:53:06.693843+11:00","close_reason":"Fixed: drill-down now auto-refreshes when board tasks change. New epic children appear within 5 seconds."}
{"id":"az-72fu","title":"prompt injection is a bit silly cause the first thing ai does anyways is always bd show","description":"replace injected prompt with just a simple prompt that tells em to bd show the bead id and maybe some reiteration of keeping the bead up to date (leave this part as it is i guess)","design":"I will simplify the prompt injection in SessionHandlersService.ts. \n1. Replace the large context generated by buildBeadContext with a simple instruction to run 'bd show \u003cid\u003e'.\n2. Retain the instructions about asking questions and updating the bead with design notes.\n3. Remove the buildBeadContext helper function as it will no longer be used.\n4. Update startSessionWithPrompt, startSessionDangerous, and chatAboutTask to use the new simplified prompts.\n5. Verify changes with type-check and build.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T14:54:28.432163+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-22T14:58:26.318044+11:00","close_reason":"Simplified prompt injection by replacing the large buildBeadContext-generated block with a simple 'bd show' instruction. This reduces token usage and encourages the AI to use its tools to explore the task context.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-74sw","title":"space c is causing tmux to detach and dump me out in non tmux terminal","description":"When pressing `space c` (Chat about task with Haiku), the app calls `tmux.switchClient()` which switches the tmux client to the new chat session. This takes the user OUT of the Azedarach TUI completely and into the chat session's terminal.\n\nThe user expects to remain in the TUI while the chat session runs in the background (similar to how `space s` starts a work session but doesn't immediately switch to it).","design":"## Root Cause Analysis\n\nThe issue is in `src/services/keyboard/SessionHandlersService.ts` lines 279 and 295:\n\n```typescript\n// Line 279 - when session already exists:\nyield* tmux.switchClient(chatSessionName)\n\n// Line 295 - after creating new session:\nEffect.tap(() =\u003e tmux.switchClient(chatSessionName))\n```\n\nThe `tmux switch-client` command switches the *current* tmux client to a different session, which moves the user away from the Azedarach TUI.\n\n## Comparison with `space a` (Attach)\n\nThe `space a` action (attachExternal) uses `switchClient()` intentionally - the user wants to attach to the session and interact with it. However `space c` (chat) should probably behave differently since it's about spawning a background chat, not immediately switching to it.\n\n## Design Decision\n\nTwo options for `space c` behavior:\n\n**Option A: Match attach behavior (current)**\n- Create chat session and switch to it\n- User can return via Ctrl-a Ctrl-a\n- Downside: Unexpected UX - user is immediately ripped out of TUI\n\n**Option B: Stay in TUI, show toast to attach**\n- Create chat session in background\n- Show toast: \"Chat session started for az-xyz - press Space+a to attach\"\n- User explicitly attaches when ready\n- More consistent with `space s` (start session) which doesn't auto-attach\n\n## Implementation Plan\n\nImplement Option B:\n\n1. Remove `switchClient()` calls from `chatAboutTask()` in `SessionHandlersService.ts`\n2. Update toast messages to guide user to attach manually\n3. Consider: Should `space c` check for existing chat session and offer to attach if one exists?\n\n## Files to Modify\n\n- `src/services/keyboard/SessionHandlersService.ts` - Remove switchClient calls from chatAboutTask()","acceptance_criteria":"- [ ] `space c` creates chat session without switching to it\n- [ ] Toast message guides user to attach with `space a` or similar\n- [ ] User remains in the Azedarach TUI after pressing `space c`\n- [ ] Chat session is properly created and accessible","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:56:26.424876+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:30.623063+11:00","close_reason":"Fixed: Removed `tmux.switchClient()` calls from `chatAboutTask()` so that pressing `space c` creates the chat session in the background without switching away from the Azedarach TUI. Toast messages now guide the user to press `Space+a` to attach when ready.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-76a","title":"session busy status even though claude has been waiting for me to press 1-3 for 2mins","notes":"**Root cause:** The `Stop` hook fires immediately when Claude finishes responding, but HookReceiver was ignoring it (returning `null` instead of transitioning to \"waiting\" state).\n\n**Primary fix (HookReceiver.ts):**\nChanged `mapEventToState(\"stop\")` from returning `null` to returning `\"waiting\"`.\n\nThe Stop hook was already correctly configured in WorktreeManager to call `az notify stop ${beadId}`, but the event was being discarded.\n\n**Secondary fix (StateDetector.ts):**\nAdded backup PTY patterns for AskUserQuestion tool output (numbered options, \"Other\" option). This provides defense-in-depth but the hook-based solution is more reliable.\n\n**Architecture note:**\n- Hook-based detection (Stop hook) is authoritative and immediate\n- PTY pattern matching is a fallback for edge cases\n- idle_prompt notification (60s timeout) is a last-resort safety net","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:17:07.106897+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T10:24:26.792564+11:00","close_reason":"Fixed: Stop hook now correctly transitions to 'waiting' state (HookReceiver.ts). Also added PTY pattern fallbacks (StateDetector.ts).","comments":[{"id":4,"issue_id":"az-76a","author":"riordan","text":"Initial fix was incomplete - the real issue was in HookReceiver, not just StateDetector patterns","created_at":"2025-12-17T23:24:06Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-786g","title":"fix responsiveness of details panel","description":"it should go a bit wider probs\nit should scroll with ctrl-u/d and up/down if content is too long","design":"## Implementation Plan (Revised)\n\nOpenTUI has a native `\u003cscrollbox\u003e` component! This is the idiomatic solution.\n\n### 1. Width Adjustment\n- Change `minWidth` from 70 to 80\n- Change `maxWidth` from 90 to 110 (or use percentage width)\n\n### 2. Use Native `\u003cscrollbox\u003e` Component\nThe `\u003cscrollbox\u003e` from `@opentui/react` provides:\n- Built-in vertical/horizontal scrolling\n- Native keyboard handling (`handleKeyPress`)\n- Optional scrollbar rendering\n- Viewport culling for performance\n\n**Props to use:**\n- `scrollY={true}` - enable vertical scrolling\n- `focused={true}` - when detail overlay is active\n- `maxHeight` - constrain to terminal height minus chrome\n\n### 3. Keyboard Integration\nThe scrollbox has built-in keyboard handling. When `focused={true}`:\n- Arrow keys scroll content\n- The component handles `Ctrl+u/d` via its `handleKeyPress` method\n\n**Potential approach:** Get a ref to the scrollbox and call `scrollBy()` from the InputHandlersService for custom scroll amounts.\n\n### 4. Service Changes\nIn `InputHandlersService.handleDetailOverlayInput`:\n- Add `C-u` / `C-d` handlers that emit scroll commands\n- Need to communicate scroll intent from service ‚Üí component\n\n**Options for service ‚Üí component communication:**\n1. **OverlayService state** - Add `scrollOffset` to overlay state\n2. **Dedicated ScrollService** - Track scroll position per overlay\n3. **Ref-based** - Store scrollbox ref, call methods directly (not Effect-friendly)\n\nGoing with option 1: Add scroll commands to OverlayService that the DetailPanel subscribes to.\n\n### Files to modify:\n- `src/ui/DetailPanel.tsx` - Wrap content in `\u003cscrollbox\u003e`, set maxHeight\n- `src/services/keyboard/InputHandlersService.ts` - Add scroll key handlers\n- `src/services/OverlayService.ts` - Add scroll intent/offset state (minimal)\n\n### Alternative: Component-local scroll with keyboard forwarding\nIf scrollbox's built-in `handleKeyPress` works well when `focused={true}`, we may not need service changes at all - just forward the key events to the component.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:27:58.11595+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T14:13:51.706767+11:00","close_reason":"Implemented scrollable detail panel with wider layout (80-110 chars) and Ctrl-u/d scrolling via OpenTUI scrollbox component","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-7oa","title":"Add test coverage for core services","description":"Currently only FileLockManager.test.ts exists. Add tests for:\n\n**High priority (business-critical):**\n- SessionManager - lifecycle, state transitions\n- BeadsClient - CLI parsing, error handling\n- CommandQueueService - serialization, race conditions\n- StateDetector - pattern matching accuracy\n\n**Medium priority:**\n- BoardService - filtering, sorting\n- NavigationService - cursor movement, boundary handling\n- WorktreeManager - git operations\n\nUse Effect's testing utilities and TestClock for time-based tests.","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:45.163878+11:00","updated_at":"2025-12-17T15:59:45.163878+11:00"}
{"id":"az-7rj","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.\n\n## Requirements\n- User provides a description of the task/feature they want to create\n- Claude interprets the prompt and creates the appropriate bead (title, type, description, etc.)\n- The tmux session used for bead creation should persist after creation\n- This allows the user to immediately start working on the newly created bead in the same session\n\n## Use Case\nInstead of manually running `bd create`, user can describe what they need in natural language from within azedarach's TUI, and Claude handles the bead creation. The persistent session means they can seamlessly transition from \"create this task\" to \"now work on it\".","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:27:20.092741+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T02:45:45.653563+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-7she","title":"when i remove an image it should be also removed from notes","design":"## Problem\nWhen images are attached to an issue, a markdown link like `üìé [filename.png](.beads/images/az-xxx/filename.png)` is automatically added to the issue's notes field (via `linkAttachmentInNotes`). However, when the image is removed via `removeSelectedAttachment()` or `remove()`, the markdown link is NOT removed, leaving broken references in notes.\n\n## Solution\nAdd an `unlinkAttachmentFromNotes` helper function that:\n1. Reads the current issue notes\n2. Removes lines matching the pattern `üìé [filename](...)` for the removed attachment\n3. Updates the issue notes via BeadsClient\n\nCall this function from both `removeSelectedAttachment()` and `remove()` methods.\n\n## Implementation Plan\n1. Add `unlinkAttachmentFromNotes(issueId, attachment)` function near `linkAttachmentInNotes`\n2. Pattern to match: Lines starting with `üìé [${attachment.filename}]`\n3. Call from `removeSelectedAttachment()` after removing the file\n4. Call from `remove()` after removing the file\n\n## Files to Modify\n- `src/core/ImageAttachmentService.ts` - Add helper and integrate into removal methods","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T02:09:49.472426+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:31:32.138193+11:00","close_reason":"Implemented unlinkAttachmentFromNotes helper that removes the üìé [filename](...) line from notes when an image is deleted. Called from both removeSelectedAttachment() and remove() methods.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-7sr","title":"Add orchestration mode ('o' from epic detail) to TUI","description":"New editor mode for orchestrating parallel workers on an epic.\n\n**Entry flow:**\n1. `Enter` on epic ‚Üí DetailPanel shows epic info + children\n2. `o` in detail overlay ‚Üí enters orchestration mode\n\n**Mode behavior:**\n- Display children as selectable list\n- Space toggles task selection (spawnable tasks only)\n- Enter confirms and triggers spawn\n- Esc returns to detail panel\n\n**Prerequisites:**\n- Epic drill-down: DetailPanel must show children when viewing an epic\n\n**UI:** Overlay-style task selector with selection count and keybinding hints.","design":"## Orchestration Mode Design (Revised)\n\n### Overview\n\nOrchestration mode is entered **from within the detail panel** when viewing an epic. This integrates naturally with the epic drill-down flow: user views epic ‚Üí sees children ‚Üí decides to spawn parallel workers.\n\n### Prerequisites\n\n**Epic drill-down in DetailPanel** must show:\n- List of child tasks (from `bd show \u003cepic-id\u003e` ‚Üí `dependents` where `dependency_type: \"parent-child\"`)\n- Child status indicators (open/in_progress/blocked/closed)\n- Session indicators for children with active sessions\n- Hint: \"Press 'o' to orchestrate\" when viewing an epic\n\n### Entry Flow\n\n```\nEnter on epic ‚Üí DetailPanel with children list\n         ‚Üì\n  Press 'o' in detail overlay\n         ‚Üì\nOrchestration overlay (replaces detail)\n         ‚Üì\nSelect tasks ‚Üí Enter ‚Üí Spawn workers\n```\n\n1. User presses `Enter` on epic task ‚Üí opens detail overlay\n2. DetailPanel shows epic info + children list\n3. User presses `o` ‚Üí `enterOrchestrate()` is triggered\n4. Validates current detail task is an epic (should always be true given UX)\n5. Loads children with session state merged\n6. Pushes orchestration overlay (or transitions detail panel mode)\n7. User selects tasks ‚Üí `Enter` confirms and triggers spawn\n\n### Mode Definition\n\nAdd new variant to `EditorMode` union in `EditorService.ts`:\n\n```typescript\n| {\n    readonly _tag: \"orchestrate\"\n    readonly epicId: string                      // The epic being orchestrated\n    readonly epicTitle: string                   // For display\n    readonly childTasks: ReadonlyArray\u003cOrchestrationTask\u003e  // Children loaded from bd\n    readonly selectedIds: ReadonlyArray\u003cstring\u003e  // Tasks selected for spawning\n    readonly focusIndex: number                  // Currently focused task in list\n  }\n\ninterface OrchestrationTask {\n  id: string\n  title: string\n  status: \"open\" | \"in_progress\" | \"blocked\" | \"closed\"\n  hasSession: boolean  // Already has active session\n}\n```\n\n### Keybindings\n\n**In detail overlay (viewing epic):**\n| Key | Action | Description |\n|-----|--------|-------------|\n| o | enterOrchestrate | Enter orchestration mode (epic only) |\n\n**In orchestrate mode:**\n| Key | Action | Description |\n|-----|--------|-------------|\n| j/‚Üì | moveDown | Move focus down in task list |\n| k/‚Üë | moveUp | Move focus up in task list |\n| Space | toggleTask | Toggle task selection (if spawnable) |\n| Enter | confirmSpawn | Confirm and trigger spawn for selected |\n| a | selectAll | Select all spawnable (open, no session) |\n| n | selectNone | Clear all selections |\n| Escape | cancel | Return to epic detail (or close overlay) |\n\n### Spawn Eligibility\n\nTasks are spawnable if:\n- `status` is `\"open\"` (not in_progress, blocked, or closed)\n- `hasSession` is `false` (no active Claude session)\n\nNon-spawnable tasks shown grayed out, cannot be selected.\n\n### UI Design\n\n**Option A: Orchestration as separate overlay**\n```\n‚îå‚îÄ Orchestrate: Epic Title ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                            ‚îÇ\n‚îÇ  [x] az-abc  Implement feature X     OPEN  ‚îÇ\n‚îÇ  [ ] az-def  Write tests for X       OPEN  ‚îÇ\n‚îÇ  --- az-ghi  Fix bug Y          IN_PROGRESS‚îÇ\n‚îÇ  --- az-jkl  Refactor Z            BLOCKED ‚îÇ\n‚îÇ                                            ‚îÇ\n‚îÇ  Selected: 1/2 spawnable                   ‚îÇ\n‚îÇ                                            ‚îÇ\n‚îÇ  Enter: Spawn  Space: Toggle  Esc: Back    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**Option B: Enhanced detail panel with mode switch**\nThe DetailPanel itself gains an \"orchestrate mode\" where children become selectable.\n- Simpler implementation (no new overlay)\n- Context preserved (epic info still visible)\n\n**Recommendation:** Option A (separate overlay) for cleaner separation of concerns.\n\n### DetailPanel Enhancement (Prerequisite)\n\nWhen viewing an epic, DetailPanel should show:\n\n```tsx\n{/* Children section - only for epics */}\n{task.issue_type === \"epic\" \u0026\u0026 children.length \u003e 0 \u0026\u0026 (\n  \u003cbox flexDirection=\"column\"\u003e\n    \u003ctext fg={theme.blue} attributes={ATTR_BOLD}\u003e\n      {`Children (${children.length}):`}\n    \u003c/text\u003e\n    {children.map((child) =\u003e (\n      \u003ctext key={child.id} fg={getChildColor(child)}\u003e\n        {`  ${child.id}  ${child.title}  [${child.status}]`}\n      \u003c/text\u003e\n    ))}\n    \u003ctext fg={theme.subtext0}\u003e\n      {\"Press 'o' to orchestrate parallel workers\"}\n    \u003c/text\u003e\n  \u003c/box\u003e\n)}\n```\n\n### BeadsClient Extension\n\nUpdate `IssueSchema` to include dependency fields:\n\n```typescript\nconst DependencyRefSchema = Schema.Struct({\n  id: Schema.String,\n  title: Schema.String,\n  status: Schema.Literal(\"open\", \"in_progress\", \"blocked\", \"closed\", \"tombstone\"),\n  dependency_type: Schema.Literal(\"blocks\", \"related\", \"parent-child\", \"discovered-from\"),\n  issue_type: Schema.Literal(\"bug\", \"feature\", \"task\", \"epic\", \"chore\").pipe(Schema.optional),\n})\n\nconst IssueSchema = Schema.Struct({\n  // ... existing fields\n  dependent_count: Schema.Number.pipe(Schema.optional),\n  dependency_count: Schema.Number.pipe(Schema.optional),\n  dependents: Schema.Array(DependencyRefSchema).pipe(Schema.optional),\n  dependencies: Schema.Array(DependencyRefSchema).pipe(Schema.optional),\n})\n```\n\nAdd method:\n```typescript\ngetEpicWithChildren: (epicId: string, cwd?: string) =\u003e\n  Effect.Effect\u003c{ epic: Issue; children: ReadonlyArray\u003cDependencyRef\u003e }, BeadsError | ParseError | NotFoundError\u003e\n```\n\n### Service Methods\n\nIn `EditorService`:\n```typescript\nenterOrchestrate: (epicId: string, epicTitle: string, children: ReadonlyArray\u003cOrchestrationTask\u003e) =\u003e\n  SubscriptionRef.set(mode, Data.struct({\n    _tag: \"orchestrate\",\n    epicId,\n    epicTitle,\n    childTasks: children,\n    selectedIds: [],\n    focusIndex: 0,\n  }))\n\norchestrateMoveDown: () =\u003e SubscriptionRef.update(mode, ...)\norchestrateMoveUp: () =\u003e SubscriptionRef.update(mode, ...)\norchestrateToggle: (taskId: string) =\u003e SubscriptionRef.update(mode, ...)\norchestrateSelectAll: () =\u003e SubscriptionRef.update(mode, ...)\norchestrateSelectNone: () =\u003e SubscriptionRef.update(mode, ...)\nexitOrchestrate: () =\u003e SubscriptionRef.set(mode, normalMode)\n```\n\n### Handler Service\n\nNew `OrchestrateHandlersService`:\n```typescript\nexport class OrchestrateHandlersService extends Effect.Service\u003c...\u003e()(..., {\n  dependencies: [EditorService, BeadsClient, BoardService, SessionService, ToastService, OverlayService],\n  effect: Effect.gen(function* () {\n    return {\n      enterFromDetail: () =\u003e Effect.gen(function* () {\n        // Get current detail overlay's task\n        const overlay = yield* overlayService.current()\n        if (overlay?._tag !== \"detail\") return\n        \n        const task = yield* boardService.getTaskById(overlay.taskId)\n        if (!task || task.issue_type !== \"epic\") {\n          yield* toast.show(\"Not an epic\", \"error\")\n          return\n        }\n        \n        const { children } = yield* beadsClient.getEpicWithChildren(task.id)\n        const withSessions = yield* mergeSessionState(children)\n        yield* editor.enterOrchestrate(task.id, task.title, withSessions)\n        // Optionally close detail overlay or keep it in background\n      }),\n      \n      confirmSpawn: () =\u003e Effect.gen(function* () {\n        const mode = yield* editor.getMode()\n        if (mode._tag !== \"orchestrate\") return\n        \n        if (mode.selectedIds.length === 0) {\n          yield* toast.show(\"No tasks selected\", \"warning\")\n          return\n        }\n        \n        const toSpawn = mode.selectedIds\n        yield* editor.exitOrchestrate()\n        yield* overlayService.clear() // Close all overlays\n        \n        // Emit spawn event (handled by az-bjp)\n        yield* toast.show(`Spawning ${toSpawn.length} sessions...`, \"info\")\n      }),\n    }\n  }),\n})\n```\n\n### StatusBar Integration\n\nWhen in orchestrate mode:\n```typescript\nMODE_KEYBINDINGS.orchestrate = [\n  { key: \"Space\", action: \"Toggle\" },\n  { key: \"Enter\", action: \"Spawn\" },\n  { key: \"a\", action: \"All\" },\n  { key: \"n\", action: \"None\" },\n  { key: \"Esc\", action: \"Back\" },\n]\n```\n\nMode display: `\"orchestrate (1/2)\"`\n\n### File Changes Required\n\n1. `src/services/EditorService.ts` - Add orchestrate mode + methods\n2. `src/core/BeadsClient.ts` - Extend schema, add getEpicWithChildren\n3. `src/services/keyboard/OrchestrateHandlersService.ts` - **NEW**\n4. `src/services/keyboard/bindings.ts` - Add `o` in detail overlay, orchestrate mode keybindings\n5. `src/services/keyboard/types.ts` - Add \"orchestrate\" to KeyMode\n6. `src/ui/StatusBar.tsx` - Add orchestrate keybinding hints\n7. `src/ui/OrchestrationOverlay.tsx` - **NEW** overlay component\n8. `src/ui/DetailPanel.tsx` - Add children section for epics\n9. `src/ui/App.tsx` - Render orchestration overlay\n10. `src/ui/atoms/mode.ts` - Add orchestrate-related atoms\n11. `src/services/OverlayService.ts` - Potentially add orchestrate overlay type (if using overlay stack)","acceptance_criteria":"## Acceptance Criteria\n\n### Prerequisites (Epic Drill-Down)\n- [ ] DetailPanel shows children list when viewing an epic\n- [ ] Children show: id, title, status\n- [ ] Children show session indicator if they have active session\n- [ ] \"Press 'o' to orchestrate\" hint visible for epics\n\n### Entry\n- [ ] `o` in detail overlay on epic enters orchestration mode\n- [ ] `o` in detail overlay on non-epic shows error toast \"Not an epic\"\n- [ ] Orchestration mode loads child tasks with session state merged\n- [ ] Child tasks display with correct status (open/in_progress/blocked/closed)\n- [ ] Tasks with active sessions marked as non-spawnable\n\n### Navigation\n- [ ] j/k moves focus through task list\n- [ ] Focus wraps at boundaries (or stops - TBD)\n- [ ] Focused task visually highlighted\n\n### Selection\n- [ ] Space toggles selection on spawnable tasks\n- [ ] Space on non-spawnable task does nothing (no error)\n- [ ] 'a' selects all spawnable tasks\n- [ ] 'n' clears all selections\n- [ ] Selection count shown in UI (\"Selected: X/Y spawnable\")\n\n### Confirmation\n- [ ] Enter with selections exits mode and emits spawn event\n- [ ] Enter with no selections shows toast \"No tasks selected\"\n- [ ] Escape returns to epic detail panel (or closes all overlays)\n\n### UI\n- [ ] Orchestration overlay displays epic title in header\n- [ ] Tasks show: selection state, ID, title, status\n- [ ] Non-spawnable tasks visually distinct (grayed/dimmed)\n- [ ] StatusBar shows orchestrate-specific keybindings\n- [ ] Mode display shows \"orchestrate (X/Y)\"\n\n### Integration\n- [ ] BeadsClient.getEpicWithChildren works correctly\n- [ ] Session state merged to determine spawnable tasks\n- [ ] Spawn event emitted for downstream handling (az-bjp)\n- [ ] No regressions to existing modes or detail panel","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:29:14.653445+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T11:31:29.234847+11:00","dependencies":[{"issue_id":"az-7sr","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.732517+11:00","created_by":"daemon"}],"comments":[{"id":12,"issue_id":"az-7sr","author":"riordan","text":"Adding az-bjp and az-lqb implementation","created_at":"2025-12-18T23:54:01Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"az-7tzh","title":"lustre_tui: Reconciler - convert Lustre Elements to Renderables","description":"Convert Lustre Element trees to tui_core Renderable trees.\n\n## Why Separate\nThe reconciler is the bridge between declarative Lustre views and the imperative rendering system. Element types are in az-uwcd, runtime is in az-d19m.\n\n## Core Function\n```gleam\n/// Convert a Lustre Element tree to a Renderable tree\nfn element_to_renderable(el: Element(msg)) -\u003e Renderable\n\n/// Internal: Convert attributes to styles\nfn attrs_to_box_style(attrs: List(Attribute(msg))) -\u003e BoxStyle\nfn attrs_to_text_style(attrs: List(Attribute(msg))) -\u003e TextStyle\n\n/// Extract event handlers from element tree (for input dispatch)\nfn collect_handlers(el: Element(msg)) -\u003e List(#(Selector, fn(Key) -\u003e Option(msg)))\n```\n\n## Implementation Notes\n- Pattern match on Element variant (Box, Text, Span)\n- Extract style attributes, build corresponding style types\n- Recursively process children\n- Track event handlers for input dispatch\n\n## Example Flow\n```\nview(model) ‚Üí Element(msg) tree\n    ‚Üì element_to_renderable\nRenderable tree\n    ‚Üì layout (az-se6w)\nLayoutNode tree (with positions)\n    ‚Üì render_tree\nFrameBuffer\n    ‚Üì renderer (az-5xza)\nTerminal output\n```\n\n## Acceptance Criteria\n- [ ] Box elements convert to Box renderables\n- [ ] Text/Span elements convert correctly\n- [ ] All style attributes map correctly\n- [ ] Nested elements handle correctly\n- [ ] Event handlers extracted for dispatch","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:26:08.268961+11:00","updated_at":"2025-12-28T11:32:54.539651+11:00","labels":["gleam","lustre-tui"],"dependencies":[{"issue_id":"az-7tzh","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.871442+11:00","created_by":"daemon"},{"issue_id":"az-7tzh","depends_on_id":"az-ud48","type":"blocks","created_at":"2025-12-28T11:26:28.831699+11:00","created_by":"daemon"},{"issue_id":"az-7tzh","depends_on_id":"az-5xza","type":"blocks","created_at":"2025-12-28T11:26:28.901966+11:00","created_by":"daemon"},{"issue_id":"az-7tzh","depends_on_id":"az-uwcd","type":"blocks","created_at":"2025-12-28T11:34:13.268266+11:00","created_by":"daemon"}]}
{"id":"az-7vk","title":"Auto-wrap in tmux on startup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:16:24.296316+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T17:16:32.587438+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-7y5","title":"if i /clear in the bead's space S claude session the tmux session seems to be lost in az","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:32:07.377782+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:24:45.510132+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-7y9","title":"worktree created but not found","description":"we may be looking in the wrong spot for worktrees sometimes. i looked in finder and the worktree existed so not sure how we failed to find it. also make sure that errors that we should via toast are also logged via Effect.logError","notes":"Fixed both issues: (1) Added Effect.logError to all toast error handlers in KeyboardService, (2) Updated WorktreeManager to use branch name as beadId (more reliable than path parsing), added path normalization to avoid symlink/trailing slash issues, added diagnostic logging when worktree not found in cache, made the fallback regex case-insensitive to support any prefix (e.g., Chefy-xxx). Also added MCP tool permissions to project settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:32:16.690535+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T15:32:17.764918+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-8axr","title":"test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T15:30:40.337109+11:00","updated_at":"2025-12-18T15:30:50.278932+11:00","deleted_at":"2025-12-18T15:30:50.278932+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-8ep","title":"Beads sync coordination for worktrees","description":"Coordinate beads sync across main repo and worktrees.","design":"- Define BeadsSyncCoordinator as Effect.Service\n- Depends on: BeadsClient, WorktreeManager, SessionManager\n- Sync strategy:\n  1. Before task start: sync (pull latest)\n  2. Periodic sync during work (configurable interval via Schedule)\n  3. On task completion: sync (push final state)\n- Methods:\n  - syncAll(): Effect\u003cSyncResult[], BeadsError\u003e\n  - syncWorktree(path): Effect\u003cSyncResult, BeadsError\u003e\n  - startPeriodicSync(interval): Effect\u003cFiber.RuntimeFiber\u003cvoid\u003e, never\u003e\n- Use Effect.retry with exponential backoff for conflicts\n- Handle sync conflicts gracefully with Effect.catchTag\n- 's' keybinding triggers syncAll()\n- Show sync status in StatusBar via Ref\u003cSyncStatus\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.819887+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T12:17:55.89465+11:00","dependencies":[{"issue_id":"az-8ep","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.882335+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-8f4j","title":"board refresh failed","description":"timestamp=2025-12-22T00:37:24.824Z level=ERROR fiber=#561 message=\"BoardService refresh failed\" message=\"ParseError: Schema validation failed: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly description?: string | undefined; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly priority: number; readonly issue_type: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\"; readonly created_at: string; readonly updated_at: string; readonly closed_at?: string | null | undefined; readonly assignee?: string | null | undefined; readonly labels?: ReadonlyArray\u003cstring\u003e | undefined; readonly design?: string | undefined; readonly notes?: string | undefined; readonly acceptance?: string | undefined; readonly estimate?: number | undefined; readonly dependent_count?: number | undefined; readonly dependency_count?: number | undefined; readonly dependents?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined; readonly dependencies?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined }\u003e\\n‚îî‚îÄ [0]\\n   ‚îî‚îÄ { readonly id: string; readonly title: string; readonly description?: string | undefined; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly priority: number; readonly issue_type: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\"; readonly created_at: string; readonly updated_at: string; readonly closed_at?: string | null | undefined; readonly assignee?: string | null | undefined; readonly labels?: ReadonlyArray\u003cstring\u003e | undefined; readonly design?: string | undefined; readonly notes?: string | undefined; readonly acceptance?: string | undefined; readonly estimate?: number | undefined; readonly dependent_count?: number | undefined; readonly dependency_count?: number | undefined; readonly dependents?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined; readonly dependencies?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined }\\n      ‚îî‚îÄ [\\\"priority\\\"]\\n         ‚îî‚îÄ is missing\\n‚îî‚îÄ [0]\\n   ‚îî‚îÄ { readonly id: string; readonly title: string; readonly description?: string | undefined; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly priority: number; readonly issue_type: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\"; readonly created_at: string; readonly updated_at: string; readonly closed_at?: string | null | undefined; readonly assignee?: string | null | undefined; readonly labels?: ReadonlyArray\u003cstring\u003e | undefined; readonly design?: string | undefined; readonly notes?: string | undefined; readonly acceptance?: string | undefined; readonly estimate?: number | undefined; readonly dependent_count?: number | undefined; readonly dependency_count?: number | undefined; readonly dependents?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined; readonly dependencies?: ReadonlyArray\u003c{ readonly id: string; readonly title: string; readonly status: \\\"open\\\" | \\\"in_progress\\\" | \\\"blocked\\\" | \\\"closed\\\" | \\\"tombstone\\\"; readonly dependency_type: \\\"blocks\\\" | \\\"related\\\" | \\\"parent-child\\\" | \\\"discovered-from\\\"; readonly issue_type?: \\\"bug\\\" | \\\"feature\\\" | \\\"task\\\" | \\\"epic\\\" | \\\"chore\\\" | undefined }\u003e | undefined }\\n      ‚îî‚îÄ [\\\"priority\\\"]\\n         ‚îî‚îÄ is missing\\n    at \u003canonymous\u003e (/Users/riordan/prog/azedarach/src/core/BeadsClient.ts:424:11)\"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T11:38:31.466993+11:00","updated_at":"2025-12-22T11:38:31.466993+11:00"}
{"id":"az-8ivo","title":"Add orchestrate mode atoms","description":"In src/ui/atoms/mode.ts, add:\n\n1. `isOrchestrateAtom` - derived boolean for mode check\n2. `orchestrateStateAtom` - full orchestrate mode state (or null)\n3. `orchestrateSelectedIdsAtom` - selected task IDs\n4. `orchestrateFocusIndexAtom` - current focus index\n5. `orchestrateSpawnableCountAtom` - count of spawnable tasks\n6. Action atoms for EditorService methods:\n   - `orchestrateMoveDownAtom`\n   - `orchestrateMoveUpAtom`\n   - `orchestrateToggleAtom`\n   - `orchestrateSelectAllAtom`\n   - `orchestrateSelectNoneAtom`\n   - `exitOrchestrateAtom`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:06.245377+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:32.339402+11:00","close_reason":"Added 12 orchestrate mode atoms: isOrchestrate, orchestrateState, orchestrateSelectedIds, orchestrateFocusIndex, orchestrateSpawnableCount, and 7 action atoms for navigation and selection","dependencies":[{"issue_id":"az-8ivo","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:26.55225+11:00","created_by":"daemon"},{"issue_id":"az-8ivo","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:50.728533+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-8mp","title":"Fix TUI height in tmux and improve session scrolling","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T00:37:17.384839+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T00:37:34.04098+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-8wyv","title":"diff view not great","description":"its not got code highlighting, +/-, etc...","design":"...","notes":"## Root Cause\nThe diff view was using `git diff --color=always` but difftastic (configured as `diff.external` in user's gitconfig) uses its own `DFT_COLOR` environment variable, not git's `--color` flag.\n\n## Solution\nAdded `DFT_COLOR=always` to the git diff command in `PRHandlersService.ts:showDiff()`.\n\nThe fix respects user's git configuration:\n- If user has difftastic as `diff.external` ‚Üí DFT_COLOR enables syntax highlighting\n- If user has delta or default git diff ‚Üí `--color=always` still works\n\n## Changes\n- `src/services/keyboard/PRHandlersService.ts`: Added `DFT_COLOR=always` environment variable to the diff command\n\n## Configuration Note\nUser's difftastic is properly configured in `~/nix/home.nix`:\n```nix\nprograms.git.difftastic = {\n  enable = true;\n  enableAsDifftool = true;\n  background = \"dark\";\n};\n```\nThis generates `diff.external = \"difft --background dark\"` in gitconfig.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T00:42:38.725574+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:30.876106+11:00","close_reason":"Fixed: Added DFT_COLOR=always to diff command for difftastic syntax highlighting support","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-8z1i","title":"add ability to preview images in tui","notes":"Research completed:\n- OpenTUI has no built-in image component (text/cell-based FrameBuffer)\n- Terminal capability detection exists for kitty_graphics and sixel\n- terminal-image npm package offers Kitty/iTerm2/Sixel + ANSI fallback\n- Will use terminal-image for cross-terminal support","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:49:35.350993+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T14:42:07.981166+11:00","close_reason":"Implemented image preview feature with terminal-image library. Added imagePreview overlay, keyboard handling (v to preview, j/k to navigate, o to open externally), and documentation.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-8zkp","title":"lustre_tui: Demo app - validate framework before Azedarach port","description":"Build a simple demo app to validate LustreTUI works before porting the full Azedarach.\n\n## Why\nCatch issues early with a minimal test case rather than debugging in a complex app.\n\n## Demo Features\n```gleam\n// Simple counter with styled UI\ntype Model { Model(count: Int) }\ntype Msg { Increment | Decrement | Quit }\n\nfn view(model: Model) -\u003e Element(Msg) {\n  box([flex_direction(Column), padding(1), border(Rounded)], [\n    text([fg(\"#cad3f5\")], \"LustreTUI Demo\"),\n    box([flex_direction(Row), gap(2)], [\n      button([on_click(Decrement)], \"-\"),\n      text([fg(\"#8aadf4\"), bold()], int.to_string(model.count)),\n      button([on_click(Increment)], \"+\"),\n    ]),\n    text([fg(\"#6e738d\")], \"Press q to quit\"),\n  ])\n}\n```\n\n## Validation Checklist\n- [ ] Basic layout (Row, Column) works\n- [ ] Nested boxes render correctly\n- [ ] Hex colors display properly\n- [ ] Border styles work\n- [ ] Keyboard input dispatches messages\n- [ ] Screen clears and redraws without flicker\n- [ ] Alt screen buffer works (clean exit)\n\n## Acceptance Criteria\n- [ ] Demo compiles and runs\n- [ ] All validation checklist items pass\n- [ ] No visual glitches or artifacts\n- [ ] Clean exit (terminal restored)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T11:31:22.714961+11:00","updated_at":"2025-12-28T11:31:22.714961+11:00","labels":["demo","gleam","lustre-tui"],"dependencies":[{"issue_id":"az-8zkp","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.559459+11:00","created_by":"daemon"},{"issue_id":"az-8zkp","depends_on_id":"az-d19m","type":"blocks","created_at":"2025-12-28T11:34:13.559695+11:00","created_by":"daemon"}]}
{"id":"az-92fj","title":"never show epic children on main board, only in drill down","design":"## Problem\nEpic children are appearing on the main board when they shouldn't. Additionally, the toggle to show/hide them should be removed entirely - epic children should ONLY be visible in drill-down view.\n\n## Root Cause Analysis\nThe `hideEpicSubtasks` filter exists and defaults to `true`, but either:\n- A bug prevents it from working correctly, OR  \n- Persisted state with `hideEpicSubtasks: false` overrides the default\n\n## Implementation Plan\n\n### 1. Remove hideEpicSubtasks from FilterConfig\n- Remove field from `FilterConfig` interface in `EditorService.ts`\n- Remove from `DEFAULT_FILTER_CONFIG`\n- Remove `toggleHideEpicSubtasks()` method\n\n### 2. Update BoardService filtering\n- Change `applyFilterConfig()` to ALWAYS filter out epic children (no conditional)\n- Remove dependency on `config.hideEpicSubtasks`\n\n### 3. Remove UI toggle from FilterMenu\n- Remove the 'e' keybinding option from `FilterMenu.tsx`\n\n### 4. Update ProjectStateService schema\n- Remove `hideEpicSubtasks` from persisted state schema\n- Handle migration for existing state files (ignore the field if present)\n\n### 5. Update keyboard bindings\n- Remove 'e' handler from filter mode if it exists\n\n## Files to modify\n- `src/services/EditorService.ts` - FilterConfig interface and default\n- `src/services/BoardService.ts` - applyFilterConfig function\n- `src/ui/FilterMenu.tsx` - Remove UI toggle\n- `src/services/ProjectStateService.ts` - Schema changes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T13:16:50.664758+11:00","updated_at":"2025-12-30T13:55:20.103521+11:00","closed_at":"2025-12-30T13:55:20.103521+11:00","close_reason":"Implemented: Epic children are now always hidden on main board, only visible in drill-down view. Removed the toggle option entirely."}
{"id":"az-9870","title":"Add orchestrate mode to EditorService","description":"Add new mode variant to EditorMode union:\n\n```typescript\n| {\n    readonly _tag: \"orchestrate\"\n    readonly epicId: string\n    readonly epicTitle: string\n    readonly childTasks: ReadonlyArray\u003cOrchestrationTask\u003e\n    readonly selectedIds: ReadonlyArray\u003cstring\u003e\n    readonly focusIndex: number\n  }\n```\n\nAdd OrchestrationTask interface and service methods:\n- enterOrchestrate(epicId, epicTitle, children)\n- orchestrateMoveDown()\n- orchestrateMoveUp()\n- orchestrateToggle(taskId)\n- orchestrateSelectAll()\n- orchestrateSelectNone()\n- exitOrchestrate()\n\nAlso update getMode() to handle the new variant.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:03.493537+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:31.591108+11:00","close_reason":"Added orchestrate mode variant to EditorMode, 7 service methods (enterOrchestrate, orchestrateMoveDown/Up, orchestrateToggle, orchestrateSelectAll/None, exitOrchestrate), plus KeyMode and StatusBar updates","dependencies":[{"issue_id":"az-9870","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:23.354103+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-9an","title":"gg command should take me to top of current column not top of open column always","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:50.236333+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T01:01:29.643058+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-9b8","title":"Epic progress indicator in TaskCard","description":"Show progress bar for epic tasks: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5\n\n**Implementation:**\n- Query child task statuses\n- Calculate completed/total\n- Render as Unicode progress bar\n- Only show for issue_type=epic\n\n**Space cost:** One line, replaces description line for epics","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.040003+11:00","updated_at":"2025-12-12T13:29:15.040003+11:00","dependencies":[{"issue_id":"az-9b8","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.835556+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-9bua","title":"when az restarts we lose track of claude session status","notes":"Implemented session persistence to .azedarach/sessions.json:\n\nChanges made:\n1. SessionManager.ts: Added Schema-based persistence with Schema.HashMap + Schema.DateTimeUtc\n2. Updated Session.startedAt from Date to DateTime.Utc\n3. Added loadPersistedSessions() and persistSessions() helpers (with BunContext layer)\n4. Enhanced listActive() to recover state from persisted file\n5. Added persist calls to start(), stop(), pause(), resume(), updateState()\n6. BoardService.ts: Updated toISOString() to DateTime.formatIso()\n7. .gitignore: Added .azedarach/\n\nType-check passes. Ready for testing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:53:43.340812+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T15:41:04.467694+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-9ch","title":"Worktree init hooks (direnv, env vars, custom commands)","description":"Allow configuring commands to run when a worktree is created or session is started. Common use cases: direnv allow, setting env vars, installing deps, etc.","design":"Config structure (in future az config file):\n```yaml\nworktree:\n  init:\n    - direnv allow\n    - pnpm install\n  env:\n    CLAUDE_MODEL: opus\n    DEBUG: true\n```\n\nImplementation options:\n1. Run init commands after worktree creation in WorktreeManager\n2. Run init commands in the tmux session before claude starts\n3. Both (worktree-level vs session-level hooks)\n\nOption 2 is simpler - modify the session command:\n```\n$SHELL -c 'direnv allow \u0026\u0026 claude; exec $SHELL'\n```\n\nFor env vars, use tmux set-environment or export in the shell command.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:13:03.534484+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T17:24:21.906802+11:00","dependencies":[{"issue_id":"az-9ch","depends_on_id":"az-pnx","type":"blocks","created_at":"2025-12-12T12:13:09.239776+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-9co","title":"bd sync needs atomic operations to prevent race conditions","notes":"## Problem\n\nMultiple bd processes (daemon, beads-mcp servers, manual bd sync) can race to update the beads-sync branch, causing data loss.\n\n## Race Scenario\n\n1. Process A reads JSONL with [issue-1, issue-2]\n2. Process B creates issue-3, exports to JSONL\n3. Process A commits its JSONL to beads-sync (missing issue-3!)\n4. Process B runs bd sync, pulls from beads-sync\n5. Process B tombstones issue-3 (sees it as \"deleted\")\n\n## Root Cause\n\n- bd sync is not atomic\n- No locking between concurrent bd processes\n- beads-sync branch can be overwritten by stale data\n\n## Proposed Fix (upstream)\n\nOption 1: Git ref transactions\n- Use git's atomic ref updates\n- bd sync should fail if beads-sync moved since last read\n\nOption 2: File-based locking\n- Acquire lock before any sync operation\n- Release after commit+push complete\n\nOption 3: CRDT-based merge\n- Instead of overwrite, use conflict-free merge\n- Tombstones require consensus, not just \"missing from one branch\"\n\n## Workaround (Azedarach)\n\n- Use FileLockManager around bd sync calls\n- Prevents races within our own operations\n- Does NOT fix races with external bd processes\n\n## Related\n\n- az-zby: bd sync incorrectly tombstones issues","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T12:55:05.604475+11:00","updated_at":"2025-12-18T12:55:05.879012+11:00","labels":["beads-upstream"]}
{"id":"az-9e4q","title":"Extend Beads client with convoy management commands","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T00:40:37.46033+11:00","updated_at":"2026-01-05T00:40:37.46033+11:00"}
{"id":"az-9fhx","title":"use lazygit for space f diffing","design":"## Implementation Plan\n\nReplace the `showDiff()` method in PRHandlersService to use lazygit instead of `git diff | less`.\n\n### Changes\n1. **File**: `src/services/keyboard/PRHandlersService.ts`\n   - Modify `showDiff()` method (lines 438-476)\n   - Replace the git diff command with `lazygit status`\n   - Use `-p` flag to set worktree path\n   - Use `status` positional arg to open directly on files/diff panel\n\n### New Command\n```bash\nlazygit -p \"${worktreePath}\" status\n```\n\nThis opens lazygit:\n- In the worktree directory (`-p` flag)\n- Focused on the status/files panel (`status` arg) where diffs are visible\n- User can navigate files with j/k, view diffs with enter, stage with space\n\n### Benefits\n- Interactive file navigation\n- Can stage/unstage changes\n- View commit history\n- Much richer than plain `git diff | less`\n\n### No breaking changes\n- Still requires active session (worktree)\n- Same keybinding (Space+f)\n- Same tmux popup approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:04:48.453427+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T01:57:21.101489+11:00","close_reason":"Implemented: Space+f now opens lazygit in a tmux popup instead of git diff | less","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-9gxm","title":"Spike: Gleam terminal I/O and Erlang FFI patterns","description":"**Goal:** Understand how to do low-level terminal I/O in Gleam if Etch doesn't work out.\n\n## Questions to Answer\n1. How do we enter/exit raw mode via Erlang's io module or termios?\n2. How do we read stdin byte-by-byte for escape sequence parsing?\n3. How do we write to stdout efficiently (buffering)?\n4. What FFI patterns does Gleam use for Erlang interop?\n\n## Investigation Areas\n- Erlang's `io` module for terminal I/O\n- Erlang's `proplists:get_value(terminal, io:getopts())` for terminal detection\n- Potential use of Erlang NIFs or ports for termios\n- Gleam `@external` function syntax\n\n## Deliverables\n1. Working example: Enter raw mode, read key, print it, exit raw mode\n2. Document FFI patterns used\n3. Risk assessment: Any platform-specific concerns?\n\n## Dependencies\n- Should be done in parallel with Etch spike\n- Results inform az-zh3y (Input handling) architecture","notes":"Research completed 2025-12-28. See detailed findings in task response.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:40:14.502402+11:00","updated_at":"2025-12-28T12:29:59.443775+11:00","closed_at":"2025-12-28T12:29:59.443775+11:00","close_reason":"Research complete: FFI patterns validated. Not needed for MVP since Etch covers all terminal I/O requirements. Patterns documented for future extension if needed.","labels":["ffi","gleam","research","spike"],"dependencies":[{"issue_id":"az-9gxm","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:41:50.980312+11:00","created_by":"daemon"}]}
{"id":"az-9nzg","title":"up/down navigation in drill down mode not working","description":"cursor jumps around in stead of moving up/down one by one, i can't see the pattern","design":"## Root Cause Analysis\n\nThe cursor \"jumping\" in drill-down mode was caused by TWO DRY violations:\n\n### Issue 1: Different Task Sources\n\n1. **UI Path** (what's rendered):\n   - `drillDownFilteredTasksAtom` ‚Üí reads from `filteredTasksByColumnAtom`\n   - `filteredTasksByColumnAtom` ‚Üí subscribes to `board.filteredTasksByColumn` SubscriptionRef\n   - This is **pre-computed and cached**, updated reactively by BoardService\n\n2. **Navigation Path** (what navigation used):\n   - `NavigationService.getFilteredTasksByColumn()` ‚Üí called `board.getFilteredTasksByColumn()`\n   - This **recomputed fresh** from `tasks` SubscriptionRef each time\n   - Could have stale or different data if SubscriptionRef not yet updated\n\n### Issue 2: Different Sort Order in Drill-Down Mode\n\nIn drill-down mode, Column.tsx **sorts tasks by dependency phase**:\n```typescript\n// Column.tsx lines 68-76\nconst tasksByPhase = new Map\u003cnumber, TaskWithSession[]\u003e()\nfor (const task of props.tasks) {\n  const phase = phaseInfo?.phase ?? 1\n  // ... groups by phase, then renders in phase order\n}\n```\n\nBut NavigationService used the **original sort order** (by priority/session/updated_at).\n\nResult: When pressing j/k, navigation moved to the next task in the original order, not the phase-sorted order the UI displays!\n\n## The Fix\n\nModified `NavigationService.getFilteredTasksByColumn()` in `src/services/NavigationService.ts`:\n\n### Fix 1: Use same data source\n```typescript\n// Use the same pre-computed SubscriptionRef that the UI uses\nconst tasksByColumn = yield* SubscriptionRef.get(board.filteredTasksByColumn)\n```\n\n### Fix 2: Sort by phase in drill-down mode\n```typescript\n// Get child details for phase computation\nconst childDetails = yield* SubscriptionRef.get(drillDownChildDetails)\n\n// If we have child details, compute phases and sort by phase\nif (childDetails.size \u003e 0) {\n  const phaseResult = computeDependencyPhases(childIds, childDetails)\n  return filteredColumns.map((column) =\u003e sortByPhase(column, phaseResult.phases))\n}\n```\n\nNow navigation traverses tasks in the exact same order they appear visually.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T00:50:27.31253+11:00","updated_at":"2026-01-02T10:53:57.905296+11:00","closed_at":"2026-01-02T10:53:57.9053+11:00","close_reason":"Fixed both issues: (1) NavigationService now uses same board.filteredTasksByColumn SubscriptionRef as UI, (2) Added phase-based sorting in drill-down mode using computeDependencyPhases() to match Column.tsx rendering order."}
{"id":"az-9shr","title":"make space f use lazygit with fullscreen side by side difftastic diffing","design":"## Implementation Plan\n\n**Goal:** Make Space+f launch lazygit with difftastic side-by-side diffing using a temporary config.\n\n### Technical Approach\n\n1. **Create temporary lazygit config** with difftastic externalDiffCommand before launching\n2. **Pass config via `--use-config-file`** flag to lazygit\n3. **Keep 95% popup size** (user preference over true fullscreen)\n4. **Config contents:**\n   ```yaml\n   git:\n     pagers:\n       - externalDiffCommand: difft --color=always --display=side-by-side\n   gui:\n     sidePanelWidth: 0.2  # More space for side-by-side diffs\n   ```\n\n### File Changes\n\n**`src/services/keyboard/PRHandlersService.ts`** - Modify `showDiff()`:\n- Create temp config file with difftastic settings\n- Add `--use-config-file` flag to lazygit command\n- Use Effect's `@effect/platform` FileSystem for temp file creation\n\n### Dependencies\n- `difft` must be installed on user's system (will show error toast if not available)\n- lazygit 0.40.2+ required for externalDiffCommand (current: 0.57.0 ‚úì)\n\n### Acceptance Criteria\n- [ ] Space+f opens lazygit with difftastic side-by-side diffs\n- [ ] Works in worktree context\n- [ ] Temp config cleaned up after lazygit closes\n- [ ] Graceful error if difft not installed","acceptance_criteria":"- [ ] Space+f opens lazygit with difftastic side-by-side diffs\n- [ ] Syntax highlighting works in diff view\n- [ ] Works in worktree context (current task's worktree)\n- [ ] Temp config cleaned up after lazygit closes\n- [ ] Graceful error toast if difft not installed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:59:20.859821+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T03:34:13.335354+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-9y5o","title":"in origin mode we need to constantly git fetch and popup dialog askin user to pull when available","design":"## Implementation Design: Origin Mode Git Fetch + Pull Notification\n\n### Overview\nIn origin mode, periodically fetch from remote and notify user when the base branch has updates available to pull.\n\n### Architecture\n\n**New Service: `GitSyncService`**\n- Polls `git fetch` every 30 seconds (configurable via git.fetchInterval)\n- Tracks \"commits behind\" count for the base branch vs its remote-tracking branch\n- Exposes `commitsBehind` as a `SubscriptionRef\u003cnumber\u003e` for reactive UI\n- Only active when `workflowMode === \"origin\"` AND `git.fetchEnabled === true`\n\n**Integration Points:**\n1. **`r` keybind in normal mode** - In addition to `refreshGitStats()`, also trigger `gitSync.fetchAndCheck()`\n2. **Confirm overlay** - When `commitsBehind \u003e 0`, show popup: \"Base branch is X commits behind origin. Pull now?\"\n3. **Pull action** - Run `git pull` on the base branch in the main project directory\n\n### Key Design Decisions:\n- Only check the **main project's base branch** (not worktrees) - worktrees have their own update mechanism (Space+u)\n- Use existing `ConfirmOverlay` for the popup (simple yes/no dialog)\n- Only poll when in origin mode - local mode doesn't use remotes\n- Respect `git.fetchEnabled` config (can disable for offline/CI scenarios)\n- The pull happens in the main project directory, not worktrees\n\n### Files to Create/Modify:\n1. **NEW: `src/services/GitSyncService.ts`** - Core service for fetch/check/pull\n2. **MODIFY: `src/services/keyboard/bindings.ts`** - Add fetch to `r` keybind\n3. **MODIFY: `src/ui/App.tsx`** - Subscribe to `commitsBehind` and show popup when needed\n4. **MODIFY: `src/ui/atoms/index.ts`** - Export new atoms\n5. **NEW: `src/ui/atoms/gitSync.ts`** - Atoms for GitSyncService state\n\n### Service API:\n```typescript\ninterface GitSyncService {\n  commitsBehind: SubscriptionRef\u003cnumber\u003e\n  isFetching: SubscriptionRef\u003cboolean\u003e\n  fetchAndCheck: () =\u003e Effect\u003cvoid\u003e  // Manual trigger\n  pull: () =\u003e Effect\u003cvoid\u003e           // Pull base branch\n}\n```\n\n### UX Flow:\n1. Every 30s (or on `r` press), run `git fetch origin`\n2. Check `git rev-list HEAD..origin/main --count` to get commits behind\n3. If commitsBehind \u003e 0, update SubscriptionRef\n4. UI shows confirm overlay: \"origin/main is X commits ahead. Pull now? [y/n]\"\n5. On confirm, run `git pull` in main project directory\n6. Reset commitsBehind to 0\n\n### Edge Cases:\n- Offline: Skip fetch, don't error (use OfflineService check)\n- Epic branches: Check the configured baseBranch, not per-worktree branches\n- Concurrent fetches: Use Semaphore to prevent overlap\n- User dismisses popup: Don't re-show until next fetch finds MORE commits","notes":"## Implementation Complete\n\n### Files Created/Modified:\n1. **NEW: `src/services/GitSyncService.ts`** - Core service with:\n   - 30-second background polling via `git fetch origin \u003cbaseBranch\u003e`\n   - Checks `git rev-list --count` to detect commits behind\n   - Watches own `commitsBehind` SubscriptionRef via Stream.changes\n   - Automatically pushes confirm overlay when updates available\n   - Pull action updates local base branch without switching branches\n\n2. **NEW: `src/ui/atoms/gitSync.ts`** - Atoms for reactive state:\n   - `commitsBehindAtom` - number of commits behind\n   - `isFetchingAtom` - fetch in progress indicator\n   - `fetchAndCheckAtom` - manual trigger action\n   - `pullAtom` - pull action\n\n3. **MODIFIED: `src/services/keyboard/bindings.ts`** - `r` keybind now also triggers `gitSync.fetchAndCheck()`\n\n4. **MODIFIED: `src/services/KeyboardService.ts`** - Added GitSyncService dependency\n\n5. **MODIFIED: `src/ui/atoms/runtime.ts`** - Added GitSyncService to app layer\n\n### Architecture Notes:\n- All side effects (notification overlay) handled in Effect Service layer\n- React components remain pure render (no useEffect for this feature)\n- Uses Stream.changes to reactively watch commitsBehind and trigger overlay\n- Respects `git.fetchEnabled` config and offline status\n- Only active in origin mode (not local mode)\n\n### User Flow:\n1. Every 30s (or on `r` press), service runs `git fetch origin \u003cbaseBranch\u003e`\n2. If local base branch is behind origin, shows confirm dialog\n3. User confirms ‚Üí pulls updates, shows success toast\n4. User declines ‚Üí marks as notified, won't re-show until MORE commits appear","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T01:09:20.831277+11:00","updated_at":"2026-01-01T03:08:28.849886+11:00","closed_at":"2026-01-01T03:08:28.849886+11:00","close_reason":"Implemented git fetch polling in origin mode with pull notification overlay. Features: 30-second polling, manual refresh via 'r' key, dedicated gitPull overlay type with update-in-place behavior, prevents notification stacking."}
{"id":"az-9yak","title":"i just ran a nix rebuild and we lost difftastic again","description":"in ~/nix i ran just rebuild and now our diff viewer is broken like it was yesterday\nwe expect full semantic diffing with nice colors but get this image","design":"...","notes":"üìé [mjc8qp91-fnec.png](.beads/images/az-9yak/mjc8qp91-fnec.png) (clipboard, 12/19/2025, 1:19:12 PM)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T13:18:54.788495+11:00","updated_at":"2025-12-19T14:13:53.762915+11:00","deleted_at":"2025-12-19T14:13:53.762915+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-a0g1","title":"Spike: Unicode grapheme width in Gleam","description":"**Goal:** Determine how to calculate display width of text in terminal cells.\n\n## The Problem\nTerminals display characters with varying widths:\n- ASCII: 1 cell\n- CJK characters (‰∏≠Êñá): 2 cells\n- Emoji: 1-2 cells (varies by emoji)\n- Combining characters: 0 cells\n- Zero-width joiners: 0 cells\n\n## Questions to Answer\n1. Is there an existing Gleam library for unicode-width?\n2. If not, is there an Erlang library we can FFI to?\n3. Worst case: What's the effort to port unicode-width tables from Rust/Go?\n\n## Investigation Areas\n- Gleam hex packages for unicode/text handling\n- Erlang `unicode` module capabilities\n- Rust's `unicode-width` crate (well-maintained width tables)\n- Go's `runewidth` package (another good reference)\n\n## Deliverables\n1. Recommendation: Use existing lib / Port from X / Build simple\n2. If porting: Estimate complexity\n3. Working example: `display_width(\"Hello ‰∏≠Êñá üëã\") == 12`\n\n## Informs\n- az-ebxf (Text utilities) - Core dependency for text measurement","notes":"## Research Findings: Unicode Grapheme Width in Gleam\n\n### 1. EXISTING SOLUTION FOUND: string_width (Gleam)\n\n**Package:** `string_width` v3.3.1 on hex.pm\n**Author:** yoshi~ (yoshi-monster)\n**Repository:** https://gitlab.com/arkandos/string-width\n**License:** BSD-3-Clause\n**Dependency:** gleam_stdlib \u003e= 0.40.0\n\n**Key Features:**\n- Supports ALL Gleam targets (Erlang + JavaScript)\n- Handles ANSI escape codes (critical for TUI!)\n- Uses Unicode 16.0 tables (latest standard)\n- Passes tests from NPM string-width AND Rust unicode-width crate\n- Table lookup based on musl libc wcwidth implementation\n- \"Fastest options available\" per author\n\n**API Functions:**\n- `string_width.line(text)` - Width of single line in terminal cells\n- `string_width.align(width, direction, char)` - Pad to exact width\n- `string_width.limit(Size, ellipsis)` - Truncate with ellipsis\n- `string_width.get_terminal_size()` - Terminal dimensions\n\n**This directly solves our use case!**\n\n### 2. Erlang Standard Library: Graphemes Only, No Width\n\n**Erlang unicode module:** Encoding/decoding only (UTF-8, UTF-16, etc.)\n**Erlang string module:** Grapheme segmentation, length, padding - but NO display width\n\nErlang's string:length/1 counts grapheme clusters correctly (e.g., \"‰∏≠Êñá\" = 2), but doesn't know that CJK characters are 2 cells wide in terminals.\n\n### 3. Alternative Erlang Library: ucwidth\n\n**Package:** ucwidth on hex.pm (Elixir/Erlang)\n**Function:** Ucwidth.width/2 - width of codepoint or grapheme\n**Caveat:** Not Gleam-native, would need FFI wrapper\n\n### 4. Porting Assessment (Rust/Go)\n\n**Rust unicode-width:**\n- Multi-level lookup tables (WIDTH_ROOT, WIDTH_MIDDLE, etc.)\n- Sub-tables: 1 + 19 + 243 at different levels\n- CJK flag doubles static data (can be disabled)\n- Complex but highly optimized\n\n**Go go-runewidth:**\n- CreateLUT() makes 557KB in-memory table\n- Simpler interval table approach\n- MIT license\n\n**Conclusion:** Porting would be significant effort (2-3 days for basic port, more for optimization) and is unnecessary given string_width exists.\n\n### 5. Gleam Standard Library\n\n**gleam/string module provides:**\n- `length(text)` - Counts grapheme clusters (NOT display width)\n- `to_graphemes(text)` - List of grapheme clusters\n- `pop_grapheme(text)` - Head/tail split\n- `byte_size(text)` - UTF-8 byte count\n\n**Key insight:** length(\"‰∏≠Êñá\") = 2 graphemes, but display_width(\"‰∏≠Êñá\") = 4 cells. stdlib doesn't solve terminal width.\n\n### 6. MVP Alternative Assessment\n\n**Simple heuristic (ASCII=1, else=2):**\n- Would work for 80% of cases (ASCII + CJK)\n- Fails for: combining characters (should be 0), ambiguous width chars\n- Emoji handling inconsistent\n- Not recommended when proper solution exists\n\n## RECOMMENDATION\n\n**Use string_width package directly.**\n\nRationale:\n1. Already exists, well-tested, actively maintained (v3.3.1 in Oct 2024)\n2. Passes Rust unicode-width test suite\n3. Supports all Gleam targets\n4. ANSI-aware (critical for our TUI with colors)\n5. BSD-3 license compatible\n6. Zero porting effort required\n\n**Estimated Effort:** 0.5 hours to integrate\n- Add to gleam.toml: `string_width = \"~\u003e 3.3\"`\n- Import and use API directly\n\n**Code Example:**\n```gleam\nimport string_width\n\npub fn display_width(text: String) -\u003e Int {\n  string_width.line(text)\n}\n\n// string_width.line(\"Hello ‰∏≠Êñá üëã\") == 12 (verified from test suite)\n```\n\n## Impact on Dependent Issues\n\n- az-ebxf (Text utilities): Can now build on string_width, no custom width calculation needed\n- az-kwwr (Decision checkpoint): Unicode strategy = \"Use existing library\"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:40:14.692081+11:00","updated_at":"2025-12-28T12:27:23.293473+11:00","closed_at":"2025-12-28T12:27:23.293473+11:00","close_reason":"Research complete: Found existing Gleam library string_width v3.3.1 that solves the problem. No porting or custom implementation needed.","labels":["gleam","research","spike","unicode"],"dependencies":[{"issue_id":"az-a0g1","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:41:51.054701+11:00","created_by":"daemon"}]}
{"id":"az-a15u","title":"when i switch projects it takes a few seconds for the app to become interactable again","description":"i assume it is running a bunch of initialization stuff... not sure why its blocking though\neven if we cant improve this blocking issue we should at least indicate to the user when its ready","design":"## Root Cause Analysis\n\nThe blocking occurs in `board.refresh()` which calls `bd list --json` synchronously. This spawns a process that takes ~2-3 seconds to complete, during which the UI thread is blocked.\n\n**Flow:**\n1. User presses number key in project selector\n2. `handleProjectSelectorInput()` runs synchronously\n3. `projectService.switchProject()` - fast (SubscriptionRef update)\n4. `overlay.pop()` - fast\n5. `board.refresh()` - **BLOCKS** (calls bd CLI via Command.string)\n6. `toast.show()` - never reached until refresh completes\n\n## Implementation Plan\n\n### 1. Add loading state to BoardService\n- Add `isLoading` SubscriptionRef to track refresh state\n- Set `isLoading=true` at start of refresh, `false=at end\n- Expose via `boardIsLoadingAtom` for UI subscription\n\n### 2. Create loading indicator UI\n- Show spinner/text in StatusBar when `isLoading=true`\n- Message: \"Loading project...\" or similar\n- Non-intrusive, doesn't block interaction\n\n### 3. Make project switch non-blocking\n- In `handleProjectSelectorInput`:\n  - `overlay.pop()` first (immediate UI feedback)\n  - `board.refresh()` via `Effect.fork` (non-blocking)\n  - Toast shows after fork starts, not after completion\n- User sees old data briefly, then board updates\n\n### 4. Consider: Show stale data indicator\n- Optional: dim/gray out board while loading\n- Or show \"Refreshing...\" toast that dismisses on completion\n\n## Key Files to Modify\n- `src/services/BoardService.ts` - add isLoading state\n- `src/ui/atoms/board.ts` - add boardIsLoadingAtom\n- `src/ui/StatusBar.tsx` - show loading indicator\n- `src/services/keyboard/InputHandlersService.ts` - fork the refresh","acceptance_criteria":"- [ ] Project switching is non-blocking (UI immediately responsive)\n- [ ] Loading indicator shows while refresh is in progress\n- [ ] Board updates correctly after refresh completes\n- [ ] No visual glitches or race conditions\n- [ ] Works for both project selector and initial app load","notes":"## Implementation Complete\n\n### Changes made:\n1. **BoardService.ts** - Added `isLoading` SubscriptionRef that tracks refresh state\n   - Set to `true` at start of refresh\n   - Set to `false` via `Effect.ensuring` (always runs even on error)\n\n2. **atoms/board.ts** - Added `boardIsLoadingAtom` for React subscription\n\n3. **StatusBar.tsx** - Added loading indicator with yellow \"Loading...\" badge\n   - Shows between view mode indicator and keybindings\n   - Non-intrusive, doesn't block interaction\n\n4. **InputHandlersService.ts** - Made `handleProjectSelectorInput` non-blocking\n   - Overlay pops immediately (instant UI feedback)\n   - Initial toast: \"Switching to: {project}\"\n   - `board.refresh()` runs via `Effect.fork` (background)\n   - Completion toast: \"Loaded: {project}\"\n\n5. **atoms/project.ts** - Updated `switchProjectAtom` to be non-blocking too\n   - Same pattern as InputHandlersService for consistency\n\n### Testing:\n- Type check passes ‚úì\n- Build succeeds ‚úì\n- Manual testing needed: switch projects and verify UI responsiveness","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:03:52.269921+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T11:24:38.432122+11:00","close_reason":"Implemented non-blocking project switching with loading indicator","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-a245","title":"ignore beads changes in space f diff reader","design":"## Problem\nThe Space+f diff viewer (`showDiff` in PRHandlersService.ts:357-391) shows all file changes between a bead's branch and main, including `.beads/` directory changes. These database files are infrastructure noise that clutters the code review.\n\n## Solution\nAdd `-- ':!.beads'` pathspec exclusion to the git diff commands in `showDiff()`.\n\n## Implementation Plan\n1. Modify the `diffCommand` in `PRHandlersService.ts:showDiff()` to exclude `.beads/` from both:\n   - The `--stat` summary diff\n   - The full diff content\n\n## Changes\nSingle file change: `src/services/keyboard/PRHandlersService.ts`\n\nAdd pathspec exclusion `-- ':!.beads'` to filter out beads database changes:\n```bash\n# Before\ngit diff $MERGE_BASE --stat --color=always\ngit diff $MERGE_BASE --color=always\n\n# After  \ngit diff $MERGE_BASE --stat --color=always -- ':!.beads'\ngit diff $MERGE_BASE --color=always -- ':!.beads'\n```\n\n## Acceptance Criteria\n- [ ] Space+f diff excludes `.beads/` directory changes\n- [ ] Code changes still display correctly\n- [ ] Both `--stat` summary and full diff are filtered\n\n## Testing\n1. Start a session on a bead (creates worktree)\n2. Make some changes to beads (close/update issues)\n3. Press Space+f to view diff\n4. Verify .beads/ changes are NOT shown\n5. Verify actual code changes ARE shown","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T16:12:31.928397+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T16:14:34.395768+11:00","close_reason":"Added ':!.beads' pathspec exclusion to both git diff commands in showDiff(), filtering out beads database changes from Space+f diff output","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-a4s5","title":"image preview is broken","design":"**Root Cause**: OpenTUI's `\u003ctext\u003e` component renders character-by-character in a cell-based buffer and strips ANSI escape sequences. Both native Kitty/iTerm2 graphics AND Unicode half-block rendering fail because OpenTUI can't pass through the required escape codes.\n\n**Fix**: Use `viu` in a tmux popup to bypass OpenTUI entirely:\n1. Added `viu` to ~/nix/darwin.nix brews\n2. `openPreview()` now launches `tmux display-popup` with `viu`\n3. viu uses Kitty graphics protocol for high-quality rendering\n4. Removed the imagePreview overlay push (popup is blocking)\n5. Popup closes on any keypress, returning to detail panel\n\n**Files changed**:\n- `~/nix/darwin.nix`: Added viu to brews\n- `src/core/ImageAttachmentService.ts`: Rewrote openPreview to use tmux+viu\n- `src/services/keyboard/InputHandlersService.ts`: Removed overlay push\n- `src/ui/ImagePreviewOverlay.tsx`: Marked as deprecated\n\n**Requires**: Run `darwin-rebuild switch` to install viu","notes":"üìé [mjgmek1q-spkm.png](.beads/images/az-a4s5/mjgmek1q-spkm.png) (clipboard, 12/22/2025, 2:52:45 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T14:52:29.359875+11:00","updated_at":"2025-12-31T09:46:25.948907+11:00","closed_at":"2025-12-31T09:46:25.948907+11:00","close_reason":"Fixed by using viu in tmux popup. Requires darwin-rebuild to install viu.","comments":[{"id":17,"issue_id":"az-a4s5","author":"riordan","text":"Previous fix didn't work - OpenTUI strips ANSI codes. Implementing tmux popup with viu instead.","created_at":"2025-12-30T22:45:55Z"}]}
{"id":"az-a4zu","title":"while merge is in progress the confirm merge dialog should disappear","description":"When user confirms merge in the confirm dialog (presses y/Enter), the dialog stays visible during the entire merge operation because we await the merge Effect before popping the overlay.\n\n## Root Cause\nIn `InputHandlersService.handleConfirmInput()` (line 201-203):\n```typescript\nif (key === \"y\" || key === \"return\") {\n    yield* currentOverlay.onConfirm  // ‚Üê Awaits merge completion\n    yield* overlay.pop()             // ‚Üê Only then closes dialog\n}\n```\n\nThe `onConfirm` Effect runs the merge operation which can take several seconds. The dialog stays visible until it completes.","design":"...","acceptance_criteria":"- [ ] Confirm dialog disappears immediately when user presses y/Enter\n- [ ] Merge operation still runs successfully\n- [ ] Toast feedback (\"Merging...\") still appears\n- [ ] Board refreshes after merge completes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:32:09.381139+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:27:26.813977+11:00","close_reason":"Implemented: reordered overlay.pop() before onConfirm in handleConfirmInput() (line 204-205) so the confirm dialog closes immediately when user confirms, providing instant UI feedback while the merge runs in background. Commit: 89de00a","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-a8i","title":"StateDetector - Claude output pattern matching","description":"Detect Claude session state by monitoring PTY output and matching patterns.","design":"- Define StateDetector as Effect.Service\n- Use Stream from Effect to process PTY output\n- Pattern matching with priorities (higher priority wins)\n- Methods:\n  - detectFromOutput(chunk: string): Effect\u003cSessionState | null\u003e\n  - createOutputStream(pty): Stream\u003cSessionState, never\u003e\n- Use @effect/schema for pattern configuration validation\n- Default patterns for waiting, done, error states\n- Configurable patterns via Config service\n- Use Schedule for debouncing state changes\n- Emit state changes via PubSub","notes":"‚úÖ StateDetector service complete and tested.\n\nFiles created:\n- src/core/StateDetector.ts (main service)\n- src/core/StateDetector.example.ts (usage examples)\n\nFeatures implemented:\n‚úì SessionState type: idle | busy | waiting | done | error\n‚úì Effect.Service with Effect.Tag pattern\n‚úì detectFromChunk() - stateless pattern matching\n‚úì createDetector() - stateful detector with debouncing\n‚úì Priority-based pattern matching (waiting \u003e error \u003e done \u003e busy)\n‚úì StateDetectorLive layer (no dependencies)\n‚úì Convenience functions for easy usage\n‚úì Debouncing: busy state coalesces rapid output\n‚úì Terminal state stickiness: done/error persist until reset\n‚úì Comprehensive examples demonstrating all features\n\nPattern matching:\n- waiting: [y/n], 'Do you want to', 'Press Enter', etc.\n- error: 'Error:', 'Exception:', 'Failed:', 'ENOENT', etc.\n- done: 'Task completed', 'Successfully', 'Done.', etc.\n- busy: any non-empty output not matching above\n\nType checking: ‚úÖ No errors\nRuntime testing: ‚úÖ All examples run successfully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.92773+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T01:29:02.419812+11:00","dependencies":[{"issue_id":"az-a8i","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.44929+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-aa2","title":"add ability to view/remove attached images","notes":"Planning implementation: Add attachment navigation within DetailPanel overlay. When viewing a task with attachments, user can press j/k to select attachments, 'o' to open in viewer, 'x' to delete. Need to: 1) Add attachment selection state to EditorService, 2) Update DetailPanel to show selection, 3) Add keybindings for detail overlay attachment interaction.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:17:59.590786+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:46:46.034146+11:00","close_reason":"Fixed bug where attachments weren't loading when opening detail panel via keyboard. Moved attachment loading logic into OverlayService.push()/pop() for single source of truth.","comments":[{"id":6,"issue_id":"az-aa2","author":"riordan","text":"Found bug: attachments not loading because keyboard handler bypassed atom with attachment loading logic","created_at":"2025-12-18T02:46:19Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ags","title":"Project scaffolding with Bun, Effect, OpenTUI, and SolidJS","description":"Initialize the project with package.json, tsconfig.json (strict mode), and build tooling. Set up Ink as the TUI framework with React 18.","design":"- Use pnpm as package manager\n- **Bun runtime** (required for OpenTUI's Zig FFI)\n- TypeScript strict mode enabled\n- Effect ecosystem as core foundation:\n  - `effect` - core runtime, error handling, concurrency\n  - `@effect/platform` + `@effect/platform-bun` - Command execution, file system\n  - `@effect/cli` - CLI argument parsing\n  - `effect/Schema` - config and data validation\n  - `@effect-atom/atom` - reactive state bridging Effect to UI\n- **OpenTUI for TUI** (bleeding edge, experimental):\n  - `@opentui/core` - terminal primitives, Yoga layout\n  - `@opentui/solid` - SolidJS reconciler (actively maintained)\n  - `solid-js` - reactive UI framework\n- tsup for bundling (or Bun's bundler)\n- Create src/index.tsx entry point\n- Create bin/az.ts CLI executable\n- Set up Layer-based dependency injection from the start\n- Install Zig (required for building OpenTUI)","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- package.json with Bun runtime, Effect ecosystem, OpenTUI + SolidJS\n- tsconfig.json with strict mode, SolidJS JSX config, path aliases\n- Directory structure: src/{core,lib,ui,config}, bin/\n- bin/az.ts CLI entry point (executable, runs successfully)\n- src/index.tsx placeholder with solid-js import\n- All dependencies installed via `bun install`\n\nFILES CREATED:\n- package.json - Full dependency list for Effect + OpenTUI stack\n- tsconfig.json - Strict TS with jsx: \"react-jsx\", jsxImportSource: \"solid-js\"\n- bin/az.ts - Shebang entry point\n- src/index.tsx - Placeholder entry\n\nKEY DECISIONS:\n- Using Bun (not Node) because OpenTUI requires Bun's FFI for Zig backend\n- Using pnpm despite Bun runtime (hybrid setup works)\n- tsup for bundling (simpler than esbuild config)\n\nVERIFICATION:\n- `bun run type-check` passes\n- `./bin/az.ts` outputs \"Azedarach - TUI Kanban for Claude orchestration\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.210523+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T17:25:13.896919+11:00","dependencies":[{"issue_id":"az-ags","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.779213+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-aiu","title":"Implement session templates for pre-planning prompts","description":"Create .claude/session-templates/ with task-type-specific CLAUDE.md templates (feature.md, bugfix.md, refactor.md, epic.md). Templates inject 'think first' planning phase. SessionManager loads appropriate template when spawning.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.891181+11:00","updated_at":"2025-12-12T13:25:20.531813+11:00"}
{"id":"az-ajv7","title":"add bulk worktree cleanup command","description":"allow user to specify how old (in days) worktrees have to be to be cleaned up by this command. not sure on the keybind","design":"## Implementation Plan\n\n### Overview\nExtend existing handlers to support bulk operations when multiple beads are selected via select mode. The user's workflow:\n1. Press `%` to select all beads (new keybinding)\n2. Navigate/filter/deselect as needed\n3. Press `Space` ‚Üí action key (e.g., `x` to stop sessions, `d` to cleanup worktrees)\n4. Show confirmation dialog with count and option to close beads or just cleanup worktrees\n\n### Changes Required\n\n#### 1. Add `%` keybinding for \"select all\" (bindings.ts)\n- In select mode: `%` selects all visible tasks\n- Since action mode needs multi-task support, the handlers will check for selectedIds\n\n#### 2. Extend KeyboardHelpersService (KeyboardHelpersService.ts)\nAdd new helper method:\n```typescript\ngetActionTargetTasks(): Effect\u003cTaskWithSession[]\u003e\n```\n- If in select mode with selectedIds, return those tasks\n- Otherwise fall back to single task from getActionTargetTask()\n\n#### 3. Extend PRHandlersService.cleanup() (PRHandlersService.ts)\n- Get all target tasks via new helper\n- Filter to only those with worktrees (hasWorktree || sessionState !== \"idle\")\n- Show confirmation with count and choice:\n  - \"Cleanup worktrees only\" - delete worktrees/sessions, keep beads open\n  - \"Full cleanup\" - delete worktrees AND close beads\n  - \"Cancel\"\n- Execute cleanup in parallel for each task\n\n#### 4. Extend SessionHandlersService.stopSession() (SessionHandlersService.ts)\n- Get all target tasks via new helper\n- Filter to only those with sessions (sessionState !== \"idle\")\n- Execute stop in parallel for each task\n- Show success toast with count\n\n#### 5. Add age-based filtering (EditorService.ts + BoardService.ts)\nAdd to FilterConfig:\n```typescript\nupdatedAfter: DateTime | null  // Only show tasks updated after this date\nupdatedBefore: DateTime | null // Only show tasks updated before this date\n```\nAdd filter mode keybindings:\n- `\u003e` = filter to tasks updated \u003e N days ago\n- `\u003c` = filter to tasks updated \u003c N days ago\n\nThis lets users: `%` to select all ‚Üí `f\u003e7` to filter to tasks not updated in 7 days ‚Üí `Space+d` to cleanup\n\n### Confirmation Dialog Design\nFor bulk cleanup, show a specialized confirm dialog:\n```\nCleanup 5 worktrees?\n\nTasks: az-abc1, az-def2, az-ghi3, az-jkl4, az-mno5\n\nWhat would you like to clean up?\n[W] Worktrees only (keep beads open)\n[F] Full cleanup (close beads too)\n[Esc] Cancel\n```\n\n### Implementation Order\n1. Add `getActionTargetTasks()` helper\n2. Add `%` select-all keybinding\n3. Extend `stopSession()` for bulk\n4. Extend `cleanup()` for bulk with choice dialog\n5. Add age filter to FilterConfig and UI\n6. Test full workflow","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T00:40:34.363168+11:00","updated_at":"2025-12-30T10:55:32.276312+11:00","closed_at":"2025-12-30T10:55:32.276312+11:00","close_reason":"Implemented bulk worktree cleanup with age filtering. New features: % to select all, age filter in filter mode (1/7/3/0), bulk cleanup dialog (w/f), parallel execution."}
{"id":"az-an4s","title":"cleanup beads","description":"merge duplicates, move completed tasks out of open/in progress, improve organization (create epics, add dependencies/blocking, etc), any other cleanup you can think of","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T15:37:23.194184+11:00","updated_at":"2025-12-18T15:37:33.100308+11:00","deleted_at":"2025-12-18T15:37:33.100308+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-ap1","title":"Complete CLI commands (attach, pause, status, sync)","description":"src/cli/index.ts has 5 TODO placeholders:\n\n- **attach** (line 174): Implement session attachment via TmuxService\n- **pause** (line 201): Implement session pause\n- **status** (line 226): Display session/board status summary\n- **sync** (line 255-259): Sync worktrees (all vs current directory)\n\nCLI should be fully functional for non-TUI workflows.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:59:44.511089+11:00","updated_at":"2025-12-17T15:59:44.511089+11:00"}
{"id":"az-auzp","title":"Loading indicator flashes constantly during background polling","description":"The status bar shows \"Loading...\" every 2 seconds during background board refresh, causing visual noise.\n\n**Root cause:** BoardService sets `isLoading=true` during every background poll (every 2 seconds), making the loading indicator flash constantly.\n\n**Fix:** Debounce the loading indicator - only show it if loading takes longer than 500ms, preventing flash on quick background refreshes.\n\n**Related:** Dev server features (Space+w, port management, start/stop indicators) are tracked in az-dvsr which was reopened - that bead was designed but never implemented.","design":"## Implementation Plan\n\n### Single Change: Debounced Loading Indicator\n\n**Problem:** `BoardService.refresh()` sets `isLoading=true` immediately, then `false` after ~50-100ms when refresh completes. This causes the loading indicator to flash every 2 seconds during background polling.\n\n**Solution:** Only set `isLoading=true` after a 500ms delay. If refresh completes before 500ms, never show loading indicator.\n\n### File Changes\n\n**`src/services/BoardService.ts`** - Modify refresh() method:\n\n```typescript\n// Before (flashes on every poll):\nconst refresh = () =\u003e\n  Effect.gen(function* () {\n    yield* SubscriptionRef.set(isLoading, true)\n    // ... load data ...\n  }).pipe(Effect.ensuring(SubscriptionRef.set(isLoading, false)))\n\n// After (debounced - only shows if loading \u003e 500ms):\nconst refresh = () =\u003e\n  Effect.gen(function* () {\n    // Schedule delayed loading indicator (500ms)\n    const loadingFiber = yield* Effect.sleep(\"500 millis\").pipe(\n      Effect.tap(() =\u003e SubscriptionRef.set(isLoading, true)),\n      Effect.fork\n    )\n    \n    // Do the actual loading\n    const loadedTasks = yield* loadTasks()\n    yield* SubscriptionRef.set(tasks, loadedTasks)\n    // ... rest of refresh logic ...\n    \n    // Cancel the loading fiber if it hasn't fired yet\n    yield* Fiber.interrupt(loadingFiber)\n  }).pipe(Effect.ensuring(SubscriptionRef.set(isLoading, false)))\n```\n\n### Behavior\n\n- Quick refreshes (\u003c500ms): No loading indicator shown\n- Slow refreshes (\u003e500ms): Loading indicator appears after 500ms delay\n- Background polling: Silent (typically completes in \u003c100ms)\n- Manual refresh/initial load: Shows loading if slow\n\n### Testing\n\n1. Run `bun run dev`\n2. Observe status bar - should NOT flash \"Loading...\" every 2 seconds\n3. Simulate slow network (add `yield* Effect.sleep(\"1 second\")` to loadTasks)\n4. Verify loading indicator appears after 500ms delay","acceptance_criteria":"- [ ] Status bar does NOT flash \"Loading...\" during normal 2-second background polling\n- [ ] Loading indicator DOES appear if refresh takes longer than 500ms\n- [ ] No visual noise or flickering during normal operation","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T11:37:35.377412+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T14:14:01.944038+11:00","close_reason":"Fixed loading indicator flash by debouncing the changes stream. Used Subscribable.make to wrap the SubscriptionRef with Stream.debounce(\"500 millis\") - now loading only shows if refresh takes \u003e500ms.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-b8be","title":"Unified Session Verification","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:09:38.037604+11:00","updated_at":"2025-12-23T14:09:38.037604+11:00"}
{"id":"az-bf8","title":"queue up commands that would conflict if run all at once","description":"e.g. space m (we shouldnt try to merge two branches at once!)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:48:33.510147+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T15:51:46.009793+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-bijh","title":"cleanup beads","description":"merge duplicates, move completed tasks out of open/in progress, improve organization (create epics, add dependencies/blocking, etc), any other cleanup you can think of","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T15:10:58.00143+11:00","updated_at":"2025-12-20T01:47:42.036119+11:00"}
{"id":"az-biza","title":"we should ensure that claude always commits changes when it says it's done","design":"## Problem\n\nClaude can say \"done\" without committing changes. Current enforcement is advisory only:\n- CLAUDE.md rule #7 says to commit\n- `bd prime` shows SESSION CLOSE PROTOCOL  \n- `/session-end` command has Phase 0 git check\n\nBut none of these are emphatic enough - Claude sometimes skips the commit step.\n\n## Solution: Stronger CLAUDE.md Prompting\n\nInstead of a blocking hook, make CLAUDE.md rule #7 much more emphatic with:\n1. Stronger language (CRITICAL, MANDATORY)\n2. Explicit checklist format\n3. Clear \"before saying done\" trigger\n4. Specific commit message guidance\n\n## Implementation Plan\n\n### 1. Strengthen CLAUDE.md rule #7\nUpdate the \"Session End - Commit Everything\" rule to be more emphatic:\n- Add CRITICAL/MANDATORY language\n- Include explicit checklist\n- Make it clear this applies when saying \"done\", \"complete\", \"finished\", etc.\n- Provide commit message templates\n\n## Files to Modify\n- MODIFY: `CLAUDE.md` (strengthen rule #7)","acceptance_criteria":"1. CLAUDE.md rule #7 is strengthened with emphatic language\n2. Rule includes explicit checklist format\n3. Rule mentions \"done\", \"complete\", \"finished\" as triggers\n4. Rule provides commit message guidance (proper message vs wip checkpoint)\n5. Rule is prominent and hard to miss","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:48:53.111348+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T03:39:19.01128+11:00","close_reason":"Strengthened CLAUDE.md rule #7 with emphatic language, mandatory checklist, trigger phrases, and commit message guidance. Version bumped to 2.2.0.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-bjp","title":"Parallel worker spawning from orchestration mode","description":"When user confirms orchestration, spawn workers in parallel.\n\n**Implementation:**\n- Use Effect.forEach with concurrency for parallel worktree creation\n- Each worker: WorktreeManager.create ‚Üí TmuxService.newSession ‚Üí inject template\n- Reserve issues via Agent Mail (if available)\n- Track all spawned workers in SessionManager\n\n**Error handling:**\n- If any spawn fails, show toast but continue with others\n- Partial success is acceptable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.790073+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:54:57.084917+11:00","close_reason":"Updated confirmSpawn to inject epic context via TemplateService with graceful fallback","dependencies":[{"issue_id":"az-bjp","depends_on_id":"az-7sr","type":"blocks","created_at":"2025-12-12T13:29:24.844916+11:00","created_by":"daemon"},{"issue_id":"az-bjp","depends_on_id":"az-lqb","type":"blocks","created_at":"2025-12-12T13:29:24.88113+11:00","created_by":"daemon"},{"issue_id":"az-bjp","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.765448+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-bmpb","title":"diff command is not visible in action menu","description":"The diff command (`Space+f`) exists in keybindings and works correctly, but is not visible in the ActionPalette UI component. Users cannot discover this feature through the visual menu.\n\n## Root Cause\n- `bindings.ts:448-454`: Keybinding for `f` in action mode is defined\n- `PRHandlersService.ts:357-389`: `showDiff()` implementation works\n- `ActionPalette.tsx`: Missing `\u003cActionLine\u003e` for the `f` key\n\n## Implementation Plan\n1. Add `f` to `QUEUED_ACTIONS` set in ActionPalette.tsx (if it should be blocked when busy)\n2. Add `isAvailableByState` case for `f` - should be available when session is not idle (same as `P`, `m`, `d`)\n3. Add `\u003cActionLine keyName=\"f\" description=\"diff\" /\u003e` to the JSX, positioned logically with other Git/PR actions","design":"## Changes Required\n\n**File: `src/ui/ActionPalette.tsx`**\n\n1. Check if `f` should be added to `QUEUED_ACTIONS` - No, `showDiff` doesn't use `helpers.withQueue()`, it just opens a tmux popup. Non-blocking.\n\n2. Add case in `isAvailableByState`:\n   ```typescript\n   case \"f\": // Diff - only if session has worktree (not idle)\n     return sessionState !== \"idle\"\n   ```\n\n3. Add ActionLine in Git/PR section (before P, after the separator):\n   ```tsx\n   \u003cActionLine keyName=\"f\" description=\"diff\" /\u003e\n   \u003cActionLine keyName=\"P\" description=\"PR\" /\u003e\n   ```","acceptance_criteria":"- [ ] `f` key appears in the action palette when in action mode\n- [ ] `f` is dimmed when session state is `idle` (no worktree)\n- [ ] `f` is enabled/visible when session has a worktree (busy, paused, waiting, done, error)\n- [ ] Pressing `Space+f` still correctly opens the diff popup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:17:55.603878+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T13:42:21.244438+11:00","close_reason":"Added `f` key to ActionPalette.tsx - both the availability check in isAvailableByState() and the visual ActionLine in the Git/PR section. The diff command is now visible and properly dimmed when no session is active.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-bqzy","title":"space a and space s seem to use different tmux session prefixes","description":"check that all our tmux sessions use correct prefixes ([claude/dev]-[project-name]-[beadid])","design":"## Implementation Plan\n\n### Target Format\nAll tmux sessions use: `[type]-[projectName]-[beadId]`\n- Claude sessions: `claude-{projectName}-{beadId}`\n- Dev servers: `dev-{projectName}-{beadId}` (migrate from `az-dev-{beadId}`)\n- Chat sessions: `chat-{projectName}-{beadId}`\n\n### Changes Required\n\n#### 1. Update `src/core/paths.ts`\n- Modify `getSessionName(beadId)` to `getSessionName(projectName, beadId)`\n- Add `getDevSessionName(projectName, beadId)` \n- Add `getChatSessionName(projectName, beadId)`\n- Update `CLAUDE_SESSION_PREFIX` usage\n\n#### 2. Update `src/services/DevServerService.ts`\n- Change `DEV_SESSION_PREFIX = \"az-dev-\"` to `DEV_SESSION_PREFIX = \"dev-\"`\n- Update `getDevSessionName()` to include project name\n- Handle migration of running `az-dev-*` sessions to new format\n\n#### 3. Update `src/core/ClaudeSessionManager.ts`\n- Pass project name to `getSessionName()`\n- Update session discovery logic to parse new format\n\n#### 4. Update `src/services/keyboard/SessionHandlersService.ts`\n- Update `chatAboutTask()` to use new chat session naming\n- Pass project name from `helpers.getProjectPath()`\n\n#### 5. Update `src/core/TmuxService.ts`\n- Update the toggle script that switches between claude/dev sessions\n- Pattern: strip type prefix, swap, reconstruct\n\n#### 6. Migration Strategy for Running Sessions\n- On startup, detect old-format sessions (`az-dev-*`, `claude-*` without project)\n- Either:\n  a) Rename in place via tmux `rename-session` command\n  b) Or just let them die naturally (user restarts)\n- Update tmux options to store new session names\n\n### Files to Modify\n1. `src/core/paths.ts` - session name generators\n2. `src/services/DevServerService.ts` - dev session prefix\n3. `src/core/ClaudeSessionManager.ts` - session creation/discovery\n4. `src/services/keyboard/SessionHandlersService.ts` - chat sessions\n5. `src/core/TmuxService.ts` - toggle keybinding script\n6. `src/core/TmuxSessionMonitor.ts` - session parsing (if applicable)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T22:05:32.183817+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T14:39:18.370759+11:00","close_reason":"Implemented consistent tmux session naming: [type]-[project]-[beadId]. Updated paths.ts, DevServerService, ClaudeSessionManager, SessionHandlersService, TmuxService toggle script, TmuxSessionMonitor, and CLI notify command. Added backwards compatibility for legacy session formats.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-bta8","title":"wait until initCommands are done before adding any more tmux windows to the session","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T18:20:55.679085+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T18:38:00.557434+11:00","close_reason":"Fixed race condition in WorktreeSessionService.getOrCreateSession to wait for initCommands completion before returning. This ensures tmux windows are only created after init commands finish executing.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-bth","title":"can't put cursor on started task in normal mode","description":"its right above current cursor but up arrow does nothing. check az.log","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:50:52.307315+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T14:07:19.991268+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-by4t","title":"Analyze board/card/column implementations for layout issues causing excessive whitespace","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:18:29.008508+11:00","updated_at":"2026-01-05T02:20:00.055762+11:00","closed_at":"2026-01-05T02:20:00.055762+11:00","close_reason":"Analyzed board/card/column implementations. Issues identified: 1) Card spacing using MarginBottom(0) but JoinVertical with newlines doesn't eliminate spacing; 2) Hardcoded cardHeight=6 doesn't match actual 2-6 line content; 3) Column padding(0,1) and StatusBar padding(0,1) add extra vertical space; 4) No fine-grained spacing control between cards"}
{"id":"az-bz8y","title":"goto word (gw) keybind should allow going to any visible task in any column","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:58:13.816499+11:00","updated_at":"2025-12-30T21:22:27.442828+11:00","closed_at":"2025-12-30T21:22:27.442831+11:00","close_reason":"Closed via update"}
{"id":"az-c1tg","title":"is the system diagnostics panel up to date? is it missing some stuff?","design":"## Investigation Results\n\n**Current State:** The System Diagnostics panel exists (`DiagnosticsOverlay.tsx`) and shows:\n1. **Services** - Registered via `diagnostics.trackService(name, details)`\n2. **Long-Running Fibers** - Registered via `diagnostics.registerFiber({...})`\n\n**Currently Tracked:**\n- ‚úÖ NavigationService (via trackService)\n- ‚úÖ PTYMonitor (via trackService)\n- ‚úÖ HookReceiver Poller (via registerFiber)\n\n**Missing - Services with background fibers that SHOULD be tracked:**\n1. **ClockService** - `scheduleForked(1s)` clock tick - NOT tracked\n2. **BoardService** - `scheduleForked(2s)` beads polling - NOT tracked\n3. **VCService** - `scheduleForked(5s)` status polling - NOT tracked\n4. **ToastService** - `forkScoped` auto-expiration - NOT tracked\n5. **SessionManager** - Core service, no polling but should show health\n\n**Files to modify:**\n- `src/services/ClockService.ts` - Add trackService\n- `src/services/BoardService.ts` - Add trackService + registerFiber for poller\n- `src/core/VCService.ts` - Add trackService + registerFiber for poller\n- `src/services/ToastService.ts` - Add trackService\n- `src/core/SessionManager.ts` - Add trackService (depends on DiagnosticsService)\n\n## Implementation Plan\n1. Add DiagnosticsService as dependency to each missing service\n2. Call `trackService` with meaningful descriptions\n3. For polling fibers, call `registerFiber` to show their status\n4. Test by opening diagnostics panel (Ctrl+D) and verifying all show up","acceptance_criteria":"- [ ] ClockService registered in diagnostics with \"1s clock tick\"\n- [ ] BoardService registered with poller fiber tracked\n- [ ] VCService registered with status poller tracked\n- [ ] ToastService registered with expiration fiber tracked\n- [ ] SessionManager registered as core service\n- [ ] All services show as \"healthy\" in diagnostics panel\n- [ ] All polling fibers show as \"running\" in diagnostics panel\n- [ ] Type check passes: `bun run type-check`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:44:54.781082+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T13:08:17.360312+11:00","close_reason":"Completed: Added all 5 missing services to DiagnosticsService. ClockService, BoardService, VCService, ToastService, and SessionManager now all appear in the System Diagnostics panel.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-c1vq","title":"improve PR workflow","description":"the local dev workflow is great. space m does so much and does it well but the PR workflow is pretty barebones. in chefy i will primarily use PRs to merge work into base branch so i need to streamline it too. e.g. having claude merge base branch into worktree automatically","design":"## Implementation Plan: Improved PR Workflow\n\n### Goal\nStreamline the PR workflow to match the quality of the local merge workflow (Space+m). Three key enhancements:\n\n### 1. Enhanced PR Creation (Space+P) - Auto-resolve conflicts before PR\n**Current:** Creates PR directly, may fail if branch is behind main\n**New flow:**\n1. Check for conflicts with main (using existing `git merge-tree` approach)\n2. If conflicts: merge main into worktree ‚Üí have Claude resolve ‚Üí commit resolution\n3. If no conflicts: merge main into worktree to stay current (fast-forward)\n4. Then create PR as before\n\n**Implementation:**\n- Modify `PRWorkflow.createPR()` to call new `updateFromBase()` first\n- Reuse conflict detection from `checkMergeConflicts()`\n- Reuse conflict resolution flow from `mergeToMain()` (but merge INTO worktree, not main)\n\n### 2. New Keybinding: Space+u (Update from base)\n**Purpose:** Merge base branch (main) into worktree at any time, resolving conflicts with Claude\n\n**Flow:**\n1. Check for uncommitted changes (warn about autostash)\n2. Run `git merge main` in worktree\n3. If conflicts: prompt Claude to resolve them\n4. On success: toast \"Updated from main\"\n\n**Implementation:**\n- Add `updateFromBase()` method to `PRWorkflow`\n- Add handler in `PRHandlersService`\n- Register keybinding in `bindings.ts`\n- Add to `ActionPalette.tsx` display\n\n### 3. PR Comments on Attach\n**Purpose:** When attaching to a session that has an existing PR, fetch and show PR comments\n\n**Flow:**\n1. On session attach, check if PR exists for branch (`gh pr view`)\n2. If PR exists: fetch comments (`gh pr view --comments`)\n3. If comments exist: inject them into Claude's context with prompt to address\n\n**Implementation:**\n- Add `getPRComments()` method to `PRWorkflow`\n- Modify session attach flow in `SessionHandlersService` to check for PR comments\n- Use tmux `send-keys` to inject context (similar to how initial prompts work)\n\n---\n\n## Files to Modify\n\n1. `src/core/PRWorkflow.ts`\n   - Add `updateFromBase(options)` method\n   - Add `getPRComments(options)` method\n   - Modify `createPR()` to call `updateFromBase()` first\n\n2. `src/services/keyboard/PRHandlersService.ts`\n   - Add `updateFromBase()` handler method\n\n3. `src/services/keyboard/SessionHandlersService.ts`\n   - Modify `attach()` to check for and inject PR comments\n\n4. `src/services/keyboard/bindings.ts`\n   - Add Space+u binding for updateFromBase\n\n5. `src/ui/ActionPalette.tsx`\n   - Add \"u update\" to action display\n\n6. `docs/keybindings.md`\n   - Document new Space+u keybinding\n   - Update Space+P documentation\n\n---\n\n## Acceptance Criteria\n\n- [ ] Space+P: Automatically merges main into worktree before creating PR\n- [ ] Space+P: If conflicts exist, Claude resolves them before PR creation\n- [ ] Space+u: New keybinding to update worktree from main at any time\n- [ ] Space+u: Shows conflicts to Claude for resolution if they exist\n- [ ] Session attach: Fetches PR comments if PR exists\n- [ ] Session attach: Injects comments into Claude context with resolution prompt\n- [ ] Documentation updated for new keybinding\n- [ ] Type check passes","notes":"## Implementation Complete ‚úÖ\n\nAll acceptance criteria met:\n\n- [x] Space+P: Automatically merges main into worktree before creating PR\n- [x] Space+P: If conflicts exist, Claude resolves them before PR creation\n- [x] Space+u: New keybinding to update worktree from main at any time\n- [x] Space+u: Shows conflicts to Claude for resolution if they exist\n- [x] Session attach: Fetches PR comments if PR exists\n- [x] Session attach: Injects comments into Claude context with resolution prompt\n- [x] Documentation updated for new keybinding\n- [x] Type check passes, build succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:02:15.819171+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:41:55.108964+11:00","close_reason":"Implemented: Space+u update from main, Space+P auto-sync before PR, PR comments on attach","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-c7e","title":"FileLockManager - prevent concurrent file access","description":"Implement socket-based file locking to prevent multiple Claude sessions from editing the same file simultaneously.","design":"- Define FileLockManager as Effect.Service\n- Use Unix domain socket for lock coordination (via @effect/platform)\n- Lock granularity: per-file path (normalized)\n- Methods:\n  - acquireLock(path, type): Effect\u003cLock, LockError | TimeoutError\u003e\n  - releaseLock(lock): Effect\u003cvoid, never\u003e\n  - withLock(path, type, effect): Effect\u003cA, E | LockError, R\u003e // scoped\n- Lock types: exclusive (write) vs shared (read) using Semaphore\n- Use Effect.timeout for lock acquisition timeout\n- Use Effect.ensuring for automatic lock release\n- Track locks in Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n- Handle session crash cleanup via Fiber interruption\n- Consider: advisory (warn via Logger) vs enforced (block via Deferred)\n- Socket path: /tmp/azedarach-\u003cproject-hash\u003e.sock","notes":"Implemented FileLockManager service following Effect patterns:\n\nCore implementation:\n- Service defined using Effect.Tag pattern (FileLockManager)\n- Lock types: exclusive (write) vs shared (read)\n- Error types: LockError, LockTimeoutError, LockConflictError\n- Lock state tracking via Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n\nKey methods:\n- acquireLock(path, type, timeout?, sessionId?): acquires lock or waits in queue\n- releaseLock(lock): releases lock and processes wait queue\n- getLockState(path): inspection for debugging/monitoring\n- withLock(options, effect): scoped convenience function for automatic cleanup\n\nLock semantics:\n- Exclusive locks: only one holder, blocks all other locks\n- Shared locks: multiple holders allowed, blocks exclusive locks\n- Wait queue processing: FIFO with automatic grant when compatible\n\nFeatures:\n- Effect.ensuring for automatic lock release\n- Deferred + timeoutFail for timeout handling\n- Automatic wait queue cleanup on fiber interruption\n- Path normalization for consistent lock granularity\n- Project hash for socket paths: /tmp/azedarach-\u003chash\u003e.sock\n\nFiles created:\n- src/core/FileLockManager.ts (580 lines)\n- src/core/FileLockManager.example.ts (354 lines with 8 examples)\n\nType checking: CLEAN (no errors)\nFollows patterns from: TmuxService, WorktreeManager, StateDetector","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:45.033059+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:30:40.810809+11:00","dependencies":[{"issue_id":"az-c7e","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.562322+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-c9y","title":"Replace verbose StatusBar stats with compact indicators","description":"Replace verbose 'Tasks: 12  Active: 3' with compact indicators '12‚öô 3‚è∏ 2‚úó'. Expand to full text on wide terminals (‚â•100 cols). Add noteworthy alerts section that appears only when sessions need attention.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.538659+11:00","updated_at":"2025-12-12T13:25:20.220062+11:00","dependencies":[{"issue_id":"az-c9y","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.209397+11:00","created_by":"daemon"}]}
{"id":"az-ccvg","title":"Add getEpicWithChildren method to BeadsClient","description":"Add method to BeadsClient:\n```typescript\ngetEpicWithChildren: (epicId: string, cwd?: string) =\u003e\n  Effect.Effect\u003c{ epic: Issue; children: ReadonlyArray\u003cDependencyRef\u003e }, BeadsError | ParseError | NotFoundError\u003e\n```\n\nImplementation:\n- Call `bd show \u003cepicId\u003e --json`\n- Parse with extended schema\n- Extract `dependents` filtered by `dependency_type: \"parent-child\"`\n- Return epic + children","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:02.388922+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:31.353903+11:00","close_reason":"Added getEpicWithChildren method to BeadsClient - fetches epic and filters dependents by parent-child type","dependencies":[{"issue_id":"az-ccvg","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:22.095947+11:00","created_by":"daemon"},{"issue_id":"az-ccvg","depends_on_id":"az-xqvh","type":"blocks","created_at":"2025-12-19T01:43:47.801368+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ce9","title":"how do we track context? do we watch this bit in claude code somehow?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:36.741749+11:00","updated_at":"2025-12-18T01:11:36.741749+11:00"}
{"id":"az-cgf","title":"Add VC command input mode (:)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-14T01:05:15.626687+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T01:10:33.962738+11:00","dependencies":[{"issue_id":"az-cgf","depends_on_id":"az-f4q","type":"blocks","created_at":"2025-12-14T01:05:21.400864+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-cktn","title":"when we manually and deliberately delete a bead with space D we should immediately sync that","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:39:04.318158+11:00","updated_at":"2025-12-18T13:39:04.318158+11:00"}
{"id":"az-cl1","title":"Add concurrency limit config for parallel sessions","description":"Add configuration option to limit maximum number of parallel Claude sessions.\n\nInspiration: AutoMaker's maxConcurrency setting with canStartNewTask check.\n\nImplementation:\n1. Add maxConcurrency to config schema (default: unlimited or 5)\n2. Check limit in SessionManager before starting new session\n3. Show visual indicator when at capacity\n4. Optionally queue pending starts when limit reached\n5. Display running/max in status bar (e.g., '3/5 sessions')","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:04Z","updated_at":"2025-12-16T12:00:04Z"}
{"id":"az-cqqj","title":"still seeing sync failed","description":"failed to parse json... we already know bd sync doesnt output json and so we shouldnt json.parse sync output right?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:36:32.970544+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T14:23:57.721217+11:00","close_reason":"Fixed: Changed sync() and syncImportOnly() to use runBdDirect() which skips the --json flag, since bd sync doesn't output JSON. Methods now return void instead of attempting to parse non-existent JSON output.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-cs0","title":"when performing left/right actions keep action mode active. otherwise return to normal mode immediately","description":"currently if i space S action mode remains until the toast appears instead of returning to normal mode as soon as i press \"S\". this is just an example","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:15:17.592791+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T14:15:21.967725+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-csh","title":"when a title is too long truncate it so the text doesnt overflow","notes":"Working on adding title truncation to TaskCard.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:27:43.068828+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T00:47:49.957663+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-cxow","title":"Integrate orchestration in App.tsx","description":"Update App.tsx to render OrchestrationOverlay when in orchestrate mode:\n\n1. Import OrchestrationOverlay and orchestrate atoms\n2. Add orchestrate mode detection to render logic\n3. Render OrchestrationOverlay with props from atoms\n4. Ensure keyboard events route to orchestrate mode handlers\n\nTest the full flow:\n- Enter on epic ‚Üí detail panel\n- Press 'o' ‚Üí orchestration overlay\n- Navigate, select, confirm\n- Verify spawn toast appears","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:06.779395+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:43.312283+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-cxow","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:27.173174+11:00","created_by":"daemon"},{"issue_id":"az-cxow","depends_on_id":"az-f1j7","type":"blocks","created_at":"2025-12-19T01:43:52.458704+11:00","created_by":"daemon"},{"issue_id":"az-cxow","depends_on_id":"az-8ivo","type":"blocks","created_at":"2025-12-19T01:43:53.055371+11:00","created_by":"daemon"},{"issue_id":"az-cxow","depends_on_id":"az-ek3m","type":"blocks","created_at":"2025-12-19T01:43:53.611806+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-cyra","title":"allow pasting into text input","description":"specifically not worknig when using C keybind to create task with ai, that text prompt should accept cmd v to paste","design":"## Implementation Plan: Allow Pasting into Text Input\n\n### Problem Analysis\nOpenTUI's `useKeyboard` hook only subscribes to `keypress` and `keyrelease` events. However, terminal paste (Cmd+V or bracketed paste) is handled via a separate `paste` event with `PasteEvent` type in OpenTUI's `KeyHandler` class.\n\nCurrent text input components (ClaudeCreatePrompt, PlanningOverlay, CreateTaskPrompt, etc.) use `useKeyboard` which never receives paste content.\n\n### Solution\nCreate a new `usePaste` hook following OpenTUI's pattern:\n\n1. **Create `/src/ui/hooks/usePaste.ts`**\n   - Similar pattern to `useKeyboard` from OpenTUI\n   - Subscribe to `paste` event from `keyHandler`\n   - Handler receives `PasteEvent` with `text: string` property\n   - Export from hooks index\n\n2. **Update text input components to use `usePaste`**\n   - `ClaudeCreatePrompt.tsx` - AI task creation prompt\n   - `PlanningOverlay.tsx` - Planning description input\n   - `CreateTaskPrompt.tsx` - Manual task creation\n   - Any other components with text input\n\n3. **Implementation details**\n   - `usePaste((event) =\u003e setDescription(prev =\u003e prev + event.text))`\n   - No need to filter characters - paste content is already sanitized by terminal\n\n### Files to Modify\n- `src/ui/hooks/usePaste.ts` (NEW)\n- `src/ui/hooks/index.ts` (export new hook)\n- `src/ui/ClaudeCreatePrompt.tsx` (add usePaste)\n- `src/ui/PlanningOverlay.tsx` (add usePaste)\n- `src/ui/CreateTaskPrompt.tsx` (add usePaste)\n\n### Verification\n- Test paste with Cmd+V in ClaudeCreatePrompt (C keybind)\n- Verify multi-line paste works correctly\n- Ensure existing keyboard input still works","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T16:24:50.874944+11:00","updated_at":"2025-12-31T17:39:19.877815+11:00","closed_at":"2025-12-31T17:39:19.87782+11:00","close_reason":"Implemented usePaste hook and added paste support to ClaudeCreatePrompt, PlanningOverlay, and CreateTaskPrompt components. Terminal paste events (Cmd+V, bracketed paste) are now handled via OpenTUI's separate PasteEvent system."}
{"id":"az-czq","title":"Tmux popup persists after Ctrl-C when editor was opened via 'c'","description":"When user presses 'c' to create a bead via editor, a tmux popup is spawned. If user Ctrl-C's azedarach before closing the popup, the popup remains orphaned and must be manually dismissed.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.795322+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T21:46:18.162342+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-d19m","title":"lustre_tui: Runtime - main loop, input dispatch, render cycle","description":"The runtime that drives a Lustre TUI application.\n\n## Why Separate from Reconciler\nThe runtime handles the event loop, timing, and lifecycle. Reconciler just converts Elements to Renderables.\n\n## Responsibilities\n1. Initialize terminal (alt screen, raw mode, hide cursor)\n2. Run initial render\n3. Poll for input events\n4. Dispatch events as Lustre messages\n5. Re-render on model changes\n6. Handle cleanup on exit\n7. **Handle signals (SIGINT/SIGTERM) for graceful shutdown**\n\n## API (Gleam)\n```gleam\ntype App(model, msg) {\n  App(\n    init: fn() -\u003e model,\n    update: fn(model, msg) -\u003e model,\n    view: fn(model) -\u003e Element(msg),\n  )\n}\n\ntype Runtime(model, msg)\n\n/// Start the TUI application (blocking)\nfn start(app: App(model, msg)) -\u003e Result(Nil, Error)\n\n/// Start with configuration\nfn start_with_config(app: App(model, msg), config: Config) -\u003e Result(Nil, Error)\n\ntype Config {\n  Config(\n    fps: Int,              // Target frame rate (default 60)\n    alt_screen: Bool,      // Use alternate screen buffer (default True)\n    mouse: Bool,           // Enable mouse events (default False)\n  )\n}\n```\n\n## Implementation\n```gleam\nfn run_loop(runtime: Runtime(model, msg)) -\u003e Result(Nil, Error) {\n  // 1. Check for input or resize events\n  case poll_event(runtime.input_handler) {\n    Some(Key(key)) -\u003e {\n      // 2. Convert to message via view's event handlers\n      case find_handler(runtime.view_tree, key) {\n        Some(msg) -\u003e {\n          // 3. Update model\n          let new_model = runtime.app.update(runtime.model, msg)\n          // 4. Re-render\n          let new_view = runtime.app.view(new_model)\n          render(runtime, new_view)\n          run_loop(Runtime(..runtime, model: new_model, view_tree: new_view))\n        }\n        None -\u003e run_loop(runtime)\n      }\n    }\n    Some(Resize(w, h)) -\u003e {\n      // Handle resize: update dimensions, re-layout, re-render\n      ...\n    }\n    None -\u003e {\n      // No input, continue loop\n      run_loop(runtime)\n    }\n  }\n}\n```\n\n## Signal Handling\n- **SIGINT (Ctrl+C)**: Clean shutdown, restore terminal\n- **SIGTERM**: Same as SIGINT\n- **SIGWINCH**: Handled by resize task (az-otrx)\n\n```gleam\n// On startup, install signal handlers\nfn install_signal_handlers() -\u003e Result(Nil, Error)\n\n// Cleanup function (called on any exit)\nfn cleanup(runtime: Runtime) -\u003e Nil {\n  exit_alt_screen()\n  show_cursor()\n  exit_raw_mode()\n}\n```\n\n## Acceptance Criteria\n- [ ] Terminal initializes correctly (alt screen, raw mode)\n- [ ] Initial render displays correctly\n- [ ] Input events are captured\n- [ ] Messages dispatch to update function\n- [ ] Model changes trigger re-render\n- [ ] Clean shutdown restores terminal\n- [ ] Ctrl+C handling works (graceful exit)\n- [ ] SIGTERM handling works\n- [ ] Resize events trigger re-layout (via az-otrx)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:32:20.13649+11:00","updated_at":"2025-12-28T11:44:02.69659+11:00","labels":["gleam","lustre-tui","runtime"],"dependencies":[{"issue_id":"az-d19m","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.484499+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-7tzh","type":"blocks","created_at":"2025-12-28T11:34:13.336661+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-5xza","type":"blocks","created_at":"2025-12-28T11:34:13.411369+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-zh3y","type":"blocks","created_at":"2025-12-28T11:34:13.488943+11:00","created_by":"daemon"},{"issue_id":"az-d19m","depends_on_id":"az-otrx","type":"blocks","created_at":"2025-12-28T11:43:16.866604+11:00","created_by":"daemon"}]}
{"id":"az-d1bu","title":"i restarted my computer and my tmux sessions died, i thought they would survive","design":"## Session Persistence \u0026 Recovery\n\n### Goal\nAllow users to restart their computer without losing track of Claude sessions. Sessions should automatically recover (default) or offer manual recovery (configurable).\n\n### Architecture\n\n#### 1. Session State Persistence\n- **File:** `.azedarach/sessions.json` (in project root)\n- **Contents:** Map of session ID ‚Üí { beadId, worktreePath, tmuxSessionName, status, createdAt, lastSeen }\n- **Writes:** On session spawn, status change, periodic heartbeat\n- **Reads:** On Azedarach startup\n\n#### 2. Startup Reconciliation\nOn startup:\n1. Load persisted sessions from disk\n2. Query tmux for actual running sessions (`tmux list-sessions`)\n3. Compare: \n   - Persisted but not in tmux ‚Üí \"crashed\" status\n   - In tmux but not persisted ‚Üí \"orphaned\" (ignore or adopt?)\n   - Both match ‚Üí \"alive\", update lastSeen\n\n#### 3. Recovery Modes (Config Option)\n\n```typescript\n// config schema addition\nsessionRecovery: {\n  mode: \"auto\" | \"manual\",  // default: \"auto\"\n  autoRecoveryDelay: number, // ms to wait before auto-recovering, default: 2000\n}\n```\n\n**Auto mode (default):**\n- On startup, after reconciliation, automatically respawn crashed sessions\n- Show toast: \"Recovered 3 sessions\" \n- Small delay (2s default) so user sees what's happening\n\n**Manual mode:**\n- Show crashed sessions in UI with \"crashed\" status indicator\n- Add keybinding `R` (Recover) to respawn selected crashed session\n- Add `Shift+R` to recover ALL crashed sessions\n\n#### 4. Session Respawn\nWhen recovering a crashed session:\n1. Verify worktree still exists (if not, show error)\n2. Verify bead still exists and is open (if closed, skip or warn)\n3. Create new tmux session in same worktree\n4. Run `claude --resume` to continue conversation\n5. Update persisted state with new tmux session name\n\n#### 5. tmux Plugin Recommendation\nDocument in README/docs that users should install:\n- `tmux-resurrect` - for window layout preservation\n- `tmux-continuum` - for automatic periodic saves\n\nThese complement our session recovery but aren't required.\n\n### Implementation Steps\n1. Create `SessionPersistenceService` - handles read/write of sessions.json\n2. Add `persistSession()` call to session spawn flow\n3. Add `reconcileSessions()` to startup flow  \n4. Add \"crashed\" status to session state model\n5. Implement auto-recovery in startup (with configurable delay)\n6. Add manual recovery keybinding `R` / `Shift+R`\n7. Add config schema for `sessionRecovery.mode`\n8. Update docs with tmux plugin recommendations\n\n### Edge Cases\n- Worktree deleted while crashed ‚Üí show error, offer to close bead\n- Bead closed while session crashed ‚Üí skip recovery, clean up persisted state\n- Multiple crashes of same session ‚Üí don't stack recovery attempts\n- Orphaned tmux sessions (not in our state) ‚Üí ignore, user's responsibility","acceptance_criteria":"## Acceptance Criteria\n\n### Session Persistence\n- [x] Sessions are persisted to `.azedarach/sessions.json` (already existed)\n- [x] \"crashed\" state added to SessionState type\n\n### Crash Detection\n- [x] `listActive()` detects persisted sessions whose tmux died\n- [x] Sessions in \"initializing\", \"busy\", \"waiting\", \"paused\", \"warning\" states are detected\n- [x] Crashed sessions shown with üíÄ indicator\n\n### Recovery Methods\n- [x] `recoverSession(beadId)` method added to ClaudeSessionManager\n- [x] Uses `claude --resume` to continue conversation\n- [x] Verifies worktree still exists before recovery\n\n### Auto-Recovery (Default)\n- [x] On startup, crashed sessions are automatically recovered\n- [x] Configurable delay (default 2s) before recovery starts\n- [x] Logs recovery progress\n\n### Manual Recovery (Configurable)\n- [x] Config option: `sessionRecovery.mode: \"auto\" | \"manual\"`\n- [x] Keybindings: `Shift+R` recover selected, `Ctrl+R` recover all\n- [x] Toast notifications for recovery status\n\n### Config Schema\n- [x] `sessionRecovery.mode` - \"auto\" (default) or \"manual\"\n- [x] `sessionRecovery.autoRecoveryDelayMs` - delay before auto-recovery (default 2000)\n\n### Build\n- [x] Type-check passes\n- [x] Build succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T15:22:43.089997+11:00","updated_at":"2025-12-31T16:17:59.804967+11:00","closed_at":"2025-12-31T16:17:59.804967+11:00","close_reason":"Implemented session recovery for computer restarts. Sessions now auto-recover (or can be manually recovered) using `claude --resume` to continue conversations."}
{"id":"az-d1v","title":"look into how tools like ccmonitor keep track of token/context usage","description":"https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/tree/main\nthey may have a better way than we currently use to track context usage in a session","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T00:28:23.974311+11:00","updated_at":"2025-12-18T00:28:23.974311+11:00"}
{"id":"az-d2x6","title":"review keybind decisions","description":"see if keybinds are still good or if we need to overhaul them with more modifiers or secondary menu layers e.g. space , opens a secondary menu layer, more of the action menus could be nested like that","design":"# Keybind Review - Comprehensive Analysis\n\n## 1. Current Keybind Philosophy\n\nAzedarach follows **Helix-style modal editing** with these principles:\n\n1. **Modal isolation** - Each mode has its own keybind namespace (no cross-mode conflicts)\n2. **Single-letter mnemonics** - Actions use memorable single letters (s=start, a=attach, p=pause)\n3. **Modifier consistency** - Shift variants for \"enhanced\" actions (s=start, S=start+work)\n4. **Data-driven bindings** - All keybindings defined in `bindings.ts` with descriptions\n5. **Escape always exits** - Universal pattern across all modes\n\n## 2. Current State Assessment\n\n### Mode Inventory\n\n| Mode | Keys Used | Remaining Capacity | Status |\n|------|-----------|-------------------|--------|\n| **normal** | 18 keys | ~8 single letters | üü° Moderate |\n| **action** | 18 keys | ~8 single letters | üü° Moderate |\n| **filter** | 22 keys | Very few | üî¥ Crowded (but well-organized) |\n| **goto** | 6 keys | Many | üü¢ Comfortable |\n| **sort** | 3 keys | Many | üü¢ Comfortable |\n| **select** | 10 keys | Many | üü¢ Comfortable |\n| **orchestrate** | 8 keys | Many | üü¢ Comfortable |\n\n### What's Working Well\n\n1. **Status bar hints** - Shows context-sensitive keybinds per mode with \"? more\" overflow\n2. **Help overlay** - `?` shows grouped keybindings (though incomplete)\n3. **Mnemonic scheme** - Most keys are intuitive (s/S/! for session start variants)\n4. **Filter sub-menus** - Good pattern: s‚Üístatus, p‚Üípriority, then value toggles\n\n### Keybind Conflicts/Issues Found\n\n- **None critical** - No actual conflicts between modes\n- **Help overlay incomplete** - Missing: filter mode details, Tab, f (filter), d (diagnostics)\n- **d key overload** - Normal mode: diagnostics. Action mode: cleanup worktree. Filter mode: closed status\n\n## 3. Future Pain Points\n\n### Action Mode (Space menu) Will Hit Limits First\n\nCurrently 18 bindings. Remaining single letters: b, j, k, n, o, q, t, u, w, y, z\n\n**Likely future actions needing keys:**\n- Dependency management (add/remove deps)\n- Label management\n- Priority quick-change\n- Status quick-change (without moving columns)\n- Duplicate task\n- Archive vs delete\n\n### Filter Mode Is Already Dense\n\n22 bindings but well-organized via sub-menus. Pattern works but adding new filter dimensions (labels, assignee) would require more sub-menus.\n\n## 4. Proposed Solutions\n\n### A. Space+, Secondary Menu (Recommended)\n\nAdd `,` as a keybinding within action mode that opens a nested menu:\n\n```\nSpace ‚Üí Action Mode (primary actions)\n  ‚îú‚îÄ‚îÄ s/S/! - Session start variants\n  ‚îú‚îÄ‚îÄ a/A - Attach variants  \n  ‚îú‚îÄ‚îÄ p/r/x - Pause/Resume/Stop\n  ‚îú‚îÄ‚îÄ e/E - Edit variants\n  ‚îú‚îÄ‚îÄ h/l - Move left/right\n  ‚îú‚îÄ‚îÄ i - Attach image\n  ‚îî‚îÄ‚îÄ , ‚Üí Secondary Menu (git/PR operations)\n        ‚îú‚îÄ‚îÄ f - Show diff (was Space+f)\n        ‚îú‚îÄ‚îÄ P - Create PR (was Space+P)\n        ‚îú‚îÄ‚îÄ m - Merge to main (was Space+m)\n        ‚îú‚îÄ‚îÄ M - Abort merge (was Space+M)\n        ‚îú‚îÄ‚îÄ d - Delete worktree (was Space+d)\n        ‚îî‚îÄ‚îÄ D - Delete bead (was Space+D)\n```\n\n**Rationale:** Git/PR operations are less frequent than session management. Nesting them frees up prime keys (f, m, d, P) for future high-frequency actions.\n\n### B. Goto Mode Extensions\n\n`goto` mode has capacity. Could add:\n- `gd` ‚Üí Go to dependencies view\n- `ga` ‚Üí Go to assignee filter\n- `gt` ‚Üí Go to type filter\n\n### C. Quick-Action Keys in Normal Mode\n\nReserved letters in normal mode: b, m, n, o, p, r, s, w, x, y, z\n\nCould use for one-key shortcuts to common operations:\n- `o` ‚Üí Quick open (same as Enter?)\n- `n` ‚Üí New task (same as c?)\n- `x` ‚Üí Quick close task\n\n**Recommendation:** Don't add these yet. Keep normal mode sparse for navigation.\n\n## 5. Discoverability Assessment\n\n### Current State\n\n| Feature | Status | Notes |\n|---------|--------|-------|\n| **Status bar hints** | ‚úÖ Good | Context-sensitive, responsive width handling |\n| **Help overlay (?)** | ‚ö†Ô∏è Incomplete | Missing filter details, some actions |\n| **Mode indicators** | ‚úÖ Good | NOR/ACT/GTO/etc with colors |\n| **Action palette** | ‚úÖ Good | Shows available actions with availability |\n\n### Recommendations\n\n1. **Update HelpOverlay.tsx** - Add missing sections for filter mode, diagnostics, Tab toggle\n2. **Add \"? more\" expansion** - Pressing `?` from status bar could show full keybind list\n3. **Consider whichkey-style** - After timeout in goto/action mode, show available completions\n\n## 6. Implementation Priority\n\n1. **Low effort, high value:**\n   - Update HelpOverlay with missing keybindings\n   - Add filter mode section to help\n\n2. **Medium effort, future-proofing:**\n   - Implement Space+, secondary menu pattern\n   - Move git/PR actions there\n   - Document the pattern for future growth\n\n3. **Optional polish:**\n   - Whichkey-style popup after key timeout\n   - Configurable keybindings (user rebinding)\n\n## 7. Decision: Should We Refactor Now?\n\n**Recommendation: No immediate refactor needed.**\n\nThe current system has room to grow. The Space+, pattern should be implemented when:\n- Action mode needs \u003e3 more keybindings, OR\n- User feedback indicates discoverability issues with current action menu\n\n**Document this review** in CLAUDE.md or internal-docs for future reference.","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Review design notes and confirm alignment with project vision\n- [ ] Decide: Implement Space+, now or defer until needed?\n- [ ] If implementing: Create follow-up task for Space+, secondary menu\n- [ ] Update HelpOverlay.tsx with missing keybindings (filter mode, etc.)\n- [ ] Add this keybind philosophy to internal-docs for future reference","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:15:13.916786+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:38:55.583242+11:00","close_reason":"Comprehensive keybind review completed. Documented current philosophy, identified future pain points (Action mode will hit capacity first), proposed Space+, secondary menu pattern for when needed. Quick win implemented: HelpOverlay.tsx updated with full keybinding coverage (Sort mode, Filter mode, and missing General keys added).","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-d5q","title":"Help overlay with keybinding reference","description":"Contextual help overlay showing available commands.","design":"- Toggle with '?' key\n- Show all keybindings grouped by category\n- Context-aware: highlight actions valid for selected task\n- Dismiss with any key or Escape\n- Include version info","notes":"Created HelpOverlay component with Catppuccin-themed modal showing all keybindings grouped by category (Navigation, Modes, Select Mode, Action Mode, General). Added '?' keybind to App.tsx to toggle the help overlay. The overlay dismisses on any key press. Successfully type-checked with no errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.840117+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T01:29:02.41928+11:00","dependencies":[{"issue_id":"az-d5q","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.144875+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-d8c8","title":"Migrate status bar to use proper bubbletea patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:18:30.472754+11:00","updated_at":"2026-01-05T02:22:58.39814+11:00","closed_at":"2026-01-05T02:22:58.39814+11:00","close_reason":"Removed Padding(0,1) from StatusBar style in styles.go to eliminate extra vertical space below the status bar.","dependencies":[{"issue_id":"az-d8c8","depends_on_id":"az-0n59","type":"discovered-from","created_at":"2026-01-05T02:18:35.943566+11:00","created_by":"riordan"}]}
{"id":"az-d8p4","title":"we should copy over .direnv to new worktrees so we dont have to wait for nix flake cache refresh","design":"## Context\nWhen Azedarach creates new git worktrees for parallel Claude sessions, the `.direnv` directory (which contains Nix flake evaluation caches) is not copied because it's gitignored. This means each new worktree must re-evaluate the flake from scratch, which can take significant time.\n\n## Implementation Plan\nAdd `.direnv` directory copying to `WorktreeManager.create()`:\n\n1. **Location**: `src/core/WorktreeManager.ts`\n2. **Add helper function** `copyDirenvCache()`:\n   - Similar pattern to existing `copyClaudeLocalSettings()`\n   - Check if source `.direnv` exists\n   - Copy entire directory recursively using `fs.copy()`\n   - Non-fatal: log warning on failure, don't block worktree creation\n\n3. **Call from create()**: After worktree is created (after line 547), call `copyDirenvCache()`\n\n## Technical Notes\n- Uses `FileSystem.copy()` from `@effect/platform` for recursive directory copy\n- Matches error handling pattern of `copyClaudeLocalSettings` (catchAll ‚Üí warning)\n- No user-facing config needed - always copy if `.direnv` exists","acceptance_criteria":"- [ ] New worktrees have `.direnv` copied from main project\n- [ ] If `.direnv` doesn't exist in source, no error occurs\n- [ ] If copy fails, worktree creation continues with warning logged\n- [ ] Type-check passes: `bun run type-check`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:43:45.268742+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T12:46:53.711866+11:00","close_reason":"Implemented copyDirenvCache helper in WorktreeManager that copies .direnv directory to new worktrees after creation. Uses same error-handling pattern as copyClaudeLocalSettings - logs warning on failure but doesn't block worktree creation.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-d8z","title":"Session Management","description":"Core orchestration layer: git worktrees, tmux sessions, Claude spawning, state detection, and file locking to prevent concurrent access.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.762911+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:33:37.439444+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"az-da6y","title":"issue attaching to session","notes":"üìé [mjycc00f-58n3.png](.beads/images/az-da6y/mjycc00f-58n3.png) (clipboard, 1/4/2026, 12:30:40 AM)\nüìé [mjycc7za-enxj.png](.beads/images/az-da6y/mjycc7za-enxj.png) (clipboard, 1/4/2026, 12:30:50 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T00:30:32.837178+11:00","updated_at":"2026-01-05T11:42:23.180336+11:00","closed_at":"2026-01-05T11:42:23.180339+11:00"}
{"id":"az-ddcn","title":"virtual list in git diff is not filling available area","design":"## Problem Analysis\n\nThe FilePicker component in the git diff viewer uses a hardcoded `DEFAULT_MAX_VISIBLE = 20`, but the dialog occupies 90% of terminal height. This results in the virtual list only showing 20 items even when there's room for 40+ items.\n\nLooking at the screenshot:\n- Dialog shows \"Changed Files (151)\" \n- Only ~20 files are visible\n- Large empty area below the list\n- Status bar shows \"7/151 +131\" indicating virtual scroll is working but with wrong size\n\n## Root Cause\n\nIn `FilePicker.tsx`:\n```typescript\nconst DEFAULT_MAX_VISIBLE = 20\n\nexport const FilePicker = ({\n  maxVisible = DEFAULT_MAX_VISIBLE, // Hardcoded default\n  ...\n}) =\u003e { ... }\n```\n\nThe `DiffViewer` doesn't pass `maxVisible` prop, so it always uses 20.\n\n## Implementation Plan\n\n1. **Calculate available height in DiffViewer.tsx**\n   - Use `process.stdout.rows` (same pattern as DetailPanel.tsx)\n   - Calculate: `dialogHeight = terminalRows * 0.9`\n   - Subtract chrome: header (2 lines), status bar (2 lines), FilePicker header (3 lines), scroll indicator (2 lines) ‚âà 9 lines total\n   - Pass calculated `maxVisible` to FilePicker\n\n2. **Update DiffViewer to pass maxVisible prop**\n   ```typescript\n   const maxVisibleFiles = useMemo(() =\u003e {\n     const terminalRows = process.stdout.rows || 24\n     const dialogHeight = Math.floor(terminalRows * 0.9)\n     const chromeHeight = 9 // header + status + picker chrome\n     return Math.max(5, dialogHeight - chromeHeight)\n   }, [])\n   ```\n\n3. **Pass to FilePicker component**\n   ```typescript\n   \u003cFilePicker\n     maxVisible={maxVisibleFiles}\n     // ... other props\n   /\u003e\n   ```\n\n## Files to Modify\n\n- `src/ui/DiffViewer/DiffViewer.tsx` - Add maxVisible calculation and pass to FilePicker\n\n## Testing\n\n1. Run `bun run dev`\n2. Open diff viewer on a bead with many changed files (or the target repo)\n3. Verify the file list fills the available vertical space\n4. Resize terminal and verify it adapts","notes":"üìé [mjshw81s-2ies.png](.beads/images/az-ddcn/mjshw81s-2ies.png) (clipboard, 12/30/2025, 10:19:44 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T22:19:37.107888+11:00","updated_at":"2025-12-30T22:36:56.625794+11:00","closed_at":"2025-12-30T22:36:56.6258+11:00","close_reason":"Fixed by passing dynamically calculated maxVisible to FilePicker based on terminal height. Uses useTerminalDimensions hook to get current terminal size, calculates 90% for dialog, subtracts chrome (headers, status bar) to get available list area."}
{"id":"az-dhpf","title":"indicator to card if a PR exists for it","description":"and if so, space P should open the pr in your browser","design":"## Implementation Plan\n\n### Goal\nShow a üîó indicator on TaskCards when a PR exists for that task, and make Space+P open the existing PR in browser instead of creating a new one.\n\n### Architecture\n\n**PR State Tracking:**\n- Add `prInfo?: { url: string; number: number; draft: boolean }` to `TaskWithSession` type\n- Use `PRWorkflow.getPR()` in `BoardService` refresh cycle to check for PRs\n- Cache PR info per task to avoid excessive GitHub API calls\n- Refresh PR state every board refresh (2 seconds) with debouncing\n\n**UI Changes:**\n- TaskCard header line: add üîó indicator after type when `prInfo` exists\n- Show draft indicator with different color (e.g., üîó gray for draft, üîó blue for ready)\n\n**Action Changes:**\n- PRHandlersService.createPR(): \n  - First check if PR exists using `prWorkflow.getPR()`\n  - If exists ‚Üí open browser with `open \u003curl\u003e` (macOS) or show toast with URL\n  - If not ‚Üí create new PR (current behavior)\n\n### Files to Modify\n1. `src/ui/types.ts` - Add prInfo to TaskWithSession\n2. `src/services/BoardService.ts` - Fetch PR info during refresh\n3. `src/ui/TaskCard.tsx` - Display üîó indicator\n4. `src/services/keyboard/PRHandlersService.ts` - Check for existing PR\n\n### Acceptance Criteria\n- [ ] TaskCard shows üîó when PR exists for that task\n- [ ] Space+P on task with existing PR opens browser to PR page\n- [ ] Space+P on task without PR creates new PR (unchanged behavior)\n- [ ] PR state updates on board refresh (not stale)","acceptance_criteria":"- [x] TaskCard shows üîó when PR exists for that task\n- [x] Space+P on task with existing PR opens browser to PR page  \n- [x] Space+P on task without PR creates new PR (unchanged behavior)\n- [x] PR state updates on board refresh (cached per-task, refreshes when session list changes)","notes":"Implementation complete. Key files changed:\n- `src/ui/types.ts` - Added PRInfo type and prInfo field to TaskWithSession\n- `src/services/BoardService.ts` - Added PR cache and fetching in loadTasks()\n- `src/ui/TaskCard.tsx` - Shows üîó indicator in header line\n- `src/services/keyboard/PRHandlersService.ts` - Space+P checks for existing PR, opens browser if found\n- `docs/keybindings.md` - Updated documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:26:58.402898+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T01:29:12.259649+11:00","close_reason":"Feature implemented and committed. Task cards now show üîó indicator when PR exists, and Space+P opens existing PR in browser.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-dl1","title":"Add detail level toggle for cards","description":"Add toggle to switch between minimal/standard/detailed card views.\n\nInspiration: AutoMaker's three-level detail toggle.\n\nLevels:\n- Minimal: ID + title only (fits more tasks on screen)\n- Standard: Current view (ID, title, priority, status indicator)\n- Detailed: Add description preview, session metrics, context health\n\nImplementation:\n1. Add detailLevel to ViewService (minimal/standard/detailed)\n2. Add 'd' key to cycle through levels\n3. Adjust TaskCard rendering based on level\n4. Persist preference in config","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:02Z","updated_at":"2025-12-16T12:00:02Z"}
{"id":"az-dn2","title":"we keep losing beads in the tui when doing stuff like killing other bead's sessions etc","description":"the following log may be related:\ntimestamp=2025-12-16T13:19:15.063Z level=WARN fiber=#1356 message=\"Sync failed for az-31i: ParseError: Failed to parse JSON: SyntaxError: JSON Parse error: Unrecognized token '‚Üí'\"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:04.341522+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T01:02:07.4346+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-dp47","title":"Add epic drill-down to DetailPanel","description":"When DetailPanel displays an epic, show its children:\n\n1. Add atom to fetch children when detail overlay opens on an epic\n2. Display children section in DetailPanel:\n   - Header: \"Children (N):\"\n   - List: id, title, status, session indicator\n   - Hint: \"Press 'o' to orchestrate parallel workers\"\n3. Style: status-based colors, session indicators for active sessions\n\nThis is the prerequisite for orchestration mode - users need to see children before they can orchestrate them.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:02.932675+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:43.283757+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-dp47","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:22.744482+11:00","created_by":"daemon"},{"issue_id":"az-dp47","depends_on_id":"az-ccvg","type":"blocks","created_at":"2025-12-19T01:43:48.344657+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-dpi","title":"Integrate Agent Mail with SessionManager","description":"Wire Agent Mail into session lifecycle for automatic reservation management.\n\nDesign:\n- SessionManager.start() calls agentMail.reserve() before worktree creation\n- SessionManager.stop() calls agentMail.release() after cleanup\n- SessionManager.pause() keeps reservation but updates status\n- Add reservation info to Session type\n- Fail session start if issue already reserved by another agent\n- Handle reservation conflicts gracefully\n- Update Kanban board to show reservation status (who owns what)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.738474+11:00","updated_at":"2025-12-12T10:33:13.738474+11:00","dependencies":[{"issue_id":"az-dpi","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.870895+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dpi","depends_on_id":"az-4r0","type":"blocks","created_at":"2025-12-12T10:33:21.939099+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-dpi","depends_on_id":"az-tgc","type":"blocks","created_at":"2025-12-12T10:33:21.972727+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-dqt","title":"Extend TaskWithSession type with session metrics","description":"Extend TaskWithSession interface with optional session metrics: contextPercent (0-100), sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput. This is the foundation for other session metrics features.","notes":"Session 2025-12-12: Created from Claude Code best practices research.\n\nRESEARCH CONTEXT:\n- 6 parallel research agents analyzed: Anthropic blog, Reddit, latest features, orchestration tools, CLAUDE.md patterns, real-world usage\n- Key finding: Context % monitoring is critical - users hit auto-compact (95%) unexpectedly\n- Key finding: MCP servers consume 55K-134K tokens before conversation starts\n- Design: Use progressive disclosure - border colors for at-a-glance, DetailPanel for full metrics\n\nUI DESIGN DECISIONS:\n- Border color encodes context health: lavender (\u003c70%), yellow (70-90%), red (\u003e90%)\n- Only show metrics when session is active (not idle)\n- Extend existing TaskWithSession type (no new components needed)\n\nIMPLEMENTATION NOTES:\n- Add: contextPercent, sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput\n- All fields optional (populated when session active)\n- This is foundation - unblocks az-6la, az-5p5, az-2ek, az-c9y\n\nNEXT STEP: Implement type changes in src/ui/types.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T13:25:00.109541+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-13T00:58:21.053672+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-dv9t","title":"read hook error","description":"Claude Code hooks call `az notify` but the `az` command isn't in /bin/sh's PATH. Error: \"Stop hook error: Failed with non-blocking status code: /bin/sh: az: command not found\". Need to use absolute path in generated hook config.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:05:15.520227+11:00","updated_at":"2025-12-20T01:46:58.532728+11:00","close_reason":"Fixed: Hook commands now use absolute path `bun run \"/abs/path/to/bin/az.ts\"` instead of `az`","comments":[{"id":9,"issue_id":"az-dv9t","author":"riordan","text":"May have misunderstood the issue - need to clarify if it's about hook failures","created_at":"2025-12-18T03:15:15Z"}],"deleted_at":"2025-12-20T01:46:58.532728+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-dvsr","title":"Dev server integration (Space+r)","description":"Add ability to spawn and manage dev servers from Azedarach.\n\n**Inspiration:** Vibe Kanban lets users launch dev servers and monitor them.\n\n**Features:**\n- Space+r in action mode to start dev server\n- Spawn in dedicated tmux pane (not session pane)\n- Parse port from output, show URL in status bar\n- Toggle to kill server\n- Auto-cleanup on exit\n\n**Command Detection (priority order):**\n1. Config override: `devServer.command` if set\n2. package.json scripts: check for `dev`, `start`, `serve`\n3. Lock file detection:\n   - bun.lockb ‚Üí `bun run dev`\n   - pnpm-lock.yaml ‚Üí `pnpm run dev`\n   - yarn.lock ‚Üí `yarn dev`\n   - package-lock.json ‚Üí `npm run dev`\n4. Fallback: `npm run dev`\n\n**Config (azedarach.json):**\n```json\n{\n  \"devServer\": {\n    \"command\": \"bun run dev:local\",\n    \"portPattern\": \"localhost:(\\\\d+)\",\n    \"cwd\": \".\"\n  }\n}\n```\n\n**Implementation:**\n- Add DevServerService to manage lifecycle\n- StatusBar shows: localhost:3000 when running\n- Space+r toggles: start if stopped, stop if running\n\n**UI:**\n- ActionPalette: \"dev server\" action\n- StatusBar: port indicator when running\n- Toast on start/stop","design":"## Revised Implementation Plan (2025-12-19)\n\n### Key Design Changes from Original\n\n1. **Worktree-scoped, not project-scoped**: Each worktree gets its own dev server with port injection\n2. **Multi-port support**: Can inject multiple env vars (PORT, VITE_PORT, VITE_SERVER_PORT, etc.)\n3. **Keybinding**: `Space+r` for dev server, `Space+R` (shifted) for resume session\n4. **tmux sessions** (not windows): Consistent with Claude/VC pattern\n\n### Architecture Overview\n\nDevServerService manages per-worktree dev server lifecycles via tmux sessions.\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DevServerService (Effect.Service)            ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ State (SubscriptionRef):                                        ‚îÇ\n‚îÇ   - servers: Map\u003cbeadId, DevServerState\u003e                        ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îÇ DevServerState:                                                 ‚îÇ\n‚îÇ   - status: \"idle\" | \"starting\" | \"running\" | \"error\"           ‚îÇ\n‚îÇ   - port: number | undefined (primary port for display)         ‚îÇ\n‚îÇ   - tmuxSession: string | undefined                             ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îÇ Methods:                                                        ‚îÇ\n‚îÇ   - toggle(beadId): start if idle, stop if running              ‚îÇ\n‚îÇ   - start(beadId, worktreePath): spawn server, poll for port    ‚îÇ\n‚îÇ   - stop(beadId): kill tmux session, update state               ‚îÇ\n‚îÇ   - getStatus(beadId): get current state                        ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Port Allocation Strategy\n\n```\naz-123 ‚Üí basePort 3001 ‚Üí PORT=3001, VITE_PORT=3001, VITE_SERVER_PORT=4001\naz-456 ‚Üí basePort 3002 ‚Üí PORT=3002, VITE_PORT=3002, VITE_SERVER_PORT=4002\naz-789 ‚Üí basePort 3003 ‚Üí PORT=3003, VITE_PORT=3003, VITE_SERVER_PORT=4003\n```\n\n- Base port starts at 3001 (reserve 3000 for main project)\n- Each worktree gets next available base port\n- Additional ports use offsets (e.g., server port = base + 1000)\n\n### Config Schema\n\n```typescript\nconst DevServerConfigSchema = Schema.Struct({\n  command: Schema.optional(Schema.String),           // Override command\n  ports: Schema.optional(Schema.Record({             // Env var ‚Üí port offset\n    key: Schema.String, \n    value: Schema.Number \n  })),\n  basePort: Schema.optional(Schema.Number),          // Starting port (default: 3001)\n  portPattern: Schema.optional(Schema.String),       // Regex for port extraction\n  cwd: Schema.optional(Schema.String),               // Working directory\n})\n\n// Example config for full-stack app:\n{\n  \"devServer\": {\n    \"command\": \"bun run dev\",\n    \"ports\": {\n      \"PORT\": 0,\n      \"VITE_PORT\": 0,\n      \"VITE_SERVER_PORT\": 1000\n    }\n  }\n}\n```\n\n### Default Behavior (no config)\n\n```typescript\nconst DEFAULTS = {\n  ports: { PORT: 0 },           // Just inject PORT\n  basePort: 3001,\n  portPattern: \"localhost:(\\\\d+)|127\\\\.0\\\\.0\\\\.1:(\\\\d+)\"\n}\n```\n\n### Keybinding Changes\n\n| Key | Mode | Action |\n|-----|------|--------|\n| `Space+r` | action | Toggle dev server (start/stop) for worktree |\n| `Space+R` | action | Resume paused session (moved from `r`) |\n\n### tmux Session Naming\n\nFormat: `az-dev-{beadId}` (e.g., `az-dev-az-123`)\n\n### StatusBar Integration\n\nWhen a bead with running dev server is selected:\n```\nDEV: localhost:3001\n```\n\nWhen starting:\n```\nDEV: starting...\n```\n\n### File Changes\n\n1. **`src/config/schema.ts`** - Add DevServerConfigSchema\n2. **`src/services/DevServerService.ts`** - NEW FILE\n3. **`src/services/keyboard/bindings.ts`** - `r`‚Üídev server, `S-r`‚Üíresume\n4. **`src/ui/atoms/runtime.ts`** - Add DevServerService.Default\n5. **`src/ui/atoms/devServer.ts`** - NEW FILE\n6. **`src/ui/StatusBar.tsx`** - Add dev server indicator\n7. **`src/ui/App.tsx`** - Wire up devServerStatusAtom\n\n### Error Handling\n\n- No worktree exists ‚Üí Toast error \"Start a session first\"\n- Command fails ‚Üí Toast error, set status to \"error\"\n- Port detection timeout ‚Üí Keep \"running\" without port display","acceptance_criteria":"### Acceptance Criteria\n\n**Functional:**\n- [ ] Space+\u003ckey\u003e in action mode toggles dev server for current project\n- [ ] Dev server runs in dedicated tmux window (not pane)\n- [ ] Window is named `az-dev-\u003cprojectName\u003e` for easy identification\n- [ ] Port is detected from output within 30 seconds\n- [ ] StatusBar shows \"DEV: localhost:3000\" when running with detected port\n- [ ] StatusBar shows \"DEV: starting...\" during startup\n- [ ] Pressing toggle again stops the server (kills tmux window)\n- [ ] Toast notification on start/stop/error\n- [ ] Multiple projects can have independent dev servers\n\n**Command Detection:**\n- [ ] Respects `devServer.command` in azedarach.json config\n- [ ] Falls back to package.json scripts (dev ‚Üí start ‚Üí serve)\n- [ ] Detects package manager from lock files\n- [ ] Uses npm as final fallback\n\n**Configuration:**\n- [ ] `devServer.command` overrides auto-detection\n- [ ] `devServer.portPattern` allows custom regex\n- [ ] `devServer.cwd` allows custom working directory\n\n**Cleanup:**\n- [ ] Dev server windows killed on Azedarach exit\n- [ ] State properly tracked if user closes window manually\n\n**Edge Cases:**\n- [ ] Works when no package.json exists (graceful error)\n- [ ] Handles port detection timeout (stays \"running\" without port)\n- [ ] Handles immediate server crash (shows error state)","notes":"PR: ","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T16:00:00+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T19:24:18.771407+11:00","comments":[{"id":13,"issue_id":"az-dvsr","author":"riordan","text":"Feature was designed but never implemented - no DevServerService exists in codebase","created_at":"2025-12-19T00:48:53Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-e0w","title":"board doesn't seem to update when i change sort mode","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T16:48:52.461805+11:00","updated_at":"2025-12-20T01:47:02.922437+11:00","deleted_at":"2025-12-20T01:47:02.922437+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-e3k","title":"do a full report on all the beads flows az uses","description":"i want to know all the ways our app connects with beads/uses the beads cli","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:14:03.324845+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T10:19:39.166353+11:00","close_reason":"Completed full report documenting all 11 bd CLI commands, 17 integration files, and 3 architectural layers (BeadsClient facade, Effect services, UI handlers)","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-e3wr","title":"add configurable background tasks on new sessions","description":"e.g. i want to build types when i start a session in ~/prog/Chefy but i dont want to block anything based on that","notes":"Implementation Plan:\n- Add `backgroundTasks: string[]` to `SessionConfigSchema` in `src/config/schema.ts`.\n- Implement `newWindow(sessionName, windowName, options)` in `src/core/TmuxService.ts`.\n- Update `src/core/WorktreeSessionService.ts` to spawn background windows for each task.\n- Tasks will run `initCommands` followed by the task command and `exec $SHELL`.\n- Group all windows under the same bead-specific tmux session.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:42:48.753219+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T13:40:01.849338+11:00","close_reason":"Implemented configurable background tasks in sessions. Tasks run in separate tmux windows, pre-loaded with initCommands and shell fallback.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-e6z2","title":"when i attach to an epic's child task and it offers to merge it should merge the epic in","description":"not the project's base branch. we need to do a full review of git operations in an epic. everything in an epic should all revolve around using the epic branch as the base","design":"## Implementation Plan\n\n**Problem:** When attaching to an epic child's session, `checkBranchBehindMain` and `mergeMainIntoBranch` incorrectly use `gitConfig.baseBranch` (main) instead of the parent epic's branch.\n\n**Solution:** Use the existing `getBeadBaseBranch` helper in both methods.\n\n### Changes Required\n\n**1. PRWorkflow.ts - `checkBranchBehindMain` (line ~1749)**\n- Add call to `getBeadBaseBranch(beadId)` to get correct base branch\n- Replace hardcoded `gitConfig.baseBranch` with the resolved base branch\n- Return the baseBranch name so callers can show correct UI message\n\n**2. PRWorkflow.ts - `mergeMainIntoBranch` (line ~1793)**\n- Add call to `getBeadBaseBranch(beadId)` to get correct base branch\n- Replace all uses of `gitConfig.baseBranch` with resolved base branch\n- Fetch attempt will gracefully fail for local-only epic branches (existing catchAll handles this)\n\n**3. SessionHandlersService.ts - `attachExternal` (line ~404)**\n- Update to use the baseBranch returned from checkBranchBehindMain\n- Display correct branch name in merge dialog (epic branch instead of \"main\")\n\n### Files Modified\n- `src/core/PRWorkflow.ts`\n- `src/services/keyboard/SessionHandlersService.ts`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:11:44.123285+11:00","updated_at":"2025-12-30T14:23:09.296506+11:00","closed_at":"2025-12-30T14:23:09.296506+11:00","close_reason":"Implemented: checkBranchBehindBase and mergeBaseIntoBranch now use getBeadBaseBranch to determine the correct base branch - parent epic's branch for children, main for standalone tasks"}
{"id":"az-e94l","title":"add support for multiple separate dev servers","description":"so space opens bead action menu, r opens dev server menu, depending on config in .azedarach it shows the options.\ncan configure multiple dev server commands e.g. in chefy we have pnpm dev:server and pnpm dev:web\ncan configure dev command aliases for nice formatting in az\ncan start any/all of the dev commands. can stop any/all of the dev commands\ncan see the ports each one is using","design":"Implementation Plan:\n1. Update schema.ts to support multiple named servers in DevServerConfig.\n2. Refactor DevServerService.ts to manage a map of servers per bead.\n3. Create a DevServerMenu UI component for managing multiple servers.\n4. Update DevServerHandlersService and ActionPalette to integrate the new menu.\n5. Support starting/stopping individual or all servers and viewing their ports.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T13:51:40.489323+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T13:40:19.204818+11:00","close_reason":"Implemented multiple dev server support","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ebxf","title":"tui_core: Text utilities - grapheme width, wrapping, truncation","description":"Handle text measurement and manipulation for proper terminal rendering.\n\n## Why\nTerminals display characters with varying widths:\n- ASCII: 1 cell\n- CJK characters: 2 cells\n- Emoji: 1-2 cells (varies)\n- Zero-width joiners: 0 cells\n\n## API (Gleam)\n```gleam\n/// Get display width of a string in terminal cells\nfn display_width(text: String) -\u003e Int\n\n/// Get display width of a single grapheme\nfn grapheme_width(grapheme: String) -\u003e Int\n\n/// Truncate text to fit in N cells, adding ellipsis if needed\nfn truncate(text: String, max_width: Int, ellipsis: String) -\u003e String\n\n/// Wrap text to fit within max_width, respecting word boundaries\nfn wrap(text: String, max_width: Int) -\u003e List(String)\n\n/// Pad text to exactly N cells\nfn pad_right(text: String, width: Int, char: String) -\u003e String\nfn pad_left(text: String, width: Int, char: String) -\u003e String\nfn pad_center(text: String, width: Int, char: String) -\u003e String\n```\n\n## Implementation Notes\n- Use unicode-width table (or port a lib)\n- Consider using Gleam's grapheme handling\n- Emoji handling is complex - start simple\n\n## Acceptance Criteria\n- [ ] Correctly measure ASCII text width\n- [ ] Handle CJK double-width characters\n- [ ] Truncate with ellipsis correctly\n- [ ] Word-wrap respecting boundaries\n- [ ] Pad text to exact width","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:31:22.295003+11:00","updated_at":"2025-12-29T15:16:03.616292+11:00","closed_at":"2025-12-29T15:16:03.616292+11:00","close_reason":"Implemented tui_core/text.gleam with display_width, truncate, wrap, pad_left/right/center using string_width package.","labels":["foundation","gleam","tui-core"],"dependencies":[{"issue_id":"az-ebxf","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.205467+11:00","created_by":"daemon"},{"issue_id":"az-ebxf","depends_on_id":"az-a0g1","type":"blocks","created_at":"2025-12-28T11:41:51.274213+11:00","created_by":"daemon"},{"issue_id":"az-ebxf","depends_on_id":"az-kwwr","type":"blocks","created_at":"2025-12-28T11:52:29.384581+11:00","created_by":"daemon"}]}
{"id":"az-ee4","title":"Configuration \u0026 Polish","description":"User configuration (cosmiconfig + zod), multi-project support, help system, and final polish.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:05.070257+11:00","updated_at":"2025-12-11T14:44:05.070257+11:00"}
{"id":"az-eei","title":"creating beads with space C (capital) not working","description":"i dont see any errors in log either","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:12.469026+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T01:07:50.693525+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-eemx","title":"use new tmux window per dev server, not panes","description":"that way the system is way more durable, also try to improve durability if you can see any way to do so","design":"## Implementation Plan: Windows Instead of Panes for Dev Servers\n\n### Problem\nCurrent implementation uses tmux panes within a single `dev` window. This is fragile:\n- Pane IDs can become stale\n- If az crashes, tracking which pane belongs to which server is difficult\n- Manual restarts in panes can lose association with server state\n\n### Solution\nUse separate tmux windows named `dev-{serverLabel}` for each dev server.\n\n### Changes Required\n\n#### 1. DevServerService.ts - Core Changes\n- **Window naming**: `dev-{serverName}` instead of shared `dev` window with panes\n  - Example: `dev-frontend`, `dev-api`, `dev-worker`\n- **Remove `splitWindow` logic**: Lines 567-603 currently split panes for multiple servers\n- **Use `ensureWindow` for each server**: Each server gets its own window\n- **Update state tracking**: Replace `paneId` with window-based tracking\n- **Update health checks**: Monitor windows instead of panes (use `hasWindow` instead of `listPanes`)\n- **Update `stop()`**: Use `killWindow` or send Ctrl-C + close window instead of `killPane`\n\n#### 2. TmuxService.ts - Add Missing Methods\n- **`killWindow(target: string)`**: Kill a specific window\n- Possibly: **`selectWindowByName(session, windowName)`** if not covered by existing methods\n\n#### 3. DevServerMetadata Schema Updates\n- Remove `paneId` field (or keep for backwards compat but don't rely on it)\n- Add `windowName` field for clearer tracking\n\n#### 4. Health Check Updates (Lines 417-476)\n- Replace pane existence checks with window existence checks\n- Use `hasWindow(sessionName, windowName)` instead of `listPanes`\n- Port polling remains the same (capture from window target)\n\n#### 5. Discovery/Recovery (Lines 207-234)\n- On startup, scan for `dev-*` windows in bead sessions\n- Reconstruct state from tmux user options + window presence\n\n### Durability Improvements\n1. **Window-based state**: Windows are more stable than panes; window names survive az restarts\n2. **Metadata redundancy**: Store server metadata as tmux session option AND in window\n3. **Port as source of truth**: If port is responding, server is running (regardless of internal state)\n4. **Graceful degradation**: If metadata is missing, detect servers by window name pattern + port polling\n\n### Testing Strategy\n1. Start single dev server ‚Üí verify window created as `dev-{name}`\n2. Start multiple servers ‚Üí verify separate windows created\n3. Kill az process ‚Üí restart ‚Üí verify servers rediscovered\n4. Manual Ctrl-C in server window ‚Üí verify state updates to \"stopped\"\n5. Manual restart in window ‚Üí verify state updates to \"running\"\n\n### Files to Modify\n- `src/services/DevServerService.ts` (main changes)\n- `src/core/TmuxService.ts` (add killWindow if needed)\n- `src/core/paths.ts` (add dev window name helper if useful)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T15:04:47.56107+11:00","updated_at":"2025-12-29T18:06:34.689877+11:00","closed_at":"2025-12-29T18:06:34.689879+11:00","close_reason":"Implemented window-based dev server management: each server now gets its own tmux window (e.g., dev-frontend, dev-api) instead of panes in a shared window. This improves durability by making windows survive az crashes and enabling fallback discovery by scanning for dev-* windows."}
{"id":"az-eh8i","title":"help me figure out what the point of effect atom is","description":"i appreciate some of the features but i cant help but feel i should be doing all the state and state derivation in the effect services layers\nwhat are the use cases where we should do one vs the other?","design":"## Analysis Complete\n\nAfter reviewing the codebase architecture, effect-atom library, and Effect SubscriptionRef docs, here's a comprehensive answer to \"when should state/derivation be in Effect services vs effect-atom atoms?\"\n\n### TL;DR Decision Matrix\n\n| Use Case | Where | Why |\n|----------|-------|-----|\n| Core domain state | Effect Services | Testable, lifecycle-managed, business logic lives here |\n| Polling/background tasks | Effect Services | Scoped fibers, automatic cleanup |\n| React-specific derived state | Atoms (`Atom.readable`) | Parameterized derivation, cross-service composition |\n| Bridge to React | `appRuntime.subscriptionRef()` | Converts SubscriptionRef ‚Üí useAtomValue-compatible |\n| Actions (mutations) | `appRuntime.fn()` | Provides services, lifecycle, error handling |\n\n### effect-atom's Core Value Proposition\n\neffect-atom is NOT a replacement for Effect services - it's specifically a **React integration layer** that:\n\n1. **Provides a Scope for Effect execution** - `appRuntime.atom()` runs Effects with automatic cleanup when React unmounts\n2. **Bridges SubscriptionRef ‚Üí React reactivity** - `appRuntime.subscriptionRef()` subscribes to changes and triggers re-renders\n3. **Parameterized derivations** - `elapsedFormattedAtom(startedAt)` creates per-instance computation unavailable in services\n4. **Cross-service composition** - Atoms can combine data from multiple services without coupling those services\n\n### What effect-atom Does NOT Do\n\n- Doesn't manage fiber lifecycles (that's Effect + scoped services)\n- Doesn't replace SubscriptionRef for state storage (services own state)\n- Doesn't provide business logic home (that's services)\n\n### Current Architecture Is Correct\n\n```\nEffect Services (SubscriptionRef state + business logic)\n       ‚Üì subscriptionRef() bridge\neffect-atom Atoms (derivation + React integration)\n       ‚Üì useAtomValue()\nReact Components (pure render)\n```\n\n### Concrete Examples From Codebase\n\n**‚úÖ Correct: Service owns state, atom bridges to React**\n```typescript\n// Service\nexport class ClockService extends Effect.Service\u003cClockService\u003e()(...) {\n  scoped: Effect.gen(function* () {\n    const now = yield* SubscriptionRef.make\u003cDateTime.Utc\u003e(initial)\n    yield* Effect.scheduleForked(Schedule.spaced(\"1 second\"))(...)\n    return { now }\n  })\n}\n\n// Atom (bridge)\nexport const clockTickAtom = appRuntime.subscriptionRef(\n  Effect.gen(function* () {\n    const clock = yield* ClockService\n    return clock.now  // Returns the SubscriptionRef\n  })\n)\n\n// Atom (parameterized derivation)\nexport const elapsedFormattedAtom = (startedAt: string) =\u003e\n  Atom.readable((get) =\u003e {\n    const nowResult = get(clockTickAtom)\n    if (!Result.isSuccess(nowResult)) return \"00:00\"\n    return computeElapsedFormatted(startedAt, nowResult.value)\n  })\n```\n\n**Why `elapsedFormattedAtom` can't live in the service:**\n- It's parameterized by `startedAt` (different per component instance)\n- It depends on ClockService state but computation is per-consumer\n- This is the sweet spot for atoms: per-consumer derivation\n\n**‚úÖ Correct: Multi-service composition in atom**\n```typescript\nexport const focusedTaskRunningOperationAtom = Atom.readable((get) =\u003e {\n  const focusedIdResult = get(focusedTaskIdAtom)     // NavigationService\n  const stateResult = get(commandQueueStateAtom)     // CommandQueueService\n  // Compose without coupling services\n})\n```\n\n### When You COULD Move Derivation to Services\n\nFor derivations that:\n1. Are NOT parameterized (same for all consumers)\n2. Don't compose across services\n3. Are part of business logic (not presentation)\n\nExample: `filteredTasksByColumn` is computed in BoardService because it's:\n- Not parameterized\n- Core to the board model\n- Used by multiple atoms\n\n### Acceptance Criteria\n\n- [x] Document when to use services vs atoms\n- [x] Explain effect-atom's actual purpose (React integration, not state management)\n- [x] Show parameterized derivation as key atom use case\n- [x] Confirm current architecture is sound","notes":"Completed research task. The architecture is correct - effect-atom serves as a React integration layer, not a replacement for Effect services. Key insight: atoms excel at parameterized derivations and cross-service composition for UI needs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:21:15.448445+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T23:53:11.436442+11:00","close_reason":"Documented effect-atom architecture decision. Created internal-docs/effect-atom-architecture.md with full analysis. Updated CLAUDE.md with critical rule #9 and decision matrix in State Management section.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-eiwd","title":"add offline mode which disables stuff like PR creation, git push/pull etc without breaking the app","description":"Add offline mode that allows Azedarach to work without network connectivity. This is useful for:\n- Working on planes/trains without internet\n- Local-only development workflows  \n- Avoiding accidental pushes during experimentation\n\nThe feature uses granular controls so users can disable specific network operations independently.","design":"## Implementation Design\n\n### 1. Config Schema Changes (`src/config/schema.ts`)\n\nAdd granular offline controls to existing config sections:\n\n```typescript\n// GitConfigSchema additions\ngitPush: Schema.optional(Schema.Boolean),    // Enable/disable git push (default: true)\ngitFetch: Schema.optional(Schema.Boolean),   // Enable/disable git fetch/pull (default: true)\n\n// PRConfigSchema additions  \nenabled: Schema.optional(Schema.Boolean),    // Enable/disable PR creation entirely (default: true)\n\n// New BeadsSyncConfigSchema\nbeads: Schema.optional(Schema.Struct({\n  syncEnabled: Schema.optional(Schema.Boolean),  // Enable bd sync (default: true)\n}))\n\n// Network config\nnetwork: Schema.optional(Schema.Struct({\n  autoDetect: Schema.optional(Schema.Boolean),    // Auto-detect network status (default: true)\n  checkInterval: Schema.optional(Schema.Number),  // Check interval in seconds (default: 30)\n  checkHost: Schema.optional(Schema.String),      // Host to ping (default: \"github.com\")\n}))\n```\n\n### 2. NetworkService (NEW - `src/services/NetworkService.ts`)\n\nNew service to monitor network connectivity:\n\n```typescript\nexport class NetworkService extends Effect.Service\u003cNetworkService\u003e()(\"NetworkService\", {\n  scoped: Effect.gen(function* () {\n    const isOnline = yield* SubscriptionRef.make(true)\n    \n    // Poll network status every N seconds\n    yield* Effect.scheduleForked(Schedule.spaced(checkInterval))(\n      checkConnectivity.pipe(\n        Effect.flatMap(status =\u003e SubscriptionRef.set(isOnline, status))\n      )\n    )\n    \n    return { isOnline }\n  })\n}) {}\n\n// Check connectivity via DNS lookup or HTTP HEAD to github.com\nconst checkConnectivity = Effect.tryPromise(() =\u003e \n  fetch(\"https://github.com\", { method: \"HEAD\", signal: AbortSignal.timeout(5000) })\n).pipe(Effect.map(() =\u003e true), Effect.orElse(() =\u003e Effect.succeed(false)))\n```\n\n### 3. ConfigService Enhancement (`src/services/ConfigService.ts`)\n\nAdd helper methods that combine config + network status:\n\n```typescript\nisGitPushEnabled(): Effect\u003cboolean\u003e   // config.git.gitPush \u0026\u0026 networkService.isOnline\nisGitFetchEnabled(): Effect\u003cboolean\u003e  \nisPREnabled(): Effect\u003cboolean\u003e\nisBeadsSyncEnabled(): Effect\u003cboolean\u003e\n```\n\n### 4. Network Operation Guards\n\n**PRWorkflow.ts:**\n- `createPR()`: Check `isPREnabled()`, return `Option.none()` if disabled\n- `pushBranch()`: Check `isGitPushEnabled()`, skip silently if disabled\n- Push to main after merge: Check `isGitPushEnabled()`\n\n**BeadsClient.ts:**\n- `sync()`: Check `isBeadsSyncEnabled()`, return `{ pushed: 0, pulled: 0 }` if disabled\n\n**WorktreeManager.ts:**\n- Already respects `git.pushBranchOnCreate`, will also check new `git.gitPush`\n\n### 5. UI Changes\n\n**Action Menu (Space menu):**\n- PR action shows \"Create PR (disabled - offline)\" when `pr.enabled: false` OR network is down\n- Selecting it shows brief message, doesn't execute\n\n**Status Bar (optional):**\n- Could show network indicator icon when offline (üì¥ or similar)\n\n### 6. Example Config\n\n```json\n{\n  \"git\": {\n    \"gitPush\": false,\n    \"gitFetch\": true,\n    \"pushBranchOnCreate\": false\n  },\n  \"pr\": {\n    \"enabled\": false\n  },\n  \"beads\": {\n    \"syncEnabled\": false\n  },\n  \"network\": {\n    \"autoDetect\": true,\n    \"checkInterval\": 30,\n    \"checkHost\": \"github.com\"\n  }\n}\n```\n\n### Key Decisions\n- **Granular over global**: Users can disable just PR but keep beads sync\n- **Auto-detect network**: Polls github.com to detect connectivity\n- **Config overrides network**: If user sets `git.gitPush: false`, stays disabled even when online\n- **Silent skip**: Network ops just don't execute, no noise\n- **Action menu feedback**: User gets clear message when trying disabled action\n- **Backward compatible**: All new fields optional, default to enabled + auto-detect","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] `git.gitPush: false` prevents all git push operations\n- [ ] `git.gitFetch: false` prevents git fetch/pull operations  \n- [ ] `pr.enabled: false` disables PR creation\n- [ ] `beads.syncEnabled: false` disables bd sync network calls\n- [ ] Disabled actions in Space menu show \"(disabled - offline)\" suffix\n- [ ] Attempting disabled action shows informative message\n- [ ] All network operations fail gracefully (no crashes)\n- [ ] Default behavior unchanged (all enabled by default)\n- [ ] Type-check passes\n- [ ] App builds successfully","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:09:15.972805+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:37:31.72862+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ek3m","title":"Add orchestrate mode keybindings","description":"In bindings.ts:\n\n1. Add \"orchestrate\" to KeyMode type in types.ts\n2. Add 'o' binding in detail overlay mode:\n   ```typescript\n   { key: \"o\", mode: \"detail\", description: \"Orchestrate\", action: orchestrateHandlers.enterFromDetail() }\n   ```\n3. Add orchestrate mode bindings:\n   - j/down: moveDown\n   - k/up: moveUp\n   - space: toggle\n   - return: confirmSpawn\n   - a: selectAll\n   - n: selectNone\n   - escape: exitOrchestrate\n\n4. Update getEffectiveMode() in InputHandlersService to return \"orchestrate\" for orchestrate mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:04.569139+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:43.30364+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-ek3m","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:24.646113+11:00","created_by":"daemon"},{"issue_id":"az-ek3m","depends_on_id":"az-o72x","type":"blocks","created_at":"2025-12-19T01:43:50.107381+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-eqa2","title":"when attaching, dont show option to merge when a merge is already in progress","design":"## Problem\nWhen attaching to a session (Space+a), if the branch is behind its base branch, the app shows a MergeChoiceOverlay with options to \"Merge \u0026 Attach\" or \"Skip \u0026 Attach\". However, if a merge is already in progress (MERGE_HEAD exists), offering to merge again doesn't make sense and could cause confusion.\n\n## Solution\nIn `attachExternal()` in `SessionHandlersService.ts`, check if `task.hasMergeConflict` is true BEFORE showing the merge choice overlay. If a merge is in progress:\n- Skip the merge choice overlay entirely\n- Attach directly (equivalent to \"Skip \u0026 Attach\")\n- Show an informational toast explaining why merge option was skipped\n\n## Implementation\nFile: `src/services/keyboard/SessionHandlersService.ts`\nLocation: `attachExternal()` function, around line 425\n\nAfter checking `branchStatus.behind === 0`, add a check:\n```typescript\n// If merge already in progress, skip merge choice and attach directly\nif (task.hasMergeConflict) {\n  yield* toast.show(\"info\", \"Merge in progress - attaching directly\")\n  yield* doAttach(task.id)\n  return\n}\n```\n\nThis leverages the existing `hasMergeConflict` property that's already populated by BoardService (via `checkMergeConflict()` which checks for MERGE_HEAD existence).\n\n## Files to modify\n- `src/services/keyboard/SessionHandlersService.ts` - Add the check in `attachExternal()`\n\n## Acceptance criteria\n- When attaching to a session where MERGE_HEAD exists, user should NOT see the merge choice overlay\n- User should see an informational toast explaining merge is already in progress\n- Attach proceeds normally after skipping the merge choice","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:39:11.244145+11:00","updated_at":"2025-12-30T14:43:28.947738+11:00","closed_at":"2025-12-30T14:43:28.947738+11:00","close_reason":"Implemented: When attaching to a session where a merge is already in progress (MERGE_HEAD exists), the merge choice overlay is now skipped and the user is attached directly with an informational toast."}
{"id":"az-esy","title":"Implement inline attachment mode in AttachmentService","description":"src/core/AttachmentService.ts line 204 has TODO for inline attachment.\n\nCurrently only external tmux attachment works. Inline mode should:\n- Capture session output in current terminal\n- Overlay UI on top of session stream\n- Allow quick interactions without leaving TUI","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.670743+11:00","updated_at":"2025-12-17T15:59:44.670743+11:00"}
{"id":"az-et1","title":"Add elapsed timer to TaskCard","description":"Display MM:SS elapsed timer on TaskCards when session is active (busy/waiting state).\n\nInspiration: AutoMaker's CountUpTimer component.\n\nImplementation:\n1. Already have session startedAt timestamp in session metrics\n2. Add timer display component that updates every second\n3. Show on card when session state is busy or waiting\n4. Format as MM:SS (pad with zeros)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:01Z","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T14:09:14.159624+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ey9u","title":"in chefy when i space S it somehow messes up the opencode config","description":"in ~/prog/Chefy the config correctly has a plugin key but somehow new sessions always get \"plugins\" instead","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T12:39:26.283981+11:00","updated_at":"2025-12-22T12:39:26.283981+11:00"}
{"id":"az-eyws","title":"bead got stuck merging","notes":"üìé [mjgkbwhw-ybaw.png](.beads/images/az-eyws/mjgkbwhw-ybaw.png) (clipboard, 12/22/2025, 1:54:41 PM)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T13:54:38.068469+11:00","updated_at":"2025-12-22T13:54:41.76088+11:00"}
{"id":"az-f1j7","title":"Create OrchestrationOverlay component","description":"New component: src/ui/OrchestrationOverlay.tsx\n\nProps: epicTitle, children, selectedIds, focusIndex\n\nUI:\n- Header with epic title\n- Task list with selection markers ([x]/[ ]/---)\n- Status column (OPEN/IN_PROGRESS/BLOCKED)\n- Focus highlight\n- Footer: \"Selected: X/Y spawnable\"\n- Keybinding hints: Enter:Spawn Space:Toggle Esc:Back\n\nStyling:\n- Spawnable tasks: normal color\n- Non-spawnable: grayed/dimmed\n- Selected: checkbox [x]\n- Focused: highlight bg","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:05.131601+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:31.83202+11:00","close_reason":"Created OrchestrationOverlay.tsx component with task list, selection indicators, focus highlighting, and keyboard hint footer","dependencies":[{"issue_id":"az-f1j7","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:25.230451+11:00","created_by":"daemon"},{"issue_id":"az-f1j7","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:51.329879+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-f3iw","title":"sometimes action menu command gets sent to wrong bead/worktree","description":"i just pressed space d and then y to confirm cleanup on a bead and then immediately moved my cursor and the fuckin newly cursor selected bead is the one that was cleaned up!","design":"## Root Cause Analysis\n\n**The Problem**: When user opens action menu (`Space`) and triggers cleanup (`d` + `y`), the wrong bead could get cleaned up if cursor moved between keypresses.\n\n**Investigation Findings**: Task ID was captured when action key (`d`) was pressed, not when action mode was entered (`Space`). This allowed a window where cursor could move, causing the wrong task to be targeted.\n\n## Implementation\n\n### Fix: Capture Task ID at Action Mode Entry\n\nChanged the action mode to capture the target task ID when Space is pressed:\n\n1. **EditorMode Type** (`EditorService.ts:123`):\n   ```typescript\n   | { readonly _tag: \"action\"; readonly targetTaskId: string | null }\n   ```\n\n2. **enterAction** captures task ID:\n   ```typescript\n   enterAction: (targetTaskId: string | null) =\u003e\n     SubscriptionRef.set(mode, { _tag: \"action\", targetTaskId })\n   ```\n\n3. **Space binding** gets task ID first (`bindings.ts:159-162`):\n   ```typescript\n   action: Effect.gen(function* () {\n     const taskId = yield* bc.nav.getFocusedTaskId()\n     yield* bc.editor.enterAction(taskId)\n   })\n   ```\n\n4. **New helper** `getActionTargetTask()` in KeyboardHelpersService:\n   - Returns task from captured `targetTaskId` if in action mode\n   - Falls back to current cursor for non-action-mode usage\n\n5. **Updated all action handlers** to use `getActionTargetTask()` instead of `getSelectedTask()`:\n   - PRHandlersService (cleanup, merge, PR, update from base, show diff)\n   - SessionHandlersService (start, stop, attach, pause, resume)\n   - TaskHandlersService (edit, delete, move)\n   - DevServerHandlersService (toggle, restart, attach)\n   - bindings.ts (image attach)\n\n### Diagnostic Logging\n\nAdded Effect.log calls at key points (can be removed later):\n- `[cleanup:capture]` - Task ID captured when d is pressed\n- `[cleanup:confirm]` - Confirm dialog shown\n- `[cleanup:execute]` - Cleanup actually runs\n- `[confirm:key]` - Keys received while confirm is open\n\nLogs go to `az.log` file.","acceptance_criteria":"- [x] Identify root cause: task ID captured at wrong time (action key vs mode entry)\n- [x] Add diagnostic logging to doCleanup to capture task ID at execution time\n- [x] Implement fix: capture task ID when entering action mode (Space press)\n- [ ] Test: Space+d on task A, try to press j/k, confirm - should act on task A\n- [ ] Verify no regression in normal action menu flow","notes":"Implementation complete. Needs manual testing to verify:\n1. Normal flow works (Space+action+confirm)\n2. Rapid keypresses still target correct bead\n3. Moving cursor after action key but before confirm still targets original bead","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:58:31.886682+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T03:37:41.26313+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-f4q","title":"Add auto-pilot toggle keybinding (a)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T01:05:15.523081+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T01:06:38.936838+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-f5g2","title":"when we added epic base branch feature to our git ui we broke non epic base branch","description":"now all worktrees show 0 git diff when they should show lines changed","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:38:53.369414+11:00","updated_at":"2025-12-30T12:39:22.468034+11:00","deleted_at":"2025-12-30T12:39:22.468034+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-fei","title":"when i search and press enter on a search result i expect to put cursor on that item in normal mode","description":"it should be scrolled into view too","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:16:12.214738+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:18:42.942191+11:00","close_reason":"Added mode change watcher to NavigationService that calls ensureValidFocus() when the search query changes. This keeps focusedTaskId in sync with the filtered view, so when Enter is pressed in search mode, the cursor stays on the visible task.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ffkx","title":"Implement Convoy data models and domain types","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T00:40:23.239235+11:00","updated_at":"2026-01-05T00:40:23.239235+11:00"}
{"id":"az-fjy","title":"add a git push keybind","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:59:10.618121+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T10:32:36.837731+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-fl2u","title":"when there are 500+ beads it starts to take a solid amount of time to load","description":"so the bottom bar debounce for loading indicator is too low. we may need to account for this better in other aspects that i havent thought of too...","design":"## Problem Analysis\n\nWith 800+ beads, the current 2-second polling architecture causes multi-second load times:\n- `bd list --json` returns ALL beads every 2 seconds\n- Schema validates every issue every cycle\n- 4 git commands per active session per cycle (1-12 sessions = 4-48 git ops)\n- No caching - same data fetched repeatedly\n\n### User Requirements\n- Fast sequential mutations (3 quick arrow taps should show real-time movement)\n- 5-10s staleness acceptable for passive viewing\n- Overall slowness is priority over git diff flash on switch\n\n## Implementation Plan\n\n### Phase 1: Quick Wins (First)\n1. **Event-driven refresh instead of polling**\n   - Stop 2-second constant polling\n   - Refresh only when: app loads, after mutation (debounced 500ms), explicit refresh (r key), session state changes\n   - Add `refreshDebounced()` that coalesces rapid mutations\n\n2. **Clear stale data on project switch**\n   - Immediately clear gitAdditions/gitDeletions when switching to prevent '30k lines' flash\n   - Show cached board instantly, refresh in background\n\n3. **Per-project board cache**\n   - Store last loaded board state per project path\n   - On switch: show cached data immediately, then refresh\n\n### Phase 2: Optimistic Mutations (After Phase 1)\n1. **In-memory optimistic state**\n   - UI mutations update local state immediately (move task = instant column change)\n   - No waiting for bd CLI\n\n2. **Sequential command queue**\n   - Queue bd commands, execute one at a time\n   - Track pending operations per task\n\n3. **Rollback on failure**\n   - If bd command fails, revert to last confirmed state\n   - Show error toast\n   - Trigger full refresh to resync\n\n### Files to Modify\n- `src/services/BoardService.ts` - Remove polling, add debounced refresh, per-project cache\n- `src/ui/atoms/project.ts` - Clear git stats on switch\n- `src/ui/atoms/board.ts` - Update loading behavior\n- New: `src/services/CommandQueueService.ts` - For Phase 2","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T13:03:42.860168+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-24T02:58:50.403417+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-fn1","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:19:56.843403+11:00","updated_at":"2025-12-17T00:20:45.047717+11:00"}
{"id":"az-foy","title":"Update docs from Ink to OpenTUI + React","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-12T17:16:24.188255+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T17:16:32.49283+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"az-fvj","title":"BeadsClient - wrapper around bd CLI","description":"Create a TypeScript wrapper around the bd CLI for reading and updating beads issues.","design":"- Define BeadsClient as Effect Service using Effect.Service\n- Use @effect/platform Command for shelling out to bd\n- Methods return Effect with typed errors:\n  - list(): Effect\u003cIssue[], BeadsError\u003e\n  - show(id): Effect\u003cIssue, BeadsError | NotFoundError\u003e\n  - update(id, fields): Effect\u003cvoid, BeadsError\u003e\n  - close(id): Effect\u003cvoid, BeadsError\u003e\n  - sync(): Effect\u003cSyncResult, BeadsError\u003e\n- Use @effect/schema for parsing bd --json output\n- Support running in different worktrees via workingDirectory option\n- Create BeadsClientLive layer with real implementation\n- Create BeadsClientTest layer for testing","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full Effect service wrapping bd CLI\n- Schema validation for Issue type\n- All major bd commands wrapped with typed errors\n\nFILES CREATED:\n- src/core/BeadsClient.ts (447 lines) - Complete service\n- src/core/BeadsClient.example.ts (152 lines) - 8 usage examples\n\nSERVICE METHODS:\n- list(filters?) - List issues with status/priority/type filters\n- show(id) - Get single issue details\n- update(id, fields) - Update status/notes/priority\n- close(id, reason?) - Close issue\n- sync() - Push/pull beads database\n- ready() - Get unblocked issues\n- search(query) - Search issues\n\nERROR TYPES:\n- BeadsError - Generic bd command failures\n- NotFoundError - Issue not found\n- ParseError - JSON/Schema validation errors\n\nLAYERS:\n- BeadsClientLive - Service only (needs BunContext)\n- BeadsClientLiveWithPlatform - Complete with platform deps (recommended)\n\nVERIFICATION:\n- Type check passes\n- Runtime test fetched 10 ready issues from actual beads database","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.409567+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T17:25:14.06403+11:00","dependencies":[{"issue_id":"az-fvj","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.006035+11:00","created_by":"daemon"},{"issue_id":"az-fvj","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.575251+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-g19","title":"Terminal attachment (external and inline)","description":"Implement session attachment for manual intervention.","design":"- External (a): detect terminal emulator, open new window/tab with tmux attach\n- Ghostty: ghostty -e tmux attach-session -t \u003cid\u003e\n- iTerm: osascript to open new tab\n- Inline (A): replace TUI with session output, handle detach to return\n- Track which sessions user has attached to","notes":"Implementation complete:\n\n1. Created AttachmentService (src/core/AttachmentService.ts):\n   - External attachment via attachExternal() - opens new terminal window/tab\n   - Inline attachment stub via attachInline() - reserved for future implementation\n   - Terminal type detection (Ghostty, iTerm, Terminal.app)\n   - Attachment history tracking\n   - Proper Effect error handling with AttachmentError and SessionNotFoundError\n\n2. Updated atoms.ts:\n   - Added AttachmentService to runtime layer (appLayer)\n   - Created attachExternalEffect() and attachInlineEffect() helper functions\n   - Properly composed layers with dependencies (AttachmentService depends on TmuxService and TerminalService)\n\n3. Integrated with App.tsx keyboard handling:\n   - Added 'a' key in action mode (Space + a) for external attachment\n   - Added 'A' key in action mode (Space + A) for inline attachment (shows error for now)\n   - Session ID is constructed as 'claude-{task.id}'\n   - Error handling with console.error fallback\n\nTechnical details:\n- AttachmentService uses TmuxService for session validation and attach command generation\n- TerminalService provides terminal detection and command execution\n- External attachment opens new terminal with 'tmux attach-session -t {sessionId}'\n- Inline attachment is stubbed - future implementation will require suspending TUI renderer\n- All code passes type-check with strict TypeScript mode\n- No 'as' casts or 'any' types used\n\nUsage:\n1. Navigate to a task with hjkl\n2. Press Space to enter action mode\n3. Press 'a' to attach externally in new terminal window\n4. Press 'A' to attempt inline (will show error message)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:08.219579+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:32:33.851115+11:00","dependencies":[{"issue_id":"az-g19","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.313043+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-g5nf","title":"when resolving merge conflicts show a different color of session dot","description":"or a different icon entirely","design":"## Implementation Plan\n\n**Goal**: Show a distinct conflict indicator when a worktree is in an active merge conflict state.\n\n### Approach\n- Track `hasMergeConflict` as a separate boolean flag (not a SessionState)\n- Detect via presence of MERGE_HEAD in worktree's git directory\n- Display as combination: session indicator + conflict badge (e.g., \"üîµ ‚öîÔ∏è\")\n\n### Changes Required\n\n1. **src/ui/types.ts**\n   - Add `hasMergeConflict?: boolean` to `TaskWithSession` interface\n   - Add `CONFLICT_INDICATOR` constant (e.g., \"‚öîÔ∏è\" or \"üîÄ\")\n\n2. **src/services/BoardService.ts** (or new service)\n   - Add merge conflict detection during board refresh\n   - Check for `.git/MERGE_HEAD` in each active worktree\n   - For worktrees: `\u003cworktree\u003e/.git` is a file pointing to real git dir\n\n3. **src/ui/TaskCard.tsx**\n   - Display conflict indicator after session indicator when `hasMergeConflict` is true\n   - e.g., \"az-123 [task] üîµ ‚öîÔ∏è\" (busy + has conflict)\n\n### Detection Logic\n```bash\n# In worktree, .git is a file containing \"gitdir: /path/to/real/git\"\n# Check: \u003cworktree\u003e/.git/MERGE_HEAD exists\ngit -C \u003cworktree\u003e rev-parse MERGE_HEAD 2\u003e/dev/null \u0026\u0026 echo \"conflict\"\n```\n\n### Visual Design\n- Conflict indicator: ‚öîÔ∏è (crossed swords - signals conflict)\n- Shown AFTER session indicator to maintain session visibility\n- Only shown when worktree has active merge state","acceptance_criteria":"- [ ] Tasks with active merge conflicts show ‚öîÔ∏è indicator\n- [ ] Indicator appears alongside (not replacing) session state indicator\n- [ ] Conflict state is detected by checking MERGE_HEAD in worktree\n- [ ] Indicator disappears when merge is completed or aborted\n- [ ] Works correctly for worktrees (not just main repo)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:17:16.58094+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:31:19.187727+11:00","close_reason":"Implemented conflict indicator (‚öîÔ∏è) that displays alongside session state when worktree has active merge conflict. Uses git rev-parse MERGE_HEAD detection, checked in parallel during board refresh.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-g7p","title":"sometimes space S/s moves the task to in progress but doesnt start a tmux session","description":"what could even cause the tmux session to not be started? check az.log maybe","notes":"Root cause identified: Action handlers in KeyboardService use Effect.tap() which fires-and-forgets the inner Effect. Need to change to Effect.flatMap() to properly await the session start.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:44:06.046821+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:01:19.62138+11:00","close_reason":"Fixed: Moved bead status update from BEFORE session creation to AFTER. Previously if worktree, init commands, or tmux session creation failed, the bead would be left in \"in_progress\" state with no actual session. Now the status only updates after the session is successfully created.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-g7ut","title":"should not see .beads changes in git line diff","description":"the attached image shows a space f diff file picker open for the bead in the top right (1400 lines added) only 1 line was added outside of .beads so thats what the line diff should show","design":"## Implementation\n\nFilter `.beads/` directory from git diff operations using pathspec exclusion `:^.beads`.\n\n### Changes Made\n1. **BoardService.ts** (line stats on task cards): Added `\"--\", \":^.beads\"` to `git diff --numstat` command\n2. **DiffService.ts** (file picker list): Added `\"--\", \":^.beads\"` to `git diff --name-status` command\n3. **atoms/diff.ts** (diff popup): Updated existing `:!.beads` to `:^.beads` for consistency\n\n### Technical Note\nGit pathspec magic uses `!` or `^` as synonyms for exclude. Using `^` avoids shell escaping issues since `!` can trigger bash history expansion.","notes":"üìé [mjtpwp4b-jknk.png](.beads/images/az-g7ut/mjtpwp4b-jknk.png) (clipboard, 12/31/2025, 6:51:49 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:51:45.530902+11:00","updated_at":"2026-01-01T02:14:48.945835+11:00","closed_at":"2026-01-01T02:14:48.945838+11:00","close_reason":"Implemented .beads/ filtering from git diff operations using :^.beads pathspec exclusion"}
{"id":"az-g84","title":"space c (chat with claude about task) not working","description":"it seems to start a session cause i see a blue dot in az tui but when i press space a it says it failed to attach (not found) i also think it would be better to attach inline or whatever its called in this instance (overlay tui and end on closing out) similar to the log viewer (L) keybind","notes":"Investigated the issue. Found two problems:\n\n1. Space+c starts session but doesn't auto-attach - user sees blue dot but session lookup fails on Space+a\n2. User wants inline popup attach (like Shift+L for logs) instead of external terminal\n\nSolution: Modify actionChatAboutTask to use tmux displayPopup like the log viewer, which will:\n- Start the Claude chat session\n- Immediately show it in a popup overlay\n- Auto-close popup when session ends","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:21:47.203086+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:27:28.647989+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-gds","title":"Subagent orchestration for parallel epic development","description":"Enable TUI to orchestrate multiple parallel Claude sessions working on related tasks (e.g., epic children). Each worker runs in its own worktree/tmux session. Coordination via Agent Mail for real-time updates, beads for persistent state.\n\n**Key Features:**\n1. Space+o on epic ‚Üí orchestration mode showing child tasks\n2. Select which tasks to parallelize\n3. Spawn workers (worktree + tmux + claude per task)\n4. Workers get injected context about epic and coordination rules\n5. Real-time progress tracking via Agent Mail status broadcasts\n6. Epic progress bar showing X/Y tasks complete\n7. Optional orchestrator Claude for planning/review phases\n\n**Architecture:**\n- TUI is external orchestrator (not a Claude subagent)\n- Workers are independent Claude sessions\n- Agent Mail handles: reservations, status, completion signals\n- Beads handles: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\n**New UI:**\n- Orchestration mode (Space+o)\n- Epic progress indicator (‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5)\n- Indented child tasks under epic\n- Worker status in session indicators\n\n**Session Templates:**\n- worker.md template with epic context injection\n- Coordination rules (stay focused, report discoveries)\n- Auto-close task on completion","notes":"Session 2025-12-12: Designed from Claude Code best practices research.\n\nRESEARCH VALIDATION:\n- Pattern confirmed: Git worktrees are de facto standard for parallel AI agents (Cursor, ccswarm, Claude-Flow all use this)\n- Key insight: TUI as external orchestrator avoids Claude subagent nesting limits\n- Agent Mail provides \u003c100ms coordination vs 2-5s git sync\n\nARCHITECTURE DECISIONS:\n- TUI spawns workers (not Claude spawning subagents) - no nesting limits\n- Each worker: worktree + tmux session + Claude instance\n- Agent Mail for: reservations, status broadcasts, completion signals  \n- Beads for: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\nUI DESIGN:\n- Space+o triggers orchestration mode on epics\n- Reuse select mode patterns for task selection\n- Progress bar: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5 format\n- Indented children under epics in board view\n\nDEPENDENCIES:\n- [deleted:az-7sr] (orch mode) + [deleted:az-lqb] (template) ‚Üí [deleted:az-bjp] (spawning)\n- az-l7a (Agent Mail epic) ‚Üí az-2il (status broadcasts)\n\nNEXT STEP: Implement [deleted:az-7sr] (orchestration mode) or [deleted:az-lqb] (worker template) - both are ready","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:28:50.911119+11:00","updated_at":"2025-12-28T11:48:04.491213+11:00"}
{"id":"az-ghj","title":"clean up open tasks and offer to create 5-10 new tasks based on gaps in our program/tech debt","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:59.901658+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:13:04.792751+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-gwck","title":"when i press space a to attach and az asks if i want to merge, it doesnt merge latest","description":"i literally JUST pressed space a on this in ~/prog/Chefy project when it said something like 59 behind, dialog said i was 40 behind, m to merge, ctrl a a to get back to az, still behind but less behind","notes":"Analyzing attach-merge flow. Identified that PRWorkflow.checkBranchBehindMain and mergeMainIntoBranch lack fetch logic, causing them to operate on stale local base branch. Planning to align with updateFromBase logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T14:50:37.689516+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T13:40:25.898995+11:00","close_reason":"Unified PRWorkflow counting logic with BoardService and added TUI refresh after merge.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-gzgg","title":"Prompt user to configure dependencies when creating task in epic drill-down","description":"When a task is created within an epic drill-down view, the new task may have dependencies on other tasks in the same epic. Currently we only auto-link the task to the epic as a parent-child relationship, but we don't help the user establish sibling dependencies.\n\nFor example, if an epic has tasks A, B, C and the user creates task D, task D might need to depend on task B completing first. The user currently has to manually set this up after creation.","design":"## Potential Approaches\n\n### Option 1: Post-creation prompt overlay\nAfter creating the task in drill-down mode, show an overlay asking:\n- \"Does this task depend on any other tasks in this epic?\"\n- List the epic's existing children with checkboxes\n- User selects dependencies, we run `bd dep add` for each\n\n### Option 2: Spawn Claude session for dependency analysis\nMore sophisticated approach - spawn a quick Claude session that:\n1. Reads the new task's title/description\n2. Reads all sibling tasks in the epic\n3. Suggests likely dependencies based on semantic analysis\n4. User confirms/adjusts the suggestions\n\nThis would be especially useful for complex epics where dependencies aren't obvious.\n\n### Option 3: Keybinding for \"add to epic with deps\"\nAdd a separate keybinding (e.g., Shift+C) that does the enhanced flow, keeping plain 'c' simple.\n\n## Recommendation\nStart with Option 1 (simple overlay) as it's quick to implement and covers most use cases. Option 2 could be a follow-up enhancement for power users.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-19T15:10:45.058612+11:00","updated_at":"2025-12-19T15:10:45.058612+11:00","dependencies":[{"issue_id":"az-gzgg","depends_on_id":"az-5z7z","type":"discovered-from","created_at":"2025-12-19T15:10:52.889655+11:00","created_by":"daemon"}]}
{"id":"az-h3v","title":"Agent Mail server for local development","description":"Implement simple Agent Mail server for local multi-agent testing.\n\nDesign:\n- Bun HTTP server with Effect\n- In-memory reservation store (Map\u003cissueId, agentName\u003e)\n- Endpoints:\n  - POST /reserve/:issueId - acquire reservation\n  - POST /release/:issueId - release reservation\n  - GET /ready - list unreserved, unblocked issues\n  - POST /status/:issueId - update status\n  - GET /health - server health check\n- WebSocket support for real-time notifications (optional)\n- Configurable port via CLI argument\n- Graceful shutdown handling","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T10:33:13.621222+11:00","updated_at":"2025-12-12T10:33:13.621222+11:00","dependencies":[{"issue_id":"az-h3v","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.836567+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-h5gk","title":"attached images should be linked in bead description or notes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:29:36.523901+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T15:37:23.405149+11:00","close_reason":"Implemented automatic linking of attached images in bead notes. When an image is attached via `attachFile` or `attachFromClipboard`, a markdown-formatted link is appended to the bead's notes field with the format: üìé [filename](path) (source, timestamp). This makes attachments visible in `bd show` output and preserves them in git history.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-hdj","title":"does pty watcher handle using tmux to add windows/panels to the bead session?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:36:14.373167+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:18:28.637134+11:00","close_reason":"Investigated: PTYMonitor does NOT handle multiple windows/panes. It only captures the default pane (session:0.0). If users split panes or add windows, those are not monitored. To fix, would need to store the pane ID at session start and target it explicitly with `-t %{pane_id}` format.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-hdrt","title":"move keybind factories pattern to Effect.Service layers","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:45:18.020158+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T17:21:01.651873+11:00","close_reason":"Moved keybind factories pattern to Effect.Service layers. Created KeyboardHelpersService, SessionHandlersService, TaskHandlersService, PRHandlersService, and InputHandlersService. Updated KeyboardService to use these new service layers. Removed old factory pattern files and HandlerContext.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-he5g","title":"dont specify ai model by default, only if configured","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T11:57:12.775728+11:00","updated_at":"2026-01-05T11:57:12.775728+11:00"}
{"id":"az-hk98","title":"when opencode is configured over claude make sure all actions that start an ai use it","description":"e.g. space s/S/c and auto merge","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:14:10.142036+11:00","updated_at":"2026-01-05T12:03:03.902365+11:00","closed_at":"2026-01-05T12:03:03.902367+11:00"}
{"id":"az-hkfa","title":"tui_core: Color utilities - hex parsing and ANSI conversion","description":"Port OpenTUI's ansi.ts color handling to Gleam.\n\n## Why First\nColors are used by FrameBuffer cells and Renderer output. Need this foundation before either.\n\n## API (Gleam)\n```gleam\ntype Color {\n  Hex(String)           // \"#8aadf4\"\n  Rgb(Int, Int, Int)    // Rgb(138, 173, 244)\n  Ansi256(Int)          // 256-color palette index\n  Named(String)         // \"red\", \"blue\", etc.\n  Default               // Terminal default\n}\n\n/// Parse hex string to RGB values\nfn parse_hex(hex: String) -\u003e Result(#(Int, Int, Int), Nil)\n\n/// Convert to ANSI 256-color (for older terminals)\nfn to_ansi256(r: Int, g: Int, b: Int) -\u003e Int\n\n/// Generate foreground escape sequence (true color)\nfn fg_escape(color: Color) -\u003e String  // \"\\x1b[38;2;R;G;Bm\"\n\n/// Generate background escape sequence (true color)\nfn bg_escape(color: Color) -\u003e String  // \"\\x1b[48;2;R;G;Bm\"\n\n/// Reset all attributes\nfn reset() -\u003e String  // \"\\x1b[0m\"\n```\n\n## Reference\n- OpenTUI: packages/core/src/ansi.ts\n- ANSI escape codes: https://en.wikipedia.org/wiki/ANSI_escape_code\n\n## Acceptance Criteria\n- [ ] Parse \"#rrggbb\" and \"#rgb\" formats\n- [ ] Generate true color (24-bit) escape sequences\n- [ ] Generate 256-color fallback escape sequences\n- [ ] Handle bold, dim, underline, etc. attributes","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:31:22.083652+11:00","updated_at":"2025-12-29T15:16:03.528986+11:00","closed_at":"2025-12-29T15:16:03.528986+11:00","close_reason":"Implemented tui_core/color.gleam with hex parsing, RGB convenience functions, and Catppuccin Macchiato palette constants. Tests included.","labels":["foundation","gleam","tui-core"],"dependencies":[{"issue_id":"az-hkfa","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.129131+11:00","created_by":"daemon"},{"issue_id":"az-hkfa","depends_on_id":"az-lvah","type":"blocks","created_at":"2025-12-28T11:41:51.199473+11:00","created_by":"daemon"},{"issue_id":"az-hkfa","depends_on_id":"az-kwwr","type":"blocks","created_at":"2025-12-28T11:52:29.324605+11:00","created_by":"daemon"}]}
{"id":"az-hllj","title":"check codebase for dead code","description":"Audit the Azedarach codebase to identify and remove dead code - unused exports, unreferenced functions, orphaned files, and stale imports that are no longer needed.","design":"## Approach\n\nUse TypeScript compiler and static analysis to find dead code:\n\n1. **Unused Exports**: Use `ts-prune` or manual grep analysis to find exports that are never imported\n2. **Orphaned Files**: Check for .ts/.tsx files not imported anywhere\n3. **Stale Imports**: Imports that exist but whose values are never used\n4. **Unreferenced Functions**: Functions defined but never called\n\n## Tools\n- `rg` for pattern matching\n- TypeScript compiler errors (unused locals)\n- Manual cross-reference analysis\n\n## Safety\n- Verify each \"dead\" item is truly unused before removal\n- Check for dynamic imports or indirect references\n- Preserve public API surface","acceptance_criteria":"- [ ] All unused exports identified and documented\n- [ ] Orphaned files (not imported anywhere) identified\n- [ ] Dead code removed or flagged with rationale for keeping\n- [ ] `bun run type-check` passes after changes\n- [ ] `bun run build` succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T15:03:31.850422+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T23:49:35.131302+11:00","close_reason":"Dead code removed: (1) src/index.tsx placeholder, (2) src/atoms/keyboardAtoms.ts duplicate, (3) unused layer exports in src/atoms/runtime.ts, (4) unused convenience functions in StateDetector.ts. Type-check and build pass.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-hmmx","title":"remove as yet unused a (VC) keybind","design":"## Implementation Plan\n\n### Context\nThe `a` key in normal mode is bound to \"Toggle VC auto-pilot\" which starts/stops the VC (VibeCoder) executor. This is a third-party integration with `steveyegge/vc` that is not yet in active use. The keybinding exists in the code but the feature is incomplete (note the `Effect.log(\"todo: poll vc status\")` placeholder).\n\n### Files to Modify\n\n1. **`src/services/keyboard/bindings.ts`** (line ~285-289)\n   - Remove the normal mode keybinding for `a` ‚Üí \"Toggle VC auto-pilot\"\n\n2. **`src/services/keyboard/TaskHandlersService.ts`** (line ~233-248)\n   - Remove the `toggleVC` function definition\n   - Remove it from the return object\n\n3. **`docs/keybindings.md`** (line 61, 524)\n   - Remove documentation for the `a` key toggle VC auto-pilot\n   - Update command mode section that mentions \"toggle with `a` key\"\n\n### Notes\n- The VCService itself remains in `src/core/VCService.ts` - it's a complete service that could be reactivated later\n- The atoms in `src/ui/atoms/vc.ts` also remain - they're not being used by the removed binding\n- Command mode (`:`) which sends commands to VC REPL remains - it still makes sense if someone manually runs VC\n\n### Acceptance\n- `a` key in normal mode does nothing (or is available for future use)\n- No TypeScript errors\n- Documentation updated","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T02:06:22.60798+11:00","updated_at":"2025-12-30T10:53:36.709332+11:00","closed_at":"2025-12-30T10:53:36.709334+11:00","close_reason":"Removed unused 'a' keybinding for VC toggle. The VCService remains available but is no longer keyboard-accessible."}
{"id":"az-hri","title":"Basic Kanban board component (OpenTUI + Solid)","description":"Create the main Ink-based Kanban board displaying beads issues in columns by status.","design":"- Use OpenTUI + SolidJS for components\n- App.tsx: root component, provides Effect runtime context\n- Board.tsx: horizontal flexbox layout of columns (Yoga)\n- Column.tsx: vertical list of tasks per status (open, in_progress, blocked, review, closed)\n- TaskCard.tsx: individual task with title, id, session indicator\n- Session indicators: üîµ Busy, üü° Waiting, ‚úÖ Done, ‚ùå Error, ‚è∏Ô∏è Paused\n- Use SolidJS signals for reactive state (pairs well with Effect Ref)\n- Use createResource for async data fetching from Effect services\n- Style with OpenTUI's built-in primitives (Box, Text, etc.)","notes":"Implemented basic Kanban board component with OpenTUI + SolidJS:\n\n- Created UI types (SessionState, TaskWithSession, COLUMNS, SESSION_INDICATORS)\n- TaskCard.tsx: displays individual tasks with title, ID, session indicator, priority color\n- Column.tsx: vertical list of tasks per status with header and count\n- Board.tsx: horizontal layout of columns using Yoga flexbox\n- StatusBar.tsx: bottom bar with keyboard shortcuts and stats\n- App.tsx: root component with Effect runtime, fetches tasks from BeadsClient\n- launch.tsx: TUI initialization with OpenTUI render\n\nAll components use OpenTUI primitives (box, text) with proper styling (fg/bg colors, attributes for bold, border styles). Successfully type checks with strict mode.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.662469+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T18:03:13.707242+11:00","dependencies":[{"issue_id":"az-hri","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.667781+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.898548+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-fvj","type":"blocks","created_at":"2025-12-11T14:46:26.110348+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-mq9","type":"blocks","created_at":"2025-12-11T17:10:08.980724+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-hsnx","title":"add confirm dialog to delete/cleanup actions (y/n and enter/esc)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:49:16.229704+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:04:07.468433+11:00","close_reason":"Implemented confirm dialogs for Space+d (cleanup) and Space+D (delete bead) actions using existing ConfirmOverlay infrastructure","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-hu9b","title":"if there is a PR, we should be able to view via action menu keybind","design":"## Implementation Plan: Open PR via Action Menu\n\n### Goal\nAdd a keybinding `Space+o` to open the task's PR in the user's browser when a PR exists.\n\n### Approach\nUse `gh pr view \u003cprNumber\u003e --web` command, which is the standard way to open a PR in the browser via GitHub CLI. This approach:\n- Leverages existing `gh` CLI availability (already checked by the app)\n- Works cross-platform (gh handles opening the browser)\n- Uses the PR number from `parsePRInfo()` which extracts it from the task's notes field\n\n### Files to Modify\n\n1. **src/services/keyboard/PRHandlersService.ts**\n   - Add `openPR()` handler method\n   - Pattern: Similar to other simple handlers like `showDiff()`\n   - Flow:\n     1. Get task via `helpers.getActionTargetTask()`\n     2. Check if task has PR (`task.hasPR \u0026\u0026 task.prNumber`)\n     3. Get project path for cwd context\n     4. Run `gh pr view \u003cprNumber\u003e --web` command\n     5. Show toast on success/failure\n\n2. **src/services/keyboard/bindings.ts**\n   - Add keybinding in Action Mode section:\n     ```typescript\n     {\n       key: \"o\",\n       mode: \"action\",\n       description: \"Open PR\",\n       action: Effect.suspend(() =\u003e\n         bc.editor.exitToNormal().pipe(Effect.tap(() =\u003e bc.prHandlers.openPR())),\n       ),\n     }\n     ```\n\n3. **src/ui/ActionPalette.tsx**\n   - Add `ActionLine` for \"o\" key in the Git/PR section (after \"P\" for create PR)\n   - Add availability check: only available when task.hasPR is true\n   - Add \"o\" to NETWORK_ACTIONS set (requires network to load GitHub)\n\n### Availability Logic\n- Only shown/available when:\n  - `task.hasPR === true` (has PR URL in notes)\n  - Network is online (offline ‚Üí grayed out)\n- No worktree requirement (PR exists independent of local state)\n\n### Command Execution\nUse existing `@effect/platform` Command pattern:\n```typescript\nconst openPR = () =\u003e\n  Effect.gen(function* () {\n    const task = yield* helpers.getActionTargetTask()\n    if (!task) return\n\n    if (!task.hasPR || !task.prNumber) {\n      yield* toast.show(\"error\", `No PR for ${task.id} - create one first (P)`)\n      return\n    }\n\n    const projectPath = yield* helpers.getProjectPath()\n    yield* runCommand(`gh pr view ${task.prNumber} --web`, projectPath).pipe(\n      Effect.tap(() =\u003e toast.show(\"info\", `Opening PR #${task.prNumber}...`)),\n      Effect.catchAll(helpers.showErrorToast(\"Failed to open PR\")),\n    )\n  })\n```\n\n### Testing\n- Press Space+o on task without PR ‚Üí error toast \"No PR for az-xxx\"\n- Press Space+o on task with PR ‚Üí opens browser to PR page\n- Action palette shows \"o open PR\" only when task has PR","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T21:54:32.67056+11:00","updated_at":"2026-01-02T10:54:07.211552+11:00","closed_at":"2026-01-02T10:54:07.211556+11:00","close_reason":"Implemented Space+O keybinding to open PR in browser via gh pr view --web"}
{"id":"az-i0d","title":"improve the initial prompt when we press space S","description":"sometimes claude gets confused and doesnt realise we are saying to work on a specific bead with that id","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:23:28.189773+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T01:34:17.372932+11:00","close_reason":"Improved the initial prompt in Space+S to include the task title alongside the bead ID. Now sends \"work on az-xxx: \u003ctitle\u003e\" instead of just \"work on az-xxx\", giving Claude clearer context about what to work on.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-i5fb","title":"i'm going to show the project to others","description":"tell me what i should do first before opening it up as an opensource repo. e.g. check for security issues (keys), add license, credit creator of/repo of beads etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:37:44.071386+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:11:04.204356+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-i7h5","title":"review https://github.com/chefy-org/Chefy/pull/1995/changes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T22:44:32.214544+11:00","updated_at":"2025-12-31T09:07:47.400709+11:00","deleted_at":"2025-12-31T09:07:47.400709+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-idq3","title":"name claude sessions [bead-id]","description":"when space s/S etc name them after the type of ssesion and bead id","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T00:38:22.983613+11:00","updated_at":"2025-12-30T00:58:45.166002+11:00","deleted_at":"2025-12-30T00:58:45.166002+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-ism6","title":"we seem to use the green checkbox emoji/icon for more than one thing. fix that","design":"## Problem\nThe checkmark symbol `‚úì` is used for two different meanings in OrchestrationOverlay.tsx:\n1. `[‚úì]` = selected task in multi-select mode\n2. `‚úì` = closed/completed task status\n\nThis creates confusion when both appear on the same line: `[‚úì] az-123 ‚úì Task title`\n\n## Solution\nChange the selection indicator from `[‚úì]` to `[‚Ä¢]` (filled dot):\n- `[‚Ä¢]` = selected\n- `[ ]` = not selected but selectable  \n- `[-]` = not selectable (unchanged)\n\nThis keeps `‚úì` consistently meaning 'closed/completed' across the codebase while making selection visually distinct.\n\n## Files to modify\n- src/ui/OrchestrationOverlay.tsx: Update getSelectionIndicator() function","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T21:55:07.570921+11:00","updated_at":"2026-01-02T10:54:27.307155+11:00","closed_at":"2026-01-02T10:54:27.307161+11:00","close_reason":"Changed selection indicator from [‚úì] to [‚Ä¢] in OrchestrationOverlay to avoid semantic collision with ‚úì (closed status)"}
{"id":"az-ivql","title":"hooks not informing when claude prompts","design":"## Problem Analysis\n\nHooks were not informing Azedarach when Claude prompts because:\n1. The `az notify` command was slow (~600ms) due to `bun run` TypeScript compilation\n2. Session naming was inconsistent - hooks expected `claude-\u003cbeadId\u003e` but sessions were created as just `\u003cbeadId\u003e`\n\n## Solution\n\n### 1. Fast Shell Script (`bin/az-notify.sh`)\nCreated a lightweight shell script that directly calls `tmux set-option`:\n- **Before:** `bun run az.ts notify ...` ‚Üí ~600ms\n- **After:** Shell script with direct tmux ‚Üí ~10ms (60x faster)\n\nThe script:\n- Maps events to status (pretooluse/user_prompt‚Üíbusy, permission_request/idle_prompt/stop‚Üíwaiting, session_end‚Üíidle)\n- Sets `@az_status` tmux session option\n- Logs to `/tmp/az-notify-debug.log` for debugging\n\n### 2. Updated Hook Generation (`src/core/hooks.ts`)\n- Changed `generateHookConfig()` to use `az-notify.sh` instead of `bun run az.ts`\n- Added `getAzNotifyPath()` helper for the shell script path\n\n### 3. Consistent Session Naming\nFixed session naming to consistently use `claude-\u003cbeadId\u003e` prefix:\n- `src/core/paths.ts`: Added `CLAUDE_SESSION_PREFIX` constant, updated `getSessionName()`\n- `src/core/TmuxSessionMonitor.ts`: Import prefix from paths.ts\n- `src/core/ClaudeSessionManager.ts`: Updated crash recovery to extract beadId from prefixed session names\n- `src/cli/index.ts`: Use `getSessionName()` instead of hardcoded prefix\n\n### Session Types\nDifferent session types use different prefixes:\n- `claude-\u003cbeadId\u003e` - Claude work sessions (for bead work)\n- `az-dev-\u003cbeadId\u003e` - Dev server sessions\n- `chat-\u003cbeadId\u003e` - Chat sessions\n\n## Files Modified\n- `bin/az-notify.sh` (new)\n- `src/core/hooks.ts`\n- `src/core/paths.ts`\n- `src/core/TmuxSessionMonitor.ts`\n- `src/core/ClaudeSessionManager.ts`\n- `src/cli/index.ts`","acceptance_criteria":"- [ ] Hook notifications complete in \u003c50ms (not 600ms)\n- [ ] Permission prompts trigger \"waiting\" status within 100ms\n- [ ] PreToolUse notifications don't block other hooks\n- [ ] Manual `az notify` CLI still works for debugging","notes":"üìé [mjfh0nen-31wy.png](.beads/images/az-ivql/mjfh0nen-31wy.png) (clipboard, 12/21/2025, 7:34:11 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T19:34:09.775411+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T21:47:28.550981+11:00","close_reason":"Implemented fast hook notifications and consistent session naming. Changes merged to main.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-j7qi","title":"Create quality-gate subagent definition","description":"Reusable subagent that validates epic readiness for parallel execution.\n\n**Core function:** Detect file conflicts between tasks that will run simultaneously.\n\n**Outputs:**\n- Which tasks can safely run in parallel\n- Conflict warnings (tasks touching same files)\n- Suggested groupings or reordering\n\n**Location:** .claude/agents/quality-gate.md (portable to other beads projects)","design":"## Implementation Plan\n\n### Purpose\nReusable Claude Code Task tool subagent that analyzes epic tasks for parallel execution safety.\n\n### Design Decisions (from user clarification)\n1. **File detection**: Both codebase analysis (Grep/Glob) AND parsing explicit file mentions from task metadata\n2. **Granularity**: File-level conflicts (any two tasks touching same file = conflict)\n3. **Invocation**: On-demand by orchestrator via Task tool (not pre-flight)\n\n### Agent Definition Structure\n\n**Location:** `.claude/agents/quality-gate.md`\n\n**Inputs (from orchestrator prompt):**\n- Epic ID and context\n- List of child task IDs to analyze\n\n**Analysis Steps:**\n1. For each task, gather file touchpoints via:\n   - Parse task description/design for explicit file paths\n   - Search codebase for keywords from task title (imports, references)\n   - Identify related files by pattern (e.g., \"TaskCard\" ‚Üí TaskCard.tsx, TaskCard.test.ts)\n2. Build task ‚Üí files mapping\n3. Detect overlaps (file mentioned by 2+ tasks = conflict)\n4. Group non-conflicting tasks into parallel batches\n\n**Output Format (structured for orchestrator):**\n```markdown\n## Analysis Results\n\n### Task File Mappings\n- az-xxx: [file1.ts, file2.ts]\n- az-yyy: [file3.ts]\n- az-zzz: [file1.ts, file4.ts]  ‚Üê conflicts with az-xxx\n\n### Conflicts Detected\n- az-xxx ‚Üî az-zzz: Both touch file1.ts\n\n### Recommended Parallel Batches\n**Batch 1 (can run together):** az-xxx, az-yyy\n**Batch 2 (after batch 1):** az-zzz\n\n### Confidence Notes\n- High confidence: explicit file mentions found\n- Medium: inferred from keywords\n- Low: task scope unclear, recommend serial execution\n```\n\n### Portability\n- No Azedarach-specific code - just beads CLI for reading tasks\n- Works in any beads-enabled project\n- Orchestrator just needs to pass epic ID in the prompt","acceptance_criteria":"1. Agent file exists at `.claude/agents/quality-gate.md`\n2. Agent can be invoked via Task tool with epic ID\n3. Agent uses `bd show` to read task details\n4. Agent uses Grep/Glob to identify related files\n5. Agent outputs structured parallel batch recommendations\n6. Agent identifies file-level conflicts between tasks\n7. Agent is portable (no azedarach-specific imports)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.47434+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T11:53:29.237705+11:00","close_reason":"Created .claude/agents/quality-gate.md - a portable subagent definition for analyzing epic tasks for parallel execution safety. Agent uses file-level conflict detection via codebase analysis (rg/fd) and explicit file parsing from task metadata. Outputs structured batch recommendations for orchestrator consumption.","dependencies":[{"issue_id":"az-j7qi","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.766793+11:00","created_by":"daemon"},{"issue_id":"az-j7qi","depends_on_id":"az-0h3d","type":"blocks","created_at":"2025-12-19T11:14:22.034941+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-j95d","title":"our settings.local.json merge feature doesnt work like i wanted","description":"It should work by merging in WorkTree settings.local.json files into main when we merge with space m. making sure to avoid duplicate settings","design":"## Problem\n\nWhen merging a worktree branch to main with `Space+m`, the `settings.local.json` file is not merged back. Claude Code adds permission grants (allowedTools, trustedPaths, etc.) to this file during sessions. These permissions are lost when the worktree is deleted after merge.\n\n## Solution\n\n1. **Create `mergeClaudeLocalSettings` function** in `src/core/hooks.ts`:\n   - Read worktree's `settings.local.json`\n   - Read main's `settings.local.json`\n   - Extract permission-related keys from worktree (NOT hooks - those are bead-specific)\n   - Deep merge with deduplication for arrays\n   - Write merged result to main's `settings.local.json`\n\n2. **Permission keys to merge**:\n   - `allowedTools` (array)\n   - `trustedPaths` (array)\n   - Other permission settings Claude may add\n\n3. **Deduplication strategy**:\n   - For arrays, deduplicate by JSON stringification (full object equality)\n   - This prevents duplicate tool/path entries\n\n4. **Integration point**:\n   - Add call to `mergeClaudeLocalSettings` in `PRWorkflow.mergeToMain`\n   - Called BEFORE worktree deletion\n   - Errors are logged but don't fail the merge (same as current settings copy behavior)\n\n## Files to modify\n\n- `src/core/hooks.ts` - Add `mergeClaudeLocalSettings` function + dedup helper\n- `src/core/PRWorkflow.ts` - Call merge function during `mergeToMain`","acceptance_criteria":"- [ ] When merging with Space+m, permission grants from worktree's settings.local.json are merged into main's settings.local.json\n- [ ] No duplicate entries in allowedTools or trustedPaths arrays after merge\n- [ ] Hook configurations are NOT merged (they are bead-specific)\n- [ ] Merge failures are logged but don't block the overall merge operation\n- [ ] Type-check passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:04:25.684598+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T11:08:46.056379+11:00","close_reason":"Implemented mergeClaudeLocalSettings() function to merge permission grants from worktree settings.local.json back to main during Space+m merge. Deduplicates array entries and excludes bead-specific hook configs.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-j9h1","title":"pr icon never shows up","description":"we may wanna poll gh cli for pr with bead in title or something like that as well as fixing the fuckin space P flow to save pr state somewhere","design":"## PR Icon Display Fix - Implementation Plan\n\n### Problem Analysis\nThe PR icon never shows up because:\n1. **No PR state field in `TaskWithSession`** - The type system doesn't model PR state at all\n2. **Notes field stores PR URL** (`PR: https://...`) but is **never parsed** for display\n3. **`TaskCard.tsx` has no PR indicator** - It shows session, worktree, conflict, dev server, and phase indicators, but no PR indicator\n4. **No gh CLI polling** for PR state - We can't distinguish open/merged/closed PRs\n\n### Solution Design\n\n**Approach**: Parse notes field for fast initial display + poll gh CLI for accurate state (open/merged/closed)\n\n#### 1. Add PR State Types (`src/ui/types.ts`)\n```typescript\n// PR state detected from gh CLI\nexport type PRState = \"open\" | \"merged\" | \"closed\" | \"draft\" | undefined\n\n// Add to TaskWithSession interface\nexport interface TaskWithSession extends Issue, SessionMetrics, GitStatus {\n  // ... existing fields ...\n  /** Whether a PR exists for this task (fast check from notes field) */\n  hasPR?: boolean\n  /** PR state from gh CLI polling (open, merged, closed, draft) */\n  prState?: PRState\n  /** PR URL extracted from notes field */\n  prUrl?: string\n  /** PR number extracted from notes field */\n  prNumber?: number\n}\n\n// Add PR indicator constant\nexport const PR_INDICATORS: Record\u003cNonNullable\u003cPRState\u003e | \"unknown\", string\u003e = {\n  open: \"üîó\",      // Link = open PR\n  draft: \"üìù\",     // Draft = not ready\n  merged: \"‚úÖ\",    // Checkmark = merged (same as done for clarity)\n  closed: \"üö´\",    // No = closed without merge\n  unknown: \"üîó\",   // Fallback for when we have URL but no gh CLI state\n}\n```\n\n#### 2. Create PRStateService (`src/services/PRStateService.ts`)\n- **Purpose**: Poll gh CLI periodically to get accurate PR states\n- **Caching**: Cache PR states with 30s TTL (similar to parent epic cache)\n- **Batching**: Query multiple PRs in parallel (bounded concurrency)\n- **Registration**: Register with DiagnosticsService for visibility\n\n```typescript\ninterface PRStateCache {\n  state: PRState\n  timestamp: number\n}\n\nexport class PRStateService extends Effect.Service\u003cPRStateService\u003e()(\"PRStateService\", {\n  scoped: Effect.gen(function* () {\n    const prStateCache = yield* Ref.make\u003cMap\u003cstring, PRStateCache\u003e\u003e(new Map())\n    \n    const getPRState = (prUrl: string) =\u003e // ... poll gh pr view\n    const refreshPRStates = (prUrls: string[]) =\u003e // ... batch refresh\n    \n    return { getPRState, refreshPRStates, prStateCache }\n  }),\n}) {}\n```\n\n#### 3. Modify BoardService.loadTasks\n- **Parse notes field**: Extract `hasPR`, `prUrl`, `prNumber` from notes like `PR: https://github.com/.../pull/123`\n- **Enrich with gh CLI state**: Call `PRStateService.getPRState()` for tasks with PRs\n- **Progressive disclosure**: Initially show \"unknown\" indicator, then update when gh CLI responds\n\n#### 4. Add PR Indicator to TaskCard.tsx\nLocation: In `getHeaderLine()` after worktree/conflict/phase/dev server indicators\n\n```typescript\n// Show PR indicator when task has a PR\nif (props.task.hasPR || props.task.prState) {\n  const prIndicator = props.task.prState \n    ? PR_INDICATORS[props.task.prState]\n    : PR_INDICATORS.unknown\n  line += ` ${prIndicator}`\n}\n```\n\n#### 5. Polling Integration\n- Background fiber in PRStateService polls every 30s\n- Only polls for beads with notes containing \"PR:\"\n- Updates shared cache that BoardService reads during loadTasks\n\n### Files to Modify\n1. `src/ui/types.ts` - Add PRState type and TaskWithSession fields\n2. `src/services/PRStateService.ts` - NEW: gh CLI polling service\n3. `src/services/BoardService.ts` - Parse notes, integrate PR state\n4. `src/ui/TaskCard.tsx` - Add PR indicator to header line\n5. `src/ui/atoms.ts` or layer - Register PRStateService\n\n### Edge Cases\n- **Offline mode**: Fall back to notes-only detection (hasPR = true, prState = undefined)\n- **gh CLI not installed**: Graceful fallback, log warning\n- **Rate limiting**: Respect gh CLI rate limits, use cache aggressively\n- **Cross-project PRs**: Cache is keyed by PR URL, works across projects","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T19:01:43.359093+11:00","updated_at":"2026-01-02T10:53:46.73889+11:00","closed_at":"2026-01-02T10:53:46.738895+11:00"}
{"id":"az-jb2v","title":"Fix context capture in CommandQueue operations","description":"Fix all CommandQueueService operations that query project context inside the queued effect.\n\n**Operations to fix:**\n\n1. **PRHandlersService.doMerge** (line 70-80)\n   - Move `getProjectPath()` call BEFORE `withQueue`\n   - Pass captured path to `prWorkflow.mergeToMain()`\n\n2. **PRHandlersService.updateFromBase** (line 143-156)\n   - Move `getProjectPath()` call BEFORE `withQueue`\n   - Pass captured path to `prWorkflow.updateFromBase()`\n\n3. **PRHandlersService.abortMerge** (line 548-558)\n   - Move `getProjectPath()` call BEFORE `withQueue`\n   - Pass captured path to `prWorkflow.abortMerge()`\n\n**Pattern to follow (from SessionHandlersService:94):**\n```typescript\nconst projectPath = yield* helpers.getProjectPath()\n\nyield* helpers.withQueue(\n  task.id,\n  \"start\",\n  sessionManager.start({ beadId: task.id, projectPath })\n)\n```\n\n**Testing:**\n- Start a merge operation\n- Immediately switch projects before merge completes\n- Verify merge targets original project, not new one","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-01T22:06:56.763458+11:00","updated_at":"2026-01-01T22:19:56.397667+11:00","dependencies":[{"issue_id":"az-jb2v","depends_on_id":"az-67fc","type":"parent-child","created_at":"2026-01-01T22:07:11.197134+11:00","created_by":"daemon"},{"issue_id":"az-jb2v","depends_on_id":"az-mqpe","type":"blocks","created_at":"2026-01-01T22:07:22.58366+11:00","created_by":"daemon"}]}
{"id":"az-jb2v.1","title":"Fix flexbox layout - main view height and status bar height","description":"BUG: The new flexbox layout has wrong cell dimensions causing UI display issues. Problems: 1) mainRow uses flexbox.NewCell(1, 1) for mainView - should use (1, m.height-1) to account for status bar 2) statusRow uses flexbox.NewCell(1, 0) for statusBarView - should use (1, 1) to give status bar proper height. Root cause: Hardcoded heights instead of calculated dimensions. Impact: Only shows 1 line of content and status bar is invisible. Fix: Calculate heights dynamically based on m.height and statusBarHeight constant. File to fix: internal/app/model.go around lines 811-818.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-05T01:13:38.803035+11:00","updated_at":"2026-01-05T01:17:13.729286+11:00","closed_at":"2026-01-05T01:17:13.729286+11:00","close_reason":"Fixed flexbox layout - main view now uses m.height-1 and status bar uses height 1. UI now displays properly with all tasks visible and status bar showing.","dependencies":[{"issue_id":"az-jb2v.1","depends_on_id":"az-jb2v","type":"parent-child","created_at":"2026-01-05T01:13:38.803655+11:00","created_by":"riordan"}]}
{"id":"az-jc3k","title":"since we filtered epic children out of the main board arrow navigation has broken","design":"## Root Cause\n\nThe UI rendering and navigation service have divergent filtering logic:\n\n1. **UI (board.ts:200)**: On main board, filters tasks with `task.parentEpicId === undefined`\n2. **NavigationService (line 96-98)**: On main board, returns ALL tasks (only checks `drillDownChildIds.size === 0`)\n\nResult: Navigation can move cursor to tasks that are hidden from the UI (epic children).\n\n## Fix\n\nUpdate `getFilteredTasksByColumn()` in NavigationService.ts to match UI filtering:\n\n```typescript\n// Apply drill-down filter if active\nconst childIds = yield* SubscriptionRef.get(drillDownChildIds)\nif (childIds.size === 0) {\n  // Main board: filter OUT epic children (same as board.ts:200)\n  return tasksByColumn.map((column) =\u003e \n    column.filter((task) =\u003e task.parentEpicId === undefined)\n  )\n}\n// Drill-down: filter to only children\nreturn tasksByColumn.map((column) =\u003e \n  column.filter((task) =\u003e childIds.has(task.id))\n)\n```\n\n## Files to Change\n- `src/services/NavigationService.ts` (lines 94-102)\n\n## Testing\n1. Create an epic with child tasks\n2. Navigate main board with j/k - should skip epic children\n3. Enter drill-down (Enter on epic) - should navigate children only\n4. Exit drill-down (Escape) - navigation should work correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:44:19.97566+11:00","updated_at":"2025-12-30T21:31:58.425934+11:00","closed_at":"2025-12-30T21:31:58.425936+11:00","close_reason":"Fixed: NavigationService.getFilteredTasksByColumn() now filters out epic children on main board (task.parentEpicId === undefined), matching board.ts drillDownFilteredTasksAtom logic. Commit e5fcb56."}
{"id":"az-jhbz","title":"fix issues with select mode","description":"i cant do any actions on selected items currently\ni need to be able to move them left/right columns, clean them up, etc\nkeybind is wrong. space should be to open action menu not to select. select should be \"a\" or something.\nshould be select all in column keybind\nshould be select all keybind \"%\"","design":"## Implementation Design (Updated)\n\n### UX Flow\n1. `v` ‚Üí enters select mode (empty selection)\n2. Navigate with `hjkl`\n3. `a` ‚Üí toggles current task's selection (add/remove)\n4. `S-a` ‚Üí select all tasks in current column\n5. `%` ‚Üí select all tasks (existing)\n6. `Space` ‚Üí opens action menu (same as normal mode)\n7. Actions in action menu apply to ALL selected tasks\n8. `v` or `Esc` ‚Üí exit select mode\n\n### Keybinding Changes in `bindings.ts`\n\n#### Select Mode Changes:\n| Key | Current | New |\n|-----|---------|-----|\n| `space` | Toggle selection | **Enter action mode** (capture selected IDs) |\n| `a` | (none) | **Toggle current task selection** |\n| `S-a` | Clear selections | **Select all in column** |\n| `v` | Exit select mode | Exit select mode (unchanged) |\n| `%` | Select all | Select all (unchanged) |\n\n#### Action Mode Changes:\n- No changes needed! Action handlers already use `getActionTargetTasks()` which checks for selectedIds first\n\n### Implementation Details\n\n#### 1. Change `space` in select mode\n```typescript\n// FROM:\n{ key: \"space\", mode: \"select\", description: \"Toggle selection\", action: bc.helpers.toggleCurrentSelection() }\n\n// TO:\n{ key: \"space\", mode: \"select\", description: \"Enter action mode\", \n  action: Effect.gen(function* () {\n    const taskId = yield* bc.nav.getFocusedTaskId()\n    yield* bc.editor.enterAction(taskId)  // Same as normal mode\n  })\n}\n```\n\n#### 2. Add `a` for toggle selection\n```typescript\n{ key: \"a\", mode: \"select\", description: \"Toggle selection\",\n  action: Effect.suspend(() =\u003e bc.helpers.toggleCurrentSelection())\n}\n```\n\n#### 3. Change `S-a` to select all in column\n```typescript\n{ key: \"S-a\", mode: \"select\", description: \"Select all in column\",\n  action: Effect.gen(function* () {\n    // Need to get tasks in current column\n    const pos = yield* bc.nav.getCursorPosition()\n    const columns = yield* bc.board.getColumns() // or similar\n    const columnTasks = columns[pos.columnIndex]?.tasks ?? []\n    const selectableIds = columnTasks\n      .filter((t) =\u003e t.status !== \"tombstone\")\n      .map((t) =\u003e t.id)\n    yield* bc.editor.addToSelection(selectableIds)\n    yield* bc.toast.show(\"info\", `Selected ${selectableIds.length} tasks in column`)\n  })\n}\n```\n\n### Files to Modify\n1. `src/services/keyboard/bindings.ts` - Change select mode bindings\n2. `src/services/EditorService.ts` - May need `addToSelection()` method if not exists\n3. `docs/keybindings.md` - Update documentation\n\n### Acceptance Criteria\n- [ ] `a` toggles current task selection in select mode\n- [ ] `Space` in select mode opens action menu\n- [ ] `S-a` selects all tasks in current column\n- [ ] Actions from action menu apply to all selected tasks\n- [ ] Documentation updated","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T09:35:39.722356+11:00","updated_at":"2025-12-31T11:02:28.329796+11:00","closed_at":"2025-12-31T11:02:28.329799+11:00"}
{"id":"az-jjht","title":"when i scroll down with arrow keys in board view, cursor goes off the screen","description":"When navigating with arrow keys (j/k) in the board view, if there are more tasks than can fit on screen, the cursor can move to a position that's not visible. This happens because the viewport windowing logic only scrolls DOWN when the cursor approaches the bottom, but doesn't scroll UP when the cursor is near the top of the list.\n\n**Root cause in Column.tsx (lines 131-137):**\n```typescript\nlet startTaskIdx = 0\nif (selectedIdx \u003e= max - 1) {\n  // Scroll so selection is near bottom of window\n  startTaskIdx = Math.min(selectedIdx - max + 2, taskItems.length - max)\n}\n```\n\nThis logic only adjusts the window when `selectedIdx \u003e= max - 1`, meaning:\n- If you're at task 10 and press UP to go to task 9, and max=5, the window stays at 6-10 even though task 9 is now off-screen above\n- If wrapping occurs (bottom to top), the window doesn't scroll back to show task 0\n\n**Reproduction:**\n1. Have a column with more tasks than fit on screen (e.g., 10 tasks, 5 visible)\n2. Navigate down until cursor is at bottom visible task\n3. Continue pressing down - window scrolls correctly\n4. Press up - cursor moves to previous task but may be off-screen above the window","design":"**Fix: Ensure viewport window always keeps selected task visible**\n\nChange the windowing logic in `Column.tsx` to center the selected task in the viewport, or at minimum ensure it's always within the visible range.\n\n**Current logic (broken):**\n```typescript\nlet startTaskIdx = 0\nif (selectedIdx \u003e= max - 1) {\n  startTaskIdx = Math.min(selectedIdx - max + 2, taskItems.length - max)\n}\n```\n\n**New logic (fix):**\n```typescript\n// Center the selection in the visible window when possible\n// If selection is near start, show from beginning\n// If selection is near end, show the last `max` items\n// Otherwise, center the selection\nlet startTaskIdx: number\nif (selectedIdx \u003c Math.floor(max / 2)) {\n  // Near start - show from beginning\n  startTaskIdx = 0\n} else if (selectedIdx \u003e taskItems.length - Math.ceil(max / 2)) {\n  // Near end - show last `max` items\n  startTaskIdx = Math.max(0, taskItems.length - max)\n} else {\n  // Center the selection\n  startTaskIdx = selectedIdx - Math.floor(max / 2)\n}\n```\n\nThis ensures:\n1. Selected task is always visible (centered when possible)\n2. Wrap-around (bottom to top) scrolls the window back up\n3. Pressing UP when at top of window scrolls up to keep cursor visible\n\n**Files to modify:**\n- `src/ui/Column.tsx` - Fix the `visibleData` useMemo calculation\n\n**Testing:**\n1. Create/find a column with 10+ tasks\n2. Navigate down past visible area - cursor should stay visible\n3. Navigate up from middle - cursor should stay visible  \n4. Wrap from bottom to top (down at last task) - should scroll to top\n5. Wrap from top to bottom (up at first task) - should scroll to bottom","acceptance_criteria":"- [ ] Cursor is always visible when navigating with arrow keys (j/k or up/down)\n- [ ] Navigating down scrolls the viewport to keep cursor visible\n- [ ] Navigating up scrolls the viewport to keep cursor visible\n- [ ] Wrapping from bottom to top shows the top of the list\n- [ ] Wrapping from top to bottom shows the bottom of the list\n- [ ] Phase separators (in drill-down mode) don't break the windowing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T22:38:17.088597+11:00","updated_at":"2025-12-31T09:44:30.261424+11:00","closed_at":"2025-12-31T09:44:30.261427+11:00","close_reason":"Fixed with two commits:\n1. 9997758: Center cursor in viewport (Column.tsx) - changed windowing from edge-triggered to center-based\n2. 05e4906: Correct height calculation (atoms/board.ts) - TASK_CARD_HEIGHT was 4 but actual is 6, now imported from TaskCard.tsx","comments":[{"id":16,"issue_id":"az-jjht","author":"riordan","text":"Additional fix needed - height calculation was also wrong","created_at":"2025-12-30T22:41:25Z"}]}
{"id":"az-k5a","title":"is there a hook for when claude requests to enter plan mode","description":"if there is we should use it to update the session status\nif not we should improve our pty monitoring to pick it up","notes":"## Research Findings\n\n**Answer: No dedicated hook for plan mode entry/exit.**\n\nPlan mode is a permission system state, not a tool-based event. However, detection is possible via:\n\n### Available Options for Azedarach\n\n1. **Monitor `permission_mode` field in hooks** - All hooks receive this field:\n   - `PreToolUse`, `PostToolUse`, `PermissionRequest` all include `permission_mode: \"plan\"|\"default\"|...`\n   - Could detect mode by watching for changes in this field\n\n2. **PTY output monitoring** (current approach) - Look for plan mode indicators:\n   - Claude asking \"Would you like me to enter plan mode?\"\n   - Plan mode banner/status in terminal output\n   - ExitPlanMode tool calls\n\n3. **Transcript file parsing** - `transcript_path` in hook inputs points to conversation JSON\n\n### Recommendation for Azedarach\n\nEnhance PTY monitoring to detect:\n- Plan mode entry prompt patterns\n- `permission_mode` changes via any existing hooks we're using\n- Plan mode exit via ExitPlanMode tool detection\n\nThis is a documentation/research task - no code changes needed unless we want to implement enhanced detection.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:33:09.074229+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T12:42:32.735864+11:00","close_reason":"Implemented plan mode detection via PTY monitoring. Added planMode as AgentPhase with detection patterns for plan mode indicators, ExitPlanMode tool, and status bar patterns.","comments":[{"id":5,"issue_id":"az-k5a","author":"riordan","text":"Implementing plan mode detection via PTY monitoring as requested","created_at":"2025-12-18T01:40:43Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-k5m","title":"Persist session state via tmux query","description":"Session state is lost on azedarach restart because SessionManager stores state in-memory Ref. Fix by querying tmux list-sessions on startup and matching session names to bead IDs.","design":"Option 1 (recommended): Query tmux as source of truth\n- On SessionManager init or listActive(), also run tmux list-sessions\n- Parse session names matching our pattern (just beadId)\n- Merge with in-memory state\n- Tmux existence = session exists, regardless of in-memory state\n\nImplementation:\n1. Add syncFromTmux() method to SessionManager\n2. Call it in listActive() before returning\n3. Or call it once on service init via Effect.sync in the Layer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:33:52.363085+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T11:34:33.533566+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-k6hn","title":"reach feature and design parity for go-bubbletea with ts-opentui app","description":"use TDD\nulw\nin the attached image you can see the design differences, the ts version (left) looks much better. the go version (right) is missing bottom bar, beads are missing (have to use bd list --limit=0), less colouful, missign multi line titles and icons, etc","design":"## Progress - Using TDD Approach\n\n**Completed (TDD verified):**\n- StatusBar: project name, mode badges (ACT/NOR/SRC/SEL/GTO), task counts\n- Column: scroll indicators (‚Üë N / ‚Üì N)\n- TaskCard: multi-line title wrapping (no more ellipsis truncation)\n- TaskCard: git status (‚ÜìN behind, ‚óè dirty, +/- diff stats)\n- Session icons and elapsed timer (already implemented)\n\n**Tests added:**\n- TestRenderCard_TitleWrapping\n- TestRenderCard_GitStatus (3 sub-tests)\n\n**Remaining:**\n- Context health border coloring (red/yellow based on ContextPercent)\n- Final integration testing\n\n**Architecture notes:**\n- Added GitBehindCount, HasUncommittedChanges, GitAdditions, GitDeletions to domain.Task\n- These fields are populated from beads data (to be implemented in beads client)","notes":"üìé [mjz4rxfp-sang.png](.beads/images/az-k6hn/mjz4rxfp-sang.png) (clipboard, 1/4/2026, 1:46:53 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:42:41.383272+11:00","updated_at":"2026-01-04T14:55:10.132969+11:00","closed_at":"2026-01-04T14:55:10.132969+11:00","close_reason":"Feature and design parity achieved: StatusBar enhancements, multi-line titles, git status indicators, scroll indicators all implemented with TDD"}
{"id":"az-kct","title":"(deleted)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-15T01:52:58.144161Z","updated_at":"2025-12-15T01:52:58.144161Z","deleted_at":"2025-12-15T01:52:58.144161Z","deleted_by":"riordan","delete_reason":"manual delete"}
{"id":"az-kej","title":"add a way to see the diff between a bead branch and main so i can code review","design":"## Implementation Plan: Git Diff Overlay\n\n### Overview\nAdd a \"diff\" action (Space+g) that shows git diff between the bead's branch and main in a scrollable overlay. This enables code review directly from the Azedarach TUI.\n\n### Architecture\nFollowing existing patterns:\n1. **PRWorkflow**: Add `getDiff()` method to get branch diff\n2. **OverlayService**: Add `diff` overlay type  \n3. **prHandlers**: Add `showDiff()` handler\n4. **bindings.ts**: Register `g` key in action mode\n5. **DiffOverlay**: New component to display diff with syntax coloring\n6. **useOverlays**: Add `showingDiff` flag\n7. **App.tsx**: Render DiffOverlay\n8. **ActionPalette**: Add \"diff\" action line\n\n### Key Design Decisions\n- Use `git diff main..{branch}` for the diff (shows what branch adds to main)\n- Display in tmux popup for proper scrolling and less +F style viewing\n- Key: `g` in action mode (mnemonic: \"git diff\" or \"get diff\")\n- Requires non-idle session (needs worktree to diff)\n\n### Implementation Order\n1. Add getDiff to PRWorkflow.ts\n2. Add handler in prHandlers.ts  \n3. Register keybinding in bindings.ts\n4. Add to ActionPalette.tsx\n5. Update docs/keybindings.md","notes":"Using tmux popup approach (like Space+L for logs) instead of custom overlay - simpler, better scrolling, proper terminal rendering of ANSI colors from git diff","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T02:10:27.860224+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T02:22:52.010639+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-kg5g","title":"getting \"Failed to create PR\" offline error when i am connected to internet","description":"in Chefy project","design":"## Root Cause Analysis\n\n**Symptom:** \"Failed to create PR\" with offline error shown when user IS connected to the internet\n\n**Primary Cause:** `NetworkService.checkConnectivity()` is falsely reporting offline status\n\nThe connectivity check uses a HEAD request to github.com:\n```typescript\nfetch(`https://${host}`, {\n  method: \"HEAD\",\n  signal: AbortSignal.timeout(5000),\n})\n```\n\nPotential failure modes:\n1. **GitHub blocks HEAD requests** - Some servers don't respond to HEAD or respond differently\n2. **5-second timeout too aggressive** - May time out on slower connections\n3. **Bun fetch quirks** - Bun's fetch implementation might behave differently\n4. **Corporate proxies/firewalls** - May intercept and fail the request\n5. **SSL/TLS issues** - Certificate verification could fail in certain environments\n\n**Secondary Cause:** `OfflineError` formatting is missing from ErrorFormatter registry, causing \"[object Object]\" display instead of a readable message.\n\n## Implementation Plan\n\n1. **Make NetworkService connectivity check more robust**:\n   - Try HEAD first, fallback to GET on failure\n   - Increase timeout from 5s to 10s\n   - Check response.ok instead of just completion\n   - Add logging for debugging failed checks\n\n2. **Add OfflineError to ErrorFormatter registry** for proper error display\n\n3. **Fix PRHandlersService error handling** to use formatForToast() consistently\n\n## Files to Modify\n- `src/services/NetworkService.ts` - Improve connectivity check robustness\n- `src/services/ErrorFormatter.ts` - Add OfflineError formatter\n- `src/services/keyboard/PRHandlersService.ts` - Use formatForToast in error handler","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T11:02:10.174411+11:00","updated_at":"2025-12-31T17:57:20.977333+11:00","closed_at":"2025-12-31T17:57:20.977333+11:00","close_reason":"Fixed false offline detection by making NetworkService connectivity check more robust (HEAD+GET fallback, 10s timeout). Added OfflineError to ErrorFormatter for proper error messages instead of [object Object]."}
{"id":"az-kgq","title":"Multi-project support","description":"Monitor tasks across multiple beads-enabled projects.","design":"- az add /path/to/project: register project\n- az list: show registered projects\n- Combined view: tasks from all projects, grouped or mixed\n- Project selector/filter in TUI\n- Per-project configuration","notes":"Root cause identified: TWO issues\n1. `az add` doesn't exist as a top-level command - only `az project add`\n2. tmux wrapping applies to ALL commands, but when attaching to existing session with `-A`, the command is IGNORED - so `az add` just attaches to TUI instead of running add command\n\nFix: Only wrap in tmux for the default TUI command, not for subcommands","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T14:45:41.986553+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T14:15:34.883797+11:00","dependencies":[{"issue_id":"az-kgq","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.274456+11:00","created_by":"daemon"}],"comments":[{"id":8,"issue_id":"az-kgq","author":"riordan","text":"CLI add command still not working - immediately exits or opens TUI instead of adding project","created_at":"2025-12-18T02:57:48Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-kis","title":"Utility modules: paths, logger, tmux helpers","description":"Create foundational utility modules used throughout the codebase.","design":"- paths.ts: worktree path generation, project name extraction (pure functions)\n- logger.ts: Use Effect's built-in Logger service with custom formatting\n- tmux.ts: TmuxService as Effect.Service wrapping @effect/platform Command\n  - Methods: newSession, attachSession, sendKeys, listSessions, killSession\n  - Typed errors: TmuxNotFoundError, SessionNotFoundError\n- terminal.ts: TerminalService for detecting/launching terminal emulators\n  - Support Ghostty, iTerm, Terminal.app\n  - Returns Effect with TerminalNotFoundError","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- TmuxService Effect service\n- TerminalService Effect service\n- paths.ts pure utility functions\n\nFILES CREATED:\n- src/core/TmuxService.ts (3.6KB) - tmux session management\n- src/core/TerminalService.ts (1.8KB) - terminal detection/launching\n- src/core/paths.ts (868B) - path utilities\n- src/core/example-usage.ts (2.5KB) - usage examples\n\nTMUX SERVICE METHODS:\n- newSession(name, opts?) - Create detached session\n- killSession(name) - Kill session\n- listSessions() - List with metadata (windows, created, attached)\n- hasSession(name) - Check existence\n- sendKeys(session, keys) - Send keystrokes\n- attachCommand(session) - Get attach command string\n\nTERMINAL SERVICE METHODS:\n- detect() - Returns \"ghostty\" | \"iterm\" | \"terminal-app\" | \"unknown\"\n- openWithCommand(cmd) - Opens new terminal window with command\n\nPATH UTILITIES:\n- getProjectName(path) - Extract basename\n- getWorktreePath(projectPath, beadId) - ../ProjectName-\u003cbeadId\u003e/\n- getSessionName(beadId) - Uses bead ID directly\n- normalizePath(path) - path.resolve()\n\nVERIFICATION:\n- All files compile with TypeScript strict mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:44:26.516814+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T17:25:14.137924+11:00","dependencies":[{"issue_id":"az-kis","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.116031+11:00","created_by":"daemon"},{"issue_id":"az-kis","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.747591+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-kmuk","title":"tui_core: Border drawing - box borders and line characters","description":"Utility for drawing box borders with various styles.\n\n## Why\nBox borders need special characters and proper corner handling. This is tricky to get right inline.\n\n## API (Gleam)\n```gleam\ntype BorderStyle {\n  None\n  Single      // ‚îÄ ‚îÇ ‚îå ‚îê ‚îî ‚îò\n  Double      // ‚ïê ‚ïë ‚ïî ‚ïó ‚ïö ‚ïù\n  Rounded     // ‚îÄ ‚îÇ ‚ï≠ ‚ïÆ ‚ï∞ ‚ïØ\n  Bold        // ‚îÅ ‚îÉ ‚îè ‚îì ‚îó ‚îõ\n  Dashed      // ‚ïå ‚ïé ‚îå ‚îê ‚îî ‚îò\n}\n\ntype BorderChars {\n  BorderChars(\n    top: String, bottom: String, left: String, right: String,\n    top_left: String, top_right: String,\n    bottom_left: String, bottom_right: String,\n  )\n}\n\n/// Get characters for a border style\nfn get_chars(style: BorderStyle) -\u003e BorderChars\n\n/// Draw border to a FrameBuffer (just the border, not contents)\nfn draw_border(\n  fb: FrameBuffer,\n  x: Int, y: Int, width: Int, height: Int,\n  style: BorderStyle,\n  fg: Color, bg: Color,\n) -\u003e FrameBuffer\n```\n\n## Reference\n- Box-drawing characters: https://en.wikipedia.org/wiki/Box-drawing_character\n\n## Acceptance Criteria\n- [ ] All 5 border styles with correct characters\n- [ ] Correct corner handling\n- [ ] Draw to FrameBuffer correctly\n- [ ] Handle width=1 or height=1 edge cases","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:31:22.516664+11:00","updated_at":"2025-12-28T11:31:22.516664+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-kmuk","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.272007+11:00","created_by":"daemon"},{"issue_id":"az-kmuk","depends_on_id":"az-xe2h","type":"blocks","created_at":"2025-12-28T11:34:25.186165+11:00","created_by":"daemon"},{"issue_id":"az-kmuk","depends_on_id":"az-hkfa","type":"blocks","created_at":"2025-12-28T11:34:25.24931+11:00","created_by":"daemon"}]}
{"id":"az-kny9","title":"add ability to configure local/origin mode so that you either work via space m to merge or space P to pull request","description":"so you cannot accidentally use the wrong worflow in a project. this also means we need to make this config the source of truth of the base branch being remote or local. currently its always local","design":"## Implementation Plan: git.workflowMode\n\n### Goal\nAdd `git.workflowMode: 'local' | 'origin'` config that:\n1. Hides Space+m (merge) in origin mode, hides Space+P (PR) in local mode\n2. Changes base branch reference for diffs/conflicts: local mode uses `baseBranch`, origin mode uses `origin/${baseBranch}`\n3. Default: `origin` (common team workflow), configure this repo for `local`\n\n### Changes Required\n\n**1. Schema (src/config/schema.ts)**\n- Add `workflowMode: Schema.optional(Schema.Literal('local', 'origin'))` to GitConfigSchema\n- Export WorkflowMode type\n\n**2. Defaults (src/config/defaults.ts)**\n- Add `workflowMode: 'origin'` to DEFAULT_CONFIG.git\n- Add to ResolvedConfig interface\n\n**3. AppConfig (src/config/AppConfig.ts)**\n- Add `getWorkflowMode()` method\n- Add `getEffectiveBaseBranch()` method returning:\n  - local mode: `baseBranch` (e.g., 'main')\n  - origin mode: `origin/${baseBranch}` (e.g., 'origin/main')\n\n**4. PRWorkflow (src/core/PRWorkflow.ts)**\n- `checkMergeConflicts`: Use effectiveBaseBranch for merge-tree check\n- `updateFromBase`: Use effectiveBaseBranch for merge-tree conflict check (keep baseBranch for actual merge)\n\n**5. PRHandlersService (src/services/keyboard/PRHandlersService.ts)**\n- `createPR`: Early return with toast if workflowMode === 'local'\n- `mergeToMain`: Early return with toast if workflowMode === 'origin'\n- `showDiff`: Pass effectiveBaseBranch to DiffViewer overlay\n\n**6. ActionPalette (src/ui/ActionPalette.tsx)**\n- Add `workflowMode` prop\n- Filter out 'm' action in origin mode\n- Filter out 'P' action in local mode\n\n**7. App.tsx**\n- Pass workflowMode to ActionPalette\n\n**8. This repo (.azedarach.json)**\n- Add: `\"workflowMode\": \"local\"` to git section\n\n### Files to modify\n1. src/config/schema.ts\n2. src/config/defaults.ts  \n3. src/config/AppConfig.ts\n4. src/core/PRWorkflow.ts\n5. src/services/keyboard/PRHandlersService.ts\n6. src/ui/ActionPalette.tsx\n7. src/ui/App.tsx\n8. .azedarach.json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T15:30:32.823708+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T18:33:52.622327+11:00","close_reason":"Implemented workflow mode UI integration - ActionPalette now respects git.workflowMode config to hide inappropriate actions (PR in local mode, merge in origin mode)","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-krz","title":"User documentation and guides","description":"Create comprehensive user documentation in docs/ folder covering TUI usage, keybindings, tmux integration, services architecture, and testing procedures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:43:35.93321+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:43:42.698148+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-kt4j","title":"epic drill down blocked tasks don't get unblocked properly","design":"## Root Cause Analysis\n\nThe bug occurs in epic drill-down mode when viewing blocked tasks. The issue is:\n\n1. **`dependencyPhases.ts:66-68`** builds the blockers list filtering only by `dependency_type === \"blocks\"` and sibling membership, but **never checks if the blocker is closed**\n2. **`dependencyPhases.ts:108`** stores `blockedBy: originalBlockers` - the original list of blockers regardless of their status\n3. **`DetailPanel.tsx:159-166`** displays ALL blockers (including closed ones), just with different icons\n\n### Screenshot Evidence\nThe image shows task `ch-79oti` in \"In Progress\" column displaying \"Blocked By (1): ch-muhiz\" even though `ch-muhiz` is visible in the \"Closed\" column with a checkmark.\n\n## Implementation Plan\n\n**Fix Location**: `src/core/dependencyPhases.ts` lines 60-71\n\n**The Fix**: When building the blockers map, filter out blockers that are already closed:\n\n```typescript\n// Find blocking dependencies that are siblings AND not already closed\nconst siblingBlockers = issue.dependencies\n    .filter((dep) =\u003e {\n        if (dep.dependency_type !== \"blocks\") return false\n        if (!childIds.has(dep.id)) return false\n        // NEW: Skip blockers that are already closed\n        const blockerIssue = childDetails.get(dep.id)\n        return blockerIssue?.status !== \"closed\"\n    })\n    .map((dep) =\u003e dep.id)\n```\n\n**Why this is the right place**:\n- Filtering at the source means Kahn's algorithm correctly treats closed blockers as already \"resolved\"\n- Tasks blocked only by closed tasks will correctly get `phase: 1` (ready)\n- The `blockedBy` array will only contain actual blockers\n- UI naturally follows without changes needed\n\n**Alternative considered but rejected**:\n- Filtering in `DetailPanel.tsx` would hide the display but the task would still incorrectly be marked as blocked (wrong phase number)\n\n## Testing Approach\n1. Find an epic with a task that depends on a closed task\n2. Verify the dependent task shows phase 1 (ready) not phase 2+ (blocked)\n3. Verify the \"Blocked By\" section doesn't appear for tasks with only closed blockers","notes":"üìé [mjvkfmpy-lzmg.png](.beads/images/az-kt4j/mjvkfmpy-lzmg.png) (clipboard, 1/2/2026, 1:54:08 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T01:53:58.701292+11:00","updated_at":"2026-01-02T11:25:36.177468+11:00","closed_at":"2026-01-02T11:25:36.177471+11:00","close_reason":"Fixed: closed tasks no longer block dependents in epic drill-down mode"}
{"id":"az-ktbd","title":"Space+m merge fails silently - need visible error feedback","description":"When pressing Space+m to merge a branch to main, the operation can fail silently without any visible feedback to the user. This makes debugging difficult.","design":"## Problem\n\nWhen Space+m merge fails, there's no visible indication of why. The user presses the keys and nothing happens - no error toast, no status message, nothing.\n\n## Observed Failure Modes\n\n1. **Untracked files on main blocking merge** - Git refuses to merge if untracked files would be overwritten\n2. **Task not found in board** - `getActionTargetTask()` returns undefined silently\n3. **Session state is idle** - Shows error toast but might be missed\n4. **Merge conflict check fails** - Should show error but might not be visible\n\n## Investigation Points\n\n1. Check all early return paths in `PRHandlersService.mergeToMain()`:\n   - Line 253: `if (!task) return` - **SILENT**\n   - Line 257: `if (isBusy) return` - Shows toast via `checkBusy()`\n   - Line 259-262: Session idle check - Shows error toast\n   - Other paths show toasts\n\n2. Check if toasts are being rendered/visible when merge is triggered\n\n3. Check git merge error handling in `PRWorkflow.mergeToMain()`\n\n## Proposed Fix\n\n1. Add error toast when task is not found: `if (!task) { toast.show(\"error\", \"No task selected\"); return }`\n2. Add logging for all merge attempts (success and failure)\n3. Consider adding a persistent status indicator during merge operations\n4. Ensure git errors (like untracked files blocking merge) surface to the user\n\n## Acceptance Criteria\n\n- [ ] All merge failure paths show visible error feedback (toast or status)\n- [ ] User can see WHY merge failed, not just that it failed\n- [ ] Git errors (untracked files, conflicts) are surfaced clearly\n- [ ] Add debug logging for merge operations","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T21:48:09.055142+11:00","updated_at":"2026-01-04T13:23:25.139068+11:00","closed_at":"2026-01-04T13:23:25.139074+11:00"}
{"id":"az-kud","title":"improve tmux workflow","description":"i want to figure out a way to use az as the primary way i navigate through tmux to the right sessions.\ni am just starting to learn tmux so i may be doing thing all wrong but so far i've been pressing ctrl-a s to open the tmux session picker i guess and then navigating to az session or another session created previously by az.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:24:37.484276+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T22:37:21.448766+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-kwwr","title":"Decision Checkpoint: Finalize tui_core architecture based on spike findings","description":"**Goal:** Review Phase 0 spike findings and make binding architectural decisions before implementation begins.\n\n## Trigger\nAll three research spikes must be complete:\n- az-lvah: Etch library evaluation\n- az-9gxm: Gleam FFI patterns\n- az-a0g1: Unicode width research\n\n## Decisions to Make\n\n### 1. Terminal I/O Backend\nBased on Etch spike (az-lvah) and FFI spike (az-9gxm):\n- **Option A: Use Etch** - If it covers 80%+ of needs with clean API\n- **Option B: Wrap Etch** - If it's partial but extensible\n- **Option C: Build custom** - If Etch is unsuitable, use FFI patterns from az-9gxm\n\nDocument decision and rationale in this task's `notes` field.\n\n### 2. Unicode Width Strategy\nBased on az-a0g1 findings:\n- **Option A: Use existing Gleam/Erlang lib** - If one exists and is suitable\n- **Option B: Port from Rust/Go** - If no Gleam solution exists\n- **Option C: Simple ASCII-only MVP** - If porting is too complex for MVP\n\n### 3. Architecture Adjustments\nBased on findings, update epic description if:\n- API signatures need to change\n- New tasks need to be added\n- Tasks can be merged or removed\n\n## Deliverables\n- [ ] Decision documented in `notes` field\n- [ ] Epic description updated with final architecture\n- [ ] Any new blocking dependencies added\n- [ ] Phase 1-2 tasks unblocked with clear direction\n\n## Why This Matters\nWithout explicit decision-making, parallel work can go in incompatible directions. This checkpoint ensures the team commits to one path before heavy implementation begins.","notes":"## Architectural Decisions - 2025-12-28\n\n### Decision 1: Terminal I/O Backend\n**DECISION: USE ETCH (Option A)**\n\n**Rationale:**\n- Etch v1.2.0 (Dec 17, 2025) covers 100% of terminal I/O requirements\n- Raw mode, ANSI input parsing, true color RGB, alt screen, resize events, mouse - all supported\n- Command batching via `Queue` + `flush()` fits our FrameBuffer diff strategy\n- Zero dependencies, crossterm-inspired (battle-tested patterns)\n- Active maintenance, MIT license\n\n**Impact on tasks:**\n- az-hkfa (Color): Simplifies to hex parsing only; Etch handles ANSI escape generation\n- az-zh3y (Input): Thin wrapper around Etch events; no escape sequence parsing needed\n- az-5xza (Renderer): Uses Etch command batching; focus on diff algorithm\n\n### Decision 2: Unicode Width Strategy\n**DECISION: USE string_width PACKAGE (Option A)**\n\n**Rationale:**\n- `string_width` v3.3.1 exists on hex.pm, actively maintained\n- Unicode 16.0 tables (latest standard)\n- ANSI-aware (critical for TUI with styled text)\n- Supports all Gleam targets (Erlang + JavaScript)\n- Passes Rust unicode-width test suite\n- BSD-3 license, ~30 min integration effort\n\n**Impact on tasks:**\n- az-ebxf (Text utilities): Build on string_width; no custom width tables needed\n\n### Decision 3: Architecture Adjustments\n**NO MAJOR CHANGES NEEDED**\n\nThe original architecture is validated. Minor simplifications:\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    lustre_tui                                ‚îÇ\n‚îÇ  Element types ‚îÇ Reconciler ‚îÇ Runtime loop                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                    tui_core                                  ‚îÇ\n‚îÇ  Color (hex‚ÜíEtch) ‚îÇ Text (string_width) ‚îÇ FrameBuffer       ‚îÇ\n‚îÇ  Layout ‚îÇ Renderables ‚îÇ Borders                             ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                      ETCH                                    ‚îÇ  ‚Üê Terminal I/O\n‚îÇ  Raw mode ‚îÇ Input ‚îÇ ANSI output ‚îÇ Screen buffer             ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                  string_width                                ‚îÇ  ‚Üê Unicode width\n‚îÇ  display_width ‚îÇ truncate ‚îÇ align                           ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Dependencies to Add (gleam.toml)\n```toml\netch = \"~\u003e 1.2\"\nstring_width = \"~\u003e 3.3\"\n```\n\n### Phase 1-2 Unblocked\nAll Phase 1-2 tasks can now proceed with clear direction:\n- az-hkfa: Color utilities (hex parsing + Etch types)\n- az-ebxf: Text utilities (use string_width)\n- az-zh3y: Input handling (wrap Etch events)\n- az-xe2h: FrameBuffer (use Etch color types)\n- etc.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:52:06.002473+11:00","updated_at":"2025-12-28T12:30:34.000749+11:00","closed_at":"2025-12-28T12:30:34.000749+11:00","close_reason":"Decisions documented: (1) USE ETCH for terminal I/O, (2) USE string_width for Unicode width. Architecture validated, Phase 1-2 unblocked.","labels":["architecture","checkpoint","decision"],"dependencies":[{"issue_id":"az-kwwr","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:52:18.880047+11:00","created_by":"daemon"},{"issue_id":"az-kwwr","depends_on_id":"az-lvah","type":"blocks","created_at":"2025-12-28T11:52:18.945801+11:00","created_by":"daemon"},{"issue_id":"az-kwwr","depends_on_id":"az-9gxm","type":"blocks","created_at":"2025-12-28T11:52:19.026756+11:00","created_by":"daemon"},{"issue_id":"az-kwwr","depends_on_id":"az-a0g1","type":"blocks","created_at":"2025-12-28T11:52:19.123973+11:00","created_by":"daemon"}]}
{"id":"az-kzk","title":"Quick task creation from TUI","description":"Create new beads tasks without leaving the TUI.","design":"- 'n' key opens task creation modal\n- ink-text-input for title, description\n- Select type, priority from list\n- Optionally set dependencies\n- Calls bd create under the hood","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:42.159577+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T12:20:02.57418+11:00","dependencies":[{"issue_id":"az-kzk","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.411847+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-l7a","title":"Agent Mail Integration for Multi-Agent Coordination","description":"Implement Agent Mail coordination layer for multi-agent beads workflows. Agent Mail reduces coordination latency from 2-5 seconds (git sync) to \u003c100ms (HTTP API), preventing work collisions when multiple Claude sessions operate simultaneously.\n\nKey benefits:\n- 20-50x faster coordination than git sync\n- Prevents duplicate work through exclusive file reservations\n- Lightweight (~50MB memory footprint)\n- Optional with graceful degradation to git-only\n\nIntegration points:\n1. Issue reservation before starting work\n2. Issue release when work completes\n3. Ready query to find unblocked, unreserved issues\n4. Status updates for real-time visibility\n\nConfiguration:\n- BEADS_AGENT_MAIL_URL: Server endpoint\n- BEADS_AGENT_NAME: Unique agent identifier\n- BEADS_PROJECT_ID: Shared namespace\n\nReference: https://github.com/steveyegge/beads/blob/main/docs/AGENT_MAIL.md","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T10:32:57.000556+11:00","updated_at":"2025-12-12T10:32:57.000556+11:00"}
{"id":"az-l7d","title":"enhance docs with all keybinds, modes, vc explainer, etc","description":"Enhanced documentation with:\\n- keybindings.md: Space+m (merge), Space+i (image attach), Image Attachment Overlay section\\n- services.md: ImageAttachmentService documentation\\n- README.md: Expanded VC Integration with architecture diagram, decision table, examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:14:45.203716+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T14:14:51.661199+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-lex","title":"setup ~/prog/Chefy with az config","description":"we need to setup chefy ready to use az with a proper config. draw inspo from this repo's config. chefy uses pnpm so pnpm i not bun i on new worktrees, it also uses direnv but should use envdev as well after direnv allow, should also use zsh, etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:46:08.985802+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T15:35:21.030523+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-lit","title":"when we create a bead we should immediately put the cursor on it","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:22:17.05286+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T00:52:00.683781+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-lj54","title":"allow configuration of base branch e.g. space f should compare base branch (may not be main)","description":"in chefy update .azedarach.json to set base branch to preview","design":"## Implementation Complete\n\n### Problem\nMultiple places hardcode \"main\" as the base branch for git operations:\n1. `PRHandlersService.showDiff()` - compares branch to \"main\"\n2. `PRWorkflow.mergeToMain()` - merges to \"main\", checks conflicts against \"main\"\n3. `PRWorkflow.checkMergeConflicts()` - uses \"main\" for merge-tree\n\n### Solution\n1. Moved `baseBranch` from `pr` section to `git` section\n2. Added **versioned schema with automatic migration** using `Schema.transform`\n3. Added `configVersion` field to track schema changes\n\n### Schema Migration Architecture\n\n```typescript\n// Version history in schema.ts:\n// - 1: Initial versioned schema (moved pr.baseBranch ‚Üí git.baseBranch)\n// - 0/undefined: Legacy unversioned configs\n\nexport const CURRENT_CONFIG_VERSION = 1\n\n// Schema.transform handles migration automatically:\nexport const AzedarachConfigSchema = Schema.transform(\n  RawConfigSchema,      // Accepts legacy format with pr.baseBranch\n  CurrentConfigSchema,  // Outputs current format with git.baseBranch\n  {\n    decode: (raw) =\u003e {\n      // Migrate pr.baseBranch ‚Üí git.baseBranch for v0 configs\n      // Pass through for v1+ configs\n    },\n    encode: (current) =\u003e ({ ...current, configVersion: CURRENT_CONFIG_VERSION })\n  }\n)\n```\n\n### Files Modified\n\n1. **`src/config/schema.ts`**\n   - Added `CURRENT_CONFIG_VERSION = 1` constant\n   - Added `LegacyPRConfigSchema` with deprecated `baseBranch`\n   - Added `RawConfigSchema` that accepts old format\n   - Added `CurrentConfigSchema` for output format\n   - Wrapped in `Schema.transform` for automatic migration\n\n2. **`src/config/defaults.ts`**\n   - Added `configVersion: 1` to `DEFAULT_CONFIG`\n   - Added `configVersion: number` to `ResolvedConfig`\n   - Added `configVersion` to `mergeWithDefaults()`\n\n3. **`src/config/AppConfig.ts`**\n   - Removed manual `migrateConfig` function\n   - Schema.transform now handles migration automatically\n   - Fully type-safe - no `as` casts or type guards needed\n\n4. **`src/services/keyboard/PRHandlersService.ts`**\n   - Uses `gitConfig.baseBranch`\n\n5. **`src/core/PRWorkflow.ts`**\n   - Uses `gitConfig.baseBranch`\n\n### Configuration\n\nNew format (v1):\n```json\n{\n  \"configVersion\": 1,\n  \"git\": {\n    \"baseBranch\": \"preview\"\n  }\n}\n```\n\nOld format (v0) still works - automatically migrated:\n```json\n{\n  \"pr\": {\n    \"baseBranch\": \"preview\"\n  }\n}\n```\n\n### Benefits of Schema-Based Migration\n\n1. **Fully type-safe** - No `as` casts, no `any`, no type guards\n2. **Declarative** - Migration logic in schema, not scattered in loading code\n3. **Versioned** - Easy to add future migrations\n4. **Bidirectional** - encode/decode for round-tripping","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:57:24.692666+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T19:33:31.575121+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ll34","title":"Add GUPP session monitoring and auto-nudging","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T00:40:53.921478+11:00","updated_at":"2026-01-05T00:40:53.921478+11:00"}
{"id":"az-llup","title":"bead images will slowly increase size of git clones etc","description":"we should store images elsewhere or something","design":"## Problem\n\nBead images stored in `.beads/images/` are committed directly to git, causing:\n1. **Unbounded repository growth** - Every image ever attached stays in git history forever\n2. **Slow clones** - All historical images download on every fresh clone\n3. **No cleanup path** - Even deleted images remain in git objects\n\nCurrent state: 37 images, 9.7MB in `.beads/images/`, 104MB total git repo.\n\n## Solution: Git LFS + Auto-cleanup\n\n### Part 1: Git LFS for Image Storage\n\n**Why Git LFS?**\n- Images tracked in git history but stored externally (GitHub/GitLab LFS servers)\n- Clones only download images when accessed (lazy loading)\n- Native git workflow preserved (no API keys, no external services)\n- Deleting from LFS actually reclaims space (unlike regular git)\n\n**Implementation:**\n\n1. **Add `.gitattributes` rules**:\n```\n.beads/images/**/*.png filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.jpg filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.jpeg filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.gif filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.webp filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.bmp filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.svg filter=lfs diff=lfs merge=lfs -text\n```\n\n2. **Migrate existing images**:\n```bash\ngit lfs install\ngit lfs migrate import --include=\".beads/images/**\" --everything\n```\n\n3. **No code changes needed** - Git LFS is transparent to ImageAttachmentService\n\n### Part 2: Auto-cleanup on Issue Close/Compact\n\n**Trigger points:**\n- When an issue is closed via `bd close`\n- When issues are compacted via `bd compact`\n\n**Implementation in Azedarach:**\n\n1. **Add `cleanupImagesForIssue(issueId)` to ImageAttachmentService**:\n   - List all attachments for the issue from index\n   - Delete image files from `.beads/images/{issueId}/`\n   - Remove directory if empty\n   - Update index.json to remove the issue entry\n   - Commit the deletion (so LFS can eventually prune)\n\n2. **Hook into BeadsClient close/compact events**:\n   - Option A: Wrap `bd close` calls to trigger cleanup\n   - Option B: Add post-close hook in BeadsClient\n   - Option C: Use beads daemon hooks if available\n\n3. **Cleanup compacted issues**:\n   - When `bd compact` runs, get list of compacted issue IDs\n   - Call `cleanupImagesForIssue()` for each\n\n**LFS Pruning:**\n```bash\n# After cleanup commits are pushed, reclaim space:\ngit lfs prune --verify-remote\n```\n\n### Part 3: Migration Script\n\nOne-time script to convert existing repo:\n\n```bash\n#!/bin/bash\n# migrate-images-to-lfs.sh\n\n# 1. Install LFS if needed\ngit lfs install\n\n# 2. Add .gitattributes \ncat \u003e\u003e .gitattributes \u003c\u003c 'EOF'\n.beads/images/**/*.png filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.jpg filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.jpeg filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.gif filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.webp filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.bmp filter=lfs diff=lfs merge=lfs -text\n.beads/images/**/*.svg filter=lfs diff=lfs merge=lfs -text\nEOF\n\n# 3. Migrate history (rewrites commits - coordinate with team!)\ngit lfs migrate import --include=\".beads/images/**\" --everything\n\n# 4. Force push (DANGEROUS - ensure team is ready)\n# git push --force-with-lease --all\n```\n\n## Files to Modify\n\n1. **`.gitattributes`** - Add LFS tracking rules (new file or append)\n2. **`src/core/ImageAttachmentService.ts`** - Add `cleanupImagesForIssue()` method\n3. **`src/core/BeadsClient.ts`** - Hook cleanup into close/compact operations\n4. **`scripts/migrate-images-to-lfs.sh`** - One-time migration script (new)\n\n## Acceptance Criteria\n\n- [ ] `.gitattributes` tracks `.beads/images/**` with LFS\n- [ ] New images are automatically stored in LFS (transparent)\n- [ ] Existing images migrated to LFS\n- [ ] `bd close` triggers image cleanup for the closed issue\n- [ ] `bd compact` triggers image cleanup for compacted issues  \n- [ ] Deleted images can be pruned from LFS to reclaim space\n- [ ] Image preview/attach still works (no functional regression)\n\n## Edge Cases\n\n- **Shared images** - Images are per-issue, so no sharing concern\n- **Reopened issues** - Images deleted on close won't come back (acceptable for debugging images)\n- **Failed cleanup** - Log warning but don't fail the close operation\n- **No LFS on remote** - Images fall back to regular git (just larger)\n\n## Future Enhancements (Out of Scope)\n\n- Configurable retention period before cleanup\n- Image tagging (temporary vs permanent)\n- External storage backends (S3, R2)","notes":"## Implementation Complete\n\n### Changes Made\n\n**1. `.gitattributes`** - Added LFS tracking rules for all image types:\n- `.beads/images/**/*.{png,jpg,jpeg,gif,webp,bmp,svg}`\n\n**2. `ImageAttachmentService.ts`** - Added cleanup methods:\n- `cleanupImagesForIssue(issueId)` - Deletes all images for a single issue\n- `cleanupImagesForIssues(issueIds)` - Batch cleanup for multiple issues\n\n**3. `PRWorkflow.ts`** - Hooked cleanup into close operations:\n- Added ImageAttachmentService dependency\n- Added cleanup calls in:\n  - `cleanup()` method when `closeBead=true`\n  - `mergeAndCleanup()` for main bead and all epic children\n  - `mergeBead()` for source bead after merge\n\n**4. `scripts/migrate-images-to-lfs.sh`** - Migration script:\n- Installs Git LFS hooks\n- Migrates existing images in git history\n- Provides post-migration instructions\n\n### Usage\n\n**For new repos:** Just commit - LFS tracking is automatic via `.gitattributes`\n\n**For existing repos with images:**\n```bash\n./scripts/migrate-images-to-lfs.sh\ngit push --force-with-lease --all\n```\n\n**To reclaim space after cleanups:**\n```bash\ngit lfs prune --verify-remote\n```\n\n### Testing\n- Type check: ‚úÖ Passed\n- Build: ‚úÖ Passed\n\n### Note on Reopened Issues\nImages are deleted when issues close. If an issue is reopened, its images are gone (acceptable for temporary debugging screenshots).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T15:56:57.33026+11:00","updated_at":"2025-12-31T18:24:27.31907+11:00","closed_at":"2025-12-31T18:24:27.319073+11:00"}
{"id":"az-ln3v","title":"sort modes should have secondary sort layers","description":"e.g. session sort mode should use updated as a secondary layer of sorting to sort the nested and unnested","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:32:31.602591+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:35:18.905254+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-loln","title":"when creating worktree for child off of an epic make sure even untracked files are cloned over","description":"such as node_modules and .env.local files","design":"## Problem\n\nWhen creating a worktree for a child task of an epic:\n1. `WorktreeManager.create()` copies `.direnv` and Claude settings from `projectPath` (main project)\n2. But the child should inherit files from the **epic's worktree**, not the main project\n3. Untracked files like `node_modules/` and `.env.local` are not copied at all\n\n## Solution\n\n### 1. Add configurable `copyPaths` to worktree config\n\n```json\n{\n  \"worktree\": {\n    \"copyPaths\": [\"node_modules\", \".env.local\", \".direnv\"]\n  }\n}\n```\n\nDefault: `[\".direnv\"]` (current behavior for direnv cache)\n\n### 2. Modify `WorktreeManager.create()` signature\n\nAdd optional `sourceWorktreePath` parameter to `CreateWorktreeOptions`:\n```typescript\ninterface CreateWorktreeOptions {\n  beadId: string\n  baseBranch?: string\n  projectPath: string\n  sourceWorktreePath?: string  // NEW: copy untracked files from here instead of projectPath\n}\n```\n\n### 3. Implement `copyUntrackedFiles` helper\n\n- Reads `copyPaths` from config (via AppConfig)\n- Copies each path from source to target worktree\n- Handles both files and directories\n- Non-fatal: logs warning on failure, doesn't fail worktree creation\n\n### 4. Update `ClaudeSessionManager.start()`\n\nWhen creating worktree for a child task with a parent epic:\n1. First ensure epic worktree exists (already done)\n2. Pass epic's worktree path as `sourceWorktreePath` to `WorktreeManager.create()`\n\n### Files to modify\n\n1. `src/config/schema.ts` - Add `copyPaths` field to `WorktreeConfigSchema`\n2. `src/config/defaults.ts` - Add default `copyPaths: [\".direnv\"]`\n3. `src/core/WorktreeManager.ts` - Add `sourceWorktreePath` option and `copyUntrackedFiles` helper\n4. `src/core/ClaudeSessionManager.ts` - Pass epic worktree path when creating child worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T11:22:41.287238+11:00","updated_at":"2025-12-30T12:45:12.813974+11:00","closed_at":"2025-12-30T12:45:12.813976+11:00"}
{"id":"az-lolx","title":"i cannot use arrows to move cursor in epic drill down mode","description":"When in epic drill-down mode (entered by pressing Enter on an epic), arrow keys don't move the cursor because navigation operates on a different view of tasks than what's displayed.\n\n## Root Cause\n\nThere's a data mismatch between UI rendering and navigation:\n- **UI (App.tsx)**: Uses `drillDownFilteredTasksAtom` which filters to only epic children\n- **Navigation (NavigationService)**: Uses `getFilteredTasksByColumn()` which ignores drill-down mode\n\nWhen the user presses arrow keys:\n1. `NavigationService.move()` calls `getFilteredTasksByColumn()`\n2. This returns ALL tasks (not just drill-down children)\n3. Navigation finds the cursor at position X in the full task list\n4. But the UI only shows drill-down children, so position X doesn't correspond to the visible tasks\n5. Navigation appears broken because cursor movement is calculated against invisible tasks\n\n## Reproduction\n1. Create an epic with child tasks\n2. Press Enter on the epic to enter drill-down mode\n3. Try using arrow keys (j/k/h/l or up/down/left/right)\n4. Observe: cursor doesn't move as expected","design":"...","acceptance_criteria":"- [ ] Arrow keys (j/k/h/l and up/down/left/right) work in epic drill-down mode\n- [ ] Navigation respects the drill-down filter (only navigates among visible children)\n- [ ] Exit drill-down (q or Escape) restores normal navigation\n- [ ] Search mode within drill-down also works correctly","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T01:56:14.951559+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T02:23:16.631627+11:00","close_reason":"Merged to main: Fixed arrow key navigation in epic drill-down mode by filtering navigation to only visible children","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-losz","title":"issue with a partial success on space S","description":"i guess we need to make it atomic/roll back on partial success?","notes":"## Analysis\n\nThe `SessionManager.start` method has a non-atomic sequence of operations:\n\n1. Create worktree (idempotent ‚úì)\n2. Run init commands (can fail, has config for continueOnFailure ‚úì)  \n3. Create tmux session with Claude ‚Üê RESOURCE 1\n4. Update bead status to `in_progress` ‚Üê RESOURCE 2\n5. Store session in registry ‚Üê can fail after resources created\n6. Publish state change ‚Üê can fail after resources created\n\n**Problem:** If step 5 or 6 fails after steps 3-4, we have:\n- A running tmux session with Claude (orphaned)\n- Bead marked as `in_progress` with no session tracking\n\n## Solution Implemented\n\nUsed `Effect.acquireUseRelease` treating BOTH tmux and bead status as \"resources\":\n\n```typescript\nEffect.acquireUseRelease(\n  // ACQUIRE: Create tmux + update bead status (both are resources)\n  Effect.gen(function* () {\n    let createdNewSession = false\n    let updatedBeadStatus = false\n\n    if (!hasSession) {\n      yield* tmuxService.newSession(...)\n      createdNewSession = true\n    }\n    if (needsStatusUpdate) {\n      yield* beadsClient.update(beadId, { status: \"in_progress\" })\n      updatedBeadStatus = true\n    }\n    return { createdNewSession, updatedBeadStatus }\n  }),\n\n  // USE: Register in memory + publish event\n  () =\u003e Effect.gen(function* () {\n    yield* Ref.update(sessionsRef, ...)\n    yield* publishStateChange(beadId, \"idle\", \"busy\")\n    return sessionObj\n  }),\n\n  // RELEASE: Rollback BOTH on failure\n  (acquired, exit) =\u003e\n    Exit.isFailure(exit)\n      ? Effect.gen(function* () {\n          if (acquired.createdNewSession) {\n            yield* tmuxService.killSession(tmuxSessionName)\n          }\n          if (acquired.updatedBeadStatus) {\n            yield* beadsClient.update(beadId, { status: \"open\" })\n          }\n        })\n      : Effect.void,\n)\n```\n\n**Key benefits:**\n- Interrupt-safe: rollback runs even on fiber interruption\n- Tracks all state changes: both tmux and bead status\n- Selective rollback: only reverts what was actually changed\n- Idiomatic Effect pattern: proper resource management","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:21:13.743895+11:00","updated_at":"2025-12-18T13:54:02.410611+11:00","close_reason":"Complete fix: SessionManager.start now uses acquireUseRelease to rollback BOTH tmux session AND bead status on partial failure.","comments":[{"id":7,"issue_id":"az-losz","author":"riordan","text":"Extending fix to also rollback bead status","created_at":"2025-12-18T02:47:29Z"}],"deleted_at":"2025-12-18T13:54:02.410611+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-lqb","title":"Worker session template with epic context injection","description":"Create worker.md session template that injects:\n- Task title, description, design\n- Parent epic context (title, design, goals)\n- Coordination rules (stay focused, report discoveries)\n- bd commands for status updates\n\n**Template variables:** $TASK_ID, $TASK_TITLE, $EPIC_ID, $EPIC_TITLE, $EPIC_DESIGN\n\n**Location:** .claude/session-templates/worker.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.913748+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:54:56.992854+11:00","close_reason":"Created worker.md template with Mustache-style variable substitution and TemplateService for loading/rendering","dependencies":[{"issue_id":"az-lqb","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.80298+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-lsi","title":"figure out whats next with our claude status hook system","notes":"Starting implementation of Option 1: Integrate Claude Code's native hooks (Notification, Stop, SessionEnd) for authoritative state detection in spawned worktrees.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:54.252353+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T11:17:26.126292+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-lvah","title":"Spike: Evaluate Etch library for terminal primitives","description":"**Goal:** Determine if Etch (github.com/bananaofhappiness/etch) provides what we need for tui_core.\n\n## Questions to Answer\n1. Does Etch handle raw mode entry/exit?\n2. Does Etch parse ANSI escape sequences for input (arrows, function keys)?\n3. Does Etch support true color (24-bit) output?\n4. Does Etch handle alternate screen buffer?\n5. What's the API surface like? Does it fit our architecture?\n\n## Evaluation Criteria\n- **Use Etch if:** Covers 80%+ of terminal I/O needs, actively maintained, ergonomic API\n- **Build from scratch if:** Etch is incomplete/unmaintained, or would require heavy wrapping\n\n## Tasks to Inform\n- az-hkfa (Color) - Can we use Etch's color handling?\n- az-zh3y (Input) - Can we use Etch's input handling?\n- az-5xza (Renderer) - Can we use Etch's output handling?\n\n## Deliverables\n1. Summary of Etch capabilities vs our needs\n2. Recommendation: Use Etch / Wrap Etch / Build custom\n3. If using Etch: API mapping document\n4. If not using Etch: FFI spike needed (see az-xxxx)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T11:40:14.324192+11:00","updated_at":"2025-12-28T12:29:59.365379+11:00","closed_at":"2025-12-28T12:29:59.365379+11:00","close_reason":"Research complete: Etch covers 100% of terminal I/O needs. Recommend USE ETCH for tui_core foundation.","labels":["etch","gleam","research","spike"],"dependencies":[{"issue_id":"az-lvah","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:41:50.87631+11:00","created_by":"daemon"}]}
{"id":"az-lyq4","title":"Port Azedarach from Shore to LustreTUI","description":"Once LustreTUI is validated via demo app (az-8zkp), migrate Azedarach Gleam version to use it.\n\n## What\n- Replace Shore imports with lustre_tui\n- Update view code to use new Element/Attribute API\n- Verify colors, layout, keybinds all work correctly\n- Compare visual output to TypeScript version\n\n## Migration Steps\n1. Update gleam.toml dependencies\n2. Replace Shore view functions with lustre_tui equivalents\n3. Update color values (Shore format ‚Üí hex strings)\n4. Verify layout renders correctly\n5. Test all keybinds work\n6. Fix any visual differences from TypeScript version\n\n## Key Mappings\n```gleam\n// Shore ‚Üí LustreTUI\nshore.box([...]) ‚Üí lustre_tui.box([...], [...])\nshore.text(\"...\") ‚Üí lustre_tui.text([fg(\"#color\")], \"...\")\nshore.row([...]) ‚Üí lustre_tui.box([flex_direction(Row)], [...])\nshore.column([...]) ‚Üí lustre_tui.box([flex_direction(Column)], [...])\n```\n\n## Dependencies\n- az-8zkp: Demo app must pass all validation checks first\n\n## Acceptance Criteria\n- [ ] All 4 Kanban columns display correctly\n- [ ] Hex colors work (Catppuccin Macchiato theme)\n- [ ] Status bar on single line with inline colored text (was broken in Shore)\n- [ ] All keyboard input works (j/k navigation, Space for actions, etc.)\n- [ ] Overlays render correctly (action menu, search)\n- [ ] No regressions from TypeScript version\n- [ ] Performance acceptable (no noticeable lag)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T11:26:08.488708+11:00","updated_at":"2025-12-28T11:35:22.01886+11:00","labels":["azedarach","gleam"],"dependencies":[{"issue_id":"az-lyq4","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.943409+11:00","created_by":"daemon"},{"issue_id":"az-lyq4","depends_on_id":"az-7tzh","type":"blocks","created_at":"2025-12-28T11:26:28.974911+11:00","created_by":"daemon"},{"issue_id":"az-lyq4","depends_on_id":"az-8zkp","type":"blocks","created_at":"2025-12-28T11:34:13.630032+11:00","created_by":"daemon"}]}
{"id":"az-m176","title":"Add orchestrate mode to StatusBar","description":"In StatusBar.tsx, add keybindings for orchestrate mode:\n\n```typescript\nMODE_KEYBINDINGS.orchestrate = [\n  { key: \"Space\", action: \"Toggle\" },\n  { key: \"Enter\", action: \"Spawn\" },\n  { key: \"a\", action: \"All\" },\n  { key: \"n\", action: \"None\" },\n  { key: \"Esc\", action: \"Back\" },\n]\n```\n\nMode display should show: \"orchestrate (X/Y)\" where X is selected count and Y is spawnable count.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:05.683144+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:32.09255+11:00","close_reason":"Completed during Wave 1 - orchestrate keybindings added to MODE_KEYBINDINGS in StatusBar.tsx","dependencies":[{"issue_id":"az-m176","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:25.881296+11:00","created_by":"daemon"},{"issue_id":"az-m176","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:51.910544+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-m33z","title":"i want ctrl-u/d to scroll columns half screen","design":"## Implementation Plan\n\n**Finding:** Half-page scrolling is already implemented via NavigationService.halfPageUp/Down(). The bindings are currently CS-u/CS-d (Ctrl+Shift) but StatusBar shows C-d/u, indicating Ctrl+U/D was the intended binding.\n\n**Fix:** Change bindings.ts lines 138 and 144 from CS-d/CS-u to C-d/C-u.\n\n**Files to modify:**\n- src/services/keyboard/bindings.ts (lines 138, 144) - change key bindings\n\n**No other changes needed** - the NavigationService methods and StatusBar hint are already correct.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T09:42:10.270868+11:00","updated_at":"2025-12-31T11:02:39.026512+11:00","closed_at":"2025-12-31T11:02:39.026514+11:00","close_reason":"Changed half-page scroll bindings from CS-u/CS-d (Ctrl+Shift) to C-u/C-d (Ctrl) in bindings.ts to match StatusBar hint and Vim conventions."}
{"id":"az-m9vt","title":"after space m completes run type-check and fix and fix and fix any issues with a claude session","design":"## Implementation (Final)\n\nMade post-merge validation configurable via `.azedarach.json` instead of hardcoded:\n\n### Config Schema (`merge` section in .azedarach.json)\n```json\n{\n  \"merge\": {\n    \"validateCommands\": [\"bun run type-check\"],\n    \"fixCommand\": \"bun run fix\",\n    \"maxFixAttempts\": 2,\n    \"startClaudeOnFailure\": true\n  }\n}\n```\n\n### Behavior\n- **No validation by default** - must be explicitly configured\n- Runs all `validateCommands` in sequence after merge\n- If validation fails and `fixCommand` is set, runs fix up to `maxFixAttempts` times\n- If still failing and `startClaudeOnFailure` is true, starts Claude session\n- Blocks merge completion until validation passes\n\n### Files Changed\n- `src/config/schema.ts` - Added MergeConfigSchema\n- `src/config/defaults.ts` - Added merge defaults (empty by default)\n- `src/config/AppConfig.ts` - Added getMergeConfig()\n- `src/core/PRWorkflow.ts` - Refactored to use config instead of hardcoded commands\n- `.azedarach.json` - Added merge config for this project","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:17.498656+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:32.605035+11:00","close_reason":"Implemented automatic type-check and fix after Space+m merge:\n- Added runTypeCheck and runFix helper functions in PRWorkflow.ts\n- Added TypeCheckError error type for type-check failures\n- Added step 7.5 in mergeToMain that runs type-check after merge\n- Auto-runs fix up to 2 times if type-check fails\n- If still failing, starts Claude session to fix errors\n- Added TypeCheckError to ErrorFormatter for user-friendly messages","comments":[{"id":11,"issue_id":"az-m9vt","author":"riordan","text":"Misunderstood task - need to implement automatic type-check/fix in the merge action code, not manually run it","created_at":"2025-12-18T14:55:02Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-md0x","title":"Add Claude Orchestrate option to orchestration UI","description":"In OrchestrationOverlay or via new entry point:\n- Add \"Claude Orchestrate\" option alongside manual selection\n- Spawns orchestrator session with:\n  - autoCompact: true\n  - orchestrator template\n  - No initial task selection (orchestrator decides)","design":"...","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-19T11:14:04.59242+11:00","updated_at":"2025-12-20T00:33:12.299787+11:00","dependencies":[{"issue_id":"az-md0x","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.855953+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-md0x","depends_on_id":"az-2q75","type":"blocks","created_at":"2025-12-19T11:14:22.125985+11:00","created_by":"daemon"},{"issue_id":"az-md0x","depends_on_id":"az-0h3d","type":"blocks","created_at":"2025-12-19T11:14:22.221409+11:00","created_by":"daemon"},{"issue_id":"az-md0x","depends_on_id":"az-j7qi","type":"blocks","created_at":"2025-12-19T11:14:22.31572+11:00","created_by":"daemon"}]}
{"id":"az-mf23","title":"most of these git changes should not be showing in this space f git diff","description":"they were not made in the related bead/branch so i'm not sure why they are showing\nyou can see the bead id in the image and check out the git diffs directly. its in the Chefy project","notes":"üìé [mjs14d8z-izdf.png](.beads/images/az-mf23/mjs14d8z-izdf.png) (clipboard, 12/30/2025, 2:30:11 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:30:04.947769+11:00","updated_at":"2025-12-30T15:07:49.345766+11:00","closed_at":"2025-12-30T15:07:49.345768+11:00"}
{"id":"az-mj5","title":"Add structured logging with Effect Logger","description":"Add comprehensive logging for debugging and observability:\n\n**Implementation:**\n- Use Effect's Logger service with structured JSON output\n- Add log levels: debug, info, warn, error\n- Log file output option (--log-file flag)\n- Key events to log:\n  - Session lifecycle (start, stop, state changes)\n  - Beads operations (create, update, sync)\n  - Git operations (worktree, merge, PR)\n  - Keyboard actions (for debugging keybinding issues)\n  - Error conditions with context\n\n**Config:**\n- LOG_LEVEL env var (default: info)\n- --verbose flag for debug output\n- Timestamp and source service in each log entry","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:59:45.524867+11:00","updated_at":"2025-12-19T10:36:12.501117+11:00","deleted_at":"2025-12-19T10:36:12.501117+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"feature"}
{"id":"az-mlv","title":"when i press space m on beads that are in closed column but have tmux session running they seem to merge ok but the beads disappear from closed","description":"no idea where they disappear to","design":"## Root Cause\n\nThe `bd merge` driver uses standard 3-way merge semantics:\n- If a bead exists in base (ancestor) and main, but NOT in branch\n- Merge interprets this as \"branch deleted the bead\"\n- Result: bead is removed from main, marked as tombstone in DB\n\n## Why Branch Has Missing Beads\n\nWorktree's .beads/issues.jsonl becomes incomplete due to:\n1. Worktree created from older main (before bead existed)\n2. bd sync failures that don't import all beads\n3. Conflict resolution that drops beads\n\n## Proposed Fix\n\nAdd `bd sync --import-only` call in main AFTER the git merge to recover any beads that were incorrectly removed by the merge driver. This ensures the main database re-imports from the merged JSONL.","notes":"Root cause found: PRWorkflow.mergeToMain calls `beadsClient.sync(worktree.path)` without `--from-main` flag. Comment says --from-main but code doesn't use it. Fix: add syncFromMain method to BeadsClient and use it in merge workflow.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:11:43.179532+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T02:01:50.13422+11:00","close_reason":"Fixed: Added syncImportOnly after git merge in PRWorkflow.mergeToMain to recover beads that may be incorrectly removed by the bd merge driver's 3-way merge semantics","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-moj","title":"State transition hooks system","description":"Pluggable hook system for state transition events.","design":"- Define HookRegistry as Effect.Service\n- Hook types as tagged union: onWaiting | onDone | onError | onPaused\n- Built-in hooks: NotificationHook, PRCreationHook, BeadsSyncHook\n- Methods:\n  - register(hookType, handler): Effect\u003cvoid\u003e\n  - trigger(hookType, context): Effect\u003cvoid\u003e\n- Use PubSub subscription for event-driven hooks\n- Hook handlers are Effects with typed context:\n  - HookContext = { task: Issue, session: Session, worktree: Worktree }\n- Use Effect.forEach with { concurrency: \"unbounded\" } for parallel hooks\n- User-configurable hooks via Config (shell commands)\n- Use Effect.catchAll for error isolation between hooks","notes":"Implemented state transition hooks system with the following components:\n\n**Core Services:**\n- `HookRegistry` (src/core/HookRegistry.ts): Main service for hook registration/triggering with Effect.Service pattern\n- `HookOrchestrator` (src/core/HookOrchestrator.ts): Wires HookRegistry to SessionManager's PubSub, registers user shell hooks from config\n\n**Built-in Hooks:**\n- `BuiltInHooks` (src/hooks/BuiltInHooks.ts): Registers NotificationHook, PRCreationHook, BeadsSyncHook\n\n**Configuration:**\n- Added `hooks` section to config schema (schema.ts, defaults.ts)\n- User can define shell commands for each event type: onWaiting, onDone, onError, onPaused\n- Shell hooks receive context via environment variables: HOOK_TASK_ID, HOOK_TASK_TITLE, etc.\n- Can disable built-in hooks with `hooks.disableBuiltIn: true`\n\n**Key Design:**\n- Hook types as tagged union: \"onWaiting\" | \"onDone\" | \"onError\" | \"onPaused\"\n- HookContext: { task, session, worktree, stateChange }\n- Parallel execution with Effect.forEach({ concurrency: \"unbounded\" })\n- Error isolation via Effect.catchAll per hook\n- PubSub subscription for event monitoring\n\nAll types pass strict TypeScript checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.613629+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T00:46:56.514818+11:00","dependencies":[{"issue_id":"az-moj","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.589726+11:00","created_by":"daemon"},{"issue_id":"az-moj","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.411943+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-mq9","title":"Create effect-atom SolidJS adapter","description":"Create a SolidJS adapter for effect-atom since only React and Vue adapters exist. This bridges Effect services to SolidJS's reactive system.","design":"- Create src/lib/effect-atom-solid/ adapter (or separate package later)\n- Core primitives to implement:\n  - `useAtomValue(atom)` ‚Üí uses SolidJS `from()` or `createSignal` + subscription\n  - `useAtomSet(atom)` ‚Üí returns setter function\n  - `useAtom(atom)` ‚Üí returns [Accessor, Setter] tuple\n  - `useAtomMount(atom)` ‚Üí lifecycle via `onMount`/`onCleanup`\n  - `createAtomResource(atom)` ‚Üí bridges to SolidJS `createResource` for Suspense\n- Use `RegistryContext` via SolidJS `createContext`/`useContext`\n- Leverage SolidJS's `from()` utility for external subscriptions\n- Pattern: subscribe to Atom changes, update SolidJS signal\n- Consider contributing back to tim-smart/effect-atom","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full SolidJS adapter for @effect-atom/atom\n- Implements all core hooks matching React adapter API\n\nFILES CREATED:\n- src/lib/effect-atom-solid/hooks.ts - useAtomValue, useAtomSet, useAtom, useAtomMount, useAtomRefresh\n- src/lib/effect-atom-solid/Provider.tsx - AtomProvider with registry options\n- src/lib/effect-atom-solid/index.ts - Barrel exports\n- src/lib/effect-atom-solid/example.tsx - Working counter example\n- src/lib/effect-atom-solid/README.md - Full documentation\n\nKEY DECISIONS:\n- Used createSignal + subscription pattern (SolidJS equivalent of useSyncExternalStore)\n- Values returned as Accessor\u003cT\u003e (must call: count()) per SolidJS conventions\n- Default scheduler: queueMicrotask (not React Scheduler)\n- Used onCleanup for automatic subscription cleanup\n\nPOTENTIAL CONTRIBUTION:\n- This adapter could be contributed back to tim-smart/effect-atom\n- API surface mirrors @effect-atom/atom-react for easy migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:10:02.323692+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T17:25:13.974746+11:00","dependencies":[{"issue_id":"az-mq9","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T17:10:08.844553+11:00","created_by":"daemon"},{"issue_id":"az-mq9","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T17:10:08.914278+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-mqpe","title":"Design context capture pattern for CommandQueue and MutationQueue","description":"Design the standard pattern for capturing project context at operation submission time.\n\n**Current inconsistent patterns:**\n\nPattern A (correct - used by start session, create-pr):\n```typescript\nconst projectPath = yield* helpers.getProjectPath()  // BEFORE queue\nyield* helpers.withQueue(taskId, \"start\",\n  sessionManager.start({ beadId, projectPath })  // Uses captured\n)\n```\n\nPattern B (buggy - used by merge, update, abort):\n```typescript\nyield* helpers.withQueue(taskId, \"merge\",\n  Effect.gen(function* () {\n    const projectPath = yield* helpers.getProjectPath()  // INSIDE - too late!\n    yield* prWorkflow.mergeToMain({ beadId, projectPath })\n  })\n)\n```\n\nPattern C (buggy - MutationQueue):\n```typescript\n// No projectPath at all - beadsClient queries live service\nconst executeMutation = (mutation: Mutation) =\u003e {\n  return beadsClient.update(mutation.id, { status: mutation.status })\n  // beadsClient.getEffectiveCwd() ‚Üí projectService.getCurrentPath() üí•\n}\n```\n\n**Design decisions needed:**\n\n1. **Mutation type extension** - Add projectPath to all mutation types?\n2. **withQueue enhancement** - Should withQueue automatically capture context?\n3. **BeadsClient default** - Should we remove the live fallback entirely?\n4. **Rollback context** - Rollback effects also need the right project\n\n**Proposed pattern:**\n```typescript\n// Option A: Explicit context in mutation\ninterface Mutation {\n  projectPath: string  // Always required\n  // ...\n}\n\n// Option B: Context wrapper for withQueue\nhelpers.withQueueAndContext(taskId, \"merge\", (ctx) =\u003e\n  prWorkflow.mergeToMain({ beadId, projectPath: ctx.projectPath })\n)\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-01T22:06:56.529636+11:00","updated_at":"2026-01-01T22:19:56.204167+11:00","dependencies":[{"issue_id":"az-mqpe","depends_on_id":"az-67fc","type":"parent-child","created_at":"2026-01-01T22:07:11.054469+11:00","created_by":"daemon"},{"issue_id":"az-mqpe","depends_on_id":"az-y86k","type":"blocks","created_at":"2026-01-01T22:07:22.516068+11:00","created_by":"daemon"}]}
{"id":"az-mvi9","title":"we need to be able to tell if there is a worktree even though theres no tmux session","design":"## Problem\nTasks with existing worktrees but no active tmux session appear as 'idle' with no indication that git work exists. Users can't see uncommitted changes or resume work.\n\n## Solution\nAdd hasWorktree field to TaskWithSession and show worktree state even when session is idle.\n\n## Implementation Plan\n\n### 1. Add hasWorktree to types (src/ui/types.ts)\n- Add `hasWorktree?: boolean` to TaskWithSession interface\n- Add WORKTREE_INDICATOR constant (üìÅ or similar)\n\n### 2. Update BoardService.loadTasks() (src/services/BoardService.ts)\n- Query WorktreeManager.exists() for each task\n- Populate hasWorktree field\n- Show git status (uncommitted changes, behind count) even when idle IF hasWorktree is true\n\n### 3. Update TaskCard (src/ui/TaskCard.tsx)\n- Show worktree indicator (üìÅ) when hasWorktree \u0026\u0026 sessionState === 'idle'\n- Display git status (behind count, uncommitted changes) for idle tasks with worktrees\n\n### 4. Update DetailPanel (src/ui/DetailPanel.tsx)\n- Show worktree path when hasWorktree\n- Display full git status for worktrees without sessions\n\n### 5. Add actions for orphaned worktrees\n- Resume action: Attach new Claude session to existing worktree\n- Cleanup action: Remove orphaned worktree (git worktree remove)\n- Add these to ActionPalette when hasWorktree \u0026\u0026 idle\n\n### 6. Optional: Add worktree sort mode\n- New sort option in EditorService to group by worktree presence\n- Tasks with worktrees sort before tasks without\n\n## Files to Modify\n- src/ui/types.ts (add hasWorktree, WORKTREE_INDICATOR)\n- src/services/BoardService.ts (query worktree existence, populate field)\n- src/ui/TaskCard.tsx (display worktree indicator + git status)\n- src/ui/DetailPanel.tsx (show worktree info)\n- src/ui/ActionPalette.tsx (add resume/cleanup actions)\n- src/services/keyboard/SessionHandlersService.ts (implement resume/cleanup)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:03:45.394453+11:00","updated_at":"2025-12-30T00:55:19.833256+11:00","closed_at":"2025-12-30T00:55:19.833258+11:00","close_reason":"Implemented orphaned worktree detection and management"}
{"id":"az-mxk2","title":"when attaching with space a we should optionally merge in latest base branch","description":"we should detect if necessary and if so we show the dialog, if not we just attach as usual, the merge should attempt automatically and if it fails/has conflicts then we should run a claude session to resolve it just like with space m action. questions?","design":"## Implementation Plan\n\n### Overview\nWhen user presses Space+a to attach to a session, detect if the worktree branch is behind main. If behind, show a confirmation dialog and auto-merge main into the branch before attaching. If merge has conflicts, spawn Claude to resolve them (matching Space+m behavior).\n\n### Flow\n```\nSpace+a pressed\n    ‚îÇ\n    ‚ñº\nCheck if worktree branch is behind main\n(git rev-list --count main..HEAD vs HEAD..main)\n    ‚îÇ\n    ‚îú‚îÄ Not behind ‚Üí Attach immediately (current behavior)\n    ‚îÇ\n    ‚îî‚îÄ Behind by N commits ‚Üí\n        ‚îÇ\n        ‚ñº\n    Show confirmation dialog:\n    \"Branch is N commits behind main. Merge latest?\"\n    [Merge \u0026 Attach] [Skip \u0026 Attach] [Cancel]\n        ‚îÇ\n        ‚îú‚îÄ Skip ‚Üí Attach immediately\n        ‚îú‚îÄ Cancel ‚Üí Return to board\n        ‚îî‚îÄ Merge \u0026 Attach ‚Üí\n            ‚îÇ\n            ‚ñº\n        Auto-stash uncommitted changes (if any)\n            ‚îÇ\n            ‚ñº\n        Check for conflicts (git merge-tree --write-tree)\n            ‚îÇ\n            ‚îú‚îÄ No conflicts ‚Üí git merge main, pop stash, attach\n            ‚îÇ\n            ‚îî‚îÄ Conflicts detected ‚Üí\n                ‚îÇ\n                ‚ñº\n            Start actual merge (git merge main) to create conflict markers\n            Spawn Claude session with conflict resolution prompt\n            Return error: \"Conflicts detected. Claude session started. Retry after resolution.\"\n```\n\n### Key Components\n\n**1. New function: `checkBranchBehindMain()`** in PRWorkflow.ts\n- Uses `git rev-list --count HEAD..main` to count commits branch is behind\n- Returns `{ behind: number, ahead: number }` for informational display\n\n**2. Modify `SessionHandlersService.attachExternal()`** (bindings.ts:374-379)\n- Before attaching, call new `prWorkflow.checkBranchBehindMain()`\n- If behind \u003e 0, show confirmation dialog\n- Dialog options: \"Merge \u0026 Attach\", \"Skip \u0026 Attach\", \"Cancel\"\n\n**3. New function: `mergeMainIntoBranch()`** in PRWorkflow.ts\n- Reuse existing `checkMergeConflicts()` logic\n- Auto-stash uncommitted changes before merge\n- If clean merge: `git merge main --no-edit`, pop stash\n- If conflicts: same flow as Space+m - spawn Claude with conflict resolution prompt\n\n**4. Update attach flow in SessionHandlersService**\n- On \"Merge \u0026 Attach\": call mergeMainIntoBranch(), then attach\n- On \"Skip \u0026 Attach\": attach immediately\n- On \"Cancel\": exit to normal mode\n\n### Files to Modify\n1. `src/core/PRWorkflow.ts` - Add checkBranchBehindMain(), mergeMainIntoBranch()\n2. `src/services/keyboard/SessionHandlersService.ts` - Modify attachExternal handler\n3. `src/services/keyboard/bindings.ts` - May need to adjust action binding\n\n### Reusable Patterns\n- Conflict detection: reuse `checkMergeConflicts()` from PRWorkflow.ts:1079-1164\n- Claude spawn for conflicts: reuse pattern from PRWorkflow.ts:804-823\n- Stash handling: reuse pattern from Space+m uncommitted changes flow\n\n### Acceptance Criteria\n- [ ] Space+a detects when branch is behind main\n- [ ] Shows dialog with merge/skip/cancel options when behind\n- [ ] Auto-stash handles uncommitted changes safely\n- [ ] Clean merge auto-attaches to session\n- [ ] Conflicted merge spawns Claude session for resolution\n- [ ] Skip option attaches without merging\n- [ ] Not-behind branches attach immediately (no dialog)","acceptance_criteria":"- Space+a detects when branch is behind main\n- Shows dialog with merge/skip/cancel options when behind\n- Auto-stash handles uncommitted changes safely  \n- Clean merge auto-attaches to session\n- Conflicted merge spawns Claude session for resolution\n- Skip option attaches without merging\n- Not-behind branches attach immediately (no dialog)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T16:20:58.987524+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-20T03:16:22.975314+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-n6k","title":"i seem to only be able to space m merge to main one bead and then i have to restart az","description":"after one the next time i space m a different bead it does nothing","notes":"Root cause: `Effect.fork` in CommandQueueService.processNext was creating fibers tied to the parent scope. When processNext returned, the scope closed and interrupted the forked fiber before it could clean up (set running = null). This left the queue in a stuck state where `running !== null` blocked subsequent operations.\n\nFix: \n1. Changed service from `effect:` to `scoped:` to get a layer-level Scope\n2. Captured scope at construction: `const serviceScope = yield* Effect.scope`\n3. Changed `Effect.fork` to `Effect.forkIn(effect, serviceScope)`\n\nThis ensures command fibers:\n- Aren't interrupted when processNext returns (outlive parent)\n- Get cleaned up when app shuts down (not daemon fibers)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:32:43.637796+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:12:59.43952+11:00","close_reason":"Fixed by using scoped service and Effect.forkIn to properly manage fiber lifecycle","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-n9by","title":"go tui doesnt have epic drill down","description":"get a perfect understanding of epic drill down from ts app before implementing in go version\nuse TDD","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T17:29:08.904865+11:00","updated_at":"2026-01-04T17:29:08.904865+11:00"}
{"id":"az-nb04","title":"attached images break prompt injection","description":"TITLE","notes":"üìé [mjgmdu2c-3u1k.png](.beads/images/az-nb04/mjgmdu2c-3u1k.png) (clipboard, 12/22/2025, 2:52:10 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T14:52:07.963955+11:00","updated_at":"2025-12-31T09:09:10.65859+11:00","closed_at":"2025-12-31T09:09:10.658592+11:00","deleted_at":"2025-12-30T02:27:55.854308+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-ni9g","title":"space D should also run cleanup like space d if required","description":"When deleting a bead with Space+D, if the bead has an active session/worktree, the worktree should be cleaned up first (deleting the git worktree and branch). This mirrors the behavior of space+d (cleanup) but as a prerequisite to deletion.\n\nWithout this, deleting a bead with an active session leaves orphaned worktrees in the filesystem.","design":"## Architecture Pattern\n\nBoth Space+d (cleanup) and Space+D (delete) should use a **shared Effect service method** for the core cleanup operation.\n\n### Reusable Service Method\n- `PRWorkflow.cleanup({ beadId, projectPath, closeBead? })` - Core cleanup logic\n- Handles: worktree deletion, branch removal, git state cleanup\n- Can be parameterized to optionally close the bead after cleanup\n\n### Orchestration Pattern\n\n**Space+d (cleanup handler):**\n```\nUser presses Space+d\n  ‚Üí cleanup() handler in prHandlers.ts\n    ‚Üí Validates session is active\n    ‚Üí Calls prWorkflow.cleanup({ closeBead: true })\n    ‚Üí Closes the bead (marks status)\n```\n\n**Space+D (delete handler):**\n```\nUser presses Space+D\n  ‚Üí deleteBead() handler in taskHandlers.ts\n    ‚Üí If session is active:\n      ‚Üí Calls prWorkflow.cleanup({ closeBead: false })\n      ‚Üí Catches errors as best-effort (logs warning)\n    ‚Üí Calls beadsClient.delete(beadId)\n    ‚Üí Deletes bead from database\n```\n\n### Design Rationale\n- **DRY**: Cleanup logic lives in one place (PRWorkflow service)\n- **Composability**: Both handlers reuse the same cleanup operation\n- **Fail-safe**: Delete continues even if cleanup fails (prevents orphaned beads)\n- **Clear intent**: Each handler orchestrates the cleanup ‚Üí next operation flow","acceptance_criteria":"‚úÖ Both Space+d and Space+D use shared `PRWorkflow.cleanup()` method\n‚úÖ Cleanup is extracted to Effect service (not duplicated in handlers)\n‚úÖ Space+D orchestrates cleanup before bead deletion\n‚úÖ Cleanup failures in delete are best-effort (logged but don't block deletion)\n‚úÖ The pattern is documented in design notes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:03:36.08385+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T15:06:08.552053+11:00","close_reason":"Work completed and merged to main (commit a0cf409)","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-nk1","title":"Add number keys 1-9 for quick session attach","description":"Allow pressing 1-9 keys in normal mode to quickly attach to running sessions.\n\nInspiration: AutoMaker uses 1-9, 0 to view output for first 10 in-progress cards.\n\nImplementation:\n1. In normal mode, number keys 1-9 attach to nth running session\n2. Sessions ordered by: busy first, then waiting, then by start time\n3. Show number indicators on cards when sessions are running\n4. 0 could attach to 10th session or be used for other purpose","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T12:00:03Z","updated_at":"2025-12-16T12:00:03Z"}
{"id":"az-nqo","title":"Complete SessionService implementation (spawn/attach/onComplete)","description":"SessionService is a thin facade that consolidates scattered session logic in KeyboardService into a reusable API layer.\n\n**Current State (Duplicated):**\n- `spawn()` logic: KeyboardService lines 362-369 (Space+s) and 388-401 (Space+i) both call sessionManager.start()\n- `attach()` logic: KeyboardService line 443 (Space+a) calls attachmentService.attachExternal()\n- `onComplete()` logic: **MISSING** ‚Äî no PR workflow automation exists\n\n**Refactoring Goals:**\n1. Extract `spawn()` ‚Üí consolidate both keybinding paths into SessionService.spawn()\n2. Extract `attach()` ‚Üí consolidate Space+a/Space+o paths into SessionService.attach()  \n3. Implement `onComplete()` ‚Üí wire PRWorkflow for automatic PR creation + board updates (NEW)\n4. Update KeyboardService to delegate to SessionService instead of direct core service calls\n\n**Benefit:** Single source of truth for session operations, enables auto-PR workflow, cleaner architecture (UI routing vs business logic separation).","design":"## Architecture: SessionService Facade Pattern\n\n```\nKeyboardService (UI event routing)\n    ‚Üì delegates\nSessionService (consolidated API)  ‚Üê NEW facade layer\n    ‚Üì delegates\nCore Services:\n  - SessionManager.start()\n  - AttachmentService.attachExternal()\n  - PRWorkflow.createPR()\n  - TmuxService (session attachment)\n  - BeadsClient (board updates)\n```\n\n**SessionService responsibilities:**\n- Expose spawn(taskId), attach(taskId), onComplete(taskId) as Effect-returning methods\n- Depend on ToastService + NavigationService for UI feedback\n- Delegate actual work to core services\n- Consolidate error handling \u0026 logging","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T15:59:44.332899+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T02:21:09.519079+11:00","close_reason":"Implemented SessionService facade with spawn(), attach(), onComplete() methods. KeyboardService now delegates to SessionService for all session operations.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-nzvz","title":"space f is not working. should see colourfull difftastic output","design":"## Root Cause\nThe `showDiff` function (Space+f) used `git diff main...HEAD` which only shows *committed* changes. When work was only staged (not committed), the diff appeared empty.\n\n## Fix\nChanged `main...HEAD` to `main` in the diff command:\n- `main...HEAD` = commits since branching (excludes uncommitted work)\n- `main` = full diff between main and working tree (includes committed + staged + unstaged)\n\n## Changes\n- `src/services/keyboard/PRHandlersService.ts:379` - Changed diff command to use `main` instead of `main...HEAD`\n- Also removed `+Gg` from less options (was unnecessary)","notes":"üìé [mjcaysaw-91oq.png](.beads/images/az-nzvz/mjcaysaw-91oq.png) (clipboard, 12/19/2025, 2:21:28 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:21:26.408124+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T14:57:35.804225+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-o1h2","title":"there are tmux claude sessions running here and i can space a to attach","description":"but as you can see from the image we dont see and of their status at all","design":"...","notes":"**Resolution:** Not a bug - expected behavior per design decision.\n\n**Root cause:** Session monitoring filters for `claude-` prefix (defined in `src/core/paths.ts:12`). Old sessions (`az-1app`, `az-md0x`, etc.) use the old naming format without the prefix.\n\n**Decision made:** User chose \"migrate old sessions\" approach - no backwards compatibility. Old sessions won't show status; they need to be restarted to use new naming.\n\n**Verification:**\n- `claude-az-o1h2` has `@az_status=waiting` ‚úÖ (monitoring works for new format)\n- `claude-az-ktbd` has no status set (hooks may not be installed in that worktree)\n- `az-1app`, `az-md0x` etc. are invisible to monitor (old naming format)\n\n**Action for users:** Stop and restart in-progress sessions to get status indicators. New sessions spawned via Space+s will automatically use the correct `claude-\u003cbeadId\u003e` format.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T21:52:09.362856+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T23:22:04.382711+11:00","close_reason":"Resolved by design decision: old sessions need restart to use new claude- prefix naming. No code changes needed - monitoring works correctly for properly-named sessions.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-o5a","title":"Complete KeyboardService migration - replace App.tsx inline handlers","description":"Finish the half-completed migration from inline useKeyboard handlers in App.tsx to the data-driven KeyboardService + useKeyboardBridge pattern.","notes":"## Session Progress (2025-12-15)\n\n### Completed\n- Phase 1: NavigationService methods added (halfPageDown, halfPageUp, goToFirst, goToLast, goToFirstColumn, goToLastColumn, jumpToEnd)\n- Layer composition in atoms.ts restructured to support NavigationService ‚Üí BoardService dependency\n- KeyboardService rewritten with all modes and ~60 keybindings\n- **Fixed type errors** by:\n  1. Removing explicit `Effect.Effect\u003cvoid\u003e` return types from helper functions (let TS infer)\n  2. Updated `Keybinding` interface to allow `BeadsError` and `KeybindingDeps` (CommandExecutor | FileSystem)\n  3. Removed explicit return type from `handleKey` method\n- **Extended BeadsClient** to support all bd CLI fields:\n  - `update()`: Added title, description, design, acceptance, assignee, estimate, labels\n  - `create()`: Added design, acceptance, assignee, estimate, labels\n- **Refactored BeadEditorService** to use BeadsClient instead of running bd commands directly\n- **MAJOR: ID-based cursor navigation** - Changed cursor from index-based {columnIndex, taskIndex} to focusedTaskId: string | null\n  - Eliminates sync issues between UI and services\n  - NavigationService now uses EditorService for search/sort config\n  - Navigation operations find current position in filtered view, calculate new position, store new task ID\n- **Single data source** - App.tsx now uses boardTasksAtom from BoardService instead of separate tasksAtom\n  - When board.refresh() is called, UI updates automatically\n- **Skip empty columns** - Left/right navigation skips empty columns to find next non-empty one\n- **Cursor safety** - After deleting a bead, nav.initialize() moves cursor to valid task\n- **az-451 Data.struct refactor** - SubscriptionRef state now uses Data.struct() for structural equality:\n  - EditorService: EditorMode variants + SortConfig\n  - OverlayService: Overlay objects + emptyArray() singleton\n  - ToastService: Toast objects + emptyArray() singleton\n  - Created src/lib/empty.ts with singleton emptyRecord()/emptyArray()\n\n### Status: TYPE-CHECK PASSES ‚úì\n\n### Files Modified This Session\n- src/services/NavigationService.ts - Complete rewrite for ID-based cursor\n- src/services/KeyboardService.ts - Updated getSelectedTask to use focusedTaskId\n- src/services/BoardService.ts - Added getFilteredTasksByColumn, getFilteredTaskAt, Map‚ÜíRecord\n- src/services/EditorService.ts - Data.struct() wrapping for EditorMode/SortConfig\n- src/services/OverlayService.ts - Data.struct() wrapping + emptyArray()\n- src/services/ToastService.ts - Data.struct() wrapping + emptyArray()\n- src/ui/App.tsx - Use boardTasksAtom, call refreshBoard on mount\n- src/ui/atoms.ts - Removed cursorAtom, added initializeNavigationAtom, refreshBoardAtom\n- src/ui/hooks/useNavigation.ts - Derives position from focusedTaskId locally\n- src/ui/Board.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/ui/CompactView.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/lib/empty.ts - NEW: singleton emptyRecord()/emptyArray()\n\n### Remaining Work\n1. Wire useKeyboardBridge into App.tsx (handleKeyAtom already connected)\n2. Remove any remaining inline handlers from App.tsx\n3. Test all keybindings thoroughly\n4. Consider removing debug logging from KeyboardService\n\n### Recent Commits\n- eccbe28 - refactor: Add Data.struct wrapping to SubscriptionRef state\n- 19beb0a - feat: Add singleton empty collection utilities\n- 092959c - refactor: ID-based cursor navigation and single data source","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T00:43:39.319315+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T13:36:38.73138+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-o5m9","title":"merged tasks are being left in in-progress status","notes":"Root cause identified: In mergeToMain(), the bead is closed (step 10) AFTER the git push (step 9). This means the closed status is never pushed to remote. The fix is to either: (1) move the close before the push, or (2) do an additional sync+push after closing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:06:11.946082+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:14:25.570421+11:00","close_reason":"Fixed by moving bead close before git push in mergeToMain() and cleanup(), and adding bd sync after close to persist the status change to JSONL and commit it to git.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-o66c","title":"claude -p is not a think. to prompt claude just use claude \"my prompt here\"","description":"issue found with auto merge code","design":"## Problem\nMultiple files use `claude -p \"prompt\"` but `-p` is not a valid Claude Code CLI flag. The correct syntax is `claude \"prompt\"`.\n\n## Files to fix (9 occurrences in 4 files):\n\n### TypeScript\n1. `src/core/PRWorkflow.ts` - 4 occurrences at lines 1126, 1648, 1905, 2096\n\n### Gleam\n2. `gleam/src/azedarach/actors/coordinator.gleam` - 3 occurrences at lines 643, 788, 1473\n\n### Documentation\n3. `docs/gleam/session-lifecycle.md` - line 138\n4. `docs/gleam/merge-conflict-ux.md` - line 258\n\n## Fix\nReplace all instances of `claude -p \"...\"` with `claude \"...\"`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T14:00:09.740135+11:00","updated_at":"2025-12-30T14:21:41.279181+11:00","closed_at":"2025-12-30T14:21:41.279181+11:00","close_reason":"Fixed all 9 occurrences of `claude -p` ‚Üí `claude` across 4 files. TypeScript and Gleam both compile successfully."}
{"id":"az-o72x","title":"Create OrchestrateHandlersService","description":"New service: src/services/keyboard/OrchestrateHandlersService.ts\n\nMethods:\n- `enterFromDetail()`: Get current detail overlay task, validate epic, load children with session state, call editor.enterOrchestrate()\n- `confirmSpawn()`: Get selected IDs from mode, validate non-empty, exit mode, emit spawn event, show toast\n\nDependencies: EditorService, BeadsClient, BoardService, SessionService, ToastService, OverlayService\n\nAdd to layer in service index.","notes":"üìé [mjbktf29-tf9a.png](.beads/images/az-o72x/mjbktf29-tf9a.png) (clipboard, 12/19/2025, 2:09:27 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:03.999509+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:43.294016+11:00","close_reason":"Implemented: DetailPanel epic drill-down, OrchestrateHandlersService, keybindings, and App.tsx integration","dependencies":[{"issue_id":"az-o72x","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:23.992297+11:00","created_by":"daemon"},{"issue_id":"az-o72x","depends_on_id":"az-9870","type":"blocks","created_at":"2025-12-19T01:43:48.908342+11:00","created_by":"daemon"},{"issue_id":"az-o72x","depends_on_id":"az-ccvg","type":"blocks","created_at":"2025-12-19T01:43:49.461104+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-odr","title":"Fix Space+m merge workflow to prevent merge conflicts","description":"The Space+m (merge to main) workflow has repeatedly failed to prevent merge conflicts from reaching the main branch. This has happened multiple times, requiring manual conflict resolution.\n\n## Root Cause Analysis\nThe current `checkMergeConflicts` in PRWorkflow.ts only does a file-level overlap check (files modified on both branches). This doesn't catch actual content conflicts - Git only discovers those during the merge attempt.\n\n## What's Happening Now\n1. `checkMergeConflicts` compares file lists between branches\n2. If files overlap, shows a confirmation dialog\n3. User confirms (or no overlap detected), merge proceeds\n4. Git attempts merge and finds actual conflicts\n5. Conflicts land on main branch\n\n## Expected Behavior\nThe merge should NEVER introduce conflicts to main. If conflicts exist, they should be resolved in the worktree BEFORE the merge to main happens.\n\n## Proposed Solution\n1. **Perform a test merge first** - In the worktree, do `git fetch origin main \u0026\u0026 git merge --no-commit origin/main`\n2. **Check for conflicts** - If conflicts occur, abort the test merge and report them\n3. **Only proceed if clean** - If test merge succeeds, then push to main\n4. **Auto-abort on conflict** - If test merge has conflicts, abort it (`git merge --abort`) and show which files conflict\n\nThis ensures main always stays clean.","design":"## Implementation Plan\n\n### 1. Update PRWorkflow.checkMergeConflicts\nInstead of file list comparison, perform an actual test merge:\n\n```typescript\ncheckMergeConflicts = ({ beadId, projectPath }) =\u003e\n  Effect.gen(function* () {\n    const worktreePath = yield* getWorktreePath(beadId, projectPath)\n    \n    // Fetch latest main\n    yield* gitInWorktree(worktreePath, [\"fetch\", \"origin\", \"main\"])\n    \n    // Try merge with --no-commit to test\n    const result = yield* gitInWorktree(worktreePath, \n      [\"merge\", \"--no-commit\", \"--no-ff\", \"origin/main\"]\n    ).pipe(Effect.either)\n    \n    if (Either.isLeft(result)) {\n      // Get conflict list\n      const conflicts = yield* gitInWorktree(worktreePath, \n        [\"diff\", \"--name-only\", \"--diff-filter=U\"]\n      )\n      // Abort the test merge\n      yield* gitInWorktree(worktreePath, [\"merge\", \"--abort\"])\n      \n      return {\n        hasConflictRisk: true,\n        conflictingFiles: conflicts.split('\\n').filter(Boolean),\n        canAutoMerge: false\n      }\n    }\n    \n    // Clean test merge succeeded - abort it (we'll do real merge after)\n    yield* gitInWorktree(worktreePath, [\"merge\", \"--abort\"])\n    return { hasConflictRisk: false, conflictingFiles: [], canAutoMerge: true }\n  })\n```\n\n### 2. Update mergeToMain flow\n- If `checkMergeConflicts` shows conflicts, DO NOT proceed\n- Instead of confirmation dialog, show error with conflict file list\n- User must resolve conflicts manually in worktree first\n\n### 3. Files to modify\n- `src/core/PRWorkflow.ts` - Update checkMergeConflicts and mergeToMain\n- `src/services/keyboard/prHandlers.ts` - Update actionMergeToMain error handling","acceptance_criteria":"- [ ] Space+m always checks for actual conflicts before merging\n- [ ] If conflicts exist, merge is blocked (not just warned)\n- [ ] Error message shows which files conflict\n- [ ] Test merge is always aborted, never leaves worktree dirty\n- [ ] Clean merges proceed without extra confirmation\n- [ ] Main branch never has unresolved conflicts after Space+m","status":"closed","priority":1,"issue_type":"bug","assignee":"claude","created_at":"2025-12-17T17:00:52.211803+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T02:10:35.262268+11:00","close_reason":"Complete: Space+m now (1) checks for actual conflicts via git merge-tree, (2) offers Claude-assisted resolution if conflicts detected, (3) only merges to main when clean. Main branch is protected from unresolved conflicts.","labels":["bug-fix","merge","workflow"],"comments":[{"id":3,"issue_id":"az-odr","author":"riordan","text":"Adding Claude-assisted conflict resolution feature","created_at":"2025-12-17T15:10:29Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-oehz","title":"Fix PRWorkflow.ts to use configured CLI tool instead of hardcoded claude","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-05T11:49:46.631914+11:00","updated_at":"2026-01-05T11:54:13.422757+11:00","closed_at":"2026-01-05T11:54:13.422757+11:00","close_reason":"Closed"}
{"id":"az-ofl","title":"have to allow claude permissions again in every worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:26:49.402571+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T10:58:08.359395+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ogbj","title":"space m to merge epic children to parent leaves hourglass icon indefinitely","design":"## Root Cause Analysis\n\nThe hourglass icon stays indefinitely because `CommandQueueService.ts` uses `Effect.either()` to handle operation completion, but `Effect.either` only catches **expected failures** (typed errors), NOT **defects** (unexpected errors/thrown exceptions).\n\nWhen a defect occurs during the merge operation (e.g., an unexpected exception in `mergeToMain`), the forked fiber crashes without ever executing the cleanup code that clears `running: null`.\n\n## Implementation Plan\n\n1. **Change `Effect.either` to `Effect.exit`** in `CommandQueueService.ts` line 166:\n   - `Effect.exit` captures ALL outcomes: success, failure, AND defects\n   - Returns an `Exit` type that represents complete operation results\n   - Ensures cleanup code ALWAYS runs regardless of how the effect terminates\n\n2. **Update the completion handler** to use `Exit.match` or check `Exit.isFailure`:\n   - The current code checks `result._tag === \"Right\"` which is Either-specific\n   - Change to `Exit.isSuccess(result)` or use `Exit.match`\n\n3. **Add logging for defects** to help diagnose future issues:\n   - Log when a defect occurs so we can see what went wrong\n\n## Files to Modify\n\n- `src/services/CommandQueueService.ts` (lines 163-190)\n\n## Code Change\n\n```typescript\n// Before (line 166):\nconst result = yield* Effect.either(next.effect)\n\n// After:\nconst result = yield* Effect.exit(next.effect)\n\n// Update completion check:\n// Before:\nif (result._tag === \"Right\") { ... }\n\n// After:\nif (Exit.isSuccess(result)) { ... } else {\n  // Log defect for debugging\n  if (Exit.isFailure(result) \u0026\u0026 Cause.isDie(result.cause)) {\n    yield* Effect.logError(\"Command failed with defect\", { \n      taskId, \n      label: next.label,\n      cause: Cause.pretty(result.cause)\n    })\n  }\n}\n```","notes":"üìé [mjrzst6d-a56r.png](.beads/images/az-ogbj/mjrzst6d-a56r.png) (clipboard, 12/30/2025, 1:53:12 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T13:53:08.935098+11:00","updated_at":"2025-12-30T14:01:57.351668+11:00","closed_at":"2025-12-30T14:01:57.351668+11:00","close_reason":"Fixed by changing Effect.either to Effect.exit in CommandQueueService.ts. Effect.either only catches expected failures, not defects (thrown exceptions). When a defect occurred during merge, the fiber would crash without clearing running state, leaving hourglass indefinitely. Effect.exit captures all outcomes including defects, ensuring cleanup always runs."}
{"id":"az-okd4","title":"changing project during epic drilldown shows 0 beads","description":"it stays in epic drill down mode in other project which doesnt end up working very well","design":"## Root Cause\n\nWhen switching projects while in epic drilldown mode, the `drillDownChildIds` in NavigationService is never cleared. The board filtering logic then tries to filter the new project's tasks using the old project's epic child IDs, resulting in 0 matches.\n\n## Flow of Bug\n\n1. User enters epic drilldown in Project A ‚Üí `drillDownChildIds = {az-123, az-456}`\n2. User switches to Project B\n3. Board loads Project B tasks\n4. `drillDownFilteredTasksAtom` filters: `newTasks.filter(t =\u003e oldChildIds.has(t.id))`\n5. No matches ‚Üí 0 beads shown\n\n## Fix\n\nCall `nav.exitDrillDown()` before switching projects in two locations:\n\n1. **src/ui/atoms/project.ts** - `switchProjectAtom` \n2. **src/services/keyboard/InputHandlersService.ts** - `handleProjectSelectorInput`\n\nThis ensures drilldown state is always cleared before project context changes.\n\n## Why Not Persist Drilldown State?\n\nEpic child IDs are project-specific. Persisting them would require mapping IDs across projects (impossible) or re-fetching epic children on restore (complex, epic may not exist in new project). Simpler to exit drilldown on project switch.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T11:00:45.264369+11:00","updated_at":"2025-12-30T11:23:46.739155+11:00","closed_at":"2025-12-30T11:23:46.739155+11:00","close_reason":"Fixed by calling nav.exitDrillDown() before project switch in both switchProjectAtom (src/ui/atoms/project.ts) and handleProjectSelectorInput (src/services/keyboard/InputHandlersService.ts)"}
{"id":"az-oltq","title":"i need to be able to visualize dependencies in an epic drill down","description":"im not sure if thats feasible on the board. maybe need to add a graph view?","design":"## Phased Dependency Visualization in Epic Drill-Down\n\n### Overview\nWhen viewing an epic drill-down, display child tasks grouped by **dependency phase** with minimal blocked indicators on cards.\n\n### Visual Design\n\n```\n‚îå‚îÄ Open ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ In Progress ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ ‚îÄ‚îÄ Phase 1: Ready ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ ‚îÇ Setup database   ‚îÇ   ‚îÇ  ‚îÇ ‚îÇ Design API       ‚îÇ   ‚îÇ\n‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ ‚îÇ Write tests      ‚îÇ   ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ                        ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ ‚îÄ‚îÄ Phase 2 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ                        ‚îÇ\n‚îÇ ‚îÇ ‚äò Impl endpoints ‚îÇ   ‚îÇ  ‚îÇ   (dimmed card)        ‚îÇ\n‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ                        ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Features\n1. **Phase separators** - Horizontal lines: \"‚îÄ‚îÄ Phase 1: Ready ‚îÄ‚îÄ\", \"‚îÄ‚îÄ Phase 2 ‚îÄ‚îÄ\"\n2. **Minimal blocked indicator** - ‚äò icon prepended to title + dimmed card opacity\n3. **Full blocker info in DetailPanel** - Press Enter to see what's blocking\n4. **Phase separators count toward visible limit** - Reserve space for separators\n5. **Only in drill-down mode** - Normal board unchanged\n\n### Implementation Plan\n\n#### 1. Add dependency phase computation (new utility)\n- File: `src/core/dependencyPhases.ts`\n- Function: `computeDependencyPhases(children: DependencyRef[], childDetails: Map\u003cstring, Issue\u003e)`\n- Returns: `Map\u003ctaskId, { phase: number, blockedBy: string[] }\u003e`\n- Algorithm: Kahn's algorithm for topological sort\n  - Phase 1 = tasks with no blockers among siblings\n  - Phase 2 = tasks only blocked by Phase 1 tasks, etc.\n\n#### 2. Fetch full dependency info for children\n- Modify drill-down entry to fetch `Issue` details for each child (need dependencies array)\n- Store in NavigationService: `drillDownChildDetails: SubscriptionRef\u003cReadonlyMap\u003cstring, Issue\u003e\u003e`\n- Create atom: `drillDownPhasesAtom` that computes phases from child details\n\n#### 3. Create PhaseSeparator component\n- File: `src/ui/PhaseSeparator.tsx`\n- Props: `phase: number`, `isFirst: boolean` (Phase 1 shows \"Ready\")\n- Height: 1 row (counts toward visible limit)\n- Style: `‚îÄ‚îÄ Phase N ‚îÄ‚îÄ` or `‚îÄ‚îÄ Phase 1: Ready ‚îÄ‚îÄ`\n\n#### 4. Modify Column.tsx for phase grouping\n- In drill-down mode: group tasks by phase, render separators between groups\n- Pass `isBlocked` prop to TaskCard for tasks in phase \u003e 1\n- Calculate separator count to adjust max visible tasks\n\n#### 5. Modify TaskCard.tsx for blocked display\n- Add prop: `isBlocked?: boolean`\n- When blocked: prepend \"‚äò \" to title, set opacity ~60% (dim appearance)\n- NO blocker name on card (keeps layout unchanged)\n\n#### 6. Enhance DetailPanel for blocker info\n- When task has blockers: show \"Blocked by:\" section\n- List each blocker with status indicator (like epic children)\n- Reuse existing colored status indicator pattern\n\n#### 7. Update EpicHeader with phase summary (optional)\n- Show: \"Phase 1: 3 ready | Phase 2: 2 blocked\"\n\n### Files to Modify\n- `src/core/dependencyPhases.ts` (new)\n- `src/services/NavigationService.ts` (store child details)\n- `src/ui/atoms/navigation.ts` (phases atom)\n- `src/ui/PhaseSeparator.tsx` (new)\n- `src/ui/Column.tsx` (phase grouping)\n- `src/ui/TaskCard.tsx` (blocked indicator - minimal)\n- `src/ui/DetailPanel.tsx` (blocker info section)\n- `src/ui/EpicHeader.tsx` (phase summary - optional)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T10:59:57.122894+11:00","updated_at":"2025-12-30T12:15:05.97135+11:00","closed_at":"2025-12-30T12:15:05.97135+11:00","close_reason":"Implemented phased dependency visualization in epic drill-down mode. Tasks are now grouped by dependency phase with separators, blocked tasks show ‚äò indicator with dimmed appearance, and DetailPanel shows blocker info section."}
{"id":"az-om3","title":"WorktreeManager - git worktree lifecycle","description":"Manage git worktree creation, tracking, and cleanup for isolated task execution.","design":"- Define WorktreeManager as Effect.Service\n- Use @effect/platform Command for git operations (or simple-git if needed)\n- Naming: ../ProjectName-\u003cbead-id\u003e/\n- Methods return Effect with typed errors:\n  - create(beadId, baseBranch): Effect\u003cWorktree, GitError\u003e\n  - remove(beadId): Effect\u003cvoid, GitError | WorktreeNotFoundError\u003e\n  - list(): Effect\u003cWorktree[], GitError\u003e\n  - exists(beadId): Effect\u003cboolean, GitError\u003e\n- Use Effect.acquireRelease for cleanup guarantees\n- Track active worktrees in Ref\n- Handle epic vs task worktree sharing logic\n- Create WorktreeManagerLive and WorktreeManagerTest layers","notes":"Implemented WorktreeManager Effect service with:\n- Service interface with create, remove, list, exists, get methods\n- Error types: GitError, WorktreeNotFoundError, WorktreeExistsError, NotAGitRepoError\n- Idempotent create operation (safe to call multiple times)\n- Ref-based state tracking for active worktrees\n- Parses git worktree list --porcelain output\n- acquireRelease pattern via acquireWorktree for cleanup guarantees\n- Convenience functions for all operations\n- WorktreeManagerLive and WorktreeManagerLiveWithPlatform layers\n- Comprehensive example file with 7 usage patterns\n- Follows BeadsClient and TmuxService patterns\n- All type checks pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.585679+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T18:03:13.741817+11:00","dependencies":[{"issue_id":"az-om3","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.224593+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ongu","title":"Gas Town Integration for Azedarach","description":"EPIC: Integrate Gas Town's orchestration concepts (Convoys, Molecules, GUPP) into Azedarach's Go/Bubbletea TUI. This will transform Azedarach from a simple session manager into a full agent orchestrator, enabling 3x throughput through convoy organization, molecular workflows, and automatic session recovery. See integration plan document for detailed technical approach and phase breakdown. Goal: Make Azedarach the 'Kubernetes for Claude Code agents' while maintaining terminal-native simplicity.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-05T00:57:10.654457+11:00","updated_at":"2026-01-05T01:00:01.001023+11:00"}
{"id":"az-ongu.1","title":"Phase 1: Foundation - Implement Convoy system and data model extensions","description":"FEATURE: Phase 1 foundation work implementing core Gas Town concepts. Deliverables: 1) Extend internal/domain/ with Convoy and Molecule structs following Go best practices 2) Create ConvoyService in internal/services/convoy/ for CRUD operations 3) Implement Convoy Dashboard UI overlay (O key) with progress bars and task breakdown 4) Extend internal/services/beads/client.go with convoy management commands 5) Update main Model to track active convoys and session hooks. Success criteria: Users can create convoys, assign tasks, and see progress visualization in TUI.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-05T00:57:29.764727+11:00","updated_at":"2026-01-05T01:00:23.429553+11:00","dependencies":[{"issue_id":"az-ongu.1","depends_on_id":"az-ongu","type":"parent-child","created_at":"2026-01-05T00:57:29.765532+11:00","created_by":"riordan"},{"issue_id":"az-ongu.1","depends_on_id":"az-ongu.5","type":"blocks","created_at":"2026-01-05T00:59:12.207548+11:00","created_by":"riordan"}]}
{"id":"az-ongu.1.1","title":"Add Convoy and Molecule structs to domain layer","description":"TASK: Design and implement domain models for Gas Town concepts in internal/domain/. Required structs: 1) Convoy { id, title, description, status, task_ids[], created_at, updated_at, progress } 2) Molecule { id, title, description, template_path, variables[], instantiated_tasks[] } 3) SessionHook { id, session_id, molecule_id, step_index, data, auto_resume } 4) WorkflowStep { id, title, acceptance_criteria, dependencies[], variables }. All structs must include JSON tags, validation methods, and Go doc comments. Follow existing patterns in task.go and session.go.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T00:57:33.160184+11:00","updated_at":"2026-01-05T01:00:28.552557+11:00","dependencies":[{"issue_id":"az-ongu.1.1","depends_on_id":"az-ongu.1","type":"parent-child","created_at":"2026-01-05T00:57:33.162763+11:00","created_by":"riordan"}]}
{"id":"az-ongu.1.2","title":"Implement Convoy Dashboard UI overlay","description":"TASK: Create Convoy Dashboard UI overlay in internal/ui/overlay/convoy.go. Requirements: 1) Accessible via 'O' key from main board 2) List active convoys with title, progress bar, and task counts 3) Expandable view showing individual tasks with status indicators 4) Quick actions: Start convoy, Pause convoy, Add task, Edit details 5) Keyboard navigation: j/k to move, Enter to expand, Space for actions, Esc to close. Integration: Must work with existing overlay stack system and use established styling patterns from other overlays. Test with both active and completed convoys.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T00:57:37.174754+11:00","updated_at":"2026-01-05T01:00:34.405409+11:00","dependencies":[{"issue_id":"az-ongu.1.2","depends_on_id":"az-ongu.1","type":"parent-child","created_at":"2026-01-05T00:57:37.177446+11:00","created_by":"riordan"}]}
{"id":"az-ongu.1.3","title":"Extend Beads client with convoy commands","description":"TASK: Extend internal/services/beads/client.go with convoy management methods. Required methods: 1) CreateConvoy(ctx, title, taskIDs) (string, error) - creates new convoy and associates tasks 2) ListConvoys(ctx) ([]Convoy, error) - fetches all convoys 3) UpdateConvoy(ctx, id, status) error - updates convoy status 4) GetConvoy(ctx, id) (Convoy, error) - fetches single convoy 5) DeleteConvoy(ctx, id) error - removes convoy and disassociates tasks. Each method must handle JSON marshaling/unmarshaling, include proper error wrapping with domain.BeadsError, and include detailed debug logging. Update existing command runner interface if needed.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T00:57:40.540479+11:00","updated_at":"2026-01-05T01:00:41.54139+11:00","dependencies":[{"issue_id":"az-ongu.1.3","depends_on_id":"az-ongu.1","type":"parent-child","created_at":"2026-01-05T00:57:40.542887+11:00","created_by":"riordan"}]}
{"id":"az-ongu.1.4","title":"Gas Town Integration: Data Migration and Backwards Compatibility","description":"TASK: Ensure existing Azedarach installations continue working during Gas Town integration. Requirements: 1) Auto-migrate existing tasks to default convoys on first run 2) Feature flags in config for gradual rollout of new functionality 3) Legacy mode that disables Gas Town features for users who prefer current workflow 4) Migration path from current session tracking to GUPP hooks 5) Comprehensive testing of upgrade/downgrade scenarios 6) Documentation for users on migration process. Must preserve all existing data and provide clear migration messages. Create migration scripts and test with existing .beads/ data.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T01:02:26.117787+11:00","updated_at":"2026-01-05T01:02:36.784874+11:00","dependencies":[{"issue_id":"az-ongu.1.4","depends_on_id":"az-ongu.1","type":"parent-child","created_at":"2026-01-05T01:02:26.118479+11:00","created_by":"riordan"}]}
{"id":"az-ongu.2","title":"Phase 2: Workflow Engine - Molecules and template system","description":"FEATURE: Phase 2 implements Molecule system for repeatable workflows. Deliverables: 1) Molecule template storage in .beads/molecules/ with TOML format 2) Template variable substitution engine with  syntax 3) WorkflowExecutor service for step-by-step execution with state persistence 4) Molecule Builder UI overlay (M key) for visual workflow creation 5) Template library with built-in patterns (release, feature, bugfix). Success criteria: Users can create templates, instantiate them as bead workflows, and track progress through multi-step processes that survive session crashes.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T00:57:45.127831+11:00","updated_at":"2026-01-05T01:00:48.624792+11:00","dependencies":[{"issue_id":"az-ongu.2","depends_on_id":"az-ongu","type":"parent-child","created_at":"2026-01-05T00:57:45.130957+11:00","created_by":"riordan"},{"issue_id":"az-ongu.2","depends_on_id":"az-ongu.1","type":"blocks","created_at":"2026-01-05T00:59:15.136124+11:00","created_by":"riordan"}]}
{"id":"az-ongu.2.1","title":"Design Molecule template storage system","description":"TASK: Design and implement molecule template storage system. Requirements: 1) Create .beads/molecules/ directory structure with categories (release, feature, bugfix, custom) 2) Define TOML format for molecule templates with sections: [molecule] metadata, [[steps]] for workflow steps, [variables] for template variables 3) Implement template validation (required fields, step dependencies, variable references) 4) Create template loading/caching service in internal/services/molecule/ 5) Add migration logic for existing molecules on startup. Include example templates for common workflows (release process, code review, testing). Document variable substitution syntax and step dependency rules.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T00:58:00.991996+11:00","updated_at":"2026-01-05T01:00:54.537856+11:00","dependencies":[{"issue_id":"az-ongu.2.1","depends_on_id":"az-ongu.2","type":"parent-child","created_at":"2026-01-05T00:58:00.994409+11:00","created_by":"riordan"}]}
{"id":"az-ongu.2.2","title":"Implement Molecule Builder UI overlay","description":"TASK: Implement Molecule Builder UI overlay in internal/ui/overlay/molecule.go. Features required: 1) Visual workflow editor with drag-and-drop step reordering 2) Step editor with title, acceptance criteria, and variable fields 3) Variable definition panel with name, type, default value, description 4) Template preview showing bead IDs that will be generated 5) Save/Load template functionality 6) Integration with template storage service. UI requirements: Access via 'M' key, keyboard navigation, consistent styling with existing overlays, real-time validation feedback, help system. Must handle complex molecules with 10+ steps and conditional logic.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T00:58:04.376812+11:00","updated_at":"2026-01-05T01:00:59.995107+11:00","dependencies":[{"issue_id":"az-ongu.2.2","depends_on_id":"az-ongu.2","type":"parent-child","created_at":"2026-01-05T00:58:04.379763+11:00","created_by":"riordan"}]}
{"id":"az-ongu.2.3","title":"Build Workflow Executor service","description":"TASK: Build WorkflowExecutor service in internal/services/workflow/. Core functionality: 1) Step-by-step execution with dependency resolution 2) State persistence across session restarts (crash recovery) 3) Error handling with retry logic and escalation paths 4) Progress tracking with percentage complete and current step 5) Hook into existing tmux session monitoring for automatic step transitions. Interface: Execute(moleculeID, vars) (Workflow, error), GetStatus(moleculeID) (WorkflowStatus, error), Pause/Resume/Cancel workflows. Must integrate with beads client for step status updates and handle concurrent workflow execution.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T00:58:29.342185+11:00","updated_at":"2026-01-05T01:01:06.81784+11:00","dependencies":[{"issue_id":"az-ongu.2.3","depends_on_id":"az-ongu.2","type":"parent-child","created_at":"2026-01-05T00:58:29.345048+11:00","created_by":"riordan"}]}
{"id":"az-ongu.3","title":"Phase 3: GUPP Integration - Session hooks and auto-recovery","description":"FEATURE: Phase 3 implements GUPP (Gas Town Universal Propulsion Principle) for automatic session progress. Deliverables: 1) Session hook system with persistent work storage per session 2) Stuck session detection algorithms (waiting \u003e X minutes, error patterns, inactivity) 3) Auto-nudge system via tmux integration 4) GUPP status indicators in existing status bar 5) Hook management overlay for manual intervention. Success criteria: Sessions automatically continue work when stuck, recover from crashes, and show persistent hook status without requiring manual intervention.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T00:58:39.762259+11:00","updated_at":"2026-01-05T01:01:11.55291+11:00","dependencies":[{"issue_id":"az-ongu.3","depends_on_id":"az-ongu","type":"parent-child","created_at":"2026-01-05T00:58:39.764917+11:00","created_by":"riordan"},{"issue_id":"az-ongu.3","depends_on_id":"az-ongu.2","type":"blocks","created_at":"2026-01-05T00:59:18.238277+11:00","created_by":"riordan"}]}
{"id":"az-ongu.3.1","title":"Implement Session Hook system","description":"TASK: Implement Session Hook system for GUPP in internal/services/gupp/. Requirements: 1) Persistent work storage per Claude session in .beads/hooks/ as JSON 2) Hook structure: session_id, molecule_id, current_step, work_data, auto_resume_enabled 3) Hook execution on session start - automatically load and continue work 4) Hook update API - save progress, change active step, mark completion 5) Integration with tmux client to detect session lifecycle events 6) Backup/sync hooks with git for crash recovery. Must handle concurrent sessions, hook conflicts, and data migration from old session tracking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T00:58:42.877206+11:00","updated_at":"2026-01-05T01:01:17.335344+11:00","dependencies":[{"issue_id":"az-ongu.3.1","depends_on_id":"az-ongu.3","type":"parent-child","created_at":"2026-01-05T00:58:42.879592+11:00","created_by":"riordan"}]}
{"id":"az-ongu.3.2","title":"Add stuck session detection and auto-nudge","description":"TASK: Implement stuck session detection and auto-nudge algorithms. Requirements: 1) Monitor session output patterns for 'waiting', 'input needed', error states 2) Timeout detection - no activity for X minutes (configurable) 3) Pattern matching for Claude's typical waiting prompts 4) Auto-nudge via tmux send-keys - send interrupt or continue command 5) Exponential backoff for repeated nudges to prevent loops 6) Integration with existing SessionMonitor service 7) Configuration for nudge behavior (enabled/disabled, timeout, max attempts). Must distinguish between productive waiting and actual stuck states.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T00:58:47.004691+11:00","updated_at":"2026-01-05T01:01:26.102619+11:00","dependencies":[{"issue_id":"az-ongu.3.2","depends_on_id":"az-ongu.3","type":"parent-child","created_at":"2026-01-05T00:58:47.007271+11:00","created_by":"riordan"}]}
{"id":"az-ongu.4","title":"Phase 4: Advanced Features - Convoy orchestration and analytics","description":"FEATURE: Phase 4 implements advanced orchestration and analytics. Deliverables: 1) Convoy orchestration service for automatic task assignment and load balancing 2) Performance analytics dashboard with throughput metrics and bottleneck identification 3) Template marketplace integration for sharing molecules between projects 4) Advanced UI enhancements (bulk operations, advanced filtering) 5) Resource optimization algorithms for session allocation. Success criteria: Users can orchestrate large convoys automatically, identify workflow bottlenecks, and optimize resource utilization across multiple Claude sessions.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-05T00:58:53.902178+11:00","updated_at":"2026-01-05T01:01:38.515619+11:00","dependencies":[{"issue_id":"az-ongu.4","depends_on_id":"az-ongu","type":"parent-child","created_at":"2026-01-05T00:58:53.904799+11:00","created_by":"riordan"},{"issue_id":"az-ongu.4","depends_on_id":"az-ongu.3","type":"blocks","created_at":"2026-01-05T00:59:27.715735+11:00","created_by":"riordan"}]}
{"id":"az-ongu.4.1","title":"Create Convoy orchestration service","description":"TASK: Create Convoy orchestration service in internal/services/orchestration/. Core algorithms: 1) Task assignment based on session capacity and availability 2) Load balancing across multiple Claude sessions to prevent bottlenecks 3) Dependency resolution - start tasks when prerequisites are met 4) Resource optimization - prioritize tasks based on convoy critical path 5) Dynamic reassignment when sessions fail or become stuck. Interface: StartConvoy(convoyID) error, StopConvoy(convoyID) error, RebalanceSessions() error, GetOptimalAssignment(tasks, sessions) Assignment. Must handle real-time re-optimization and provide audit trail of assignment decisions.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T00:58:56.766522+11:00","updated_at":"2026-01-05T01:01:43.536819+11:00","dependencies":[{"issue_id":"az-ongu.4.1","depends_on_id":"az-ongu.4","type":"parent-child","created_at":"2026-01-05T00:58:56.768901+11:00","created_by":"riordan"}]}
{"id":"az-ongu.4.2","title":"Implement Analytics Dashboard","description":"TASK: Implement Analytics Dashboard overlay in internal/ui/overlay/analytics.go. Metrics to track: 1) Task throughput (tasks/hour, completion rate) 2) Session utilization (busy vs idle time per session) 3) Convoy performance (average completion time, bottlenecks) 4) Molecule effectiveness (success rate, failure reasons) 5) Resource allocation efficiency. UI requirements: 1) Charts and graphs for key metrics 2) Time range filtering (last hour, day, week) 3) Drilling down into specific convoys/sessions 4) Export functionality for reports 5) Performance optimization suggestions based on data. Use existing chart libraries or implement simple terminal charts.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-05T00:59:00.686945+11:00","updated_at":"2026-01-05T01:02:07.425853+11:00","dependencies":[{"issue_id":"az-ongu.4.2","depends_on_id":"az-ongu.4","type":"parent-child","created_at":"2026-01-05T00:59:00.690632+11:00","created_by":"riordan"}]}
{"id":"az-ongu.4.3","title":"Gas Town Integration: Performance Impact Analysis and Optimization","description":"TASK: Analyze performance impact of Gas Town features and optimize Azedarach performance. Requirements: 1) Profile TUI performance with convoy/molecule data loading using Go's pprof 2) Optimize rendering loops for large convoys (20+ tasks) 3) Implement lazy loading strategies for molecule templates and analytics data 4) Background synchronization via goroutines to avoid UI blocking 5) Memory usage optimization for session hook storage and workflow state 6) Benchmark against current Azedarach baseline performance. Performance targets: UI refresh \u003c100ms, startup time \u003c2s, memory usage \u003c50MB baseline + 5MB per active session, CPU usage \u003c10% during monitoring.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T01:02:56.346981+11:00","updated_at":"2026-01-05T01:03:01.663621+11:00","dependencies":[{"issue_id":"az-ongu.4.3","depends_on_id":"az-ongu.4","type":"parent-child","created_at":"2026-01-05T01:02:56.349645+11:00","created_by":"riordan"}]}
{"id":"az-ongu.5","title":"Research and documentation - Gas Town concepts study","description":"TASK: Deep dive into Gas Town source code and Steve Yegge's documentation to understand implementation details for: 1) Convoy orchestration system - how work-orders are managed and tracked 2) Molecule template format and variable substitution 3) GUPP implementation - session hooks and auto-nudge mechanisms 4) MEOW stack data structures and persistence 5) Formula cooking process for template instantiation. Output: Implementation guide with code examples, API contracts, and integration patterns for Azedarach's Go/Bubbletea architecture.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T00:59:04.172792+11:00","updated_at":"2026-01-05T01:00:17.909634+11:00","dependencies":[{"issue_id":"az-ongu.5","depends_on_id":"az-ongu","type":"parent-child","created_at":"2026-01-05T00:59:04.175791+11:00","created_by":"riordan"}]}
{"id":"az-osly","title":"unify the dev server overlays (view, edit)","description":"up, down to select\nleft, right, space to toggle start/stop.\nenter/a to attach to that specific window (only available on running/error statuses)","design":"## Design: Unified Dev Server Overlay\n\n### Goal\nReplace the separate \"toggle\" and \"attach\" modes with a single unified dev server overlay accessible via `Space+r`.\n\n### Keybindings in Overlay\n- **j/k/‚Üë/‚Üì**: Navigate server list  \n- **‚Üê/‚Üí/Space**: Toggle start/stop for selected server\n- **Enter/a**: Attach to server (enabled for running/starting/error states only)\n- **Esc/q**: Close overlay\n\n### Implementation Changes\n\n#### 1. `src/ui/DevServerMenu.tsx`\n- Remove `mode` prop entirely\n- Always show ALL configured servers (no filtering)\n- Add left/right handling for toggle (same as space)\n- Add `a` key handling for attach (same as enter)\n- Attach action enabled for: running, starting, error statuses\n- Update keybinds display at bottom to show all actions\n- Visual indicator showing which actions are available per server\n\n#### 2. `src/services/OverlayService.ts`\n- Remove `mode` from devServerMenu overlay type:\n  ```typescript\n  | { readonly _tag: \"devServerMenu\"; readonly beadId: string }\n  ```\n\n#### 3. `src/services/keyboard/DevServerHandlersService.ts`\n- Remove `attachDevServer` handler entirely\n- Simplify `toggleDevServer`:\n  - If multiple servers: show overlay (no mode param)\n  - If single server: toggle directly (current behavior)\n- Remove `restartDevServer` that opens menu with mode\n\n#### 4. `src/services/keyboard/KeyboardService.ts`\n- Remove Space+v binding (was for attach)\n- Keep Space+r binding for dev server overlay\n\n#### 5. `src/ui/atoms/overlay.ts` and `src/ui/hooks/useOverlays.ts`\n- Update types to remove mode from devServerMenu\n- Update `showDevServerMenu` helper to not take mode param\n\n#### 6. `src/ui/atoms/devServer.ts`\n- Remove `devServersForOverlayAtom` (no longer filters by mode)\n- Keep `beadDevServerViewsAtom` (returns all servers)\n\n### Visual Design\n```\n‚îå‚îÄ Dev Servers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                           ‚îÇ\n‚îÇ ‚Üí vite          running    :5173          ‚îÇ\n‚îÇ   api           stopped                   ‚îÇ\n‚îÇ   storybook     error                     ‚îÇ\n‚îÇ                                           ‚îÇ\n‚îÇ [j/k] Navigate  [‚Üê/‚Üí/Space] Toggle        ‚îÇ\n‚îÇ [Enter/a] Attach  [Esc/q] Close           ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\nAttach shown dimmed or with indicator when not available (stopped/idle states).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:40:00.106578+11:00","updated_at":"2025-12-29T18:08:42.760998+11:00","closed_at":"2025-12-29T18:08:42.760998+11:00","close_reason":"Implemented unified dev server overlay with toggle (‚Üê/‚Üí/Space) and attach (Enter/a) in single view. Removed separate Space+v binding."}
{"id":"az-otrx","title":"tui_core: Terminal resize handling (SIGWINCH)","description":"**Goal:** Handle terminal resize events so the TUI reflows correctly.\n\n## Why Critical\nIf the terminal resizes and we don't handle it:\n- Layout is wrong (still using old dimensions)\n- Rendering artifacts appear\n- User experience breaks\n\n## Implementation\n\n### Signal-based (Unix)\n```gleam\n// Listen for SIGWINCH signal\n// On signal: \n//   1. Query new terminal size\n//   2. Resize FrameBuffer\n//   3. Trigger full re-layout + re-render\n```\n\n### Polling fallback\n```gleam\n// Poll terminal size every N frames\n// On change: same as above\n```\n\n## API Addition\n```gleam\n// In tui_core/terminal\nfn get_terminal_size() -\u003e #(Int, Int)  // (width, height)\n\n// In InputHandler or Runtime\ntype Event {\n  Key(KeyEvent)\n  Resize(width: Int, height: Int)\n}\n```\n\n## Integration Points\n- az-xe2h (FrameBuffer) - needs `resize()` function\n- az-d19m (Runtime) - needs to handle Resize events\n- az-se6w (Layout) - needs to relayout on resize\n\n## Acceptance Criteria\n- [ ] Detect terminal resize (SIGWINCH or polling)\n- [ ] FrameBuffer resizes correctly\n- [ ] Full re-layout triggers\n- [ ] No visual artifacts during resize\n- [ ] Works on macOS and Linux","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:43:06.692712+11:00","updated_at":"2025-12-30T00:29:51.513613+11:00","closed_at":"2025-12-30T00:29:51.513613+11:00","close_reason":"Implemented resize.gleam with Dimensions, ResizeTracker types. Provides get_size(), from_event(), changed(), tracker pattern. Leverages Etch's built-in SIGWINCH handling. Build verified.","labels":["gleam","signals","tui-core"],"dependencies":[{"issue_id":"az-otrx","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:43:16.740429+11:00","created_by":"daemon"},{"issue_id":"az-otrx","depends_on_id":"az-zh3y","type":"blocks","created_at":"2025-12-28T11:43:16.802615+11:00","created_by":"daemon"}]}
{"id":"az-p3hh","title":"when a dev command starts many dev servers the space menu shows only 1 port next to r keybind","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T13:31:41.261372+11:00","updated_at":"2025-12-23T14:39:32.507356+11:00","deleted_at":"2025-12-23T14:39:32.507356+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-p4ds","title":"merging with space m doesnt always move bead to closed STILL","description":"we have tried to fix this twice already. please figure it out once and for all","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:41:56.573516+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:11:29.944746+11:00","close_reason":"Fixed: BeadsClient now uses ProjectService.getCurrentPath() as default cwd, ensuring bd commands operate on correct database. Added projectPath to all update calls in PRWorkflow merge operations.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-p4wy","title":"add indication of git status in bead/worktree","description":"so in kanban card header we can see if the worktree is behind in commits and/or has uncommitted changes\nwould be cool to be able to see +- as a configurable option too","design":"## Implementation Plan\n\n### Goal\nAdd git status indicators to TaskCard headers for tasks with active sessions, showing:\n- `‚ÜìN` - commits behind the base branch (configurable, defaults to \"main\")\n- `‚óè` - uncommitted changes (dirty worktree)\n- `+X/-Y` - line changes (configurable option, off by default)\n\n### Architecture Decision\nUse the existing polling pattern in BoardService (2-second refresh cycle) to collect git status alongside merge conflict detection. This keeps git operations centralized and avoids per-card polling.\n\n### Components to Modify\n\n#### 1. Config Schema (`src/config/schema.ts`)\nAdd git status configuration:\n```typescript\ngitStatus: {\n  baseBranch: string  // defaults to \"main\"\n  showLineChanges: boolean  // +X/-Y stats, defaults to false\n}\n```\n\n#### 2. UI Types (`src/ui/types.ts`)\nExtend `TaskWithSession` interface:\n```typescript\n// Git status for worktree (only populated for active sessions)\ngitBehindCount?: number      // commits behind base branch\nhasUncommittedChanges?: boolean  // dirty worktree\ngitAdditions?: number        // lines added (if showLineChanges enabled)\ngitDeletions?: number        // lines deleted (if showLineChanges enabled)\n```\n\n#### 3. BoardService (`src/services/BoardService.ts`)\nAdd git status check alongside existing `checkMergeConflict`:\n- `checkGitStatus(worktreePath, baseBranch, showLineChanges)` - returns git status info\n- Call during task loading for active sessions only\n- Uses `git rev-list` for behind count, `git status --porcelain` for dirty check\n- Uses `git diff --stat` for line changes (when enabled)\n\n#### 4. TaskCard (`src/ui/TaskCard.tsx`)\nAdd indicators to header line after existing indicators:\n- Git behind: `‚Üì3` (yellow when behind)\n- Dirty: `‚óè` (red dot)\n- Line changes: `+42/-15` (green/red, only if configured)\n\n### Git Commands\n```bash\n# Behind count: how many commits we're behind the base branch\ngit rev-list --count HEAD..origin/main\n\n# Dirty check (has uncommitted changes)\ngit status --porcelain  # non-empty = dirty\n\n# Line stats (when showLineChanges enabled)\ngit diff --stat HEAD  # parse for insertions/deletions\n```\n\n### Performance Considerations\n- Git operations run only for active sessions (not all tasks)\n- Leverages existing 2-second polling cycle\n- Git commands are fast (\u003c50ms each) and run in parallel\n- Could add caching if needed, but likely unnecessary given scope","acceptance_criteria":"1. TaskCard header shows `‚ÜìN` indicator when worktree is behind base branch\n2. TaskCard header shows `‚óè` (red) when worktree has uncommitted changes\n3. `+X/-Y` line stats shown when configured (off by default)\n4. Base branch is configurable in project config (defaults to \"main\")\n5. Indicators only appear for tasks with active sessions (has worktree)\n6. No performance regression - git checks run in parallel during existing polling cycle\n7. Type-safe: all new fields properly typed in TaskWithSession","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T03:33:32.965755+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T18:20:20.236468+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-p9ut","title":"task header isnt responsive enough","notes":"üìé [mjfpdk96-xvvs.png](.beads/images/az-p9ut/mjfpdk96-xvvs.png) (clipboard, 12/21/2025, 11:28:10 PM)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T23:28:08.094691+11:00","updated_at":"2025-12-22T13:40:30.598866+11:00"}
{"id":"az-pdr6","title":"in origin workflowMode i cant space m to merge a epic child into the epic branch/worktree","description":"i should be able to do this! space m in epic drill down should merge to the epic branch not base branch so its fine to skip PR workflow","design":"## Problem\nIn 'origin' workflow mode, Space+m (merge) is blocked unconditionally. However, when viewing an epic's children in drilldown mode, Space+m should be allowed because:\n- It merges child branch ‚Üí epic branch (not child ‚Üí main)\n- This is internal work consolidation within the epic\n- The actual PR (epic ‚Üí main) happens separately\n\n## Solution\nModify `PRHandlersService.mergeToMain()` to check if we're in epic drilldown mode before blocking.\n\n**Logic change** (lines 276-283):\n```typescript\n// OLD: Block unconditionally\nif (workflowMode === 'origin') { /* block */ }\n\n// NEW: Block only if NOT in epic drilldown\nconst drilldownEpicId = yield* nav.getDrillDownEpic()\nif (workflowMode === 'origin' \u0026\u0026 !drilldownEpicId) { /* block */ }\n```\n\n**Why this works:**\n1. NavigationService already tracks `drillDownEpic` (the epic ID when in drilldown view)\n2. In drilldown, all visible tasks are children of that epic\n3. PRWorkflow.mergeToMain already correctly uses `getBeadBaseBranch()` which returns the parent epic's branch for children\n4. So the only fix needed is at the keyboard handler level\n\n**Files to modify:**\n- `src/services/keyboard/PRHandlersService.ts`: Add drilldown check\n\n## Testing\n1. Set workflowMode: 'origin' in .azedarach.json\n2. Create epic with child task\n3. Start session on child (Space+s)\n4. Enter drilldown (Enter on epic)\n5. Try Space+m on child - should now work (merge to epic branch)\n6. Outside drilldown, Space+m should still be blocked","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T11:58:47.620234+11:00","updated_at":"2025-12-30T12:15:11.275399+11:00","closed_at":"2025-12-30T12:15:11.275399+11:00","close_reason":"Allow Space+m in origin mode when in epic drilldown (merging child‚Üíepic doesn't require PR)"}
{"id":"az-ph1","title":"Add agent phase detection and display","description":"Detect and display Claude agent phases (Planning/Action/Verification) on TaskCards. Parse Claude output patterns to identify current phase and show visual indicator.\n\nInspiration: AutoMaker shows phase status on cards with Planning ‚Üí Action ‚Üí Verification workflow.\n\nImplementation:\n1. Extend StateDetector to detect phase transitions from output patterns\n2. Add phase field to session state (idle/planning/implementing/testing/done)\n3. Display phase badge/indicator on TaskCard when session is active\n4. Update phase in real-time as output is parsed","notes":"Explored codebase. Key files:\n- StateDetector.ts: Pattern-based detection, returns SessionState (idle/busy/waiting/done/error)\n- types.ts: SessionState, SessionMetrics, TaskWithSession, SESSION_INDICATORS\n- TaskCard.tsx: Shows indicator from SESSION_INDICATORS, has header line with id/type/indicator\n- DetailPanel.tsx: Shows session metrics when active\n\nImplementation plan:\n1. Add AgentPhase type and PHASE_INDICATORS to types.ts\n2. Add agentPhase field to SessionMetrics interface\n3. Extend StateDetector with phase detection patterns\n4. Update TaskCard to show phase indicator\n5. Update DetailPanel to show phase in metrics section","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T12:00:00Z","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:22:20.767385+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-phut","title":"az loses track of dev servers if i manually restart them in the tmux window (ctrl c -\u003e startup command)","design":"## Problem\nWhen user manually restarts dev server (Ctrl+C ‚Üí startup command), Azedarach loses track because:\n1. Health check only monitors pane existence, not process state\n2. Port detection only runs at initial startup\n3. No mechanism to detect 'process died' or 'new process started'\n\n## Solution: Port-Based Lifecycle Monitoring\nFor dev servers, the port IS the source of truth. Enhance health check to verify port is responding.\n\n## Implementation\n1. Add `checkPortOpen(port: number)` utility - TCP connect check with timeout\n2. Enhance health check fiber (DevServerService.ts:295-322) to:\n   - Verify port is responding (not just pane exists)\n   - If pane exists but port dead ‚Üí status = 'stopped'\n   - If port comes back on stopped server ‚Üí re-sync metadata, status = 'running'\n3. Update `startedAt` timestamp when server restarts\n\n## Key Files\n- src/services/DevServerService.ts - Main changes (health check enhancement)\n\n## Behavior\n- Server dies (Ctrl+C): Port check fails ‚Üí status becomes 'stopped'\n- Server restarts: Port check succeeds ‚Üí re-detect port, update startedAt, status = 'running'\n- Seamless - no user intervention needed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:29:24.885249+11:00","updated_at":"2025-12-29T15:05:16.48382+11:00","closed_at":"2025-12-29T15:05:16.483823+11:00"}
{"id":"az-pn6","title":"StatusBar component","description":"Bottom status bar showing available actions and system status.","design":"- Fixed position at bottom\n- Show available keybindings for current context\n- Show connection status, sync status\n- Show count of running sessions\n- Responsive to terminal width","notes":"Enhanced StatusBar component with:\n1. Connection/sync status indicator (‚óè connected, ‚óã disconnected) using theme colors\n2. Responsive terminal width handling - hides keybinds \u003c100 cols, mode display \u003c80 cols, selected count \u003c60 cols\n3. Project name 'azedarach' displayed on left with bold styling\n4. Improved visual hierarchy using Catppuccin theme colors (green for connected, overlay0 for disconnected)\n5. Added optional 'connected' prop to StatusBarProps (defaults to true)\n6. Type-safe implementation - pnpm type-check passes with no errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:07.987695+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T01:29:02.416939+11:00","dependencies":[{"issue_id":"az-pn6","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.038999+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-pnx","title":"Configuration system with @effect/schema and Effect Config","description":"User configuration loading and validation.","design":"- Use Effect's built-in Config module for configuration\n- Use @effect/schema for config file validation (replaces zod)\n- Define ConfigSchema with Schema.Struct for type-safe config\n- Config sections: terminal, worktree, session, completion, notifications, patterns\n- Support multiple sources via Config.withDefault and Config.nested:\n  - Environment variables (AZEDARACH_*)\n  - Config files (.azedarach.json, .azedarachrc)\n  - package.json \"azedarach\" key\n- Create ConfigLive layer that loads and validates config\n- Sensible defaults for all options via Schema.withDefault","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.673276+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T17:24:13.126088+11:00","dependencies":[{"issue_id":"az-pnx","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.015922+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ppx6","title":"Fix manual layout - calculate mainViewHeight properly","description":"BUG: Current manual layout in model.go using lipgloss.JoinVertical is not working. Only shows 1 bead per column and no status bar. Root cause: Line 786 sets mainViewHeight := m.height - 1 but this height calculation may be wrong or not being used properly. Need to: 1) Verify mainViewHeight calculation is correct 2) Check if renderBoardView respects height parameter 3) Test status bar renders at correct height 4) Fix layout to properly distribute height between main content and status bar. File to fix: internal/app/model.go around lines 786-809.","status":"open","priority":0,"issue_type":"bug","created_at":"2026-01-05T01:26:44.609233+11:00","updated_at":"2026-01-05T01:26:49.54212+11:00"}
{"id":"az-pvik","title":"Migrate overlay rendering to bubbletea-overlay library","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T00:44:30.068035+11:00","updated_at":"2026-01-05T00:46:15.581643+11:00","closed_at":"2026-01-05T00:46:15.581643+11:00","close_reason":"Migrated overlay rendering to use bubbletea-overlay library. Replaced manual lipgloss.Place + layer() compositing with overlaylib.Composite(). Tests pass."}
{"id":"az-pza","title":"TUI \u0026 Interaction","description":"Ink-based terminal UI: Kanban board, keyboard navigation, session attachment, and user interaction flows.","notes":"Session 2025-12-12:\n\nEPIC PROGRESS: 6/7 tasks completed (86%)\n\nCOMPLETED CHILDREN:\n- az-hri: Basic Kanban board ‚úÖ\n- az-mq9: effect-atom SolidJS adapter ‚úÖ\n- az-t4t: Keyboard navigation (Helix-style) ‚úÖ\n- az-pn6: StatusBar component ‚úÖ\n- az-g19: Terminal attachment (external) ‚úÖ\n- az-srh: Detail view panel ‚úÖ\n\nREMAINING:\n- az-stv: Task actions (start/attach/pause/resume) - NOW UNBLOCKED\n  - Depends on SessionManager (az-xi5) which is now complete\n  - This is the final task to wire session lifecycle to TUI\n\nPHASE 2 STATUS:\nTUI is fully functional with all navigation, selection, task movement, and viewing features. Only session lifecycle integration remains.\n\nNEXT SESSION:\n- Complete az-stv to close this epic\n- Wire SessionManager.start/stop/pause/resume to keyboard actions\n- Add visual feedback for session states in TaskCard","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.871997+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:54:04.23523+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"az-q5c","title":"Test bead for output check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:23:49.203815+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T01:24:28.486686+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-qbgj","title":"Add projectPath to MutationQueue for correct targeting","description":"Fix MutationQueue so all mutations execute against the project they were submitted from.\n\n**Changes needed:**\n\n1. **Extend Mutation types** (MutationQueue.ts:24-41)\n```typescript\nexport type Mutation =\n  | {\n      _tag: \"Move\"\n      id: string\n      status: ColumnStatus\n      projectPath: string  // ‚Üê ADD\n      rollback: Effect\u003cvoid\u003e\n    }\n  | {\n      _tag: \"Delete\"\n      id: string\n      projectPath: string  // ‚Üê ADD\n      rollback: Effect\u003cvoid\u003e\n    }\n  | {\n      _tag: \"Update\"\n      id: string\n      fields: BeadUpdateFields\n      projectPath: string  // ‚Üê ADD\n      rollback: Effect\u003cvoid\u003e\n    }\n```\n\n2. **Update executeMutation** (MutationQueue.ts:77-98)\n```typescript\nconst executeMutation = (mutation: Mutation) =\u003e {\n  switch (mutation._tag) {\n    case \"Move\":\n      return beadsClient.update(\n        mutation.id, \n        { status: mutation.status },\n        mutation.projectPath  // ‚Üê Pass explicitly\n      )\n    case \"Delete\":\n      return beadsClient.delete(mutation.id, mutation.projectPath)\n    case \"Update\":\n      return beadsClient.update(\n        mutation.id, \n        mutation.fields,\n        mutation.projectPath\n      )\n  }\n}\n```\n\n3. **Update all mutation creation sites** (TaskHandlersService, etc.)\n   - Capture projectPath at mutation creation time\n   - Pass it to the mutation object\n\n**Testing:**\n- Move a task while on Project A\n- Switch to Project B before mutation processes\n- Verify task moved in Project A, not B","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T22:06:56.645171+11:00","updated_at":"2026-01-01T22:19:56.564462+11:00","dependencies":[{"issue_id":"az-qbgj","depends_on_id":"az-67fc","type":"parent-child","created_at":"2026-01-01T22:07:11.124752+11:00","created_by":"daemon"},{"issue_id":"az-qbgj","depends_on_id":"az-mqpe","type":"blocks","created_at":"2026-01-01T22:07:22.756297+11:00","created_by":"daemon"}]}
{"id":"az-qkrz","title":"we should have a status/icon for when initCommands are going (pre aiTool)","description":"currently we just see the blue dot but it doesnt make sense to show that till aiTool is going","design":"1. Add 'initializing' state to SessionState in src/ui/types.ts, src/core/StateDetector.ts, and SessionStateSchema in src/core/ClaudeSessionManager.ts.\n2. Add 'initializing: \"‚ö™\"' to SESSION_INDICATORS in src/ui/types.ts.\n3. Change initial session state in ClaudeSessionManager.start from 'busy' to 'initializing'.\n4. Rely on authoritative 'az notify' hooks (TmuxSessionMonitor) to transition from 'initializing' to 'busy' or 'waiting'.\n5. Modify PTYMonitor.ts to avoid generic 'busy' signals transitioning out of 'initializing' state prematurely, while still allowing transitions to 'error' or 'done'.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:53:19.249383+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T13:46:42.199815+11:00","close_reason":"Activated TmuxSessionMonitor hook integration and fixed initializing-to-busy transition. Added robust patterns for Claude prompt detection.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-qmg","title":"instead of using an extra line to underline column headers just use underlined ascii characters maybe?","notes":"Starting work - will use text underline attribute instead of separate line","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T12:57:11.332088+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T00:44:19.692037+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-qmo","title":"Add stop session action (Space+x)","description":"No way to stop/kill a running session from the TUI. Need Space+x to kill tmux session and mark task as idle.","design":"- Add stopSessionAtom using runtime.fn calling SessionManager.stop\n- Wire Space+x in action mode to call stopSession(task.id)\n- Confirm before stopping? Or just stop immediately\n- Show success toast 'Stopped session for {id}'\n- Refresh tasks after stop","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:42:23.169998+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T11:43:10.52549+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-qn60","title":"something in opencode is trying to use claude code instead of our configured gemini flash model","design":"1. Update src/config/defaults.ts to remove hardcoded Anthropic models. 2. Refactor SessionHandlersService.ts and task.ts to use modelConfig.default or toolModelConfig.default as fallback before 'haiku'. 3. Update opencode.json and .opencode/oh-my-opencode.json to use github-copilot/gemini-2.0-flash-exp.","notes":"üìé [mjgicw7u-3njc.png](.beads/images/az-qn60/mjgicw7u-3njc.png) (clipboard, 12/22/2025, 12:59:28 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:59:26.522251+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-22T13:07:54.724908+11:00","close_reason":"Removed hardcoded Anthropic/Haiku fallbacks and updated configurations to respect Gemini model.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-r0z1","title":"backgroundTasks are not being run upon session readyness","description":"when any session's initCommands are done we should be running backgroundTasks in a new window in that session","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T19:07:52.208129+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-24T01:08:34.706143+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-r883","title":"we just rewrote our app in go but it has bugs","description":"in folder go-bubbletea\ncurrently it shows the board view but error logs are showing up IN the main view and pushing the ui up\nthe error im seeing currently is failed to parse json (no beads showing up)","design":"## Bug Analysis\n\n### Bug 1: Wrong CLI flag for JSON output\n**Location:** `go-bubbletea/internal/services/beads/client.go`\n**Problem:** Code uses `--format=json` but `bd` CLI uses `--json` as a global flag\n**Fix:** Change all occurrences of `\"--format=json\"` to `\"--json\"`\n\n### Bug 2: JSON field name mismatch  \n**Location:** `go-bubbletea/internal/domain/task.go`\n**Problem:** Struct uses `json:\"type\"` but `bd` outputs `issue_type`\n**Fix:** Change `json:\"type\"` to `json:\"issue_type\"`\n\n### Files to modify:\n1. `internal/services/beads/client.go` - Fix `--format=json` ‚Üí `--json` (3 occurrences: List, Search, Ready)\n2. `internal/domain/task.go` - Fix `json:\"type\"` ‚Üí `json:\"issue_type\"`\n\n### Root cause of UI issue:\nThe error toast \"beads list: failed to parse JSON\" is displayed correctly in the toast area (bottom-right), but since no beads load, the board appears empty. This is working as designed - once JSON parsing works, beads will appear.","notes":"## Session Progress (2026-01-04)\n\n### Commits Made:\n1. `f475864` - wip: Fix beads JSON parsing and add viewport scrolling\n2. `802e196` - fix: Card cursor color and status color mapping\n\n### Fixed This Session:\n- ‚úÖ JSON field: `type` ‚Üí `issue_type` (matches bd output)\n- ‚úÖ Status value: `done` ‚Üí `closed` (matches bd output)\n- ‚úÖ CLI flag: `--format=json` ‚Üí `--json` (3 occurrences)\n- ‚úÖ CardActive border: Blue ‚Üí Lavender\n- ‚úÖ StatusColors map: \"done\" ‚Üí \"closed\"\n- ‚úÖ Viewport scrolling with indicators (‚ÜëN more / ‚ÜìN more)\n- ‚úÖ Task counts in column headers (e.g., \"Open (47)\")\n\n### Lost in Computer Restart (2025-12-31):\nThe \"row joining bug fix\" described in previous notes was never committed. However, the current lipgloss-based implementation (`Width(w).Height(h).Render()`) handles empty columns correctly - that bug was for a different (manual row-building) approach that was never implemented.\n\n### Outstanding Test Failures (Pre-existing):\n- `board_test.go` - Snapshot tests need updating for new layout (no column borders, new header format)\n- `jump_test.go` - Pre-existing label generation failures\n- `projects_test.go` - macOS `/private/var` vs `/var` symlink edge case\n\n### Next Steps:\n1. Test app in real terminal to verify beads load\n2. Update board_test.go snapshots to match new layout\n3. Investigate jump_test.go failures (may be from uncommitted jump.go changes)\n4. Visual testing of cursor colors, scroll indicators","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T09:21:07.260841+11:00","updated_at":"2026-01-04T12:53:21.586398+11:00","closed_at":"2026-01-04T12:53:21.586401+11:00"}
{"id":"az-r9u","title":"looks like there is hidden bead that doesnt quite fit in the screen","description":"our screen size calc must be off","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:26:58.321424+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T21:36:22.5216+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-re74","title":"we need to copy .direnv not just when creating sessions for claude but also for diffing etc","design":"...","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:34.817831+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T14:13:45.741314+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-rg9b","title":"add keybind to refresh git stats (lines changed) on all beads","design":"## Implementation Plan\n\nAdd keybind `r` in normal mode to manually refresh git stats (lines changed) for all beads with active sessions.\n\n### Components to Modify:\n\n1. **BoardService** (`src/services/BoardService.ts`)\n   - Add `isRefreshingGitStats: SubscriptionRef\u003cboolean\u003e` for loading state\n   - Add `refreshGitStats()` method that:\n     - Sets loading state to true\n     - Re-fetches git stats for all tasks with active sessions\n     - Respects `git.showLineChanges` config setting\n     - Updates task state with new git stats\n     - Sets loading state to false\n\n2. **Board Atoms** (`src/ui/atoms/board.ts`)\n   - Add `isRefreshingGitStatsAtom` to expose loading state\n   - Add `refreshGitStatsAtom` action to trigger refresh\n\n3. **Keybindings** (`src/services/keyboard/bindings.ts`)\n   - Add `r` in normal mode: \"Refresh git stats\"\n   - Calls `refreshGitStatsAtom` action\n\n4. **StatusBar** (`src/ui/StatusBar.tsx`)\n   - Show loading indicator when `isRefreshingGitStatsAtom` is true\n   - Display something like \"Refreshing git stats...\" in status area\n\n5. **Documentation** (`docs/keybindings.md`)\n   - Add `r` to normal mode keybindings table\n\n### Behavior:\n- Only refreshes stats for beads with active sessions (need worktree path)\n- Respects `git.showLineChanges` config (no-op if disabled)\n- Shows brief loading indicator in status bar during refresh\n- Debounce not needed since this is manual trigger","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:23:48.675998+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-24T02:46:52.750419+11:00","close_reason":"Implemented keybind 'r' in normal mode to refresh git stats for all beads with active sessions. Changes: BoardService.refreshGitStats(), isRefreshingGitStatsAtom, StatusBar indicator, keybindings.md documentation.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-riua","title":"i just tried to create a bead in non default project but it got created in az project (default)","notes":"FIX ACTUALLY IMPLEMENTED NOW:\n\nRoot cause: BeadsClient methods used cwd parameter directly. When not provided, bd ran in process.cwd() (where az was launched) instead of the currently selected project.\n\nFix applied:\n1. Added ProjectService as dependency to BeadsClient\n2. Created getEffectiveCwd() helper that returns explicit cwd OR current project path from ProjectService  \n3. Updated ALL BeadsClient methods (list, show, update, close, sync, syncImportOnly, recoverTombstones, ready, search, create, delete) to use getEffectiveCwd()\n\nNow when you switch projects in the TUI, bd commands execute in the correct project directory.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T14:34:45.119326+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:24:50.29642+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-rk6i","title":"something went wrong with space r dev server in ~/prog/Chefy","description":"When using Space+r to start a dev server in a worktree, the NX project fails with \"Failed to process project graph\" because node_modules doesn't exist in the worktree.\n\n**Root Cause:** Git worktrees share `.git` but NOT `node_modules/`. Each worktree needs its own `pnpm install` before the dev server can run.\n\n**Evidence:** User manually ran `pnpm i \u0026\u0026 pnpm dev` in the tmux session and it worked fine.","design":"## Implementation Plan\n\n### Solution: Auto-install dependencies before starting dev server\n\nIn `DevServerService.ts`, before running the dev command:\n\n1. **Check if node_modules exists** in the worktree\n2. **If missing, run package manager install** (`pnpm install`, `npm install`, etc.)\n3. **Show progress** via toast notification (\"Installing dependencies...\")\n4. **Then proceed** with the normal dev server startup\n\n### Code Changes\n\n**File:** `src/services/DevServerService.ts`\n\nAdd a new helper function:\n```typescript\nconst ensureDependencies = (worktreePath: string): Effect.Effect\u003cvoid, DevServerError, CommandExecutor.CommandExecutor\u003e =\u003e\n  Effect.gen(function* () {\n    const nodeModulesPath = pathService.join(worktreePath, \"node_modules\")\n    const exists = yield* fs.exists(nodeModulesPath).pipe(Effect.catchAll(() =\u003e Effect.succeed(false)))\n    \n    if (!exists) {\n      yield* Effect.log(`node_modules not found in ${worktreePath}, installing dependencies...`)\n      const pm = yield* detectPackageManager(worktreePath)\n      const installCmd = pm === \"bun\" ? \"bun install\" : `${pm} install`\n      \n      // Run install in the worktree directory\n      yield* runInstallCommand(worktreePath, installCmd)\n    }\n  })\n```\n\nCall `ensureDependencies(worktreePath)` in both `start()` and `toggle()` methods, right after verifying the worktree exists.\n\n### Alternative Considered\n\nCould add a separate \"install dependencies\" action (Space+i), but auto-install is better UX - users expect Space+r to \"just work\".","acceptance_criteria":"- [ ] Space+r on a fresh worktree automatically runs `pnpm install` (or npm/yarn/bun) first\n- [ ] Toast shows \"Installing dependencies...\" while install runs\n- [ ] After install completes, dev server starts normally\n- [ ] If install fails, show error toast with details\n- [ ] Works with all package managers (pnpm, npm, yarn, bun)","notes":"## Implementation Complete ‚úÖ\n\n### Root Cause\nWhen using Space+r to start a dev server in an 11-hour-old worktree, dependencies had drifted since session creation. The initCommands (including `pnpm install`) only ran at session start (Space+s), not when the dev server started (Space+r).\n\n### Solution\nDevServerService now runs initCommands before starting the dev server, ensuring dependencies are synced even if they changed since session creation.\n\n### Changes Made\n1. **Created `src/core/initCommands.ts`** - Reusable helper for running worktree init commands\n2. **Updated `DevServerService.start()` and `toggle()`** - Now run initCommands before starting dev server\n3. **Created `src/core/WorktreeSessionService.ts`** - Generic tmux session service for future use\n4. **Renamed `SessionManager` ‚Üí `ClaudeSessionManager`** - Clearer name for Claude-specific session management\n5. **Fixed error handling in keyboard bindings** - Dev server errors now show toast instead of propagating\n\n### Testing\n- ‚úÖ Type-check passes\n- ‚úÖ Build passes\n\n### Future Improvement\nClaudeSessionManager and DevServerService could be refactored to use WorktreeSessionService to reduce code duplication.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T00:25:00.079304+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-20T03:19:19.344942+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-rmz1","title":"goto word (gw) not going to the right task","description":"i pressed ak and it didnt go to ak","design":"## Root Cause\n\nThe `computeJumpLabels()` function in `InputHandlersService.ts` uses `board.getTasksByColumn()` which returns:\n- **Unsorted** tasks (ignores sortConfig)\n- **Unfiltered** tasks (ignores search query)\n- **Record\u003cstring, Task[]\u003e** keyed by status string\n\nBut the UI renders using `filteredTasksByColumn` (via `drillDownFilteredTasksAtom`) which:\n- Applies search filtering\n- Applies sorting\n- Applies drill-down epic filtering\n- Returns `TaskWithSession[][]` indexed by column position\n\nThis mismatch means the label `ak` might be assigned to task X in `computeJumpLabels`, but task Y is visually in that position in the rendered board.\n\n## Implementation Plan\n\n1. **Modify `computeJumpLabels()` in `InputHandlersService.ts`**:\n   - Get search query and sortConfig from EditorService\n   - Use `board.getFilteredTasksByColumn(searchQuery, sortConfig)` instead of `board.getTasksByColumn()`\n   - Apply drill-down filtering (check NavigationService for drillDownChildIds)\n   - Iterate the array directly by index (no longer keyed by status string)\n\n2. **Code changes**:\n   - Change `tasksByColumn[col.status]` to `tasksByColumn[colIdx]`\n   - Add EditorService and NavigationService dependency usage\n   - Add drill-down child filtering to match what UI renders\n\n## Files to Modify\n\n- `src/services/keyboard/InputHandlersService.ts` (computeJumpLabels function, lines 580-611)","notes":"üìé [mjbktzs7-qh5v.png](.beads/images/az-rmz1/mjbktzs7-qh5v.png) (clipboard, 12/19/2025, 2:09:54 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T02:09:11.966491+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:31:32.356707+11:00","close_reason":"Fixed computeJumpLabels to use filtered/sorted tasks matching what the board displays. The bug was that it used getTasksByColumn() (unsorted, unfiltered Record) instead of getFilteredTasksByColumn() with drill-down filtering applied.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-rtma","title":"when init and bg tasks are done, kill their tmux windows","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:50:11.634188+11:00","updated_at":"2026-01-05T12:08:10.884822+11:00","closed_at":"2026-01-05T12:08:10.884825+11:00","close_reason":"Updated WorktreeSessionService.ts to set remain-on-exit off for background task windows, ensuring they close upon task completion. Added setWindowOption to TmuxService.ts to support this."}
{"id":"az-s1n","title":"add a pre tool use hook to prevent type casting like we have in ~/prog/Chefy","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:45:55.42323+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:08:36.020343+11:00","close_reason":"Added pre-edit-type-safety.cjs hook that blocks Edit/Write operations containing type casting anti-patterns (as Type, as any, : any). Hook is registered in settings.json under PreToolUse.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-se6w","title":"tui_core: Layout engine - flexbox-style positioning algorithm","description":"Implement the layout algorithm that positions Renderables in the terminal.\n\n## Why Separate\nThis is the most complex part of the rendering pipeline. Keeping it separate from Renderable types allows focused testing and iteration.\n\n## Algorithm (simplified flexbox)\n```\n1. Measure phase (intrinsic sizes)\n   - Text: display_width of content\n   - Box with Auto: sum/max of children based on flex_direction\n   - Box with Px/Pct/Fill: use specified size\n\n2. Layout phase (position children)\n   - Calculate available space (parent size - padding - border)\n   - Distribute space to Fill children\n   - Apply justify_content for main axis alignment\n   - Apply align_items for cross axis alignment\n   - Recurse into children\n\n3. Render phase (draw to FrameBuffer)\n   - Draw background\n   - Draw border if present\n   - Draw text content\n   - Recurse into children with offset\n```\n\n## API (Gleam)\n```gleam\ntype LayoutNode {\n  LayoutNode(\n    renderable: Renderable,\n    x: Int, y: Int,           // Computed position\n    width: Int, height: Int,  // Computed size\n    children: List(LayoutNode),\n  )\n}\n\n/// Compute layout for a renderable tree\nfn layout(root: Renderable, available_width: Int, available_height: Int) -\u003e LayoutNode\n\n/// Render a laid-out tree to a FrameBuffer\nfn render_tree(node: LayoutNode, fb: FrameBuffer) -\u003e FrameBuffer\n```\n\n## Overflow Handling\nFor MVP, use **clipping** (simplest):\n- Content outside bounds is not rendered\n- No scroll state needed\n\nFuture consideration (post-MVP):\n- Scroll containers with scroll offset state\n- Scrollbar rendering\n\n```gleam\ntype Overflow { Clip | Scroll | Visible }\n```\n\n## Edge Cases\n- Overflow handling (clip vs scroll) - MVP: clip only\n- Min/max size constraints\n- Percentage of percentage calculations\n- Zero-size containers\n\n## Acceptance Criteria\n- [ ] Row layout distributes width correctly\n- [ ] Column layout distributes height correctly\n- [ ] Fill sizing expands to available space\n- [ ] Percentage sizing works\n- [ ] Nested layouts compute correctly\n- [ ] Padding and margin applied correctly\n- [ ] **Content clipping works (overflow hidden)**\n- [ ] Text truncation with ellipsis when needed","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:32:19.745554+11:00","updated_at":"2025-12-28T11:44:02.435765+11:00","labels":["gleam","layout","tui-core"],"dependencies":[{"issue_id":"az-se6w","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.339421+11:00","created_by":"daemon"},{"issue_id":"az-se6w","depends_on_id":"az-ud48","type":"blocks","created_at":"2025-12-28T11:33:58.426226+11:00","created_by":"daemon"}]}
{"id":"az-sfxp","title":"dont show epic children in main board by default","description":"also their base branch for git diff and lines changed in header of task card should be epic branch not the one in config","design":"## Problem Analysis\n\n### Issue 1: Epic children filter not working\n- `bd list --json` returns `dependency_count` but NOT the `dependencies` array\n- `isEpicChild()` in BoardService checks `task.dependencies.some(...)` which is always empty from list\n- Result: Filter never triggers because dependencies data is missing\n\n### Issue 2: Git diff uses wrong base branch\n- `BoardService.loadTasks()` uses `gitConfig.baseBranch` (e.g., \"main\") for ALL tasks\n- Epic children should use their parent epic's branch as base for accurate +N/-N line counts\n- Without this, child task line counts include all epic work, not just their own\n\n## Implementation Plan\n\n### Step 1: Enrich tasks with parent epic info during loadTasks()\n\nIn `BoardService.loadTasks()`:\n1. After getting issues from `beadsClient.list()`, identify tasks with `dependency_count \u003e 0`\n2. For those tasks, call `beadsClient.getParentEpic(id)` to get parent epic (if any)\n3. Add `parentEpicId?: string` field to `TaskWithSession` type\n4. Use concurrency: 4 for the getParentEpic calls (same as git status)\n\n### Step 2: Fix isEpicChild() filter\n\nUpdate `isEpicChild()` to check `task.parentEpicId` instead of iterating dependencies:\n```typescript\nconst isEpicChild = (task: TaskWithSession): boolean =\u003e {\n    return task.parentEpicId !== undefined\n}\n```\n\n### Step 3: Use epic branch for child git status\n\nIn `loadTasks()` git status calculation:\n1. For tasks with `parentEpicId`, use the epic's branch name as base for:\n   - `gitBehindCount` calculation (`git rev-list HEAD..${epicBranch}`)\n   - `gitAdditions`/`gitDeletions` calculation (`git diff --numstat ${epicBranch}...HEAD`)\n2. For non-epic-children, continue using `gitConfig.baseBranch`\n\n### Step 4: Create epic branch on child session start (side effect)\n\nIn session start logic (likely ClaudeSessionManager or WorktreeManager):\n1. When starting a session for an epic child\n2. Check if parent epic's branch exists\n3. If not, create the epic branch from main before creating child's worktree\n\n## Files to Modify\n\n1. `src/ui/types.ts` - Add `parentEpicId?: string` to `TaskWithSession`\n2. `src/services/BoardService.ts`:\n   - Update `loadTasks()` to enrich with `parentEpicId`\n   - Update `isEpicChild()` to use `parentEpicId`\n   - Update git status calculation to use per-task base branch\n3. `src/core/ClaudeSessionManager.ts` or `src/core/WorktreeManager.ts`:\n   - Ensure epic branch exists before child session starts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T11:09:27.040369+11:00","updated_at":"2025-12-30T12:05:16.112421+11:00","closed_at":"2025-12-30T12:05:16.112421+11:00","close_reason":"Implemented: parentEpicId field on TaskWithSession, fixed isEpicChild() filter, per-task base branch for git diff. Epic branch creation was already implemented in ClaudeSessionManager."}
{"id":"az-shf","title":"when a bead action is occurring such as space S, disable further actions from being taken on that bead until its idle again","notes":"Starting implementation. Strategy:\n1. Create taskQueueInfoAtom for reactive queue state\n2. Add isBusy check to ActionPalette isAvailable()\n3. Add busy guard to handlers that use withQueue\n4. Show running operation label in toast when blocked","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:04:50.355647+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:30:22.984791+11:00","close_reason":"Implemented bead action busy guard:\n\n1. Added `checkBusy()` helper to HandlerContext - checks if task has running operation, shows toast if busy\n2. Applied guard to all queued handlers: startSession, startSessionWithPrompt, stopSession, createPR, mergeToMain, cleanup\n3. ActionPalette now dims queued actions when busy and shows \"‚è≥ {operation}...\" indicator\n4. Created focusedTaskRunningOperationAtom for reactive UI updates\n\nUsers now see clear feedback when actions are blocked and cannot trigger duplicate operations on the same bead.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-shv","title":"Error toast notifications in TUI","description":"Show dismissible error toasts when actions fail (e.g., attach to non-existent session, start on non-idle task). Currently errors only go to console.error which users don't see.","design":"- Toast component: fixed position, auto-dismiss after 5s or on keypress\n- Error state atom: Array\u003c{id, message, timestamp}\u003e\n- Show in StatusBar area or floating overlay\n- Red background with error icon\n- Queue multiple errors, show oldest first","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T10:59:23.087691+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T11:07:55.898746+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-srh","title":"Detail view for selected task","description":"Expandable detail panel showing full task information.","design":"- Toggle with Enter or Tab on selected task\n- Show: title, description, design notes, acceptance criteria\n- Show: dependencies, PR link if exists\n- Show: recent session output (last N lines)\n- Show: available actions for current state","notes":"Implementation complete. Created DetailPanel.tsx component that shows full task details in a modal overlay. Added Enter key handler in normal mode to toggle the detail view. Updated HelpOverlay to document the Enter key. Component displays: task ID, type, priority, status, session state, description, design notes, notes, timestamps, and available actions based on task state. Follows same overlay pattern as HelpOverlay with semi-transparent background and centered box using Catppuccin theme colors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:08.103114+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:32:33.95362+11:00","dependencies":[{"issue_id":"az-srh","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.178011+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ssm","title":"i tried az in Chefy and for some reason the cursor got lost after i sorted by updated","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:49:22.39364+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T14:06:56.110719+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-stv","title":"Task actions: start, attach, pause, resume","description":"Implement keyboard shortcuts for task lifecycle actions.","design":"- Enter: start task (create worktree, spawn Claude)\n- a: attach to running session (opens external terminal)\n- A: attach inline (TUI shows session output)\n- p: pause session (interrupt, WIP commit)\n- r: resume paused session\n- Validate action is valid for current task state","notes":"Session 2025-12-12:\n\nNOW UNBLOCKED - All dependencies completed:\n- az-xi5 (SessionManager): ‚úÖ Closed - full orchestration service\n- az-t4t (Keyboard navigation): ‚úÖ Closed - Helix-style modal keybindings\n\nIMPLEMENTATION PLAN:\n1. Wire SessionManager to Action mode commands:\n   - Space+s: SessionManager.start() - create worktree + spawn Claude\n   - Space+a: Already done (AttachmentService.attachExternal)\n   - Space+p: SessionManager.pause() - Ctrl+C + WIP commit\n   - Space+r: SessionManager.resume() - reattach to paused session\n\n2. Update TaskCard to show live session state:\n   - Use SessionManager.subscribeToStateChanges() PubSub\n   - Update sessionState in TaskWithSession reactively\n   - Already have session indicators: üîµüü°‚úÖ‚ùå‚è∏Ô∏è\n\n3. Validate action availability:\n   - 's' only on idle tasks\n   - 'a' only on busy/waiting tasks\n   - 'p' only on busy tasks\n   - 'r' only on paused tasks\n\nDEPENDENCIES NOW MET:\n- SessionManager: src/core/SessionManager.ts\n- WorktreeManager: src/core/WorktreeManager.ts\n- TmuxService: src/core/TmuxService.ts\n- StateDetector: src/core/StateDetector.ts\n\nFILES TO MODIFY:\n- src/ui/App.tsx - Add action handlers for s/p/r\n- src/ui/atoms.ts - Add session lifecycle effects\n- src/ui/TaskCard.tsx - May need state subscription","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.880144+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:53:49.478801+11:00","dependencies":[{"issue_id":"az-stv","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.920801+11:00","created_by":"daemon"},{"issue_id":"az-stv","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.054522+11:00","created_by":"daemon"},{"issue_id":"az-stv","depends_on_id":"az-t4t","type":"blocks","created_at":"2025-12-11T14:46:28.161361+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-t14x","title":"epic drill down bug","description":"as soon as i pressed enter on an epic this error appeared","design":"## Root Cause (Verified via Source Code)\n\nThe issue was **nested `\u003ctext\u003e` elements**, caused by a misunderstanding of OpenTUI's component hierarchy.\n\n### OpenTUI Component Types:\n- `\u003ctext\u003e` ‚Üí `TextRenderable` (container component)\n- `\u003cspan\u003e` ‚Üí `SpanRenderable` ‚Üí `TextNodeRenderable` (inline text node)\n\n### Why Nested `\u003ctext\u003e` Fails:\n`TextRenderable.add()` only accepts: `TextNodeRenderable | StyledText | string`\n\nWhen you write `\u003ctext\u003e\u003ctext\u003e...\u003c/text\u003e\u003c/text\u003e`:\n- Inner `\u003ctext\u003e` creates a `TextRenderable`\n- Parent's `add()` rejects it (wrong type!)\n\n### Correct Patterns:\n\n**Option 1: Use `\u003cspan\u003e` for nested styling**\n```tsx\n\u003ctext fg={theme.gray}\u003e\n    \u003cspan fg={theme.blue}\u003e‚Üí\u003c/span\u003e Back\n\u003c/text\u003e\n```\n\n**Option 2: Use `\u003cbox flexDirection=\"row\"\u003e` with sibling `\u003ctext\u003e`**\n```tsx\n\u003cbox flexDirection=\"row\"\u003e\n    \u003ctext fg={theme.blue}\u003e‚Üí\u003c/text\u003e\n    \u003ctext fg={theme.gray}\u003e Back\u003c/text\u003e\n\u003c/box\u003e\n```\n\n## Fix Applied\nUsed Option 2 (`\u003cbox\u003e` with siblings) for both the back hint and progress sections.\n\n## Documentation\nAdded rule #10 to CLAUDE.md explaining OpenTUI text nesting constraints.\n\n## Files Changed\n- `src/ui/EpicHeader.tsx` - Flatten nested `\u003ctext\u003e` using `\u003cbox flexDirection=\"row\"\u003e`\n- `CLAUDE.md` - Added rule #10 documenting OpenTUI text nesting","notes":"üìé [mjbjp6e6-bkdv.png](.beads/images/az-t14x/mjbjp6e6-bkdv.png) (clipboard, 12/19/2025, 1:38:10 AM)\nüìé [mjbjxvwp-8ur6.png](.beads/images/az-t14x/mjbjxvwp-8ur6.png) (clipboard, 12/19/2025, 1:44:56 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:38:08.065373+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T02:23:16.769431+11:00","close_reason":"Merged to main: Fixed nested text element error in EpicHeader by using box layout with sibling text elements","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-t3qd","title":"this epic task is showing a small amount of changes incorrectly in task header","description":"but space f shows the full changes","design":"## Root Cause\n\nBoardService.ts line 395 uses three-dot git diff syntax (`baseBranch...HEAD`) for the task header stats, while DiffService.ts uses explicit merge-base approach for the Changed Files view.\n\n- **Three-dot** (`A...B`): Shows changes on B since merge-base, excluding A's unique changes\n- **Two-dot** with merge-base: Shows all changes from merge-base to HEAD\n\nThis causes the header to show fewer changes than the full file list.\n\n## Fix\n\nChange BoardService.ts to use the same merge-base approach as DiffService:\n\n1. First get merge-base: `git merge-base baseBranch HEAD`\n2. Then use that for numstat: `git diff --numstat mergeBase HEAD`\n\nThis ensures both views calculate changes the same way.\n\n## Files to Modify\n\n- `src/services/BoardService.ts` (lines ~388-396): Change diff command to use merge-base","notes":"üìé [mjrzux0u-sn88.png](.beads/images/az-t3qd/mjrzux0u-sn88.png) (clipboard, 12/30/2025, 1:54:51 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T13:54:44.888318+11:00","updated_at":"2025-12-30T14:01:41.369619+11:00","closed_at":"2025-12-30T14:01:41.369619+11:00","close_reason":"Fixed: BoardService now uses merge-base for git diff stats, consistent with DiffService"}
{"id":"az-t47j","title":"add a space [something] command to break up a task into an epic","description":"make the tasks parallizable as possible, etc","design":"## Implementation Plan: Space+b \"Break into Epic\" Command\n\n### Overview\nAdd a `Space+b` keybinding that converts a task into an epic and uses Claude AI to suggest parallelizable child tasks.\n\n### Architecture\n\n**Key Decision: Convert In-Place**\n- Original task becomes the epic (type changes from task ‚Üí epic)\n- Title and description are preserved\n- Uses Claude to analyze the task and suggest child tasks for parallelization\n\n**Flow:**\n1. User selects a task and presses `Space+b`\n2. Validate: task must not already be an epic\n3. Overlay shows loading state while Claude analyzes\n4. Claude suggests child tasks with titles and brief descriptions\n5. User confirms/edits suggestions\n6. On confirm:\n   - Update original task's type to \"epic\"\n   - Create each child task via BeadsClient.create()\n   - Link children to epic via addDependency(child, epic, \"parent-child\")\n   - Refresh board, enter drill-down view for the new epic\n\n### Components to Create/Modify\n\n1. **New Overlay Type** (`OverlayService.ts`)\n   - Add `breakIntoEpic` overlay variant with state for AI suggestions\n\n2. **New Overlay Component** (`src/ui/BreakIntoEpicOverlay.tsx`)\n   - Shows task title being converted\n   - Loading state while Claude analyzes\n   - Editable list of suggested child tasks\n   - Confirm/Cancel buttons\n\n3. **New Handler Service** (`src/services/keyboard/EpicHandlersService.ts`)\n   - `breakIntoEpic()` - orchestrates the conversion\n   - Uses Claude to analyze task and suggest subtasks\n\n4. **Claude Integration** (use existing patterns or create)\n   - Prompt Claude with task title + description\n   - Request: suggest parallelizable subtasks\n   - Parse response into structured task list\n\n5. **Keybinding** (`bindings.ts`)\n   - Add `{ key: \"b\", mode: \"action\", ... }` for break into epic\n\n6. **ActionPalette Update** (`ActionPalette.tsx`)\n   - Add \"b\" action line\n   - Only available when selected task is not an epic\n\n### Parallelization Notes\n- Claude suggestion + user confirmation happens in overlay (blocking interaction)\n- Child task creation can be parallelized with `Effect.all(tasks.map(...))`\n- Board refresh happens once after all children created\n\n### Testing\n- Verify only non-epic tasks show action available\n- Verify Claude suggestions are reasonable\n- Verify children are correctly linked to epic\n- Verify drill-down shows new children","notes":"## Implementation Complete - Refactored to Proper Architecture\n\n### Initial Implementation (commit 9279b92)\nIncorrectly put state management (useState, useEffect) in React component.\n\n### Refactored Implementation (commit 7a36327)\nFixed architecture violation by moving state and logic to Effect layer.\n\n### Architecture Changes\n\n**New Service: `BreakIntoEpicService`**\n- `overlayState: SubscriptionRef\u003cBreakIntoEpicState\u003e` - reactive state\n- `openOverlay(taskId, title, desc)` - sets loading state, fetches suggestions from Claude\n- `closeOverlay()` - resets to closed state\n- `selectNext()` / `selectPrevious()` - navigate suggestions list\n- `confirm()` - creates child tasks and links to parent\n\n**New Keyboard Handler: `handleBreakIntoEpicInput`**\nIn InputHandlersService, handles:\n- `j/k/down/up` - navigate suggestions\n- `Enter` - confirm and create tasks\n- `Escape` - cancel and close\n\n**Refactored Overlay Component**\nNow pure render only:\n```tsx\nconst state = useAtomValue(breakIntoEpicStateAtom)\n// Just JSX based on state\n```\n\n### Three-Layer Architecture\n1. **Effect Services** - BreakIntoEpicService holds state in SubscriptionRef\n2. **Atoms** - breakIntoEpicStateAtom exposes state via appRuntime.subscriptionRef()\n3. **React** - BreakIntoEpicOverlay uses only useAtomValue() and JSX\n\n### Files Modified\n- New: `src/core/BreakIntoEpicService.ts`\n- New: `src/ui/atoms/breakIntoEpic.ts`\n- Modified: `src/services/keyboard/InputHandlersService.ts`\n- Modified: `src/services/KeyboardService.ts`\n- Modified: `src/services/keyboard/bindings.ts`\n- Modified: `src/ui/BreakIntoEpicOverlay.tsx`\n- Modified: `src/ui/App.tsx`\n- Modified: `src/ui/atoms/runtime.ts`\n- Modified: `src/ui/atoms/index.ts`\n- Modified: `src/ui/atoms/task.ts` (removed old atoms)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T17:19:48.668591+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T01:49:50.778666+11:00","close_reason":"Implemented Space+b command that uses Claude AI to break a task into an epic with parallelizable child tasks. Build and type-check pass.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-t4t","title":"Keyboard navigation (vim-style)","description":"Implement vim-style keyboard navigation for the Kanban board.","design":"- Use OpenTUI's input handling (onKeyPress or similar)\n- SolidJS signals for tracking selection state:\n  - selectedColumn: Accessor\u003cnumber\u003e\n  - selectedTask: Accessor\u003cnumber\u003e\n- h/‚Üê, l/‚Üí: navigate columns (setSelectedColumn)\n- j/‚Üì, k/‚Üë: navigate tasks within column (setSelectedTask)\n- Visual highlight via conditional styling\n- Wrap navigation at boundaries (or stop)\n- Create useKeyboardNavigation hook for reusability","notes":"Session 2025-12-11 (evening):\n\nCOMPLETED:\n- Full Helix-style modal keybinding system implemented\n- Normal mode: hjkl navigation, g‚Üígoto, v‚Üíselect, Space‚Üíaction menu\n- Goto mode: gw shows 2-char jump labels (home row keys), gg/ge first/last, gh/gl column ends\n- Select mode: multi-selection via Space toggle, hjkl navigation\n- Action mode: h/l moves task(s) to adjacent column (updates status via bd CLI)\n- Ctrl-d/Ctrl-u half-page scrolling\n- Catppuccin Mocha theme colors\n- Virtual scrolling: columns show maxVisible tasks based on terminal height\n- StatusBar shows mode (NOR/SEL/GTO/ACT) with contextual keybind hints\n\nFILES MODIFIED:\n- src/ui/types.ts - Added EditorMode, GotoSubMode, JumpTarget types, generateJumpLabels()\n- src/ui/App.tsx - Full modal state machine, keyboard handling, terminal height calculation\n- src/ui/Board.tsx - Added activeTaskIndex, terminalHeight props\n- src/ui/Column.tsx - Virtual scrolling with scroll indicators\n- src/ui/TaskCard.tsx - Simplified to avoid OpenTUI fragment bugs\n- src/ui/StatusBar.tsx - Mode indicator + contextual keybinds per mode\n- src/ui/theme.ts - Catppuccin Mocha color palette\n- src/ui/atoms.ts - moveTaskEffect, moveTasksEffect for task movement\n- README.md - Comprehensive Helix-style keybinding documentation\n\nISSUES FIXED:\n- client.ready() only returned open/unblocked tasks - changed to client.list()\n- OpenTUI JSX fragments caused rendering corruption - use single text elements\n- Column overflow - implemented virtual scrolling\n\nREMAINING:\n- Some minor rendering artifacts in first column (title-only cards occasionally)\n- Action mode only implements h/l (move) - s/a/p/r/d/P not yet implemented\n\nNEXT STEPS:\n- Could close this bead - core vim-style navigation is complete\n- Action mode commands (start session, attach, etc.) belong in az-stv (Task actions)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.772639+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-11T23:49:35.046226+11:00","dependencies":[{"issue_id":"az-t4t","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.800764+11:00","created_by":"daemon"},{"issue_id":"az-t4t","depends_on_id":"az-hri","type":"blocks","created_at":"2025-12-11T14:46:26.269114+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-t6k3","title":"i want untracked and staged files to be accounted for in space f and git status on cards","description":"so when a claude session is working away but not yet done i can see the git lines added/removed on cards and see the changes come in via space f \nif this is not possible without losing something that we already have tell me and close the bead without and impl\nif it is possible without any tradeoffs, tell me how and show me your plan and ill approve it","notes":"üìé [mjgcspmg-09hu.png](.beads/images/az-t6k3/mjgcspmg-09hu.png) (clipboard, 12/22/2025, 10:23:48 AM)\nüìé [mjgcsxsi-qqzd.png](.beads/images/az-t6k3/mjgcsxsi-qqzd.png) (clipboard, 12/22/2025, 10:23:59 AM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:23:36.192775+11:00","updated_at":"2025-12-30T10:46:58.232284+11:00","closed_at":"2025-12-30T10:46:58.232286+11:00"}
{"id":"az-tfb3","title":"poll git pulls when git mode is remote","description":"When workflowMode is \"origin\", the behind-count calculation uses `origin/main` refs that can become stale. We need to periodically fetch from remote to keep these refs updated.","design":"## Implementation Plan\n\n### New Service: `GitService`\n\nCreate `src/services/GitService.ts` - a broader service for git operations that can be extended later.\n\n**Initial responsibilities:**\n1. Poll `git fetch origin \u003cbaseBranch\u003e` every 30 seconds\n2. Only active when `workflowMode === \"origin\"` AND `fetchEnabled === true`\n3. Run fetch from the main project directory (not per-worktree)\n\n**Architecture:**\n- Use `Effect.Service` with `scoped:` (needs long-running fiber)\n- Declare dependencies: `AppConfig.Default`, `OfflineService.Default`, `ToastService.Default`, `DiagnosticsService.Default`\n- State: `SubscriptionRef\u003cGitFetchState\u003e` tracking last fetch time, status\n- Background fiber: `Effect.scheduleForked(Schedule.spaced(\"30 seconds\"))`\n\n**Error handling:**\n- On network-related errors: Log silently, retry next interval (network status shown elsewhere)\n- On non-network errors (auth, permission): Show toast notification\n- Track in diagnostics for debugging\n\n**GitFetchState type:**\n```typescript\ntype GitFetchState = {\n  lastFetchAt: DateTime.Utc | null\n  lastError: string | null\n  consecutiveFailures: number\n}\n```\n\n### Integration\n\n1. Add `GitService.Default` to the app layer in `atoms.ts`\n2. Optionally expose `lastFetchAtom` for status bar display\n3. Register fiber with DiagnosticsService for visibility\n\n### Files to create/modify:\n- CREATE: `src/services/GitService.ts`\n- MODIFY: `src/ui/atoms.ts` (add to layer)\n\n### Future extensibility:\nThis service can later absorb:\n- Git stats calculation (currently in BoardService)\n- Push operations\n- Merge conflict detection","acceptance_criteria":"- [ ] GitService polls `git fetch origin main` every 30 seconds\n- [ ] Only polls when workflowMode=\"origin\" AND fetchEnabled=true\n- [ ] Silently handles network errors (retry next interval)\n- [ ] Shows toast for non-network errors (auth, permissions)\n- [ ] Fiber registered with DiagnosticsService\n- [ ] Service added to app layer","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:47:22.406609+11:00","updated_at":"2025-12-29T15:05:30.644054+11:00","closed_at":"2025-12-29T15:05:30.644057+11:00"}
{"id":"az-tgc","title":"Agent Mail configuration and environment","description":"Add configuration support for Agent Mail settings.\n\nDesign:\n- Environment variables:\n  - BEADS_AGENT_MAIL_URL (optional)\n  - BEADS_AGENT_NAME (defaults to hostname or generated)\n  - BEADS_PROJECT_ID (defaults to git remote or project path hash)\n- Config service using @effect/platform Config\n- Validation with @effect/schema\n- Auto-detect if Agent Mail server is available\n- CLI flag --agent-mail-url to override\n- Show Agent Mail status in TUI StatusBar","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.864792+11:00","updated_at":"2025-12-12T10:33:13.864792+11:00","dependencies":[{"issue_id":"az-tgc","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.905172+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-tgj","title":"Shift-D delete bead not working - reports \"no worktree to delete\"","description":"When pressing Space -\u003e Shift-D to delete a bead, the wrong action fires. The keyboard library reports event.name as lowercase even when shift is held, so case \"D\" never matches - it falls through to case \"d\" (cleanup worktree).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.746846+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-14T21:43:51.026071+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"az-to80","title":"add claude/opencode context mgmt features to az","description":"i want to be able to manage claude/opencode context such as memory files CLAUDE.md and AGENTS.md, skills, hooks, etc\nstart with memory files\nwe will need a new view or overlay for this","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T09:23:56.967207+11:00","updated_at":"2025-12-31T09:23:56.967207+11:00"}
{"id":"az-tsf","title":"sometimes i have to bd init when i create a worktree and attach to the session with az","description":"i assume its to do with the fact the new session has to wait for direnv (with flake) to setup the env. maybe we need to increase a timeout somewhere?","notes":"Root cause identified: tmux session uses `bash -c` which bypasses direnv shell hooks. Fix: wrap claude command with `direnv exec .` to explicitly load environment before starting Claude.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:01:38.873045+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T22:11:39.827838+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-twq1","title":"when i switch projects i expect the other project to continue working as if i hadn't","description":"e.g. state hooks updating session status etc","design":"## Problem\nWhen switching projects, UI state is cleared and the board reloads. Background sessions continue being monitored, but their state updates are lost because the UI was wiped.\n\n## Root Cause\n- UI state (tasks, navigation, filters) is stored in GLOBAL SubscriptionRefs\n- `switchProject()` calls `clearBoard()` which wipes everything\n- There's a save/restore dance via disk I/O that's fragile\n\n## Solution: Per-Project State Map\n\n**Core principle**: Project switch = just change `currentProjectPath`. All UI state lives in a `Map\u003cprojectPath, ProjectUIState\u003e`.\n\n### Architecture Change\n\n```\nBEFORE:\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ ProjectService  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ BoardService    ‚îÇ (global tasks)\n‚îÇ currentProject  ‚îÇ     ‚îÇ clearBoard()    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                              ‚Üì\n                        UI renders global state\n\nAFTER:\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ ProjectService  ‚îÇ     ‚îÇ ProjectUIStateManager      ‚îÇ\n‚îÇ currentProjectId‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Map\u003cprojectPath, UIState\u003e  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                              ‚Üì\n                        UI derives from currentId + map\n```\n\n### New: ProjectUIStateManager Service\n\nHolds all per-project state in memory:\n\n```typescript\ninterface ProjectUIState {\n  // Board\n  tasks: ReadonlyArray\u003cTaskWithSession\u003e\n  tasksByColumn: Record\u003cstring, ReadonlyArray\u003cTaskWithSession\u003e\u003e\n  isLoading: boolean\n  filteredTasksByColumn: TaskWithSession[][]\n\n  // Navigation\n  focusedTaskId: string | null\n  drillDownEpic: string | null\n  drillDownChildIds: ReadonlySet\u003cstring\u003e\n\n  // Editor\n  mode: EditorMode\n  sortConfig: SortConfig\n  filterConfig: FilterConfig\n\n  // View\n  viewMode: ViewMode\n}\n```\n\n### Changes to Existing Services\n\n1. **BoardService**\n   - Remove global `tasks`, `tasksByColumn`, `filteredTasksByColumn` SubscriptionRefs\n   - Add `getState(projectPath)` / `setState(projectPath, partial)` methods\n   - Session updates write to correct project based on `update.projectPath`\n\n2. **NavigationService**\n   - Remove global `focusedTaskId`, `drillDownEpic`, etc.\n   - Read/write via ProjectUIStateManager\n\n3. **EditorService**\n   - Remove global `mode`, `sortConfig`, `filterConfig`\n   - Read/write via ProjectUIStateManager\n\n4. **ProjectService**\n   - `switchProject()` just sets `currentProjectPath` - NO board reload\n   - Keep project registry (`projects: Array\u003cProject\u003e`) as-is\n\n### UI Atom Changes\n\n```typescript\n// Current (broken)\nexport const tasksAtom = appRuntime.subscriptionRef(\n  Effect.gen(function* () {\n    const board = yield* BoardService\n    return board.tasks  // Global!\n  })\n)\n\n// New (per-project)\nexport const tasksAtom = Atom.readable((get) =\u003e {\n  const projectPath = get(currentProjectPathAtom)\n  const stateMap = get(projectUIStateMapAtom)\n  return stateMap.get(projectPath)?.tasks ?? []\n})\n```\n\n### Session Updates (Already Works!)\n\nTmuxSessionMonitor already includes `projectPath`:\n```typescript\nhandler({\n  beadId: \"az-123\",\n  status: \"busy\",\n  projectPath: \"/Users/riordan/proj-a\",  // ‚Üê Already here!\n  ...\n})\n```\n\nJust need to use this to update the correct project's state.\n\n## Implementation Plan\n\n1. Create `ProjectUIStateManager` service with:\n   - `Ref\u003cMap\u003cstring, ProjectUIState\u003e\u003e` for in-memory state\n   - `getState(projectPath)` / `updateState(projectPath, fn)` methods\n   - Initialization from current project on startup\n\n2. Refactor `BoardService`:\n   - Remove global task SubscriptionRefs\n   - Use ProjectUIStateManager for storage\n   - Update session state handlers to use `projectPath`\n\n3. Refactor `NavigationService`:\n   - Remove global navigation SubscriptionRefs\n   - Use ProjectUIStateManager for storage\n\n4. Refactor `EditorService`:\n   - Remove global mode/filter SubscriptionRefs\n   - Use ProjectUIStateManager for storage\n\n5. Update UI atoms:\n   - Derive from `currentProjectPath` + state map\n   - Ensure reactive updates when either changes\n\n6. Simplify `switchProject`:\n   - Just `SubscriptionRef.set(currentProjectPath, newPath)`\n   - No board reload, no clearBoard(), no save/restore\n\n## Benefits\n\n- **Instant switching**: Just change a pointer, no I/O\n- **All projects stay hot**: Background monitoring works seamlessly\n- **Simpler code**: No save/restore dance\n- **Correct behavior**: Each project has isolated state","notes":"Starting implementation: Adding switchProject methods to services and simplifying switchProjectAtom","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T11:25:16.141883+11:00","updated_at":"2026-01-04T12:52:48.144128+11:00","closed_at":"2026-01-04T12:52:48.144134+11:00","close_reason":"Implemented per-project state architecture. UI state (mode, sort, filter, navigation, tasks) now stored in Map\u003cprojectPath, State\u003e per service. Project switching is now instant - just swaps which project's state is \"active\" without clearing the board."}
{"id":"az-tx5","title":"where are merged beads going? after space m they disappear","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-17T17:28:25.188775+11:00","updated_at":"2025-12-19T10:36:07.922514+11:00","deleted_at":"2025-12-19T10:36:07.922514+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-tz9","title":"when an operation is happening on a bead such as a merge we should show an indication on board","description":"e.g. show a loading spinner on the bead card itself (top right maybe)","notes":"Implemented operation indicators on task cards.\n\nChanges:\n1. Added `taskRunningOperationAtom(taskId)` in atoms.ts - parameterized atom that subscribes to CommandQueueService state for any task\n2. Updated TaskCard.tsx to show operation indicators (‚è≥ for merge/create-pr, üßπ for cleanup, ‚ö° for start, ‚èπÔ∏è for stop)\n3. Updated CompactView.tsx with same indicator support for compact mode\n\nThe indicators appear in the header line after session/phase indicators when an async operation is running on the bead.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:42:47.237644+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T13:18:36.213582+11:00","close_reason":"Implemented operation indicators on task cards - shows when merge, cleanup, start, stop operations are running","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-u6hi","title":"attach to dev server menu enter/space kills the servers instead of attaching","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T18:53:23.868537+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T18:58:46.124871+11:00","close_reason":"Fixed dev server menu attach mode to properly attach to running servers instead of killing them","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-u9t","title":"when i start a session it moves in the list","description":"when i press space s to start a tmux session for a bead it moves in the list due to sorting i guess and sometimes this moves it out of view","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:25:41.450657+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T21:29:29.243055+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ud48","title":"tui_core: Renderable types - Box, Text, Span and styling","description":"Port OpenTUI's Renderable type system to Gleam. This task focuses on TYPE DEFINITIONS only - layout algorithm is in az-se6w.\n\n## What\nHierarchical objects that can be nested, styled, and rendered.\n\n## Core Types (Gleam)\n```gleam\ntype Renderable {\n  Box(children: List(Renderable), style: BoxStyle)\n  Text(content: String, style: TextStyle)\n  Span(content: String, style: TextStyle)  // Inline within Text\n}\n\ntype BoxStyle {\n  BoxStyle(\n    width: Size, height: Size,\n    padding: Edges, margin: Edges,\n    border: Option(BorderStyle),\n    flex_direction: FlexDirection,  // Row | Column\n    justify_content: Justify,       // Start | End | Center | SpaceBetween | SpaceAround\n    align_items: Align,             // Start | End | Center | Stretch\n    gap: Int,\n    fg: Option(Color), bg: Option(Color),\n  )\n}\n\ntype TextStyle {\n  TextStyle(\n    fg: Option(Color), bg: Option(Color),\n    bold: Bool, dim: Bool, underline: Bool, italic: Bool,\n  )\n}\n\ntype Size { Px(Int) | Pct(Int) | Fill | Auto }\ntype FlexDirection { Row | Column }\ntype Justify { JustifyStart | JustifyEnd | JustifyCenter | SpaceBetween | SpaceAround }\ntype Align { AlignStart | AlignEnd | AlignCenter | Stretch }\ntype Edges { Edges(top: Int, right: Int, bottom: Int, left: Int) }\n\n// Convenience constructors\nfn edges_all(n: Int) -\u003e Edges\nfn edges_xy(x: Int, y: Int) -\u003e Edges\nfn default_box_style() -\u003e BoxStyle\nfn default_text_style() -\u003e TextStyle\n```\n\n## Reference\n- OpenTUI Renderables: packages/core/src/renderables/\n\n## Acceptance Criteria\n- [ ] All types defined and compile\n- [ ] Convenient constructors for common cases\n- [ ] Types are ergonomic to work with\n- [ ] Good documentation/comments","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T11:26:07.864793+11:00","updated_at":"2025-12-28T11:32:54.346946+11:00","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-ud48","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.729906+11:00","created_by":"daemon"},{"issue_id":"az-ud48","depends_on_id":"az-xe2h","type":"blocks","created_at":"2025-12-28T11:26:28.76366+11:00","created_by":"daemon"},{"issue_id":"az-ud48","depends_on_id":"az-ebxf","type":"blocks","created_at":"2025-12-28T11:33:58.354626+11:00","created_by":"daemon"}]}
{"id":"az-ufgi","title":"i dont see o as an option in normal mode bottom bar in epic drill down","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:39:43.508204+11:00","updated_at":"2025-12-19T11:39:43.508204+11:00"}
{"id":"az-uiid","title":"make sure processes like space m merge are uninterruptible so that pressing q to close awaits them","design":"## Problem\n\nWhen the user presses `q` to quit while a merge operation (Space+m) is running, the app calls `process.exit(0)` immediately. This can interrupt the merge mid-execution, leaving the git repository in an inconsistent state.\n\n## Current Architecture\n\n1. **Quit handler** (`src/services/keyboard/bindings.ts:179-191`):\n   - Checks if in drill-down mode (exits drill-down instead)\n   - Otherwise calls `process.exit(0)` immediately\n   - **No check for running operations**\n\n2. **CommandQueueService** (`src/services/CommandQueueService.ts`):\n   - Manages per-task FIFO command queues\n   - Has `isBusy(taskId)` to check if a single task has running operations\n   - Uses `Effect.forkIn(fiber, serviceScope)` so fibers live for service lifetime\n   - **Missing**: Global `isAnyBusy()` to check across all tasks\n\n3. **Merge operation** (`src/services/keyboard/PRHandlersService.ts`):\n   - Enqueues via `helpers.withQueue(beadId, \"merge\", ...)`\n   - Runs as a queued Effect, can take several minutes\n\n## Implementation Plan\n\n### Step 1: Add `isAnyBusy()` to CommandQueueService\n\nAdd a new method that iterates all task queues and returns true if ANY has running/queued commands:\n\n```typescript\nisAnyBusy: (): Effect.Effect\u003cboolean, never, never\u003e =\u003e\n  Effect.gen(function* () {\n    const state = yield* SubscriptionRef.get(stateRef)\n    return HashMap.reduce(state, false, (acc, taskState) =\u003e\n      acc || taskState.running !== null || taskState.queue.length \u003e 0\n    )\n  }),\n```\n\n### Step 2: Modify quit handler to await running operations\n\nChange the `q` binding to:\n1. Check `CommandQueueService.isAnyBusy()`\n2. If busy, show a toast notification explaining what's running\n3. Set a \"pending quit\" flag and return (don't exit yet)\n4. When all operations complete, the app will exit\n\nOR simpler approach:\n1. Check `isAnyBusy()`\n2. If busy, show toast \"Cannot quit while operations are running\" and block quit\n3. User must wait for operation to complete or can force-quit with Ctrl+C\n\n### Step 3: Add convenience function\n\nExport `isAnyBusy` as a convenience function like existing `getQueueInfo`.\n\n## Files to Modify\n\n1. `src/services/CommandQueueService.ts` - Add `isAnyBusy()` method\n2. `src/services/keyboard/bindings.ts` - Update quit handler to check busy state\n\n## Testing\n\n1. Start a merge operation (Space+m)\n2. While merge is running, press `q`\n3. Expected: Toast shows \"Operation in progress\", quit is blocked\n4. After merge completes, press `q` again\n5. Expected: App exits normally","acceptance_criteria":"- [ ] Pressing `q` while a merge (or other queued operation) is running shows a toast notification\n- [ ] App does NOT exit while operations are running\n- [ ] App exits normally when no operations are running\n- [ ] Ctrl+C still provides a force-quit escape hatch (existing behavior)\n- [ ] The running operation label is shown in the toast (e.g., \"merge\" or \"cleanup\")","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:58:23.547877+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T15:09:22.314389+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ulwr","title":"when i move between projects i want the last cursor position, filters, etc all saved","description":"so if i go back to a project i want to see the exact same setup as when i left (aside from if beads and tmux changed due to progress made)","design":"## Implementation Plan: Per-Project UI State Persistence\n\n### Goal\nWhen switching between projects, save and restore the full UI state (cursor position, filters, sort config, view mode) so users return to exactly where they left off.\n\n### Storage Location\nPer-project directory: `\u003cproject-path\u003e/.azedarach/state.json`\n\n**Rationale**: Keeps project-specific state with the project. State travels with the project if moved/cloned.\n\n### State to Persist (per project)\n```typescript\ninterface ProjectUIState {\n  focusedTaskId: string | null      // Cursor position\n  filterConfig: FilterConfig        // Status/priority/type/session filters\n  sortConfig: SortConfig            // Sort field and direction  \n  viewMode: ViewMode                // \"kanban\" | \"compact\"\n  savedAt: string                   // ISO timestamp\n}\n```\n\n### Save Trigger\nOn project switch only (when leaving a project).\n\n### Implementation Steps\n\n#### 1. Create ProjectStateService (new service)\n- **File**: `src/services/ProjectStateService.ts`\n- **Responsibilities**:\n  - `saveState(projectPath, state)` - Write state to `\u003cprojectPath\u003e/.azedarach/state.json`\n  - `loadState(projectPath)` - Read and parse state file, return defaults if missing/invalid\n  - Schema validation using Effect Schema\n- **Error handling**: Silently fall back to defaults on read errors (missing file, invalid JSON)\n\n#### 2. Modify ProjectService.switchProject()\n- Before switching: Collect current UI state from EditorService, NavigationService, ViewService\n- Call `ProjectStateService.saveState(currentProject.path, uiState)`\n- After switching: Load new project's state via `ProjectStateService.loadState(newProject.path)`\n- Apply loaded state to EditorService, NavigationService, ViewService\n\n#### 3. Add State Restoration Methods\n- **EditorService**: Add `restoreState(sortConfig, filterConfig)` method\n- **NavigationService**: Add `restoreState(focusedTaskId)` method (already has `setFocusedTask`)\n- **ViewService**: Add `restoreState(viewMode)` method (already has `setViewMode`)\n\n#### 4. Handle Edge Cases\n- **Missing state file**: Use defaults (first task, no filters, session sort desc, kanban view)\n- **Invalid focusedTaskId**: The existing `ensureValidFocus()` already handles this - if the saved task ID doesn't exist in the board, it falls back to first task\n- **First launch**: No state file exists, gracefully use defaults\n- **Drill-down state**: NOT persisted (ephemeral by nature - would need to validate epic still exists)\n\n### File Changes Summary\n1. **New**: `src/services/ProjectStateService.ts` - State persistence logic\n2. **Modify**: `src/services/ProjectService.ts` - Add save/restore calls to `switchProject()`\n3. **Modify**: `src/services/EditorService.ts` - Add `restoreState()` method\n4. **Modify**: `src/ui/atoms/runtime.ts` - Add ProjectStateService to layer\n\n### Schema Definition\n```typescript\nconst ProjectUIStateSchema = Schema.Struct({\n  focusedTaskId: Schema.NullOr(Schema.String),\n  filterConfig: FilterConfigSchema, // Reuse from EditorService\n  sortConfig: SortConfigSchema,     // Reuse from EditorService\n  viewMode: Schema.Literal(\"kanban\", \"compact\"),\n  savedAt: Schema.String,\n})\n```\n\n### Testing Approach\n1. Switch from Project A to B ‚Üí verify A's state saved to `.azedarach/state.json`\n2. Switch back to A ‚Üí verify UI state restored\n3. Delete state file ‚Üí verify graceful fallback to defaults\n4. Corrupt state file ‚Üí verify fallback without crash","notes":"**Bug Fix (2025-12-21)**: Initial implementation only added save/restore to `switchProjectAtom`, but the actual keyboard-triggered project switch in `InputHandlersService` was bypassing this atom and calling `ProjectService.switchProject()` directly. Fixed by adding save/restore logic directly to `InputHandlersService.handleProjectSelectorInput()`.\n\nFiles modified in fix:\n- `src/services/keyboard/InputHandlersService.ts` - Added ProjectStateService and ViewService dependencies, implemented save/restore","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:32:44.866933+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T03:38:24.180211+11:00","close_reason":"Fixed keyboard handler bypass - state now saves/restores correctly via InputHandlersService","comments":[{"id":14,"issue_id":"az-ulwr","author":"riordan","text":"Bug fix needed - keyboard handler was bypassing the atom","created_at":"2025-12-20T15:46:23Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ur03","title":"add a redraw keybind","description":"sometimes the screen size changes and az tui gets messed up","design":"## Implementation Plan\n\n### Problem\nWhen terminal size changes, the TUI display can get corrupted with text overlapping and incorrect layout. Need a manual redraw keybinding.\n\n### Solution\nAdd `Ctrl-l` keybinding (classic Unix terminal redraw shortcut) that:\n1. Clears the screen using ANSI escape codes  \n2. Calls `renderer.requestRender()` to force a full redraw\n\n### Implementation\n1. **src/ui/App.tsx**: Add direct `Ctrl-l` handler in `useKeyboard` callback\n   - Use `useRenderer()` hook from @opentui/react to access the renderer\n   - Clear screen with `process.stdout.write('\\x1b[2J\\x1b[H')` (ANSI clear + home)\n   - Call `renderer.requestRender()` to trigger redraw\n\n2. **docs/keybindings.md**: Document the new `Ctrl-l` redraw keybinding\n\n### Why this approach\n- `Ctrl-l` is the standard Unix/terminal redraw key (works in bash, vim, less, etc.)\n- Direct handler in App.tsx because we need React's `useRenderer()` hook access\n- No new service needed - simple keybinding with direct renderer access","notes":"üìé [mjfeccac-hyoq.png](.beads/images/az-ur03/mjfeccac-hyoq.png) (clipboard, 12/21/2025, 6:19:18 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T18:19:16.166589+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T20:27:32.505365+11:00","close_reason":"Implemented Ctrl-l redraw keybinding that clears screen and requests full re-render","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-use","title":"bd sync doesnt have a json output. need to parse it differently","description":"sync failed for [bd id] -\u003e not valid json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:25:05.897274+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:53:52.433345+11:00","close_reason":"Fixed by parsing human-readable output since bd sync --json doesn't work. Changed sync() to accept {cwd, fromMain} options. Updated all callers to use fromMain:true for worktrees.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-uwcd","title":"lustre_tui: Element types and attributes","description":"Define the Lustre element types that users write in their view functions.\n\n## Why Separate from Reconciler\nElement types are the user-facing API. Keep them stable and well-documented separately from the reconciler internals.\n\n## API (Gleam)\n```gleam\n// Core element type\ntype Element(msg)\n\n// Constructors\nfn box(attrs: List(Attribute(msg)), children: List(Element(msg))) -\u003e Element(msg)\nfn text(attrs: List(Attribute(msg)), content: String) -\u003e Element(msg)\nfn span(attrs: List(Attribute(msg)), content: String) -\u003e Element(msg)  // Inline text\n\n// Future: Input elements\n// fn input(attrs: List(Attribute(msg))) -\u003e Element(msg)\n// fn button(attrs: List(Attribute(msg)), label: String) -\u003e Element(msg)\n\n// Attributes - Layout\nfn width(size: Size) -\u003e Attribute(msg)\nfn height(size: Size) -\u003e Attribute(msg)\nfn flex_direction(dir: FlexDirection) -\u003e Attribute(msg)\nfn justify_content(j: Justify) -\u003e Attribute(msg)\nfn align_items(a: Align) -\u003e Attribute(msg)\nfn padding(p: Int) -\u003e Attribute(msg)\nfn padding_xy(x: Int, y: Int) -\u003e Attribute(msg)\nfn margin(m: Int) -\u003e Attribute(msg)\nfn gap(g: Int) -\u003e Attribute(msg)\n\n// Attributes - Style\nfn fg(color: String) -\u003e Attribute(msg)  // \"#8aadf4\"\nfn bg(color: String) -\u003e Attribute(msg)\nfn bold() -\u003e Attribute(msg)\nfn dim() -\u003e Attribute(msg)\nfn underline() -\u003e Attribute(msg)\nfn border(style: BorderStyle) -\u003e Attribute(msg)\n\n// Attributes - Events (for input elements)\nfn on_click(msg: msg) -\u003e Attribute(msg)\nfn on_key(handler: fn(Key) -\u003e Option(msg)) -\u003e Attribute(msg)\n```\n\n## Design Decisions\n- Attributes are typed to msg for event handlers\n- Colors are strings (parsed by tui_core/color)\n- Sizes use the same Size type as Renderables\n- Keep API minimal initially, expand based on needs\n\n## Acceptance Criteria\n- [ ] box/text/span constructors work\n- [ ] All layout attributes defined\n- [ ] All style attributes defined\n- [ ] Event attribute types defined (even if not implemented)\n- [ ] Types compile and are ergonomic to use","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T11:32:19.939067+11:00","updated_at":"2025-12-28T11:32:19.939067+11:00","labels":["api","gleam","lustre-tui"],"dependencies":[{"issue_id":"az-uwcd","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:33:36.414335+11:00","created_by":"daemon"},{"issue_id":"az-uwcd","depends_on_id":"az-ud48","type":"blocks","created_at":"2025-12-28T11:34:13.202407+11:00","created_by":"daemon"}]}
{"id":"az-uwtb","title":"dont log az notify errors like this in opencode","design":"## Root Cause\n\nThe 'JSON Parse error: Unexpected EOF' occurs because:\n- az-notify.sh outputs nothing to stdout (only logs to /tmp/az-notify-debug.log)\n- OpenCode/Claude Code hook system parses command hook output as JSON\n- When script returns empty string, JSON.parse('') throws Unexpected EOF\n\n## Evidence\n- Hook configured as type: 'command' in src/core/hooks.ts\n- Plugin uses execSync() with stdio: 'ignore' (correctly suppresses in plugin)\n- But Claude Code hooks in settings.local.json parse command output\n- Error appears in OpenCode console, not from Azedarach plugin\n\n## Solution\n\n**Add JSON output to az-notify.sh (1-line fix):**\n\nIn bin/az-notify.sh, add before 'exit 0':\n  echo '{}'\n\n**Why this works:**\n- If hook expects JSON ‚Üí gets valid JSON\n- If hook ignores output ‚Üí no harm\n- Zero side effects, negligible overhead (~1ms)\n- Simplest, most robust solution\n\n## Implementation Steps\n1. Add 'echo \"{}\"' to bin/az-notify.sh before exit 0\n2. Test hooks no longer throw JSON parse errors\n3. Verify tmux status updates still work\n\n## Files to Modify\n- bin/az-notify.sh (add 1 line: echo '{}')\n\n## Testing\n- Start OpenCode session with az-notify hooks enabled\n- Trigger hook events (user prompt, tool use)\n- Verify no JSON parse errors in console\n- Verify @az_status tmux option is still set correctly","notes":"üìé [mjhw1mv7-sf5e.png](.beads/images/az-uwtb/mjhw1mv7-sf5e.png) (clipboard, 12/23/2025, 12:10:23 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:10:21.242767+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T13:37:50.624218+11:00","close_reason":"Fixed az-notify.sh to output valid JSON ({}) before exit. This prevents 'JSON Parse error: Unexpected EOF' when OpenCode/Claude Code hooks parse command output. Tested and verified working.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ux7m","title":"when i space on a epic child with changes m is greyed out","description":"but if i hit m it still merges","design":"## Problem Analysis\n\nThe merge action (`m`) in the ActionPalette is incorrectly greyed out for epic children in \"origin\" workflow mode, even though pressing `m` actually works.\n\n**Root cause:** `ActionPalette.tsx:117` checks only `workflowMode === \"origin\"` to disable merge, but doesn't account for:\n1. Epic children (tasks with `parentEpicId`) - which merge to their parent epic, not main\n2. Epic drilldown view (`drillDownEpicId` is set) - viewing children inside an epic\n\nThe actual merge handler in `PRHandlersService.ts:280-291` has the correct logic:\n- Blocks merge in origin mode UNLESS `drilldownEpicId` is set\n- Even without drilldown, `PRWorkflow.mergeToMain` correctly merges epic children to their parent epic branch (line 982-988)\n\n## Solution\n\nPass additional context to ActionPalette and update the merge availability check:\n\n1. **Pass `parentEpicId`** from the selected task to ActionPalette (already available on `TaskWithSession`)\n2. **Pass `drillDownEpicId`** from `drillDownEpicAtom` to ActionPalette\n3. **Update merge availability check** to allow merge when:\n   - `workflowMode !== \"origin\"` (current), OR\n   - Task is an epic child (`task.parentEpicId !== undefined`), OR\n   - We're in epic drilldown view (`drillDownEpicId !== undefined`)\n\n## Files to Change\n\n1. `src/ui/ActionPalette.tsx`:\n   - Add `parentEpicId?: string` and `drillDownEpicId?: string` to props\n   - Update line 117 to: `if (action === \"m\" \u0026\u0026 workflowMode === \"origin\" \u0026\u0026 !parentEpicId \u0026\u0026 !drillDownEpicId) return false`\n\n2. `src/ui/App.tsx`:\n   - Import `drillDownEpicAtom`\n   - Get drilldown epic value with `useAtomValue(drillDownEpicAtom)`\n   - Pass `parentEpicId={selectedTask?.parentEpicId}` and `drillDownEpicId={drillDownEpic}` to ActionPalette","notes":"üìé [mjrxsl67-tjog.png](.beads/images/az-ux7m/mjrxsl67-tjog.png) (clipboard, 12/30/2025, 12:57:04 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T12:56:54.785842+11:00","updated_at":"2025-12-30T13:03:25.35626+11:00","closed_at":"2025-12-30T13:03:25.35626+11:00","close_reason":"Fixed: Both handler and UI now allow merge for epic children in origin mode"}
{"id":"az-uxkg","title":"add configurable tmux session limit (10 by default)","description":"across all projects","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T11:42:03.259918+11:00","updated_at":"2026-01-05T11:42:03.259918+11:00"}
{"id":"az-uxz","title":"Action palette overlay for Space menu","description":"Action mode keybindings are getting crowded in the status bar. Create a proper floating action palette that appears when Space is pressed, showing all available actions with descriptions.","design":"- Floating box overlay (like HelpOverlay)\n- Show action, keybind, and short description\n- Gray out unavailable actions based on task state\n- e.g., 'Start' grayed if session already running\n- Dismiss on Esc or action execution\n- Consider grouping: Session (s/a/p/r/x), Move (h/l), etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:00:26.143992+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T12:16:53.933473+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-v0xk","title":"space c to chat isnt spawning a tmux session the same way as space s/S","description":"i saw a success toast but no indication of active session on the card and space a fails","design":"Space+c (chat) now uses the same SessionManager.start() method as Space+S, but with model='haiku'. This means:\n1. Creates a worktree (same as work sessions)\n2. Tracked in SessionManager (visible on card, attachable)\n3. Uses Haiku model for cheaper/faster discussion\n4. Can seamlessly transition to implementation since you're already in a worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:42:07.57381+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:30.380941+11:00","close_reason":"Chat (Space+c) now creates worktrees and uses SessionManager.start() with model=haiku. Sessions are tracked, visible on cards, and attachable. Seamless transition from chat to implementation.","comments":[{"id":10,"issue_id":"az-v0xk","author":"riordan","text":"Design changed: chat now creates worktrees like Space+S. Need to verify changes.","created_at":"2025-12-18T05:53:56Z"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-v1p1","title":"why do i see origin/main here instead of local main in azedarach project","notes":"üìé [mjqmnehy-bgma.png](.beads/images/az-v1p1/mjqmnehy-bgma.png) (clipboard, 12/29/2025, 2:57:18 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T14:57:15.887087+11:00","updated_at":"2025-12-29T15:01:25.532344+11:00","closed_at":"2025-12-29T15:01:25.532346+11:00","close_reason":"Fixed: Added `workflowMode: local` to azedarach config. The UI was showing `origin/main` because the config was missing `workflowMode` (defaulting to Origin mode). Also fixed schema mismatch: `base` ‚Üí `baseBranch`."}
{"id":"az-v2ql","title":"ensure cwd is correctly passed down or retrieved via ProjectService at every point","description":"e.g. using space c to chat checks beads in the process.cwd instead of the project cwd still","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:22:54.126139+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:29.909492+11:00","close_reason":"Fixed all process.cwd() usages to use ProjectService for correct cwd handling. Key changes:\n- TmuxService.displayPopup now accepts optional `cwd` parameter\n- chatAboutTask passes project path to tmux popup\n- taskHandlers.ts deleteBead gets projectPath from ctx.getProjectPath()\n- bindings.ts log viewer gets projectPath dynamically\n- prHandlers.ts abortMerge gets projectPath correctly\n- ImageAttachmentService refactored to get project path via ProjectService (added dependency)\n- SessionManager refactored with ProjectService dependency and getEffectiveProjectPath helper\n- listActive() now accepts optional projectPath parameter","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-v6h","title":"use effect STM or something to enforce atomic operations where possible","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:43:45.048239+11:00","updated_at":"2025-12-17T15:43:45.048239+11:00"}
{"id":"az-vbqj","title":"both of these servers ARE running but not tracked properly in az","design":"## Root Cause\n\nThe `checkPortOpen()` function in DevServerService.ts only checks IPv4 (`127.0.0.1`), but the \"server\" dev server (Bun on port 8080) binds to IPv6 only (`[::1]:8080`).\n\n**Evidence:**\n- `lsof -i :8080` shows: `TCP [::1]:8080 (LISTEN)` - IPv6 only\n- `lsof -i :3000` shows: `TCP *:hbci (LISTEN)` - all interfaces\n- `nc -z 127.0.0.1 8080` fails (IPv4)\n- `nc -z ::1 8080` succeeds (IPv6)\n\n## Solution\n\nModify `checkPortOpen()` to try BOTH IPv4 and IPv6, returning true if either succeeds:\n\n1. Try `127.0.0.1` (IPv4)\n2. If that fails, try `::1` (IPv6)\n3. Return true if either connection succeeds\n\nAlternative: Use `localhost` which the OS resolves to the appropriate interface, but this can be unpredictable. Explicit dual-stack check is more reliable.\n\n## Implementation\n\nUpdate `checkPortOpen()` in `/src/services/DevServerService.ts` (lines 39-74):\n\n```typescript\nconst checkPortOpen = (port: number): Effect.Effect\u003cboolean\u003e =\u003e\n  Effect.gen(function* () {\n    // Try IPv4 first\n    const ipv4Open = yield* checkPortOpenOnHost(port, \"127.0.0.1\")\n    if (ipv4Open) return true\n    // Fall back to IPv6\n    return yield* checkPortOpenOnHost(port, \"::1\")\n  })\n\nconst checkPortOpenOnHost = (port: number, host: string): Effect.Effect\u003cboolean\u003e =\u003e\n  Effect.async\u003cboolean\u003e((resume) =\u003e {\n    // ... existing socket code ...\n  })\n```\n\n## Files to Modify\n\n- `src/services/DevServerService.ts` - Update checkPortOpen() to be dual-stack\n\n## Testing\n\n1. Start Azedarach\n2. Open Toggle Dev Server menu on a bead with running servers\n3. Verify both \"web\" (IPv4/*) and \"server\" (IPv6) show as \"running\"","notes":"üìé [mjqnzia8-7fam.png](.beads/images/az-vbqj/mjqnzia8-7fam.png) (clipboard, 12/29/2025, 3:34:43 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T15:34:41.102289+11:00","updated_at":"2025-12-29T16:22:35.760924+11:00","closed_at":"2025-12-29T16:22:35.760924+11:00","close_reason":"Fixed: checkPortOpen() now checks both IPv4 (127.0.0.1) and IPv6 (::1) in parallel, correctly detecting servers like Bun that bind to IPv6-only."}
{"id":"az-vcx5","title":"az got reaaaly slow today in the last hour or two","description":"analyze our commits for potential performance degrading changes and resolve the perf issue\nto be clear, the boards show nothing for AGES 20s+ and then finally load in AND the app just feels laggier\nalso it takes a bit longer than it used to to see newly created tasks in the board\nperf degradation seems correlated to number of beads","design":"## Performance Analysis\n\n**Root Cause**: O(n) subprocess calls in `BoardService.loadTasks()`:\n1. For each of 38 issues with dependencies ‚Üí calls `getParentEpic()` \n2. Each `getParentEpic()` does 1-2 `bd show` calls (0.1s each)\n3. With concurrency 4, that's ~10 batches √ó 0.1s = 1+ seconds\n\n**Key insight**: `bd show id1 id2 id3...` accepts multiple IDs and returns all in one call (~0.1s total).\n\n## Fix Strategy\n\n### Change 1: Batch getParentEpic calls\nReplace individual `bd show` calls with a single batch call:\n\n```typescript\n// BEFORE (O(n) calls):\nconst parentEpicResults = yield* Effect.all(\n  issuesWithDeps.map((issue) =\u003e beadsClient.getParentEpic(issue.id, ...)),\n  { concurrency: 4 },\n)\n\n// AFTER (O(1) call):\nconst issueIds = issuesWithDeps.map(i =\u003e i.id)\nconst issuesWithDeps = yield* beadsClient.showMultiple(issueIds) // NEW METHOD\n// Then build parentEpicMap from the returned dependency data\n```\n\n### Change 2: Add `showMultiple` to BeadsClient\nNew method that batches multiple issue IDs into single `bd show id1 id2 ...` call.\n\n### Change 3: Build parent map from batch result\nProcess the batch result to extract parent-child relationships:\n- Look for dependencies with `dependency_type === \"parent-child\"` and `issue_type === \"epic\"`\n- Build map: childId ‚Üí parentEpicId\n\n### Expected improvement\n- Before: 38 issues √ó 2 calls √ó 0.1s / 4 concurrency = ~2 seconds\n- After: 1 batch call for children + 1 batch call for epics = ~0.2 seconds\n- **10x faster for parent epic resolution**","notes":"## Changes Made (2025-12-30)\n\n### 1. Batched `bd show` calls for parent epic lookup\n**File:** `src/core/BeadsClient.ts`\n- Added `showMultiple(ids: string[])` method that takes multiple IDs and returns all in one call\n- `bd show id1 id2 id3 --json` is 10x faster than individual calls\n\n**File:** `src/services/BoardService.ts`  \n- Changed `loadTasks()` to use single `beadsClient.showMultiple()` call instead of O(n) `getParentEpic()` calls\n- With 38 issues having dependencies, this saves ~2 seconds (from ~2s to ~0.1s)\n\n### 2. TTL cache for worktree existence checks\n**File:** `src/core/WorktreeManager.ts`\n- Added 2-second TTL cache for `refreshWorktrees()` \n- `exists()`, `get()`, `list()` now use cached data when within TTL\n- `create()`, `remove()` use `forceRefreshWorktrees()` to ensure fresh data\n- Avoids O(n) git worktree list calls during `loadTasks()` (100 issues = 100 calls ‚Üí 1 call)\n\n### 3. Added timing instrumentation\n**File:** `src/services/BoardService.ts`\n- Added timing logs to loadTasks() to verify improvements:\n  - \"loadTasks: N issues fetched in Xms\"\n  - \"loadTasks: N deps resolved in Xms\" \n  - \"loadTasks: Complete in Xms\"\n\n## Expected Performance Improvement\n- Before: 20s+ for initial load with 100 beads\n- After: Should be ~1-2 seconds\n\nThe main bottlenecks were:\n1. O(n) subprocess calls for parent epic lookup (38 √ó 0.1s = ~4s)\n2. O(n) git worktree list calls for existence checks (100 √ó 0.05s = ~5s)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T12:24:27.050454+11:00","updated_at":"2025-12-30T14:03:48.366385+11:00","closed_at":"2025-12-30T14:03:48.366388+11:00"}
{"id":"az-vcxc","title":"why is there a number beside the dev server icon","design":"## Root Cause\n\nThe dev server indicator emoji `üñ•Ô∏è` (DESKTOP COMPUTER) contains a Unicode variation selector `U+FE0F` that renders poorly in many terminals:\n- The variation selector shows as vertical lines `||`\n- The base emoji renders smaller than expected\n- Combined effect: `üñ•Ô∏è||` instead of a clean icon\n\n## Solution\n\nChanged from `üñ•Ô∏è` (U+1F5A5 + U+FE0F) to `üíª` (U+1F4BB) which:\n- Is a single Unicode code point with no variation selector\n- Renders consistently across terminals\n- Semantically similar (computer = dev server)","notes":"Fixed by changing DEV_SERVER_INDICATOR from üñ•Ô∏è to üíª in src/ui/types.ts\n\nThe issue was that the desktop computer emoji has a variation selector (U+FE0F) appended which doesn't render properly in terminals, causing the small icon + vertical lines artifact.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T02:15:19.799683+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-20T04:27:20.640207+11:00","close_reason":"Fixed by changing DEV_SERVER_INDICATOR from üñ•Ô∏è (U+1F5A5 + U+FE0F) to üíª (U+1F4BB). The variation selector was causing terminal rendering issues.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-vhfg","title":"brainstorm ideas for reducing number of active tmux sessions","description":"sometimes i leave too many tmux sessions running because i dont bother space d or space x to end them.\nhow can we deal with this?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T15:46:16.5296+11:00","updated_at":"2025-12-23T15:46:16.5296+11:00"}
{"id":"az-vm5l","title":"space s/S/! on a bead that already has a worktree should not fail","description":"instead of erroring cause the worktree already exists, warn that worktree already existst and continue using that worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:18:03.403552+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T16:24:57.065916+11:00","close_reason":"Implemented: WorktreeManager.create now checks if the branch already exists and uses `git worktree add \u003cpath\u003e \u003cbranch\u003e` instead of `git worktree add -b` when appropriate. This prevents the 'branch already exists' error when pressing space s/S/! on a bead that already has a worktree or has a leftover branch from a previous session.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-vn0","title":"i just ended a session and then all beads with active sessions disappeared from the board","description":"i used space x to end the session and after quitting az and restarting it the beads that disappeared are still not back","notes":"## Investigation (2025-12-15)\n\n### Analysis\n\nInvestigated the bug where beads with active sessions disappeared after ending a session with Space+x.\n\n**Key findings:**\n1. Beads ARE present in the database (verified with `bd list` - 76 beads, 26 open, 1 in_progress)\n2. The `SessionManager.stop()` function only removes session tracking, doesn't modify beads\n3. The `bd sync` operation syncs changes FROM worktrees but shouldn't delete beads\n\n**Possible causes identified:**\n1. Error in `BoardService.refresh()` scheduled task causing stale/empty data\n2. Mismatch between session tracking and bead data after sync\n3. Transient issue that's difficult to reproduce\n\n**Root cause could not be definitively identified** - the code looks correct and beads exist in the database.\n\n### Fixes Applied\n\nAdded diagnostic logging to help identify the issue if it recurs:\n\n1. **BoardService.ts**: Added error logging for scheduled refresh failures\n2. **SessionManager.ts**: Added logging around session stop operations:\n   - Log when stopping session\n   - Log when sync completes/fails\n   - Log final session state\n3. **BoardService.ts**: Added warning log when task counts seem inconsistent (0 beads or session mismatch)\n\n### How to Diagnose in Future\n\nIf the bug recurs, check `az.log` for:\n- \"BoardService refresh failed\" - indicates data loading error\n- \"Stopping session for\" / \"Session stopped for\" - tracks session lifecycle\n- \"Sync failed for\" - indicates beads sync issues\n- \"Task load: X beads, Y active sessions\" - tracks data counts\n\n### Status\n\nClosing as \"cannot reproduce\" with diagnostic logging added. The logging will help identify the root cause if the issue occurs again.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:40:32.916186+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T17:16:31.935474+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-voa","title":"i dont like ctrl-a A as a way to return to az, come up with a better global key command","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T10:08:08.210971+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T10:48:27.086814+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-vpj","title":"make sure we warn the user if space m will cause conflicts and they can press y/n to proceed or cancel","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:26.919959+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T01:09:17.730326+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-vpz","title":"Migrate state management to Effect-atom native patterns","description":"Refactor current state management to use Effect-atom native patterns for better integration with the Effect ecosystem. This includes:\n\n- Audit current state management approach\n- Identify candidates for migration to effect-atom\n- Implement atomic state with proper Effect integration\n- Ensure reactive updates flow through the TUI correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T10:32:35.479946+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T12:42:24.80598+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-vw20","title":"Scroll containers (overflow: scroll)","description":"**Status:** Deferred to post-MVP\n\n## Overview\nAdd scrollable containers that can display content larger than their bounds.\n\n## Current State\nThe layout engine (az-se6w) implements **clipping** for MVP - content outside bounds is simply not rendered.\n\n## Features to Add\n- `Overflow::Scroll` variant for boxes\n- Scroll offset state (x, y)\n- Keyboard scroll handling (arrow keys, Page Up/Down within scroll container)\n- Optional: scrollbar rendering\n- Optional: mouse wheel scrolling (depends on mouse events)\n\n## API Addition\n```gleam\ntype Overflow { Clip | Scroll | Visible }\n\n// In BoxStyle\noverflow: Overflow  // default: Clip\n\n// Scrollbar styling\ntype ScrollbarStyle {\n  track_color: Color,\n  thumb_color: Color,\n  width: Int,  // typically 1 cell\n}\n```\n\n## Complexity\nMedium-high. Requires:\n- Layout engine changes (scroll viewport calculation)\n- State management (scroll offsets per scrollable container)\n- Event routing (scroll events to correct container)\n- Focus concept (which container is scrollable)\n\n## Why Deferred\nAzedarach Kanban columns are fixed height with a known number of tasks. Scrolling not required for MVP.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T12:07:34.366262+11:00","updated_at":"2025-12-28T12:07:34.366262+11:00","labels":["deferred","gleam","layout","tui-core"],"dependencies":[{"issue_id":"az-vw20","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T12:07:48.784419+11:00","created_by":"daemon"},{"issue_id":"az-vw20","depends_on_id":"az-se6w","type":"blocks","created_at":"2025-12-28T12:07:49.00686+11:00","created_by":"daemon"}]}
{"id":"az-vx2","title":"Add debug overlay (d key) showing service state","description":"Developer tool for debugging state issues:\n\n**Debug overlay shows:**\n- Current mode (EditorService)\n- Cursor position and focused task ID (NavigationService)  \n- Active sessions with states (SessionManager)\n- Command queue status (CommandQueueService)\n- Filter/sort settings (BoardService)\n- Recent errors/warnings\n\n**Toggle with 'd' key in normal mode**\n- Semi-transparent overlay on right side\n- Auto-refreshes every 500ms\n- Useful for debugging state sync issues like az-vn0 (disappearing tasks)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:59:45.895225+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:06:44.78128+11:00","close_reason":"Implemented debug overlay with 'd' key toggle showing mode, navigation, board, session, and command queue state","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-w2m","title":"up/down arrow should wrap around the current column when at the bottom/top not move to next column","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:54:54.218653+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:02:47.827581+11:00","close_reason":"Implemented wrap-around navigation for up/down keys within columns","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-w75","title":"pressing down at the bottom of a column in tui should wrap to the top of that column not the next column","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:28:56.744822+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:33:22.358329+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-w9g9","title":"i want to change space m to merge into main but not cleanup otherwise","description":"sometimes i need to use this flow: be space m, test in main dev server, iterate in same claude session, space m again, its done? then space d to cleanup\nit should no longer mess with closing beads or ending sessions","design":"## Implementation Plan\n\n**Goal:** Change Space+m to merge into main but NOT cleanup (no worktree deletion, no branch deletion, no bead closing, keep session running).\n\n**Current behavior (Space+m):**\n1. Stop session ‚ùå (we want to keep it running)\n2. Commit uncommitted changes in worktree ‚úÖ\n3. Merge branch to main (with conflict handling) ‚úÖ\n4. Sync beads ‚úÖ\n5. Remove worktree ‚ùå\n6. Delete local branch ‚ùå\n7. Close bead ‚ùå\n8. Push to origin ‚úÖ\n\n**New behavior (Space+m):**\n1. Keep session running (don't stop) ‚úÖ\n2. Commit uncommitted changes in worktree ‚úÖ\n3. Merge branch to main (with conflict handling) ‚úÖ\n4. Sync beads ‚úÖ\n5. Push to origin ‚úÖ\n6. **DO NOT**: remove worktree, delete branch, close bead\n\n**Changes needed:**\n\n1. **PRWorkflow.ts** - Add new method `mergeToMainOnly`:\n   - Similar to `mergeToMain` but without cleanup steps\n   - Skip: sessionManager.stop(), worktreeManager.remove(), branch deletion, bead closing\n   - Keep: git merge, beads sync, push to origin\n\n2. **PRHandlersService.ts** - Update `mergeToMain` handler:\n   - Call `prWorkflow.mergeToMainOnly()` instead of `prWorkflow.mergeToMain()`\n\n**User workflow after this change:**\n- Space+m: merge to main, stay in worktree, keep iterating\n- Space+m again: merge latest changes to main\n- Space+d: cleanup when done (existing behavior)\n\n**Alternative approach (simpler):**\n- Just pass `closeBead: false` to existing mergeToMain and skip cleanup steps\n- But current mergeToMain always deletes worktree, so we need to add a `keepWorktree` option\n\n**Chosen approach:** Add `keepWorktree: boolean` option to MergeToMainOptions, defaulting to true (new behavior). This is less code duplication than a new method.","acceptance_criteria":"- [ ] Space+m merges branch to main without deleting worktree\n- [ ] Space+m keeps Claude session running (no stop)\n- [ ] Space+m does NOT close the bead\n- [ ] Space+m does NOT delete the local branch\n- [ ] Space+d still works for full cleanup (worktree + branch + bead close)\n- [ ] Can iterate: Space+m, make changes, Space+m again, Space+d to finish\n- [ ] Beads sync still runs after merge\n- [ ] Push to origin still happens after merge","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T01:28:03.733199+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T23:30:21.85682+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-wbj3","title":"simplify tmux az service","description":"instead of multiple tmux sessions per bead we should have 1 session per bead and multiple windows in each session e.g. start a opencode session? just goes to tmux session named [bead-id] (in worktree obviously), and creates a window for that open code session. if the tmux session doesnt exist it creates it and runs initCommands in a window before allowing the opencode session window to be created. space r to start a dev server? same tmux session, new window! name the windows if you can based on their usecase. ask me if you need more details or have any questions","notes":"Design for single-session tmux model:\n1. Unified Session Name: The tmux session name will be exactly the bead ID (e.g., 'az-wbj3').\n2. Windows for Concerns:\n   - 'code': Main AI tool (Claude/OpenCode).\n   - 'dev': Dev server.\n   - 'chat': Chat sessions.\n   - 'background': For one-off background tasks.\n3. WorktreeSessionService Refactor:\n   - Centralize 'get or create session' logic.\n   - Use @az_init_done session option to synchronize window startup.\n   - New windows will wait for initialization (direnv, etc.) before running their commands.\n4. TmuxService Keybindings:\n   - Update 'C-a Tab' to toggle between 'code' and 'dev' windows in the current session.\n5. Path Utility Updates:\n   - Add getBeadSessionName(beadId) to paths.ts.\n   - Add standardized window names.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:33:06.78557+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T14:08:33.105144+11:00","close_reason":"Refactor complete: unified tmux session architecture implemented.\n- Consolidated sessions into beadId named sessions.\n- Concerns isolated to code/dev/chat windows.\n- Sync mechanism via @az_init_done implemented.\n- TUI monitor updated to handle new format.\n- Manual type check passed.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-wgc7","title":"add a space keybnid to start hx in a tmux session instead of/in addition to a claude sesh","design":"## Implementation Plan\n\n### Summary\nAdd `Space+H` (Shift+H) keybinding to open Helix editor in a dedicated tmux window within the bead's session. Works like the \"chat\" feature - creates an \"hx\" window alongside Claude/chat windows.\n\n### Key Decision: Always Available\n- If session exists ‚Üí open Helix in existing session's worktree\n- If no session (idle) ‚Üí create worktree/session first, then open Helix window\n- This matches user expectation of \"just open Helix for this bead\"\n\n### Files to Modify\n\n1. **`src/core/paths.ts`** - Add `HX: \"hx\"` to WINDOW_NAMES constant\n\n2. **`src/services/keyboard/SessionHandlersService.ts`** - Add `startHelixSession()` method:\n   - Get target task from action mode\n   - If no session exists: create worktree + session (reuse ClaudeSessionManager logic)\n   - Use `ensureWindow()` to create/reuse \"hx\" window\n   - Command: `hx .` (open Helix in worktree root)\n   - Show toast on success\n\n3. **`src/services/keyboard/bindings.ts`** - Add keybinding:\n   ```typescript\n   {\n     key: \"S-h\",  // Shift+H\n     mode: \"action\",\n     description: \"Open Helix editor\",\n     action: Effect.suspend(() =\u003e\n       bc.editor.exitToNormal().pipe(\n         Effect.tap(() =\u003e bc.sessionHandlers.startHelixSession()),\n       ),\n     ),\n   }\n   ```\n\n4. **`src/ui/ActionPalette.tsx`** - Add to session actions section:\n   - Add `\u003cActionLine keyName=\"H\" description=\"helix\" /\u003e`\n   - Update `isAvailableByState()` to return `true` for \"H\" (always available)\n\n5. **`docs/keybindings.md`** - Document the new keybinding\n\n### Implementation Notes\n- Follows exact pattern of `chatAboutTask()` for window creation\n- Uses `WorktreeSessionService.ensureWindow()` for idempotent window management\n- For idle tasks, need to call `sessionManager.createSessionOnly()` or similar to set up worktree without starting Claude\n- Helix runs in interactive shell: `${shell} -i -c 'hx .; exec ${shell}'`\n\n### Testing\n- Test on idle task (should create worktree + session)\n- Test on task with existing session (should add window)\n- Test attaching to Helix window (Space+a should work)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:54:11.2604+11:00","updated_at":"2025-12-29T15:21:12.062057+11:00","closed_at":"2025-12-29T15:21:12.062057+11:00","close_reason":"Implemented Space+H keybinding to open Helix editor in a dedicated tmux window. Works for both idle and running tasks - creates worktree if needed. Documented in keybindings.md."}
{"id":"az-wiu","title":"Eliminate React hooks in favor of Effect services (audit \u0026 migrate)","description":"Per az-x4e, 9 files still use React hooks (useEffect/useMemo/useState):\n\n- src/ui/App.tsx\n- src/ui/Board.tsx\n- src/ui/Column.tsx\n- src/ui/CompactView.tsx\n- src/ui/Toast.tsx\n- src/ui/DetailPanel.tsx\n- src/ui/CreateTaskPrompt.tsx\n- src/ui/ClaudeCreatePrompt.tsx\n- src/index.tsx\n\n**Audit each file** to determine:\n1. What state/effects can move to Effect services\n2. What computation can move to atoms\n3. What's truly local UI state (may be acceptable)\n\nDocument findings and create migration plan. This task is the audit; az-x4e is the execution.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T15:59:45.338873+11:00","updated_at":"2025-12-17T15:59:45.338873+11:00"}
{"id":"az-wj37","title":"Test and verify layout after UI component migrations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:18:30.769757+11:00","updated_at":"2026-01-05T02:27:44.528998+11:00","closed_at":"2026-01-05T02:27:44.528998+11:00","close_reason":"Tested and verified layout after migrating to bubbletea list components. All tests pass including TestViewHeight which validates the view fits within the specified terminal height. The board now uses bubbletea's list component for proper variable-height item rendering without excessive whitespace.","dependencies":[{"issue_id":"az-wj37","depends_on_id":"az-d8c8","type":"discovered-from","created_at":"2026-01-05T02:18:36.154328+11:00","created_by":"riordan"}]}
{"id":"az-wn3o","title":"Claude-orchestrated epic mode (subagent approach)","description":"Claude orchestrates an epic using parallel Task tool subagents.\n\n**Entry:** Space+O on epic ‚Üí \"Claude Orchestrate\" option\n\n**Flow:**\n1. Spawn orchestrator with auto-compact enabled\n2. Quality gate identifies safe parallel groupings\n3. Orchestrator spawns subagent batches, monitors progress\n4. Updates beads on completion/blockers\n\n**Stretch:** Configurable subagents vs external sessions (az-zg9j)","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-19T11:09:41.316984+11:00","updated_at":"2025-12-19T11:15:56.423972+11:00","dependencies":[{"issue_id":"az-wn3o","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-19T11:14:30.801875+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-wot","title":"image paste from clipboard not working still on mac","description":"no logs, no toast, just nothing happens when i press p with a image in clipboard","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:12:34.022384+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-18T01:36:22.272642+11:00","close_reason":"Fixed: ImageAttachmentService state was not being initialized when overlay opened via keybinding. Handler now auto-initializes state from overlay if needed, and added user feedback when clipboard support unavailable.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-wvkz","title":"we need to make some improvements to our git diff file picker","description":"scrolls out of bounds, need to add ctrl-u/d for scrolling up/down and / for searching","design":"## Root Cause Analysis\n\n### 1. Content Overflow Bug\nThe FilePicker receives `height={100}` (a meaningless percentage-like value) and uses it to calculate `visibleHeight = height - 4 = 96` items to render. This causes 96 items to be rendered, overflowing the container since the actual viewport is ~20-30 rows.\n\n**Fix:** Replace fixed `height` prop with `maxVisible` prop (like Column.tsx uses). The component should render at most N items and use scroll indicators, NOT CSS overflow.\n\n### 2. Missing Ctrl-d/Ctrl-u Page Scrolling  \nNormal mode has j/k for single-line nav but no half-page scroll.\n\n**Fix:** Add keyboard handlers:\n- `Ctrl-d`: Move down half-page (maxVisible/2)\n- `Ctrl-u`: Move up half-page (maxVisible/2)\n\n### 3. Search Verification\nSearch (/) appears implemented. Need to verify it works correctly.\n\n## Implementation Plan\n\n1. **FilePicker.tsx changes:**\n   - Replace `height: number` prop with `maxVisible?: number` (default ~20)\n   - Remove `height={height}` from container box\n   - Cap `visibleHeight` to `maxVisible`\n   - Ensure scroll indicator shows when items \u003e maxVisible\n\n2. **DiffViewer.tsx changes:**\n   - Remove `height={100}` prop from FilePicker\n   - Add `maxVisible` prop (calculate from viewport or use sensible default)\n   - Add Ctrl-d/Ctrl-u handlers in normal mode:\n     ```typescript\n     if (event.ctrl \u0026\u0026 event.name === \"d\") {\n       // Half-page down\n       setState(s =\u003e ({...s, selectedIndex: Math.min(s.selectedIndex + Math.floor(maxVisible/2), itemCount - 1)}))\n     }\n     if (event.ctrl \u0026\u0026 event.name === \"u\") {\n       // Half-page up  \n       setState(s =\u003e ({...s, selectedIndex: Math.max(s.selectedIndex - Math.floor(maxVisible/2), 0)}))\n     }\n     ```\n\n3. **Update status bar** to show Ctrl-d/u in normal mode keybindings\n\n## Files to Modify\n- `src/ui/DiffViewer/FilePicker.tsx` - Fix overflow, use maxVisible\n- `src/ui/DiffViewer/DiffViewer.tsx` - Add page scroll keys, update props","notes":"üìé [mjsftwk7-urhm.png](.beads/images/az-wvkz/mjsftwk7-urhm.png) (clipboard, 12/30/2025, 9:21:57 PM)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:21:48.645374+11:00","updated_at":"2025-12-30T22:18:55.6711+11:00","closed_at":"2025-12-30T22:18:55.671104+11:00"}
{"id":"az-wwui","title":"Mouse events support","description":"**Status:** Deferred to post-MVP\n\n## Overview\nAdd mouse event handling to the TUI framework. The config already has a `mouse: Bool` field but implementation is deferred.\n\n## Features\n- Mouse click detection (x, y coordinates)\n- Mouse movement tracking (hover)\n- Mouse button identification (left, right, middle)\n- Scroll wheel events\n\n## Implementation Notes\n- Requires ANSI mouse tracking escape sequences\n- Enable: `\\x1b[?1000h` (basic) or `\\x1b[?1003h` (any event)\n- Disable: `\\x1b[?1000l`\n- Events come as escape sequences: `\\x1b[M\u003cbutton\u003e\u003cx\u003e\u003cy\u003e`\n\n## Reference\n- OpenTUI mouse handling (if present)\n- ANSI mouse tracking: https://invisible-island.net/xterm/ctlseqs/ctlseqs.html\n\n## Blocked By\n- Runtime (az-d19m) must be complete first\n\n## Why Deferred\nMouse is not required for Azedarach MVP - keyboard navigation is sufficient for the Kanban board.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T12:07:33.635045+11:00","updated_at":"2025-12-28T12:07:33.635045+11:00","labels":["deferred","gleam","input","tui-core"],"dependencies":[{"issue_id":"az-wwui","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T12:07:48.715183+11:00","created_by":"daemon"},{"issue_id":"az-wwui","depends_on_id":"az-d19m","type":"blocks","created_at":"2025-12-28T12:07:48.932984+11:00","created_by":"daemon"}]}
{"id":"az-wxvn","title":"why is bd sync failing in initCommands?","design":"## Root Cause Analysis\n\n**Error**: `bd sync` (and all bd commands) fail with:\n```\nError: failed to open database: failed to initialize schema: sqlite3: SQL logic error: no such column: thread_id\n```\n\n### Investigation Findings\n\n1. **Version Mismatch**: The beads CLI is v0.30.5 (dev) but the database metadata shows `bd_version|0.30.1`\n\n2. **Missing Column**: The `dependencies` table is missing `thread_id` column:\n   - Current schema has: `issue_id, depends_on_id, type, created_at, created_by`\n   - New schema expects: + `thread_id TEXT DEFAULT ''`\n\n3. **Migration Bug**: Migration 020_edge_consolidation.go expects `thread_id` to exist during schema initialization, but doesn't properly add it first. This breaks all bd commands, including `bd migrate`.\n\n4. **Workaround**: `bd list --no-db` works because it bypasses SQLite entirely and reads from JSONL.\n\n### Why This Affects Azedarach\n\n- `.azedarach.json` has `initCommands: [\"direnv allow\", \"bun install\", \"bd sync\"]`\n- Worktrees run `bd sync` after creation\n- `bd sync` fails ‚Üí session starts with warning state\n- This is a **beads upstream bug**, not an Azedarach bug\n\n### Solution Options\n\n1. **Immediate workaround (Azedarach)**: Remove `bd sync` from initCommands OR use `bd sync --no-db`\n2. **Proper fix (beads)**: Fix the migration to add the column before referencing it\n3. **Manual fix**: `sqlite3 .beads/beads.db \"ALTER TABLE dependencies ADD COLUMN thread_id TEXT DEFAULT ''\"`","notes":"üìé [mjc92kmr-m2gt.png](.beads/images/az-wxvn/mjc92kmr-m2gt.png) (clipboard, 12/19/2025, 1:28:25 PM)\n\n### Investigation Steps Completed\n1. Read attached screenshot showing diagnostics panel with initCommands failure\n2. Ran `bd sync` manually - confirmed same error\n3. Checked beads version: 0.30.5 (dev) from nix flake\n4. Compared db schema - dependencies table missing `thread_id`\n5. Found migration 020_edge_consolidation.go adds thread_id\n6. Confirmed `--no-db` mode works as workaround\n7. Fixed by: manually adding column to main db, then deleting worktree's empty db so it recreates from JSONL\n\n### Confirmed: This is a beads upstream bug\nThe migration system should handle older databases gracefully but instead crashes.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:28:23.212365+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T14:15:10.682065+11:00","close_reason":"Investigation complete. Root cause: beads upstream migration bug where v0.30.5 expects `thread_id` in dependencies table but migration 020 fails on older dbs. Fixed by manually adding the column with: `sqlite3 .beads/beads.db \"ALTER TABLE dependencies ADD COLUMN thread_id TEXT DEFAULT ''\"`. Also fixed Chefy db.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-x4e","title":"avoid useEffect, useMemo, useState, etc.","description":"switch from react hooks such as those in the title to fully encapsulating state mgmt in effect services","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:24:52.577357+11:00","updated_at":"2025-12-17T15:03:52.386143+11:00","dependencies":[{"issue_id":"az-x4e","depends_on_id":"az-wiu","type":"blocks","created_at":"2025-12-17T15:59:52.10568+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-x4os","title":"Investigate if we can speed up .envrc (flake.nix i think takes the time)","description":"Investigate direnv/.envrc loading time - user suspects flake.nix evaluation is slow.","design":"## Investigation Findings\n\n### Current Setup\n- **nix-direnv 3.1.0** is properly installed (via home-manager)\n- **Caching works**: `~/.config/direnv/lib/hm-nix-direnv.sh` provides intelligent caching\n\n### Performance Measurements\n| Scenario | Time |\n|----------|------|\n| Cache renewal | ~11 seconds |\n| Cached load | ~0.3 seconds |\n\n### Root Cause Analysis\nThe 11-second delay happens when nix-direnv **renews the cache**. This runs:\n1. `nix print-dev-env` - evaluates flake and builds dev shell\n2. `nix flake archive` - GC roots for flake inputs\n\nCache is invalidated when ANY of these files change:\n- `flake.nix`\n- `flake.lock`\n- `~/.direnvrc`\n- `~/.config/direnv/direnvrc`\n\n### What's Already Optimized\n1. ‚úÖ nix-direnv caching (avoids re-evaluation on every shell)\n2. ‚úÖ flake.lock pins inputs (avoids network fetches)\n3. ‚úÖ Simple devShell (only essential packages)\n\n### Potential Optimizations\n\n**A. Enable Nix daemon mode** (if not already)\n```bash\n# Check if nix daemon is running\nlaunchctl list | grep nix\n```\nDaemon mode shares build cache across users/sessions.\n\n**B. Use nix-community/nix-index-database for faster package lookups**\nCurrently not relevant as we're not doing package searches.\n\n**C. Consider devenv.sh instead of raw nix flakes**\ndevenv has faster caching and simpler syntax, but adds dependency.\n\n**D. Profile what's slow in the flake**\n```bash\ntime nix eval .#devShells.aarch64-darwin.default --json\n```\n\n### Conclusion\n**The setup is already well-optimized.** The 11-second delay is inherent to Nix flake evaluation when the cache needs renewal. This only happens when:\n- flake.nix/flake.lock changes\n- First shell in a worktree (no .direnv cache)\n- Nix store garbage collection removes cached derivations\n\n**Recommendation**: No changes needed. The 0.3s cached load time is excellent.\nIf user wants sub-second cold start, would need to abandon Nix for simpler tooling.","acceptance_criteria":"- [x] Document current performance (cold vs cached)\n- [x] Identify root cause of slow loads\n- [x] Determine if nix-direnv caching is working\n- [x] Evaluate optimization options\n- [x] Make recommendation","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-12-19T12:41:03.080068+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T12:45:57.492013+11:00","close_reason":"Investigation complete: .envrc load time is already optimized. Cached loads take 0.3s (excellent). The 11s delay only occurs during cache renewal (flake.nix/lock changes, new worktrees, or post-GC). nix-direnv 3.1.0 is properly configured via home-manager. No changes recommended.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-x9m3","title":"watch for claude settings updates and merge in","description":"i want az to track/watch worktree .claude/settings.local.json files and merge any new permissons they come up with into the worktree's .claude/settings.json file","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T11:29:39.903254+11:00","updated_at":"2026-01-02T11:29:39.903254+11:00"}
{"id":"az-xe2h","title":"tui_core: FrameBuffer - 2D cell grid with hex color support","description":"Port OpenTUI's FrameBuffer concept to Gleam.\n\n## What\nA 2D array of cells where each cell has:\n- Character (grapheme)\n- Foreground color (uses Color type from az-hkfa)\n- Background color\n- Attributes (bold, dim, underline, etc.)\n\n## API (Gleam)\n```gleam\ntype Cell { \n  Cell(\n    char: String, \n    fg: Color,      // From tui_core/color\n    bg: Color, \n    attrs: Attrs,   // Bitflags: Bold | Dim | Underline | Italic\n  ) \n}\n\ntype FrameBuffer { \n  FrameBuffer(\n    width: Int, \n    height: Int, \n    cells: Array(Cell),\n    dirty: Set(Int),  // Track which cells changed for efficient diff\n  ) \n}\n\nfn new(width: Int, height: Int) -\u003e FrameBuffer\nfn set_cell(fb: FrameBuffer, x: Int, y: Int, cell: Cell) -\u003e FrameBuffer\nfn get_cell(fb: FrameBuffer, x: Int, y: Int) -\u003e Cell\nfn fill_rect(fb: FrameBuffer, x: Int, y: Int, w: Int, h: Int, cell: Cell) -\u003e FrameBuffer\nfn draw_text(fb: FrameBuffer, x: Int, y: Int, text: String, fg: Color, bg: Color) -\u003e FrameBuffer\nfn clear(fb: FrameBuffer) -\u003e FrameBuffer\nfn resize(fb: FrameBuffer, width: Int, height: Int) -\u003e FrameBuffer\nfn get_dirty_cells(fb: FrameBuffer) -\u003e List(#(Int, Int, Cell))\nfn clear_dirty(fb: FrameBuffer) -\u003e FrameBuffer\n```\n\n## Dependencies\n- az-hkfa: Color utilities (for Color type)\n\n## Reference\n- OpenTUI FrameBuffer: packages/core/src/buffer.ts\n\n## Acceptance Criteria\n- [ ] Cell type with char, colors, and attributes\n- [ ] Efficient 2D array storage (consider flat array with index calculation)\n- [ ] Basic drawing operations work correctly\n- [ ] Dirty cell tracking for efficient re-rendering\n- [ ] Bounds checking on all operations","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:26:07.426801+11:00","updated_at":"2025-12-30T00:29:51.437965+11:00","closed_at":"2025-12-30T00:29:51.437965+11:00","close_reason":"Implemented framebuffer.gleam with Cell, Attrs, FrameBuffer types. Features: new, get/set_cell, clear, resize, fill_rect, draw_text (Unicode-aware), dirty tracking. Build verified.","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-xe2h","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.590844+11:00","created_by":"daemon"},{"issue_id":"az-xe2h","depends_on_id":"az-hkfa","type":"blocks","created_at":"2025-12-28T11:33:58.159957+11:00","created_by":"daemon"}]}
{"id":"az-xi1r","title":"i want to enable the user to use claude code competitors","description":"e.g. they can configure to use opencode instead. we can just allow this one for now","design":"## Implementation Plan: CLI Tool Abstraction Layer + Settings UI\n\n### Overview\nCreate a structured CLI tool abstraction that allows users to switch between `claude` and `opencode`. The abstraction handles tool-specific command construction, flag mappings, model configuration, and leverages OpenCode's richer event system for better session status detection. Additionally, add an in-app settings overlay accessible via Ctrl+, for configuring these options.\n\n### Key Design Decisions\n\n1. **Scope**: Per-project config, applies to NEW sessions only\n2. **Architecture**: Full abstraction layer with tool-specific behaviors\n3. **Config Style**: Structured selector with validation\n4. **Model Config**: Add global model preference to config\n5. **Settings UI**: Ctrl+, opens extensible settings overlay\n\n---\n\n### NEW: Settings Overlay (Ctrl+,)\n\n**Trigger:** `Ctrl+,` (like VS Code) in normal mode\n\n**Design Goals:**\n- Extensible section-based layout for future config options\n- Live config updates (writes to `.azedarach.json`)\n- Escape to dismiss, Tab to navigate sections\n\n**Initial Sections:**\n1. **AI Tool** - Select CLI tool (claude/opencode)\n2. **Model** - Configure default and chat models\n\n**Future Sections (extensible):**\n- Session (shell, tmux prefix, permissions)\n- Git (auto-PR, branch naming)\n- UI (theme, keybindings)\n- Beads (sync behavior)\n\n**UI Layout:**\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ AI Tool ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ  CLI Tool:    [claude ‚ñº]                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ               claude | opencode           ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ Model ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ  Default:     [sonnet_____________]       ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  Chat:        [haiku______________]       ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ                                                  ‚îÇ\n‚îÇ  [Tab] Next section  [Enter] Edit  [Esc] Close  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**Keyboard Handling:**\n| Key | Action |\n|-----|--------|\n| Escape | Close settings, save changes |\n| Tab / Shift+Tab | Navigate between fields |\n| Enter | Edit current field (opens selector/input) |\n| j/k | Navigate within section |\n| h/l | Change enum value (claude ‚Üî opencode) |\n\n**Implementation Files:**\n\n1. **NEW: `src/ui/SettingsOverlay.tsx`**\n   - Main settings overlay component\n   - Section-based layout with collapsible groups\n   - Uses `currentOverlayAtom` for state\n\n2. **NEW: `src/ui/settings/SettingsSection.tsx`**\n   - Reusable section container\n   - Header with title, collapsible content\n\n3. **NEW: `src/ui/settings/SettingField.tsx`**\n   - Field types: `select`, `text`, `toggle`\n   - Handles focus state and editing\n\n4. **MODIFY: `src/services/OverlayService.ts`**\n   - Add `{ _tag: \"settings\" }` to Overlay union\n\n5. **MODIFY: `src/services/keyboard/bindings.ts`**\n   - Add `C-,` binding in normal mode\n\n6. **MODIFY: `src/ui/hooks/useOverlays.ts`**\n   - Add `showSettings()` action and `showingSettings` flag\n\n7. **NEW: `src/services/SettingsService.ts`**\n   - Read/write `.azedarach.json`\n   - Validate changes against schema\n   - Publish config changes to subscribers\n\n**Settings State:**\n```typescript\ninterface SettingsState {\n  focusedSection: number      // 0 = AI Tool, 1 = Model\n  focusedField: number        // Field within section\n  editingField: boolean       // Input mode active\n  pendingChanges: Partial\u003cAppConfig\u003e  // Unsaved changes\n}\n```\n\n**SettingsService API:**\n```typescript\nexport class SettingsService extends Effect.Service\u003cSettingsService\u003e()(\"SettingsService\", {\n  effect: Effect.gen(function* () {\n    const configPath = yield* resolveConfigPath()\n    const config = yield* SubscriptionRef.make\u003cAppConfig\u003e(defaultConfig)\n    \n    return {\n      config,  // Reactive config state\n      \n      load: () =\u003e Effect.gen(function* () {\n        const raw = yield* readJsonFile(configPath)\n        const parsed = yield* Schema.decode(AppConfigSchema)(raw)\n        yield* SubscriptionRef.set(config, parsed)\n      }),\n      \n      update: \u003cK extends keyof AppConfig\u003e(key: K, value: AppConfig[K]) =\u003e\n        Effect.gen(function* () {\n          yield* SubscriptionRef.update(config, (c) =\u003e ({ ...c, [key]: value }))\n          yield* writeJsonFile(configPath, yield* SubscriptionRef.get(config))\n        }),\n      \n      getField: \u003cK extends keyof AppConfig\u003e(key: K) =\u003e\n        SubscriptionRef.get(config).pipe(Effect.map((c) =\u003e c[key]))\n    }\n  })\n}) {}\n```\n\n---\n\n### Model Configuration\n\n**Current State:**\n- Models only passed per-session via `StartSessionOptions.model`\n- Chat sessions hardcoded to `haiku`\n- No global config option\n\n**Proposed Config:**\n```typescript\nconst AppConfigSchema = Schema.Struct({\n  cliTool: Schema.optional(Schema.Literal(\"claude\", \"opencode\")),\n  \n  model: Schema.optional(Schema.Struct({\n    default: Schema.optional(Schema.String),\n    chat: Schema.optional(Schema.String),\n  })),\n  \n  session: Schema.Struct({ /* existing */ }),\n})\n```\n\n**Model Format Per Tool:**\n| Tool | Format | Examples |\n|------|--------|----------|\n| Claude | Short name | `haiku`, `sonnet`, `opus` |\n| OpenCode | Provider/model | `anthropic/claude-sonnet`, `openai/gpt-4o` |\n\n---\n\n### Hook System Comparison\n\n| Claude Code | OpenCode | Purpose |\n|-------------|----------|---------|\n| `.claude/settings.json` hooks | `.opencode/plugin/` JS modules | Config location |\n| `SessionStart` | `session.created` | Run `bd prime` at start |\n| `PreToolUse` | `tool.execute.before` | Block/modify tool calls |\n| `PreCompact` | `session.compacted` | Pre-compaction hooks |\n\n---\n\n### OpenCode Superior Status Detection\n\nOpenCode's plugin events enable **much better session status tracking**:\n\n| Status | Claude Code Detection | OpenCode Detection |\n|--------|----------------------|-------------------|\n| `busy` | Hook signal OR PTY pattern | `tool.execute.before` + `message.updated` |\n| `idle` | Hook signal OR PTY \"Done.\" | `session.idle` event (definitive!) |\n| `waiting` | Hook signal OR PTY `[y/n]` | `permission.updated` event (definitive!) |\n| `error` | Hook signal OR PTY \"Error:\" | `session.error` event (definitive!) |\n\n---\n\n### Architecture\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    CliToolRegistry                           ‚îÇ\n‚îÇ  Maps tool names ‚Üí CliToolDefinition                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                          ‚îÇ\n                          ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                   CliToolDefinition                          ‚îÇ\n‚îÇ  - name: \"claude\" | \"opencode\"                              ‚îÇ\n‚îÇ  - executable: string                                        ‚îÇ\n‚îÇ  - buildCommand(opts): string                                ‚îÇ\n‚îÇ  - modelFlag: (model) =\u003e string                              ‚îÇ\n‚îÇ  - modelFormat: \"short\" | \"provider/model\"                   ‚îÇ\n‚îÇ  - hookConfigDir: \".claude\" | \".opencode\"                    ‚îÇ\n‚îÇ  - statusDetection: \"hooks+pty\" | \"events\"                   ‚îÇ\n‚îÇ  - sessionNamePrefix: \"claude\" | \"opencode\"                  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Complete File Changes\n\n**Core:**\n1. **NEW: `src/core/CliToolRegistry.ts`** - Tool definitions + command builders\n2. **MODIFY: `src/config/schema.ts`** - Add `cliTool`, `model.default`, `model.chat`\n3. **MODIFY: `src/config/defaults.ts`** - Default values\n4. **MODIFY: `src/core/ClaudeSessionManager.ts` ‚Üí `SessionManager.ts`** - Use registry\n5. **MODIFY: `src/core/TmuxSessionMonitor.ts`** - Tool-specific prefixes\n\n**Settings UI:**\n6. **NEW: `src/services/SettingsService.ts`** - Config read/write/subscribe\n7. **NEW: `src/ui/SettingsOverlay.tsx`** - Main settings UI\n8. **NEW: `src/ui/settings/SettingsSection.tsx`** - Section container\n9. **NEW: `src/ui/settings/SettingField.tsx`** - Field components\n10. **MODIFY: `src/services/OverlayService.ts`** - Add settings overlay type\n11. **MODIFY: `src/services/keyboard/bindings.ts`** - Add Ctrl+, binding\n12. **MODIFY: `src/services/keyboard/InputHandlersService.ts`** - Settings input handling\n13. **MODIFY: `src/ui/hooks/useOverlays.ts`** - Add showSettings\n14. **MODIFY: `src/ui/App.tsx`** - Render SettingsOverlay\n\n**OpenCode Support:**\n15. **NEW: Template `.opencode/plugin/azedarach.js`** - Status events + hooks\n\n**Documentation:**\n16. **MODIFY: `docs/keybindings.md`** - Add Ctrl+, to docs\n17. **MODIFY: `docs/README.md`** - Document CLI tool and model config\n\n### Usage Examples\n\n**.azedarach.json (Claude):**\n```json\n{\n  \"cliTool\": \"claude\",\n  \"model\": {\n    \"default\": \"sonnet\",\n    \"chat\": \"haiku\"\n  }\n}\n```\n\n**.azedarach.json (OpenCode):**\n```json\n{\n  \"cliTool\": \"opencode\",\n  \"model\": {\n    \"default\": \"anthropic/claude-sonnet\",\n    \"chat\": \"anthropic/claude-haiku\"\n  }\n}\n```\n\n### Acceptance Criteria\n\n- [ ] User can set `cliTool: \"opencode\"` in config\n- [ ] User can set `model.default` and `model.chat` in config\n- [ ] Ctrl+, opens settings overlay\n- [ ] Settings overlay shows AI Tool and Model sections\n- [ ] Changes persist to `.azedarach.json`\n- [ ] New sessions spawn with correct CLI tool and model\n- [ ] Existing sessions unaffected by config changes\n- [ ] Session naming uses tool prefix (claude-xxx vs opencode-xxx)\n- [ ] OpenCode plugin template provided for status events\n- [ ] Type-safe config with validation errors\n- [ ] Documentation updated","notes":"## Session 2 Progress (2025-12-22)\n\n### Completed ‚úì\n\n**OpenCode Plugin Ecosystem:**\n1. ‚úì Discovered existing `opencode-beads` plugin (handles bd prime, /bd-* commands)\n2. ‚úì Created `.opencode/plugin/azedarach.js` for session status monitoring\n3. ‚úì Installed globally at `~/.config/opencode/plugin/azedarach.js`\n\n**Skills Integration:**\n4. ‚úì Created `scripts/generate-opencode-skills.sh` - converts Claude skills to OpenCode format\n5. ‚úì Generated 19 skill wrappers for Chefy\n6. ‚úì Generated skill wrappers for Azedarach\n\n**CLI Command:**\n7. ‚úì Added `az opencode init` command for easy project setup\n   - Creates/updates opencode.json\n   - Checks global plugin installation\n   - Generates skill wrappers\n\n**Project Setup:**\n8. ‚úì Azedarach: opencode.json, AGENTS.md, skills\n9. ‚úì Chefy: opencode.json, skills, plugin\n\n### Remaining\n\n- [ ] Settings UI (Ctrl+, overlay) - lower priority\n- [ ] Consider publishing azedarach plugin to npm\n\n### Key Files\n\n- `.opencode/plugin/azedarach.js` - Session status plugin\n- `scripts/generate-opencode-skills.sh` - Skill generator\n- `src/cli/index.ts` - Added opencodeCommand","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T23:12:20.614607+11:00","updated_at":"2026-01-04T13:23:37.333055+11:00","closed_at":"2026-01-04T13:23:37.333059+11:00"}
{"id":"az-xi5","title":"SessionManager - Claude session orchestration","description":"Core orchestration: spawn Claude in tmux sessions, manage lifecycle, coordinate with worktrees.","design":"- Define SessionManager as Effect.Service\n- Depends on: WorktreeManager, TmuxService, BeadsClient, StateDetector, FileLockManager\n- Methods return Effect with typed errors:\n  - start(beadId): Effect\u003cSession, SessionError | WorktreeError\u003e\n  - stop(beadId): Effect\u003cvoid, SessionError\u003e\n  - pause(beadId): Effect\u003cvoid, SessionError\u003e // Ctrl+C, WIP commit\n  - resume(beadId): Effect\u003cvoid, SessionError\u003e\n  - getState(beadId): Effect\u003cSessionState, SessionError\u003e\n  - listActive(): Effect\u003cSession[], never\u003e\n- Use Effect.gen for orchestration flow\n- Use PubSub for state change events\n- Track sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- Create SessionManagerLive layer that composes dependencies","notes":"Implemented SessionManager service in src/core/SessionManager.ts following Effect service pattern.\n\nKey implementation details:\n- Service interface with 7 methods: start, stop, pause, resume, getState, listActive, updateState, subscribeToStateChanges\n- Uses Effect.gen pattern for orchestration\n- Composes WorktreeManager, TmuxService, BeadsClient, and StateDetector services\n- Tracks sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- PubSub for state change events\n- SessionManagerLive layer with all dependencies included\n- All methods require CommandExecutor in context (provided by BunContext layer)\n- Type-safe error handling with typed error unions\n- Comprehensive JSDoc documentation\n\nThe start() method creates worktree, spawns tmux session, and launches Claude.\nThe pause() method sends Ctrl+C and creates WIP commit.\nThe stop() method kills tmux session.\n\nAll types pass strict TypeScript checking (pnpm type-check).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.82144+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T10:32:34.049829+11:00","dependencies":[{"issue_id":"az-xi5","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.3385+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-om3","type":"blocks","created_at":"2025-12-11T14:46:26.452316+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-kis","type":"blocks","created_at":"2025-12-11T14:46:26.845057+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-a8i","type":"blocks","created_at":"2025-12-11T14:46:27.560945+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-xmj","title":"something is wrong with create task with claude STILL","description":"redesign the feature from the ground up cause we have tried to fix it 3 times already","notes":"Starting redesign with \"Direct bd create\" approach: Claude extracts structured data (title/type/priority) from natural language, then we call bd create directly. No more Claude CLI tool execution.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:05.459264+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T17:23:32.780765+11:00","close_reason":"Redesigned \"Create Task with Claude\" feature using two-phase approach: (1) Claude extracts structured JSON data from natural language, (2) BeadsClient.create() is called directly. This eliminates the unreliable CLI tool execution and output parsing.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-xoz","title":"fix action mode delete bead keybind","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:25:22.242622+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-15T01:37:29.061321+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-xqc2","title":"Check for uncommitted changes before Space+m merge to prevent autostash conflicts","description":"When `merge.autostash=true` is configured in git, uncommitted changes get stashed before merge and auto-popped after. If the stash pop conflicts with merged content, you get a stash conflict that the current `checkMergeConflicts()` (git merge-tree) can't detect.\n\nAdd a pre-merge check in the Space+m handler to detect uncommitted changes and warn the user before proceeding.","design":"1. Before calling `checkMergeConflicts()`, run `git status --porcelain` in the worktree\n2. If there are uncommitted changes (modified/added/deleted files), show a confirmation dialog:\n   - \"Uncommitted changes detected in worktree. With autostash enabled, these may conflict after merge. Commit changes first?\"\n   - Options: \"Commit \u0026 Merge\" / \"Merge Anyway\" / \"Cancel\"\n3. \"Commit \u0026 Merge\" option: stage all + commit with message like \"WIP: uncommitted changes before merge\" then proceed\n4. \"Merge Anyway\" lets user proceed at their own risk\n\nAlternative: Just block merge if uncommitted changes exist and show toast \"Commit changes before merging\"","acceptance_criteria":"- [ ] Space+m checks for uncommitted changes in worktree before merge\n- [ ] Shows warning/confirmation if uncommitted changes exist\n- [ ] Prevents autostash conflict scenario\n- [ ] Test with `merge.autostash=true` configured","status":"closed","priority":2,"issue_type":"feature","assignee":"claude","created_at":"2025-12-18T16:14:34.913357+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:29.667417+11:00","close_reason":"Implemented uncommitted changes check before Space+m merge. Shows confirmation dialog when uncommitted changes detected in worktree, preventing autostash conflicts.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-xqvh","title":"Extend BeadsClient schema with dependency fields","description":"Update IssueSchema in BeadsClient.ts to include:\n- `dependent_count: Schema.Number.pipe(Schema.optional)`\n- `dependency_count: Schema.Number.pipe(Schema.optional)`\n- `dependents: Schema.Array(DependencyRefSchema).pipe(Schema.optional)`\n- `dependencies: Schema.Array(DependencyRefSchema).pipe(Schema.optional)`\n\nCreate DependencyRefSchema with: id, title, status, dependency_type, issue_type (optional)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T01:43:01.855608+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T10:34:31.113453+11:00","close_reason":"Added DependencyRefSchema and dependency fields (dependent_count, dependency_count, dependents, dependencies) to IssueSchema","dependencies":[{"issue_id":"az-xqvh","depends_on_id":"az-7sr","type":"parent-child","created_at":"2025-12-19T01:43:21.510037+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-xrjk","title":"Add project context to progress view for cross-project visibility","description":"Enhance progress visibility to show which project each operation targets.\n\n**Current state:**\n- CommandQueueService tracks running/queued ops per taskId\n- No visibility into which project the op targets\n- Can't tell if ops from different projects are running\n\n**Enhancements:**\n\n1. **Extend QueuedCommand with projectPath**\n```typescript\ninterface QueuedCommand {\n  id: string\n  taskId: string\n  projectPath: string  // ‚Üê ADD\n  label: string\n  queuedAt: Date\n}\n```\n\n2. **Progress atoms**\n```typescript\n// Ops for current project\nexport const currentProjectOpsAtom = Atom.readable((get) =\u003e {\n  const projectPath = get(currentProjectPathAtom)\n  const ops = get(allOpsAtom)\n  return ops.filter(op =\u003e op.projectPath === projectPath)\n})\n\n// All ops across all projects  \nexport const allProjectOpsAtom = ...\n\n// Ops for \"other\" projects (not current)\nexport const backgroundProjectOpsAtom = ...\n```\n\n3. **UI indicator**\n- Status bar: \"2 ops running (1 in other project)\"\n- Progress overlay: Group by project\n- Visual indicator when op targets different project\n\n4. **Cross-project notification**\n- When op completes for non-current project\n- Toast with project name? \"Merge completed (in ProjectA)\"","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-01T22:06:56.994893+11:00","updated_at":"2026-01-01T22:19:56.866121+11:00","dependencies":[{"issue_id":"az-xrjk","depends_on_id":"az-67fc","type":"parent-child","created_at":"2026-01-01T22:07:11.343948+11:00","created_by":"daemon"},{"issue_id":"az-xrjk","depends_on_id":"az-jb2v","type":"blocks","created_at":"2026-01-01T22:07:22.830329+11:00","created_by":"daemon"}]}
{"id":"az-xw8","title":"Generate hooks config when spawning sessions","description":"SessionManager generates .claude/hooks.json in worktree when spawning sessions. Hooks auto-sync beads on Stop event and update issue notes. Pure bash-based automation without MCP overhead.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:25:00.000819+11:00","updated_at":"2025-12-12T13:25:20.656259+11:00","dependencies":[{"issue_id":"az-xw8","depends_on_id":"az-aiu","type":"blocks","created_at":"2025-12-12T13:25:32.748995+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-xxvo","title":"something is running bd prime in the terminal as part of initCommands which does nothing","description":"i think we bd prime in the az opencode plugin so no need for whatever this thing is","design":"Remove redundant bd prime from OpenCode initCommands since opencode-beads plugin handles this automatically. Will modify CliToolRegistry.ts getInitCommands for opencode tool to return empty array instead of ['bd prime']. This eliminates duplicate bd prime calls during session startup.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:16:28.433039+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-22T12:58:35.437367+11:00","close_reason":"Fixed redundant bd prime execution in OpenCode sessions. Removed manual bd prime from CliToolRegistry.ts initCommands since opencode-beads plugin handles this automatically.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-y6n","title":"up arrow in compact view moves a whole page up not a single task up","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:08:27.533042+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T10:27:38.776471+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-y86k","title":"Audit CommandQueue/MutationQueue ops for project context handling","description":"Audit ALL operations that go through CommandQueueService and MutationQueue to categorize their current context handling:\n\n**CommandQueueService operations (via `withQueue`):**\n\n| Operation | File:Line | Context Capture | Status |\n|-----------|-----------|-----------------|--------|\n| merge | PRHandlersService:70-80 | INSIDE effect (getProjectPath) | ‚ùå BUGGY |\n| cleanup | PRHandlersService:94-104 | BEFORE withQueue (param) | ‚úÖ OK |\n| update | PRHandlersService:143-156 | INSIDE effect (getProjectPath) | ‚ùå BUGGY |\n| create-pr | PRHandlersService:235-245 | BEFORE withQueue | ‚úÖ OK |\n| abort-merge | PRHandlersService:548-558 | INSIDE effect (getProjectPath) | ‚ùå BUGGY |\n| start | SessionHandlersService:96-103 | BEFORE withQueue | ‚úÖ OK |\n| stop | SessionHandlersService:567-576 | N/A (no project needed) | ‚úÖ OK |\n\n**MutationQueue operations:**\n\n| Operation | Context Capture | Status |\n|-----------|-----------------|--------|\n| Move | NEVER (beadsClient uses live) | ‚ùå BUGGY |\n| Update | NEVER (beadsClient uses live) | ‚ùå BUGGY |\n| Delete | NEVER (beadsClient uses live) | ‚ùå BUGGY |\n\n**BeadsClient context resolution:**\n- `BeadsClient.ts:581-582` - `getEffectiveCwd()` queries live `projectService.getCurrentPath()`\n- All methods accept optional `cwd` param but most callers don't pass it\n\n**Deliverable:** Confirmed list of all operations needing fixes, with exact line numbers.","design":"## Audit Complete - Confirmed Findings\n\n### PRHandlersService Operations (via `withQueue`)\n\n| Operation | Line | Context Capture | Timing | Status |\n|-----------|------|-----------------|--------|--------|\n| merge (via doMerge) | 70-86 | INSIDE effect (line 78) | ‚ùå Late-bound | BUGGY |\n| cleanup (via doCleanup) | 94-108 | BEFORE withQueue (line 424, passed as param) | ‚úÖ Early-bound | OK |\n| update (updateFromBase) | 144-158 | INSIDE effect (line 151) | ‚ùå Late-bound | BUGGY |\n| create-pr | 236-255 | BEFORE withQueue (line 200) | ‚úÖ Early-bound | OK |\n| abort-merge | 549-566 | INSIDE effect (line 556) | ‚ùå Late-bound | BUGGY |\n| bulk cleanup (onWorktreeOnly) | 465-488 | Uses captured projectPath (line 424) | ‚úÖ Early-bound | OK |\n| bulk cleanup (onFullCleanup) | 490-514 | Uses captured projectPath (line 424) | ‚úÖ Early-bound | OK |\n\n**Note:** merge/updateFromBase also capture path for pre-checks (lines 309, 321-323, 360-364) BEFORE queue, but doMerge recaptures INSIDE.\n\n### SessionHandlersService Operations (via `withQueue`)\n\n| Operation | Line | Context Capture | Timing | Status |\n|-----------|------|-----------------|--------|--------|\n| start (startSession) | 96-103 | BEFORE withQueue (line 94) | ‚úÖ Early-bound | OK |\n| start (startSessionWithPrompt) | 179-199 | BEFORE withQueue (line 135) | ‚úÖ Early-bound | OK |\n| start (startSessionDangerous) | 266-287 | BEFORE withQueue (line 230) | ‚úÖ Early-bound | OK |\n| stop | 567-576 | N/A (no project path needed) | ‚úÖ N/A | OK |\n\n### MutationQueue Operations\n\n| Operation | Line | Context Capture | Status |\n|-----------|------|-----------------|--------|\n| Move | 96 | NEVER - beadsClient.update() uses live projectService | ‚ùå BUGGY |\n| Update | 81-92 | NEVER - beadsClient.update() uses live projectService | ‚ùå BUGGY |\n| Delete | 94 | NEVER - beadsClient.delete() uses live projectService | ‚ùå BUGGY |\n\n**Root cause:** `BeadsClient.ts:581-582` - `getEffectiveCwd()` queries `projectService.getCurrentPath()` at execution time, not at mutation creation time.\n\n### BeadsClient Context Resolution (core/BeadsClient.ts)\n\n```typescript\n// Line 581-582\nconst getEffectiveCwd = (explicitCwd?: string): Effect.Effect\u003cstring | undefined\u003e =\u003e\n  explicitCwd ? Effect.succeed(explicitCwd) : projectService.getCurrentPath()\n```\n\nAll BeadsClient methods accept optional `cwd` param, but:\n- MutationQueue callers never pass it (lines 81, 94, 96)\n- CommandQueueService ops sometimes pass it (when captured early) but not always\n\n### Summary of Buggy Operations\n\n**CommandQueueService (PRHandlersService):**\n1. `doMerge` - PRHandlersService.ts:78\n2. `updateFromBase` queued effect - PRHandlersService.ts:151  \n3. `abortMerge` queued effect - PRHandlersService.ts:556\n\n**MutationQueue:**\n1. All Move mutations - MutationQueue.ts:96\n2. All Update mutations - MutationQueue.ts:81\n3. All Delete mutations - MutationQueue.ts:94\n\n### Required Fixes\n\n1. **PRHandlersService** - Capture projectPath before withQueue for doMerge, updateFromBase, abortMerge\n2. **MutationQueue** - Add `projectPath: string` to Mutation type, capture at add() time, pass to beadsClient\n3. **Consider** - Removing getEffectiveCwd() fallback in BeadsClient to force explicit cwd everywhere","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T22:06:56.416173+11:00","updated_at":"2026-01-04T13:24:44.975496+11:00","closed_at":"2026-01-04T13:24:44.975496+11:00","close_reason":"Audit complete. Fixed all 6 buggy operations: 3 in PRHandlersService (doMerge, updateFromBase, abortMerge) and 3 in MutationQueue (Move, Update, Delete). All now capture projectPath at submission time.","dependencies":[{"issue_id":"az-y86k","depends_on_id":"az-67fc","type":"parent-child","created_at":"2026-01-01T22:07:10.983505+11:00","created_by":"daemon"}]}
{"id":"az-ybu6","title":"when space a detects updates in base branch it should say the base branch name","description":"currently it says hardcoded (i assume) main. i hope it uses the configured base branch and not main right?","design":"## Analysis\n\nThe issue is that when `Space+a` detects that a worktree branch is behind the base branch, the UI shows \"main\" hardcoded in multiple places instead of using the configured `git.baseBranch` value.\n\n**Good news**: The code already DOES use the configured `baseBranch` for the actual git operations! The variable is read from config at:\n- `PRWorkflow.ts:682` - `const baseBranch = gitConfig.baseBranch` \n- Used correctly in: merge operations, diff commands, fetch operations\n\n**The problem**: UI messages and overlay text are hardcoded to say \"main\":\n\n### Files to change:\n\n1. **`src/ui/MergeChoiceOverlay.tsx`** (lines 67, 88):\n   - Title: \"Branch Behind Main\" ‚Üí use dynamic baseBranch\n   - Option text: \"(pull latest main into branch)\" ‚Üí use dynamic baseBranch\n\n2. **`src/services/keyboard/SessionHandlersService.ts`** (line 371):\n   - Toast: \"Merging main into branch...\" ‚Üí use dynamic baseBranch\n\n3. **`src/services/keyboard/PRHandlersService.ts`** (lines 131, 137, 171):\n   - Toast: \"Updating from main...\" ‚Üí use dynamic baseBranch\n   - Toast: \"Updated from main\" ‚Üí use dynamic baseBranch  \n   - Toast: \"Syncing with main before PR...\" ‚Üí use dynamic baseBranch\n\n4. **`src/core/PRWorkflow.ts`** (lines 1570, 1583, 1593):\n   - `checkBranchBehindMain` method uses hardcoded \"main\" in git rev-list commands\n   - Method name itself says \"Main\" but should be \"Base\"\n   - Also `mergeMainIntoBranch` has similar issues (lines 1612, 1650, etc.)\n\n## Implementation Plan\n\n1. **PRHandlersService**: Already has `gitConfig.baseBranch` available - just use it in toast messages\n\n2. **SessionHandlersService**: Need to get `gitConfig` from `AppConfig` service (already injected) and use it\n\n3. **PRWorkflow**: The `checkBranchBehindMain` and `mergeMainIntoBranch` methods use hardcoded \"main\" - should use `baseBranch` variable that's already defined at service level\n\n4. **MergeChoiceOverlay**: This is trickier - the component receives `commitsBehind` but not the branch name. Need to either:\n   - Pass `baseBranch` through the overlay props\n   - Or create an atom that exposes the configured base branch\n\nApproach: Extend the `mergeChoice` overlay type to include `baseBranch` field, then pass it from SessionHandlersService when pushing the overlay.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T04:22:17.539974+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T01:19:35.491178+11:00","close_reason":"Fixed: UI now displays configured git.baseBranch instead of hardcoded 'main' in all merge-related messages and overlays","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-yeez","title":"Create Gas Town integration epic","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-05T00:41:04.637835+11:00","updated_at":"2026-01-05T00:41:04.637835+11:00","dependencies":[{"issue_id":"az-yeez","depends_on_id":"az-6rkz","type":"blocks","created_at":"2026-01-05T00:41:10.308464+11:00","created_by":"riordan"},{"issue_id":"az-yeez","depends_on_id":"az-9e4q","type":"blocks","created_at":"2026-01-05T00:41:12.668013+11:00","created_by":"riordan"},{"issue_id":"az-yeez","depends_on_id":"az-46ed","type":"blocks","created_at":"2026-01-05T00:42:24.495766+11:00","created_by":"riordan"},{"issue_id":"az-yeez","depends_on_id":"az-ll34","type":"blocks","created_at":"2026-01-05T00:42:33.252992+11:00","created_by":"riordan"}]}
{"id":"az-yf4","title":"PRWorkflow - automated GitHub PR creation","description":"Automate PR creation when tasks complete using gh CLI.\n\nDesign:\n- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, WorktreeManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n\nMethods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n  - cleanup(beadId): Effect\u003cvoid, GitError\u003e -- NEW\n\nWorkflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n\nPR body template includes bead description, acceptance criteria.\nLink PR back to bead via bd update --notes.\nUse Effect.retry with Schedule for transient failures.\n\n**Cleanup after merge:**\n  1. Ensure session is stopped\n  2. WorktreeManager.remove() - delete worktree directory\n  3. git push origin --delete \u003cbranch\u003e - delete remote branch\n  4. git branch -D \u003cbranch\u003e - delete local branch\n  5. bd close \u003cbeadId\u003e - mark task complete\n\nThis cleanup function will also be exposed for manual use (az-6t6).","design":"- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n- Methods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n- Workflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n- PR body template includes bead description, acceptance criteria\n- Link PR back to bead via bd update --notes\n- Use Effect.retry with Schedule for transient failures","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.509773+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T12:30:29.541722+11:00","dependencies":[{"issue_id":"az-yf4","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.444969+11:00","created_by":"daemon"},{"issue_id":"az-yf4","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.29207+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-yhc4","title":"space m should inform the user if there are uncommitted changes (other than beads)","description":"* in the worktree","design":"## Design\n\n### Current Behavior\n- `Space+m` (merge to main) calls `PRWorkflow.checkUncommittedChanges()` before merging\n- This returns ALL uncommitted files from `git status --porcelain`\n- If any uncommitted files exist, a confirmation dialog is shown warning about autostash risks\n\n### Problem\n- Beads files (`.beads/issues.jsonl`, etc.) are frequently modified during normal operation\n- These changes are expected and handled separately via `bd sync`\n- Users get warnings about beads changes even when there are no actual code changes\n\n### Solution\nModify `PRWorkflow.checkUncommittedChanges()` to filter out beads-related files:\n\n1. **Filter logic**: Exclude files matching `.beads/**` from the changed files list\n2. **Return separate counts**: Return both `hasUncommittedChanges` (non-beads) and full list for transparency\n3. **UI message**: When only beads files are uncommitted, don't show the warning\n\n### Implementation Steps\n1. In `PRWorkflow.checkUncommittedChanges()`:\n   - After parsing `git status --porcelain` output\n   - Filter out files starting with `.beads/`\n   - Return filtered result for `hasUncommittedChanges` check\n\n2. In `PRHandlersService.mergeToMain()`:\n   - The existing logic already handles the result correctly\n   - No changes needed - the filtered results will automatically not trigger the warning\n\n### Files to Modify\n- `src/core/PRWorkflow.ts` - `checkUncommittedChanges()` method (lines ~1333-1366)","acceptance_criteria":"- [ ] `Space+m` does NOT warn when only `.beads/` files are uncommitted\n- [ ] `Space+m` still warns when actual code files are uncommitted\n- [ ] The warning message still shows the uncommitted non-beads files accurately\n- [ ] Beads sync operations are unaffected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:38:49.204913+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-21T03:38:51.051836+11:00","close_reason":"Implemented filter to exclude .beads/ files from uncommitted changes check in Space+m merge workflow","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-ykth","title":"add tmux hotkey that switches between dev server and claude tmux sessions in same worktree","description":"a global tmux hotkey like we did ctrl a a","design":"## Design: Tmux Claude/Dev Server Toggle Hotkey\n\n### Overview\nAdd a global tmux hotkey (`Ctrl-a Tab`) that switches between a Claude session and its corresponding dev server session in the same worktree.\n\n### Session Naming Convention (existing)\n- Claude sessions: `\u003cbeadId\u003e` (e.g., `az-ykth`)\n- Dev server sessions: `az-dev-\u003cbeadId\u003e` (e.g., `az-dev-az-ykth`)\n\n### Implementation Approach\n\n**1. Toggle Logic (inline shell script)**\nThe keybinding runs a shell script that:\n1. Gets current session name via `tmux display-message -p '#S'`\n2. Determines if we're in a Claude session or dev server session\n3. Computes the target session name\n4. Checks if target session exists\n5. Either switches to it or displays a message\n\n```bash\n# Pseudocode\ncurrent=$(tmux display-message -p '#S')\nif [[ $current == az-dev-* ]]; then\n  # In dev server ‚Üí switch to Claude\n  target=\"${current#az-dev-}\"\nelse\n  # In Claude ‚Üí switch to dev server\n  target=\"az-dev-$current\"\nfi\n\nif tmux has-session -t \"$target\" 2\u003e/dev/null; then\n  tmux switch-client -t \"$target\"\nelse\n  tmux display-message \"No matching session: $target\"\nfi\n```\n\n**2. Auto-injection Location**\nInject the keybinding in `TmuxService.newSession()` after creating the session, using:\n```bash\ntmux bind-key -T prefix Tab run-shell '\u003ctoggle-script\u003e'\n```\n\nThe `-T prefix` ensures it's bound under the prefix key (Ctrl-a).\n\n**3. Fallback Behavior**\n- If target session doesn't exist: Show tmux message \"No dev server running\" or \"No Claude session\"\n- Auto-starting dev server is complex (requires knowing project path) - defer to v2\n\n### Files to Modify\n1. `src/core/TmuxService.ts` - Add keybinding injection in `newSession()`\n2. `docs/tmux-config.md` - Document the new hotkey\n\n### Why This Approach\n- **Stateless**: The toggle logic doesn't require any state - just session naming conventions\n- **Universal**: Works from any tmux client attached to these sessions\n- **Simple**: Single keybinding, no external scripts to install\n- **Idempotent**: Safe to call multiple times (just sets the same binding)","acceptance_criteria":"- [ ] `Ctrl-a Tab` toggles between Claude session (e.g., `az-ykth`) and its dev server (`az-dev-az-ykth`)\n- [ ] Works from both Claude and dev server sessions\n- [ ] Shows informative message when target session doesn't exist\n- [ ] Keybinding is auto-installed when sessions are created\n- [ ] Documentation updated in tmux-config.md","notes":"## Implementation Complete\n\n### Changes Made\n1. **TmuxService.ts** (line 52-70): Added keybinding injection in `newSession()` that binds `Ctrl-a Tab` to a shell script that toggles between Claude and dev server sessions\n\n2. **tmux-config.md**: Added new hotkey to the cheatsheet and workflow tips section\n\n3. **keybindings.md**: Updated tmux navigation section with the new toggle and navigation flow\n\n### How It Works\n- Session naming convention: Claude uses `\u003cbeadId\u003e`, dev server uses `az-dev-\u003cbeadId\u003e`\n- The toggle script detects which session type you're in and computes the counterpart\n- If target exists: switches to it via `tmux switch-client`\n- If target doesn't exist: shows helpful message like \"No dev server (Space+r to start)\"\n\n### Testing\n- Type-check passes\n- Build succeeds\n- Manual testing needed: start a Claude session, start a dev server, try `Ctrl-a Tab`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T04:19:18.631478+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T16:00:13.078059+11:00","close_reason":"Implemented Ctrl-a Tab toggle between Claude and dev server sessions. Changes in TmuxService.ts inject the keybinding when sessions are created. Documentation updated in tmux-config.md and keybindings.md.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-yp0s","title":"allow multiple dev servers to run at once!","description":"i'm thinking we use the same tmux window for all dev servers, use tmux panels split like | not -\nopen to your recommendation though","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T18:28:09.655055+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T18:33:39.734968+11:00","close_reason":"Implemented multi-pane dev server support for beads","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-yphg","title":"prompt injection fails on some newlines","description":"```\n~/prog/azedarach-az-ktbd on Ôêò az-ktbd  via ü•ü v1.3.4 in ‚ùÑÔ∏è (nix-shell-env)\nÛ±û© claude \"work on bead az-ktbd (bug): Space+m merge fails silently - need visibl\ne error feedback\n‚àô\n‚àô ## Description\n‚àô When pressing Space+m to merge a branch to main, the operation can fail silent\nly without any visible feedback to the user. This makes debugging difficult.\n‚àô\n‚àô ## Design Notes\n‚àô ## Problem\n‚àô\n‚àô When Space+m merge fails, there's no visible indication of why. The user press\nes the keys and nothing happens - no error toast, no status message, nothing.\n‚àô\n‚àô ## Observed Failure Modes\n‚àô\n‚àô 1. **Untracked files on main blocking merge** - Git refuses to merge if untrac\nked files would be overwritten\n‚àô 2. **Task not found in board** - `getActionTargetTask()` returns undefined sil\nently\n‚àô 3. **Session state is idle** - Shows error toast but might be missed\n‚àô 4. **Merge conflict check fails** - Should show error but might not be visible\n‚àô\n‚àô ## Investigation Points\n‚àô\n‚àô 1. Check all early return paths in `PRHandlersService.mergeToMain()`:\n‚àô    - Line 253: `if (!task) return` - **SILENT**\nzsh: event not found: task)\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:15:26.227281+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-22T10:28:39.416791+11:00","close_reason":"Fixed by creating shared escapeForShellDoubleQuotes() utility that properly escapes !, `, \", $, and \\\\ for shell double-quoted strings. Consolidated duplicate escape functions into src/core/shell.ts.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-yv6x","title":"show current project name somewhere","description":"Display the current project name in the StatusBar so users always know which project they're working on.\n\nContext: The StatusBar currently shows \"azedarach\" (the app name) on the left side. We need to also show the currently selected project name from ProjectService.","design":"**Location**: StatusBar left side, after the app name \"azedarach\"\n\n**Display format**: `azedarach ‚Ä¢ project-name` (using a separator)\n- Uses the existing `currentProjectAtom` to get the project name\n- Falls back gracefully if no project is selected (shows nothing extra)\n- Subtle styling to distinguish from app name (dimmer color like subtext0)\n\n**Implementation**:\n1. Add `projectName` prop to StatusBarProps (optional string)\n2. Render project name after \"azedarach\" with a separator\n3. Update App.tsx to pass currentProject?.name to StatusBar\n\n**Files to modify**:\n- `src/ui/StatusBar.tsx` - Add projectName prop and render logic\n- `src/ui/App.tsx` - Pass projectName from currentProjectAtom","acceptance_criteria":"- [ ] Project name visible in status bar when a project is selected\n- [ ] No extra text when no project is selected\n- [ ] Updates reactively when switching projects (via ProjectSelector)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:35:35.266129+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-19T12:38:47.476303+11:00","close_reason":"Implemented: Project name now displays in StatusBar left side, replacing 'azedarach' when a project is selected. Falls back to 'azedarach' when no project. Updates reactively via currentProjectAtom.","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-z0u","title":"test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-17T00:22:01.980663+11:00","updated_at":"2025-12-17T00:22:19.310023+11:00","deleted_at":"2025-12-17T00:22:19.310023+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-z413","title":"issue with not reloading config","description":"The bug is in OfflineService.ts in the azedarach package. The service captures config values at construction time (when az starts), but these values become stale when you switch projects using gp.\n  The buggy code (in ~/.bun/install/global/node_modules/azedarach/src/services/OfflineService.ts):\n  // Lines 47-51 - Captured ONCE at service construction\n  const prConfig = yield* appConfig.getPRConfig()\n  // Line 97 - Uses stale captured value\n  isPREnabled: () =\u003e checkEnabled(prConfig.enabled)\n  search for similar failures to reload config on project switch","design":"## Root Cause\nEffect services capture config values at construction time (when `az` starts). When user switches projects via `gp`, the config values become stale because:\n1. AppConfig reloads fresh values from the new project's `.azedarach.json`\n2. But services holding old captured values still use the stale config\n\n## Affected Services\n\n### 1. OfflineService.ts (lines 48-50)\n```typescript\n// STALE: Captured once at construction\nconst gitConfig = yield* appConfig.getGitConfig()\nconst prConfig = yield* appConfig.getPRConfig()\nconst beadsConfig = yield* appConfig.getBeadsConfig()\n```\n\nUsed in:\n- `isGitPushEnabled()` ‚Üí uses `gitConfig.pushEnabled`\n- `isGitFetchEnabled()` ‚Üí uses `gitConfig.fetchEnabled`\n- `isPREnabled()` ‚Üí uses `prConfig.enabled`\n- `isBeadsSyncEnabled()` ‚Üí uses `beadsConfig.syncEnabled`\n\n### 2. NetworkService.ts (line 104)\n```typescript\n// STALE: Captured once at construction\nconst networkConfig = yield* appConfig.getNetworkConfig()\n```\n\nUsed in:\n- `checkNow()` ‚Üí uses `networkConfig.checkHost`\n- Scheduled polling loop ‚Üí uses `networkConfig.checkHost`, `networkConfig.checkIntervalSeconds`\n\n## Fix Strategy\n\n**OfflineService**: Move config fetching inside `checkEnabled()` helper:\n```typescript\nconst checkEnabled = (getConfigEnabled: () =\u003e Effect.Effect\u003cboolean\u003e): Effect.Effect\u003cEnabledStatus\u003e =\u003e\n  Effect.gen(function* () {\n    const configEnabled = yield* getConfigEnabled()\n    const online = yield* SubscriptionRef.get(network.isOnline)\n    // ... rest of logic\n  })\n\n// Usage becomes:\nisGitPushEnabled: () =\u003e checkEnabled(() =\u003e \n  Effect.map(appConfig.getGitConfig(), c =\u003e c.pushEnabled)\n),\n```\n\n**NetworkService**: Fetch config fresh in `checkNow()`, and consider if polling interval changes require service restart (likely OK to keep cached for polling since interval changes are rare and require restart anyway).\n\n## Non-Affected Services (verified OK)\n- PRHandlersService - fetches config inside methods ‚úì\n- BoardService - fetches config inside methods ‚úì\n- SessionHandlersService - fetches config inside methods ‚úì\n- All others fetch inside method Effects ‚úì","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:49:17.290504+11:00","updated_at":"2025-12-31T18:56:35.228747+11:00","closed_at":"2025-12-31T18:56:35.228747+11:00","close_reason":"Fixed stale config capture in OfflineService and NetworkService. Both now fetch config fresh on each operation to handle project switching via gp."}
{"id":"az-z4n","title":"Improve error messages with actionable guidance","description":"Current errors may be cryptic. Enhance error handling:\n\n**Error categories:**\n- Git errors ‚Üí Suggest git commands to fix (merge conflicts, dirty worktree)\n- Beads errors ‚Üí Guide to bd commands or sync issues\n- Tmux errors ‚Üí Check tmux installation, session conflicts\n- PR errors ‚Üí GitHub auth issues, branch protection rules\n\n**Implementation:**\n- Create ErrorFormatter service\n- Map error types to user-friendly messages\n- Include \"Try:\" suggestions with specific commands\n- Show in Toast with longer duration for errors\n- Option to copy error details to clipboard","notes":"Implementation complete:\\n\\n**Created ErrorFormatter service (src/services/ErrorFormatter.ts):**\\n- Registry of 30+ error formatters for all tagged error types\\n- Pattern matching within formatters for sub-cases (merge conflicts, auth issues, network errors)\\n- User-friendly messages with actionable \\\"Try:\\\" suggestions\\n- Exports: format(), formatForToast(), logFormatted(), ErrorFormatter service\\n\\n**Updated KeyboardService:**\\n- showErrorToast() now uses formatForToast() for rich error messages\\n- Merge error handling uses formatForToast()\\n\\n**Updated atoms.ts:**\\n- Task creation error uses formatForToast()\\n\\n**Updated Toast component:**\\n- Multi-line message support (for error + suggestion)\\n- Error toasts now last 8 seconds (vs 5 for info/success)\\n- Wider max width (70 chars) to accommodate suggestions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:59:45.712759+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:28:45.033741+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-z5n","title":"i feel like any beads that have a tmux session should be in progress","description":"currently you can have tmux sessions running on open/closed beads","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:35:21.548241+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-16T22:04:52.421753+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-z951","title":"Implement per-project board cache for instant switching","description":"Implement project-keyed caching so switching projects shows cached state immediately.\n\n**Current behavior:**\n- Switch project ‚Üí loading spinner ‚Üí fetch tasks ‚Üí display\n\n**Desired behavior:**\n- Switch project ‚Üí instantly show cached tasks ‚Üí background refresh ‚Üí update\n\n**Implementation:**\n\n1. **Project-keyed cache in BoardService**\n```typescript\ninterface ProjectBoardState {\n  tasks: ReadonlyArray\u003cTaskWithSession\u003e\n  lastRefreshed: DateTime\n  isRefreshing: boolean\n}\n\n// Replace single board state with per-project cache\nprojectBoards: SubscriptionRef\u003cMap\u003cstring, ProjectBoardState\u003e\u003e\n```\n\n2. **Instant switch logic**\n```typescript\nconst switchToProject = (newPath: string) =\u003e\n  Effect.gen(function* () {\n    // 1. Set current project (triggers UI update)\n    yield* projectService.setCurrentPath(newPath)\n    \n    // 2. If we have cached state, show it immediately\n    const cache = yield* getProjectCache(newPath)\n    if (cache) {\n      yield* setActiveTasks(cache.tasks)\n    }\n    \n    // 3. Trigger background refresh\n    yield* refreshProject(newPath).pipe(Effect.forkScoped)\n  })\n```\n\n3. **Cache invalidation strategy**\n- Stale after 60 seconds? Configurable?\n- Always refresh on switch but show stale first\n- Clear cache on project remove\n\n4. **Memory management**\n- Limit number of cached projects?\n- LRU eviction?\n- Or just keep all (projects are finite)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T22:06:56.880189+11:00","updated_at":"2026-01-01T22:19:56.715122+11:00","dependencies":[{"issue_id":"az-z951","depends_on_id":"az-67fc","type":"parent-child","created_at":"2026-01-01T22:07:11.272205+11:00","created_by":"daemon"},{"issue_id":"az-z951","depends_on_id":"az-mqpe","type":"blocks","created_at":"2026-01-01T22:07:22.66197+11:00","created_by":"daemon"}]}
{"id":"az-zby","title":"bd sync incorrectly tombstones issues that exist in JSONL","description":"When running `bd sync`, issues that exist in both the JSONL (from git) and the local database are incorrectly tombstoned instead of being reconciled.\n\n**Symptoms:**\n- After `bd sync`, issues disappear from the TUI/CLI\n- Database shows issues as `status='tombstone'` \n- JSONL file still contains the issues with valid status (open/closed)\n- No entries in deletions.jsonl for these tombstoned issues\n\n**Root cause hypothesis:**\nThe sync merge logic treats \"issue in JSONL but state differs from DB\" as \"deleted\" rather than \"updated from another branch\". This particularly affects issues merged from worktree branches.\n\n**Workaround:**\nManual SQL recovery to restore status from JSONL:\n```sql\nUPDATE issues SET status='\u003cjsonl_status\u003e', closed_at='\u003cjsonl_closed_at\u003e' WHERE id='\u003cid\u003e';\n```\n\n**Affected:** 21 issues in one incident (2025-12-18)","notes":"**Additional finding (2025-12-18):**\n\n`bd sync --import-only` does NOT recover tombstoned issues. It says \"8 skipped\" for issues that are tombstoned in the database but have valid status in JSONL.\n\nThe import logic appears to skip any issue that already exists in the DB, regardless of whether it's tombstoned. It should compare the JSONL status against DB status and update if JSONL has a non-tombstone status.\n\n**Affected code path:**\n- Azedarach's PRWorkflow.ts:724 calls `syncImportOnly` after git merge\n- This call is silently failing to recover tombstoned issues\n- The `Effect.catchAll(() =\u003e Effect.void)` means failures are swallowed\n\n**The fix should be in beads' import logic** - when importing from JSONL:\n1. If JSONL status is valid (not tombstone) AND DB status is tombstone\n2. Update DB to match JSONL status (un-tombstone the issue)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T02:12:15.839482+11:00","updated_at":"2025-12-18T02:16:18.616471+11:00","labels":["beads-upstream","data-loss"]}
{"id":"az-zg9j","title":"Stretch: configurable subagents vs external sessions","description":"Future enhancement: make it configurable whether orchestrator uses Task tool subagents or spawns external Claude Code sessions for true parallelism","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-19T11:14:04.695528+11:00","updated_at":"2025-12-19T11:14:04.695528+11:00","dependencies":[{"issue_id":"az-zg9j","depends_on_id":"az-wn3o","type":"parent-child","created_at":"2025-12-19T11:14:21.945128+11:00","created_by":"daemon","metadata":"{}"},{"issue_id":"az-zg9j","depends_on_id":"az-md0x","type":"blocks","created_at":"2025-12-19T11:14:22.411606+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"az-zh3y","title":"tui_core: Input handling - keyboard events and raw mode","description":"Handle keyboard input in raw terminal mode.\n\n## What\n- Enter raw mode (disable line buffering, echo)\n- Parse ANSI escape sequences for special keys (arrows, function keys, etc.)\n- Emit typed key events\n\n## API (Gleam)\n```gleam\ntype Key {\n  Char(String)\n  Enter | Escape | Tab | Backspace | Delete | Space\n  Up | Down | Left | Right\n  Home | End | PageUp | PageDown\n  F(Int)  // F1-F12\n}\n\ntype Modifiers {\n  Modifiers(shift: Bool, ctrl: Bool, alt: Bool)\n}\n\ntype KeyEvent { \n  KeyEvent(key: Key, modifiers: Modifiers) \n}\n\ntype InputHandler\n\n/// Initialize input handling (enters raw mode)\nfn start() -\u003e Result(InputHandler, Error)\n\n/// Poll for input with timeout (non-blocking)\nfn poll(handler: InputHandler, timeout_ms: Int) -\u003e Option(KeyEvent)\n\n/// Read next key event (blocking)\nfn read(handler: InputHandler) -\u003e KeyEvent\n\n/// Clean up (exits raw mode)\nfn stop(handler: InputHandler) -\u003e Nil\n```\n\n## ANSI Escape Sequences for Special Keys\n```\n\\\\x1b[A  - Up arrow\n\\\\x1b[B  - Down arrow\n\\\\x1b[C  - Right arrow\n\\\\x1b[D  - Left arrow\n\\\\x1b[H  - Home\n\\\\x1b[F  - End\n\\\\x1b[5~ - Page Up\n\\\\x1b[6~ - Page Down\n\\\\x1bOP  - F1\n...\n```\n\n## Implementation Notes\n- May need platform-specific code (termios on Unix)\n- Consider using Etch if it handles this\n- Ctrl+key comes as byte value (Ctrl+C = 0x03)\n- Need to handle multi-byte sequences atomically\n\n## Reference\n- OpenTUI input: packages/core/src/cli-renderer.ts\n- Etch (Gleam terminal): https://github.com/bananaofhappiness/etch\n\n## Acceptance Criteria\n- [ ] Raw mode enters/exits cleanly\n- [ ] Regular character input works\n- [ ] Arrow keys detected correctly\n- [ ] Ctrl+key combinations work (esp. Ctrl+C)\n- [ ] Function keys work\n- [ ] No blocking issues on poll\n- [ ] Terminal restored on exit (even on crash)","notes":"## Implementation Complete - 2025-12-29\n\nCreated `/gleam/src/tui_core/input.gleam` which wraps Etch's event handling.\n\n### API Summary\n\n**Types (re-exported from etch/event):**\n- `Event` - Terminal events (Key, Mouse, Resize, FocusGained, FocusLost)\n- `KeyEvent` - Key press with code, modifiers, kind, state, text\n- `MouseEvent` - Mouse events with kind, column, row, modifiers\n- `KeyCode` - Which key was pressed (Char, UpArrow, Enter, Esc, F(n), etc.)\n- `Modifiers` - Modifier keys (shift, alt, control, super, hyper, meta)\n- `EventError` - Parse errors\n\n**Terminal Control:**\n- `init()` - Enter raw mode, alt screen, hide cursor, start event server\n- `init_with_mouse()` - Same + enable mouse capture\n- `cleanup()` - Show cursor, leave alt screen, exit raw mode\n- `cleanup_with_mouse()` - Same + disable mouse capture\n\n**Event Handling:**\n- `poll(timeout_ms)` - Non-blocking event read with timeout\n- `read()` - Blocking event read\n\n**Helper Functions:**\n- `is_key(evt, key_code)` - Check if event matches a key\n- `has_ctrl/alt/shift/super(key_event)` - Check modifiers\n- `has_any_modifier(key_event)` - Any modifier pressed\n- `get_char(key_event)` - Extract char from Char key code\n- `as_key/as_mouse/as_resize(evt)` - Type-safe extraction\n- `is_key_event/is_mouse_event/is_resize_event(evt)` - Type checks\n- `terminal_size()` - Get current terminal dimensions\n\n### Usage Pattern\n```gleam\nimport tui_core/input\nimport etch/event.{Key, Char, Esc}\nimport gleam/option.{None, Some}\n\npub fn main() {\n  input.init()\n  loop()\n}\n\nfn loop() {\n  case input.poll(100) {\n    Some(Ok(Key(k))) -\u003e case k.code {\n      Char(\"q\") | Esc -\u003e input.cleanup()\n      _ -\u003e loop()\n    }\n    _ -\u003e loop()\n  }\n}\n```\n\n### Acceptance Criteria Status\n- [x] Types re-exported correctly\n- [x] init() enters raw mode and alt screen\n- [x] cleanup() restores terminal\n- [x] poll() returns event or None based on timeout\n- [x] read() blocks until event received\n- [x] Helper functions work correctly\n- [x] `gleam build` succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T11:26:08.074138+11:00","updated_at":"2025-12-29T15:16:03.70551+11:00","closed_at":"2025-12-29T15:16:03.70551+11:00","close_reason":"Implemented tui_core/input.gleam wrapping Etch event handling with init/cleanup, poll/read, and key event helpers.","labels":["gleam","tui-core"],"dependencies":[{"issue_id":"az-zh3y","depends_on_id":"az-2d6r","type":"parent-child","created_at":"2025-12-28T11:26:18.800339+11:00","created_by":"daemon"},{"issue_id":"az-zh3y","depends_on_id":"az-lvah","type":"blocks","created_at":"2025-12-28T11:41:51.130935+11:00","created_by":"daemon"},{"issue_id":"az-zh3y","depends_on_id":"az-kwwr","type":"blocks","created_at":"2025-12-28T11:52:29.44578+11:00","created_by":"daemon"}]}
{"id":"az-zqi","title":"Full bead editor (Space+e)","description":"Open selected bead in $EDITOR with structured markdown format. Parse on save, validate structure, discard if invalid, update via bd CLI if valid.","design":"Format:\n```markdown\n# {id}: {title}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nType:     {type}        (read-only)\nPriority: {P0-P4}\nStatus:   {status}\nAssignee: {assignee}\nLabels:   {comma-separated}\nEstimate: {minutes}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Description\n\n{description}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Design\n\n{design}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Notes\n\n{notes}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Acceptance Criteria\n\n{acceptance}\n```\n\nValidation:\n- Header must match `# {id}: {title}`\n- Separator lines: 20+ ‚îÄ chars\n- Priority: P0-P4\n- Status: open|in_progress|blocked|closed\n- Section headers required\n\nFlow:\n1. Space+e ‚Üí write /tmp/azedarach-{id}.md\n2. Spawn $EDITOR (blocking)\n3. Parse markdown on return\n4. Validate ‚Üí show error toast if invalid\n5. Diff against original ‚Üí bd update changed fields\n6. Refresh tasksAtom","notes":"Type change handling:\nIf user changes Type: field (e.g., task ‚Üí epic), the editor must:\n1. Detect type changed during parse\n2. bd create --type=newType with all other fields ‚Üí get new ID\n3. Copy dependencies: bd dep add new-id (for each dep)\n4. bd delete old-id\n5. Navigate TUI to new bead\n\nThis is necessary because bd update cannot change issue_type after creation.\n\nFormat is Azedarach-owned since bd has no full-bead format - only per-field edit (bd edit --notes) or CLI flags (bd update --notes='...').","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:59:31.596266+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-12T12:20:24.690791+11:00","dependencies":[{"issue_id":"az-zqi","depends_on_id":"az-shv","type":"blocks","created_at":"2025-12-12T10:59:35.281709+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-zr38","title":"dev server code is super fucked up. tear it out and try again","description":"im talking about space r.\nthe dev server popup doesnt work at all - it always shows 0 options","design":"### Refactoring Plan: Dev Server System\n\nGoal: Replace the bloated, brittle dev server implementation with a lean, reliable service and predictable UI.\n\n#### 1. Simplified DevServerService\n- **State**: Track only `beadId`, `serverName`, `status`, `port`, and `tmuxSession`.\n- **Discovery**: Simplify tmux session discovery. Use session name patterns as the primary signal, then verify with a single JSON-encoded tmux option for metadata instead of 8 separate options.\n- **Port Management**: Simplify port allocation.\n- **Lifecycle**: Refactor `start`/`stop`/`toggle` to be idempotent and less prone to race conditions.\n\n#### 2. Robust UI (DevServerMenu)\n- **Unified View**: Show all configured servers + any discovered running servers.\n- **Status Indicators**: Clearly mark which servers are running, starting, or idle.\n- **Reliable Selection**: Ensure Space+r always opens a menu if \u003e0 servers are possible.\n\n#### 3. Cleanup\n- Consolidate metadata into a single tmux option.\n- Reduce line count and complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:10:51.451836+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-23T14:38:00.127616+11:00","deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"az-zu3","title":"Implement hybrid state detection: native hooks + PTY monitoring","description":"Design and implement a hybrid state detection system that combines Claude Code's native hooks (authoritative state) with PTY output monitoring (supplementary signals).\n\n## Architecture\n- Native hooks (idle_prompt, stop, session_end) provide authoritative state transitions\n- PTY stream provides error pattern detection and \"busy\" feedback\n- State aggregator reconciles signals into final state\n\n## Benefits\n- Authoritative state from hooks\n- Graceful degradation if hooks fail\n- Error detection via PTY patterns\n- Future-proof as Claude adds more hooks\n\n## Depends on\n- az-lsi (native hook integration - provides foundation)","notes":"## Implementation Plan Approved\n\n### Approach\n- Full PTYMonitor service (separate scoped service)\n- Full state detection (busy, error, done using existing StateDetector patterns)\n- Hooks take priority (2s window after hook fires)\n- 500ms polling interval\n\n### Files to Modify\n1. `src/core/TmuxService.ts` - Add `capturePane` method\n2. `src/core/PTYMonitor.ts` - Create new service (~180 lines)\n3. `src/ui/atoms.ts` - Wire PTYMonitor, update session atoms\n4. `src/services/BoardService.ts` - Integrate metrics into loadTasks\n\n### Types Already Exist\n- SessionMetrics, AgentPhase, TaskWithSession in src/ui/types.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T01:04:40.22594+11:00","updated_at":"2025-12-28T11:48:04.433679+11:00","closed_at":"2025-12-17T16:45:38.912457+11:00","close_reason":"Implemented hybrid state detection with PTYMonitor service. Added: TmuxService.capturePane, PTYMonitor service (token extraction, session registration, hook priority, 500ms polling), BoardService integration for metrics, atoms wiring for reactive UI updates. Fixed unrelated CLI import type error.","dependencies":[{"issue_id":"az-zu3","depends_on_id":"az-lsi","type":"blocks","created_at":"2025-12-17T01:04:47.033729+11:00","created_by":"daemon"}],"deleted_at":"2025-12-28T11:48:04.433679+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"az-zv6","title":"Automation \u0026 Workflows","description":"Automated workflows: PR creation, state transition hooks, notifications, and beads sync coordination.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:04.97152+11:00","updated_at":"2025-12-11T14:44:04.97152+11:00"}
