{"id":"az-04d","title":"Add \"Merge to main\" action for completed worktree tasks","description":"When a task is done (manual mode, not CV mode), user should be able to press Space ‚Üí m to merge the worktree branch to main and clean up.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T21:49:14.135837+11:00","updated_at":"2025-12-16T22:21:47.442705+11:00","closed_at":"2025-12-16T22:21:47.442705+11:00"}
{"id":"az-05y","title":"Project Foundation","description":"Set up the core project infrastructure: TypeScript, Ink, CLI scaffolding, and foundational utilities.","notes":"Session 2025-12-11:\n\nEPIC PROGRESS: 3/4 tasks completed (75%)\n\nCOMPLETED CHILDREN:\n- az-ags: Project scaffolding ‚úÖ\n- az-fvj: BeadsClient Effect service ‚úÖ\n- az-kis: Utility modules ‚úÖ\n\nREMAINING:\n- az-2qy: CLI argument parsing with @effect/cli (ready to start)\n\nPHASE 1 DELIVERABLES:\n- Full project infrastructure with Bun + Effect + OpenTUI + SolidJS\n- Working CLI entry point (./bin/az.ts)\n- Core services: BeadsClient, TmuxService, TerminalService\n- Custom effect-atom SolidJS adapter (az-mq9, separate from this epic)\n\nNEXT SESSION:\n- Complete az-2qy (CLI parsing) to close this epic\n- Then move to Phase 2: TUI components (az-pza epic)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.657366+11:00","updated_at":"2025-12-12T10:24:42.833983+11:00","closed_at":"2025-12-12T10:24:42.833983+11:00"}
{"id":"az-06p","title":"TUI polish: card heights, priority labels, sticky action mode","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:23:49.590359+11:00","updated_at":"2025-12-12T10:23:55.435441+11:00","closed_at":"2025-12-12T10:23:55.435441+11:00"}
{"id":"az-09e","title":"Modularize KeyboardService into domain-specific handlers","description":"KeyboardService.ts is 1,572 lines - the largest service in the codebase.\n\nRefactor into smaller, focused modules:\n- **SessionKeyHandlers** - start/stop/pause/attach session actions\n- **NavigationKeyHandlers** - movement, selection, goto\n- **TaskKeyHandlers** - create/edit/delete/move tasks\n- **PRKeyHandlers** - PR creation, merge, cleanup\n- **ModeKeyHandlers** - mode transitions (search, command, etc.)\n\nEach module exports handler functions that KeyboardService composes.\nThis improves maintainability and makes testing individual handlers easier.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:44.99229+11:00","updated_at":"2025-12-18T02:14:02.605045+11:00","closed_at":"2025-12-17T16:54:21.233588+11:00","close_reason":"KeyboardService modularized: 1,571 ‚Üí 236 lines main file, 7 new domain-specific modules created","deleted_at":"2025-12-18T02:14:02.605045+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"chore"}
{"id":"az-0gh","title":"pretooluse hook seems to trigger before requesting permissions and other stuff","description":"so we should be able to use it to update session status in az right?","notes":"## Investigation Complete\n\n### Key Finding: PreToolUse fires BEFORE permission requests\n\nThe flow is:\n1. Claude decides to use a tool\n2. **PreToolUse hooks execute** ‚Üê WE CAN DETECT \"BUSY\" HERE\n3. Permission system checks if approval needed\n4. Tool executes\n5. PostToolUse fires\n6. Stop fires when Claude finishes responding\n\n### Current Architecture\n\n**StateDetector.ts** - Uses regex patterns on PTY output to detect state\n- Problem: Fragile, can't detect \"thinking\" vs \"waiting for permission\"\n- Example: detects \"Error:\" in output, but not before Claude tries a tool\n\n**HookReceiver.ts** - Polls /tmp/azedarach-notify-*.json files\n- Watches for: idle_prompt, stop, session_end\n- Missing: PreToolUse events!\n\n**hooks.ts** - Generates hook config for worktree sessions\n- Currently configures: Notification, PermissionRequest, Stop, SessionEnd\n- Missing: PreToolUse!\n\n### Recommendation\n\nAdd PreToolUse hook to `generateHookConfig()` in `src/core/hooks.ts`:\n\n```typescript\nPreToolUse: [\n  {\n    matcher: \"*\",  // All tools\n    hooks: [\n      {\n        type: \"command\",\n        command: `az notify pretooluse ${beadId}`,\n      },\n    ],\n  },\n],\n```\n\nThen:\n1. Update HookReceiver to handle \"pretooluse\" event type\n2. Map pretooluse ‚Üí \"busy\" state (immediately, no debounce)\n3. This gives us deterministic busy detection before permission dialogs\n\n### Benefits\n\n1. **Immediate busy detection**: Know Claude is working the instant it tries ANY tool\n2. **Works before permissions**: Even if Claude needs approval, we know it's busy\n3. **Tool-specific tracking**: We get tool_name in PreToolUse payload - could track phase (Read=planning, Edit=action, Bash=verification)\n4. **Complements existing hooks**: Stop already tells us \"waiting\", PreToolUse tells us \"busy\"","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T12:36:08.601508+11:00","updated_at":"2025-12-18T13:07:32.171021+11:00"}
{"id":"az-0h0","title":"TEST BEAD","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:04.88589+11:00","updated_at":"2025-12-18T01:11:04.88589+11:00"}
{"id":"az-2ek","title":"Add warning glyphs to TaskCard header","description":"Add tiny warning glyphs (‚ö†üîÑ) to TaskCard headerLine after session indicator. ‚ö† for context warning (\u003e70%), üîÑ for recently compacted. Space cost: 1-2 characters.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.779379+11:00","updated_at":"2025-12-12T13:25:20.429502+11:00","dependencies":[{"issue_id":"az-2ek","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.178601+11:00","created_by":"daemon"}]}
{"id":"az-2il","title":"Agent Mail status broadcast integration","description":"Workers broadcast status via Agent Mail for real-time TUI updates.\n\n**Events:**\n- STARTED: Worker began task\n- PROGRESS: Periodic heartbeat with context %\n- BLOCKED: Worker discovered blocker\n- COMPLETED: Worker finished task\n- ERROR: Worker encountered error\n\n**TUI subscription:**\n- Poll Agent Mail for status updates (or WebSocket if available)\n- Update TaskCard session indicators in real-time\n- Show toast for important events (blocked, error)\n\n**Depends on:** Agent Mail integration (az-l7a)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:15.170002+11:00","updated_at":"2025-12-14T02:13:25.698677+11:00","dependencies":[{"issue_id":"az-2il","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T13:29:24.916405+11:00","created_by":"daemon"},{"issue_id":"az-2il","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.86955+11:00","created_by":"daemon"}]}
{"id":"az-2m9","title":"search mode needs to accept enter/return to return to normal mode","description":"should have the selected item from search selected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:28:34.821948+11:00","updated_at":"2025-12-16T23:20:14.269865+11:00","closed_at":"2025-12-16T23:20:14.269868+11:00"}
{"id":"az-2p4","title":"the space m to merge feature should move the bead to closed too","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:41:22.254096+11:00","updated_at":"2025-12-18T02:20:57.249253+11:00","closed_at":"2025-12-18T02:20:57.249256+11:00","close_reason":"Fixed: Now commits and pushes bead close after merge to main","deleted_at":"2025-12-18T02:14:02.600677+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-2qy","title":"CLI argument parsing with @effect/cli","description":"Set up CLI entry point with argument parsing for the az command.","design":"- Use @effect/cli for type-safe argument parsing\n- Define Commands with Args and Options\n- Commands: az (default TUI), az start \u003cid\u003e, az attach \u003cid\u003e, az pause \u003cid\u003e, az status, az sync\n- Accept optional project path argument via Args.directory\n- Use Options for flags like --verbose, --config\n- Validate beads database exists before starting\n- Auto-generate shell completions (bash, zsh, fish)","notes":"Implemented complete CLI structure with @effect/cli:\n- Created src/cli/index.ts with all commands (default, start, attach, pause, status, sync)\n- Proper Option.Option handling for optional parameters\n- Type-safe argument parsing using Args and Options from @effect/cli\n- Integration with BeadsClient and BunContext\n- Help system auto-generates for all commands\n\nNOTE: Discovered potential issue with @effect/cli 0.72.1 where subcommands show help instead of executing. The CLI structure is correct per official docs, but runtime behavior needs investigation. Commands are properly registered (visible in help output) but not routing correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.3098+11:00","updated_at":"2025-12-11T18:03:13.670101+11:00","closed_at":"2025-12-11T18:03:13.670101+11:00","dependencies":[{"issue_id":"az-2qy","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.891408+11:00","created_by":"daemon"},{"issue_id":"az-2qy","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.453515+11:00","created_by":"daemon"}]}
{"id":"az-31h","title":"runGit doesn't extract stderr, breaking merge conflict detection","description":"The runGit helper in PRWorkflow.ts didn't extract stderr from platform errors. This caused merge conflict detection to fail because it checks e.stderr?.includes(\"CONFLICT\") which was always undefined.\n\nFixed by extracting stderr like BeadsClient does: `const stderr = \"stderr\" in error ? String(error.stderr) : String(error)`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T15:49:54.963322+11:00","updated_at":"2025-12-18T12:48:20.817252+11:00","closed_at":"2025-12-17T15:50:00.235259+11:00","close_reason":"Fixed runGit to extract stderr from platform errors, enabling proper conflict detection","deleted_at":"2025-12-18T12:48:20.817252+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"bug"}
{"id":"az-31i","title":"the claude create task feature needs work. we should use claude cli or something not a full claude ode session/instance","description":"","notes":"Analyzing current implementation and planning CLI-based approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:31.58228+11:00","updated_at":"2025-12-17T00:18:36.483483+11:00","closed_at":"2025-12-17T00:18:36.483483+11:00"}
{"id":"az-31ri","title":"dont import from \"node:*\"","description":"import from @effect/platform instead","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T13:13:35.004191+11:00","updated_at":"2025-12-18T13:13:39.741247+11:00"}
{"id":"az-385","title":"Indented child task display under epics","description":"Show epic children indented in the board view.\n\n**Visual:**\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ üéØ az-epic      ‚îÇ\n‚îÇ   ‚îú‚îÄ az-a ‚öô    ‚îÇ\n‚îÇ   ‚îú‚îÄ az-b ‚úì    ‚îÇ\n‚îÇ   ‚îî‚îÄ az-c ‚è∏    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n**Implementation:**\n- Query parent field from beads\n- Group tasks by parent in Board.tsx\n- Render children with tree prefix (‚îú‚îÄ ‚îî‚îÄ)\n- Collapse/expand with Enter on epic?\n\n**Consideration:** May need variable card heights or separate epic view","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.298636+11:00","updated_at":"2025-12-12T13:29:15.298636+11:00","dependencies":[{"issue_id":"az-385","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.905066+11:00","created_by":"daemon"}]}
{"id":"az-38m","title":"can't seem to move beads with space + left/right arrow or l/h","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:27:05.835599+11:00","updated_at":"2025-12-18T12:48:20.818993+11:00","closed_at":"2025-12-17T15:35:44.455904+11:00","deleted_at":"2025-12-18T12:48:20.818993+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-3rk","title":"Add rate_limited session state","description":"Add 'rate_limited' to SessionState type and SESSION_INDICATORS map (‚è± glyph). Extend StateDetector patterns to detect rate limiting from Claude output (patterns like 'Rate limit', 'Too many requests', 'Please wait').","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.309325+11:00","updated_at":"2025-12-12T13:25:19.967333+11:00"}
{"id":"az-3rt","title":"task is stuck merging","description":"we need to be able to abort a merge and also we need to be able to attach to the merge claude session. we should re-use the current tmux session for merging if we havent already closed it.","notes":"Starting work. Issue analysis:\n\n1. When merge detects conflicts, PRWorkflow spawns Claude to resolve them\n2. There's no way to abort a merge that's stuck in conflict state\n3. No way to easily attach to the merge-resolution Claude session\n4. Task appears \"stuck\" with no recovery options\n\nPlan:\n1. Add `abortMerge` method to PRWorkflow - runs `git merge --abort`\n2. Add `Space+M` keybinding (abort merge) to prHandlers\n3. Ensure attach (`Space+a`) works for merge-resolution sessions\n4. Consider UI feedback for merge-in-progress state","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T10:45:11.402161+11:00","updated_at":"2025-12-18T12:32:12.232088+11:00","close_reason":"Implemented abort merge functionality:\n\n1. Added `abortMerge` method to PRWorkflow service (src/core/PRWorkflow.ts)\n   - Runs `git merge --abort` in the worktree\n   - Returns appropriate errors if no worktree exists\n\n2. Added `abortMerge` handler to prHandlers (src/services/keyboard/prHandlers.ts)\n   - Queued operation to prevent race conditions\n   - Shows toast feedback\n\n3. Added `Space+M` keybinding (src/services/keyboard/bindings.ts)\n   - Capital M distinguishes from lowercase m (merge)\n\n4. Updated documentation (docs/keybindings.md)\n   - Added to Git/PR Actions table\n   - Added detailed \"Abort Merge\" section\n\nRe: attaching to merge-resolution Claude sessions:\n- This already works via `Space+a` (attach external)\n- Merge flow uses beadId as tmux session name, same as regular sessions\n- Existing attach functionality finds and switches to the session\n\nRe: re-using existing tmux session for merging:\n- The merge flow already does this (see PRWorkflow.ts lines 659-696)\n- Checks `tmuxService.hasSession(beadId)` first\n- If session exists, sends prompt via sendKeys\n- Only starts new session if none exists","deleted_at":"2025-12-18T12:32:12.232088+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-451","title":"Use immutable Data types in SubscriptionRef state","description":"Non-primitive state stored in SubscriptionRef should use Effect's immutable data types for proper equality and functional programming patterns.\n\n**Problems:**\n1. Objects/arrays without Data wrapping cause reference equality issues\n2. Mutable collections like `Map` don't play well with Effect's functional paradigm\n\n**Solutions:**\n\n**Data Wrapping:**\n- Use `Schema.Data` to wrap state schemas, OR\n- Manually wrap with `Data.array()` for arrays\n- Manually wrap with `Data.struct()` for objects/records\n\n**Immutable Collections:**\n- Replace `Map` with `ReadonlyRecord` (from `effect/Record`)\n- Replace `Set` with `HashSet` (from `effect/HashSet`)\n- Use `HashMap` if key hashing is needed\n\n**Specific changes:**\n- `tasksByColumn: Map\u003c...\u003e` ‚Üí `tasksByColumn: ReadonlyRecord\u003cstring, ReadonlyArray\u003cTask\u003e\u003e`\n\n**Files to audit:**\n- All services using SubscriptionRef with non-primitive state\n- Check EditorService, NavigationService, OverlayService, BeadsService, etc.","notes":"## Completed\n- ‚úÖ tasksByColumn: Map ‚Üí Record.ReadonlyRecord with emptyRecord() singleton\n- ‚úÖ jumpLabels: ReadonlyMap ‚Üí Record.ReadonlyRecord\n- ‚úÖ Created src/lib/empty.ts with singleton emptyRecord() and emptyArray()\n- ‚úÖ Updated all consumers: BoardService, KeyboardService, EditorService, atoms.ts, Board.tsx, CompactView.tsx, useEditorMode.ts, types.ts\n- ‚úÖ Board.tsx and CompactView.tsx now accept readonly TaskWithSession[] arrays\n- ‚úÖ Type errors from concurrent work FIXED in commit 092959c\n\n## Session 2025-12-15 Update\nThe type issues around readonly arrays are now resolved:\n- BoardProps.tasks: readonly TaskWithSession[]\n- CompactViewProps.tasks: readonly TaskWithSession[]\n- Column props were fixed (isActiveColumn instead of isActive, etc.)\n\n## Remaining\n- Data wrapping for non-primitive SubscriptionRef state (EditorMode, SortConfig, Overlay[], Toast[], etc.)\n- Consider using Data.struct() for cursor/position types\n- Audit all services for remaining mutable collections\n\n## Note\nThe linter (biome) auto-converts ReadonlyMap ‚Üî Record.ReadonlyRecord. Need to be consistent with Record.ReadonlyRecord and use Object.entries() for iteration.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-15T12:23:05.047807+11:00","updated_at":"2025-12-15T12:57:22.737672+11:00","closed_at":"2025-12-15T12:57:22.737672+11:00"}
{"id":"az-4r0","title":"AgentMailClient Effect service","description":"Create Effect service wrapper for Agent Mail HTTP API.\n\nDesign:\n- Define AgentMailClient as Effect.Service\n- Use @effect/platform HttpClient for requests\n- Methods:\n  - reserve(issueId): Effect\u003cReservation, ReservationError\u003e\n  - release(issueId): Effect\u003cvoid, ReleaseError\u003e\n  - ready(): Effect\u003cIssue[], AgentMailError\u003e\n  - updateStatus(issueId, status): Effect\u003cvoid, AgentMailError\u003e\n  - isAvailable(): Effect\u003cboolean, never\u003e (health check)\n- Read config from environment variables\n- Graceful degradation: return fallback when server unavailable\n- Retry logic with exponential backoff\n- Create AgentMailClientLive and AgentMailClientTest layers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.475812+11:00","updated_at":"2025-12-12T10:33:13.475812+11:00","dependencies":[{"issue_id":"az-4r0","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.800097+11:00","created_by":"daemon"}]}
{"id":"az-4vc","title":"paste from clipboard not working on mac still","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:25.365057+11:00","updated_at":"2025-12-18T02:14:02.602107+11:00","closed_at":"2025-12-17T16:41:03.286913+11:00","deleted_at":"2025-12-18T02:14:02.602107+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-4vp","title":"how do we install az hooks into a repo? document/improve this flow","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:22:57.513319+11:00","updated_at":"2025-12-18T10:46:02.513809+11:00","closed_at":"2025-12-18T10:39:21.455076+11:00","close_reason":"Documented and improved hook installation flow: created docs/hooks-installation.md, extracted hook generation to src/core/hooks.ts, added `az hooks install` CLI command, added PermissionRequest hook","deleted_at":"2025-12-18T10:46:02.513809+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-4zq","title":"session monitoring not working. i assume due to permission denied on hooks","description":"we may need to chmod hook scripts?","notes":"Fixed. Root cause: Effect.fork() immediately interrupts child fibers when parent effect completes. Changed to Effect.forkScoped() which ties fiber lifetime to caller's scope. Also added immediate processing of pending notifications on startup. Documented fork vs forkScoped in CLAUDE.md.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:14:22.614097+11:00","updated_at":"2025-12-18T02:14:02.598172+11:00","closed_at":"2025-12-18T00:38:48.996207+11:00","close_reason":"Fixed Effect.fork‚ÜíforkScoped in HookReceiver. Documented in CLAUDE.md.","deleted_at":"2025-12-18T02:14:02.598172+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-53o","title":"Notification system (terminal bell, system notifications)","description":"Alert user when sessions need attention.","design":"- Define NotificationService as Effect.Service\n- Methods:\n  - notify(title, body, urgency): Effect\u003cvoid, NotificationError\u003e\n  - bell(): Effect\u003cvoid\u003e // terminal bell \\x07\n- Notification backends:\n  - macOS: osascript via @effect/platform Command\n  - Cross-platform fallback: node-notifier (optional dep)\n- Use Effect.race with timeout for notification delivery\n- Notification triggers: subscribe to SessionManager PubSub\n- Configurable via Config service:\n  - enable/disable per event type\n  - sound option\n  - cooldown duration\n- Use Schedule.spaced for cooldown to prevent spam","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.717497+11:00","updated_at":"2025-12-11T14:54:42.593575+11:00","dependencies":[{"issue_id":"az-53o","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.727137+11:00","created_by":"daemon"}]}
{"id":"az-58v","title":"Implement issue type change in EditorService","description":"src/core/EditorService.ts line 773 has TODO:\n\"Implement type change (delete old, create new, preserve deps)\"\n\nChanging issue type (task‚Üíbug, feature‚Üíepic) requires:\n1. Capture existing dependencies\n2. Delete original issue\n3. Create new issue with same ID pattern but new type\n4. Re-link dependencies\n\nThis is a data migration operation that needs careful handling.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.827186+11:00","updated_at":"2025-12-17T15:59:44.827186+11:00"}
{"id":"az-5ck","title":"when i approve claude permissions in bead worktrees i want them to be merged into .claude/settings.json or something","description":"","notes":"Analyzed codebase. Plan: Add SessionEnd hook to sync permissions back to main project. Leverages existing WorktreeManager.deepMerge() for merging permission arrays.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:25:31.149667+11:00","updated_at":"2025-12-18T12:48:20.819589+11:00","closed_at":"2025-12-17T15:49:48.21207+11:00","close_reason":"Implemented permission sync: Added `az sync-permissions` CLI command and SessionEnd hook integration. When Claude sessions end in worktrees, any new permissions approved during the session are automatically merged back to the main project's settings.local.json.","deleted_at":"2025-12-18T12:48:20.819589+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-5jl","title":"File bug report for bd merge driver deleting beads incorrectly","description":"The `bd merge` driver uses standard 3-way merge semantics which can incorrectly delete beads.\n\n**Issue:** When a bead exists in base (ancestor) and main, but NOT in the branch being merged, the driver interprets this as \"branch deleted the bead\" and removes it. But the real scenario is often \"branch was created before this bead existed.\"\n\n**Expected behavior:** Beads should use additive merge semantics - beads are never deleted by merge, only added/updated. If a bead exists in either branch, it should appear in the result.\n\n**Workaround:** Azedarach now calls `bd sync --import-only` after merge to recover lost beads (az-mlv fix).\n\n**Suggested fix:** The merge driver should check `bead.created_at` against the branch divergence point. If the bead was created after the fork, keep it regardless of whether the branch has it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-18T02:09:27.362267+11:00","updated_at":"2025-12-18T02:09:27.362267+11:00","labels":["bd","upstream"]}
{"id":"az-5p5","title":"Add session metrics section to DetailPanel","description":"Add Session Metrics section to DetailPanel modal showing: Context % with warning indicator, session duration, estimated token count. Only visible when session is active (not idle).","notes":"## Progress\n\n### ‚úÖ Completed\n- DetailPanel UI section for metrics (lines 257-289)\n- Color-coded context % display (lavender/yellow/red thresholds)\n- Duration formatting from sessionStartedAt  \n- Token count display with K suffix\n- Visibility guard (only shows when session active)\n- Agent phase display (bonus)\n- **NEW**: BoardService now maps sessionStartedAt from SessionManager\n\n### ‚ùå Still Missing (requires az-zu3)\n- contextPercent: Needs PTY monitoring to parse Claude's status line\n- estimatedTokens: Needs PTY monitoring to parse Claude's status line\n- agentPhase: StateDetector exists but isn't wired to active monitoring\n\n### Dependency\nThis issue depends on az-zu3 (hybrid state detection) for full metrics collection.\nSession duration works NOW since SessionManager tracks startedAt.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.666185+11:00","updated_at":"2025-12-17T14:46:52.042889+11:00","closed_at":"2025-12-17T14:46:52.042889+11:00","dependencies":[{"issue_id":"az-5p5","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.146395+11:00","created_by":"daemon"},{"issue_id":"az-5p5","depends_on_id":"az-zu3","type":"blocks","created_at":"2025-12-17T14:44:22.017914+11:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"az-5p5","author":"riordan","text":"UI code exists but data pipeline is missing. SessionManager doesn't collect metrics, BoardService doesn't map them. Need: 1) Data source for context%, tokens 2) SessionManager collection 3) BoardService mapping","created_at":"2025-12-17T03:41:30Z"}]}
{"id":"az-65k","title":"Selection jumps to top of column after moving task left","description":"","notes":"Session progress (2025-12-14):\n\nROOT CAUSE ANALYSIS:\n- Navigation tracks position (columnIndex, taskIndex) not task ID\n- After moving RIGHT into empty column, taskIndex clamps to 0\n- Moving LEFT then uses stale taskIndex (0), navigating to top of column\n\nSOLUTION DESIGNED:\n1. Add `followTaskId` state to track which task to follow after moves\n2. Add useEffect watching followTaskId + tasksByColumn\n3. When data refreshes, find task by ID and navigate to its new position\n4. Update LEFT/RIGHT handlers in action mode to use setFollowTaskId()\n\nFILES TO MODIFY:\n- src/ui/App.tsx:\n  - Line 4: Add useEffect import\n  - After line 112: Add followTaskId state\n  - After navigateTo (line 206): Add useEffect for following task\n  - Lines 405-430: Update LEFT handler to use setFollowTaskId\n  - Lines 431-456: Update RIGHT handler to use setFollowTaskId\n\nFIX WAS APPLIED BUT REVERTED:\n- The fix was successfully implemented\n- A linter/formatter reverted the changes\n- Need to re-apply with proper formatting\n\nNEXT STEP:\nRe-apply the fix, ensuring it passes linting/formatting","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T17:17:04.148671+11:00","updated_at":"2025-12-14T02:13:17.044684+11:00","closed_at":"2025-12-14T02:13:17.044687+11:00","comments":[{"id":1,"issue_id":"az-65k","author":"riordan","text":"Fix was reverted by linter/formatter. Need to re-apply the followTaskId fix.","created_at":"2025-12-13T13:43:02Z"}]}
{"id":"az-6c5","title":"allow space S which starts a claude code instance and gets it to start working on the task","description":"e.g. prompt it with \"work on bead [bead-id]\"","notes":"Starting implementation. Approach:\n1. Add actionStartSessionWithPrompt() - starts session, waits for Claude init, sends prompt\n2. Add S-s keybinding (Shift+s) for \"start and work\"\n3. Update ActionPalette to show 'S work' option","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:26:05.162586+11:00","updated_at":"2025-12-17T00:54:24.960417+11:00","closed_at":"2025-12-17T00:54:24.960417+11:00"}
{"id":"az-6e3","title":"somehow allow starting a session via space s/S with --dangerously-skip-permissions","description":"we dont want to default to it but we should allow the user to do it somehow. not sure what the keybind should be. might need a secondary menu layer or a dialog... or might just need a new action menu keybind","notes":"Implementation plan: 1) Add dangerouslySkipPermissions to StartSessionOptions 2) Update SessionManager.start() to use the flag 3) Add new handler startSessionDangerous() 4) Add ! keybind in action mode 5) Update ActionPalette","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:40:35.565457+11:00","updated_at":"2025-12-18T12:45:17.622656+11:00","closed_at":"2025-12-18T12:45:17.622659+11:00","close_reason":"Implemented Space+! keybind to start sessions with --dangerously-skip-permissions flag","deleted_at":"2025-12-18T12:39:42.061285+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-6la","title":"Add context health border colors to TaskCard","description":"Encode context health into TaskCard border color when session is active: lavender (healthy, \u003c70%), yellow (warning, 70-90%), red (critical, \u003e90%). Requires contextPercent from TaskWithSession.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.426477+11:00","updated_at":"2025-12-12T13:25:20.07394+11:00","dependencies":[{"issue_id":"az-6la","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.111928+11:00","created_by":"daemon"}]}
{"id":"az-6nu","title":"help me figure out this tool use issue in claude sessions started via space s/S","description":"- it always stdouts ERROR: wrong usage\n - i have no idea what program/script logs it\n - it doesnt happen if i ctrl-a % to split and open a new claude session and tell it to type check\n - doesnt happen for read/write tool use only commands that use shell like bun run type-check etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:01:53.842983+11:00","updated_at":"2025-12-18T02:14:02.60403+11:00","closed_at":"2025-12-17T16:17:50.228619+11:00","deleted_at":"2025-12-18T02:14:02.60403+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-6t6","title":"Manual worktree cleanup action (Space+d)","description":"Add Space+d action to manually delete a worktree and its branch.\n\n**Use cases:**\n- Abandoned work that won't be merged\n- Failed PRs that need cleanup\n- Manual housekeeping\n\n**Implementation:**\n- Add to ActionPalette with state check (only available when worktree exists)\n- Confirm dialog before deletion (destructive action)\n- WorktreeManager.remove() + git branch -D\n- Update task card to remove blue dot\n- Toast notification on success/failure\n\n**Depends on:** az-yf4 (PRWorkflow) for the cleanup utility function","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T12:26:24.70141+11:00","updated_at":"2025-12-12T12:34:29.581402+11:00","dependencies":[{"issue_id":"az-6t6","depends_on_id":"az-yf4","type":"blocks","created_at":"2025-12-12T12:26:35.152751+11:00","created_by":"daemon"}]}
{"id":"az-76a","title":"session busy status even though claude has been waiting for me to press 1-3 for 2mins","description":"","notes":"**Root cause:** The `Stop` hook fires immediately when Claude finishes responding, but HookReceiver was ignoring it (returning `null` instead of transitioning to \"waiting\" state).\n\n**Primary fix (HookReceiver.ts):**\nChanged `mapEventToState(\"stop\")` from returning `null` to returning `\"waiting\"`.\n\nThe Stop hook was already correctly configured in WorktreeManager to call `az notify stop ${beadId}`, but the event was being discarded.\n\n**Secondary fix (StateDetector.ts):**\nAdded backup PTY patterns for AskUserQuestion tool output (numbered options, \"Other\" option). This provides defense-in-depth but the hook-based solution is more reliable.\n\n**Architecture note:**\n- Hook-based detection (Stop hook) is authoritative and immediate\n- PTY pattern matching is a fallback for edge cases\n- idle_prompt notification (60s timeout) is a last-resort safety net","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:17:07.106897+11:00","updated_at":"2025-12-18T10:46:02.515308+11:00","closed_at":"2025-12-18T10:24:26.792564+11:00","close_reason":"Fixed: Stop hook now correctly transitions to 'waiting' state (HookReceiver.ts). Also added PTY pattern fallbacks (StateDetector.ts).","comments":[{"id":4,"issue_id":"az-76a","author":"riordan","text":"Initial fix was incomplete - the real issue was in HookReceiver, not just StateDetector patterns","created_at":"2025-12-17T23:24:06Z"}],"deleted_at":"2025-12-18T10:46:02.515308+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-7oa","title":"Add test coverage for core services","description":"Currently only FileLockManager.test.ts exists. Add tests for:\n\n**High priority (business-critical):**\n- SessionManager - lifecycle, state transitions\n- BeadsClient - CLI parsing, error handling\n- CommandQueueService - serialization, race conditions\n- StateDetector - pattern matching accuracy\n\n**Medium priority:**\n- BoardService - filtering, sorting\n- NavigationService - cursor movement, boundary handling\n- WorktreeManager - git operations\n\nUse Effect's testing utilities and TestClock for time-based tests.","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-17T15:59:45.163878+11:00","updated_at":"2025-12-17T15:59:45.163878+11:00"}
{"id":"az-7rj","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.\n\n## Requirements\n- User provides a description of the task/feature they want to create\n- Claude interprets the prompt and creates the appropriate bead (title, type, description, etc.)\n- The tmux session used for bead creation should persist after creation\n- This allows the user to immediately start working on the newly created bead in the same session\n\n## Use Case\nInstead of manually running `bd create`, user can describe what they need in natural language from within azedarach's TUI, and Claude handles the bead creation. The persistent session means they can seamlessly transition from \"create this task\" to \"now work on it\".","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:27:20.092741+11:00","updated_at":"2025-12-14T19:41:43.218996+11:00","closed_at":"2025-12-14T02:45:45.653563+11:00"}
{"id":"az-7sr","title":"Add orchestration mode (Space+o) to TUI","description":"New editor mode for orchestrating parallel workers on an epic.\n\n**Trigger:** Space+o when cursor is on an epic task\n**Mode behavior:**\n- Query child tasks of epic via bd\n- Display as selectable list (like select mode)\n- Space toggles task inclusion\n- Enter confirms and triggers spawn\n- Esc cancels\n\n**UI:** Reuse select mode patterns but with orchestration-specific keybinds shown in StatusBar.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.653445+11:00","updated_at":"2025-12-14T02:13:30.983526+11:00","dependencies":[{"issue_id":"az-7sr","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.732517+11:00","created_by":"daemon"}]}
{"id":"az-7vk","title":"Auto-wrap in tmux on startup","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:16:24.296316+11:00","updated_at":"2025-12-12T17:16:32.587438+11:00","closed_at":"2025-12-12T17:16:32.587438+11:00"}
{"id":"az-7y5","title":"if i /clear in the bead's space S claude session the tmux session seems to be lost in az","description":"","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T12:32:07.377782+11:00","updated_at":"2025-12-18T12:33:19.584404+11:00"}
{"id":"az-7y9","title":"worktree created but not found","description":"we may be looking in the wrong spot for worktrees sometimes. i looked in finder and the worktree existed so not sure how we failed to find it. also make sure that errors that we should via toast are also logged via Effect.logError","notes":"Fixed both issues: (1) Added Effect.logError to all toast error handlers in KeyboardService, (2) Updated WorktreeManager to use branch name as beadId (more reliable than path parsing), added path normalization to avoid symlink/trailing slash issues, added diagnostic logging when worktree not found in cache, made the fallback regex case-insensitive to support any prefix (e.g., Chefy-xxx). Also added MCP tool permissions to project settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:32:16.690535+11:00","updated_at":"2025-12-15T15:32:17.764918+11:00","closed_at":"2025-12-15T15:32:17.764918+11:00"}
{"id":"az-8ep","title":"Beads sync coordination for worktrees","description":"Coordinate beads sync across main repo and worktrees.","design":"- Define BeadsSyncCoordinator as Effect.Service\n- Depends on: BeadsClient, WorktreeManager, SessionManager\n- Sync strategy:\n  1. Before task start: sync (pull latest)\n  2. Periodic sync during work (configurable interval via Schedule)\n  3. On task completion: sync (push final state)\n- Methods:\n  - syncAll(): Effect\u003cSyncResult[], BeadsError\u003e\n  - syncWorktree(path): Effect\u003cSyncResult, BeadsError\u003e\n  - startPeriodicSync(interval): Effect\u003cFiber.RuntimeFiber\u003cvoid\u003e, never\u003e\n- Use Effect.retry with exponential backoff for conflicts\n- Handle sync conflicts gracefully with Effect.catchTag\n- 's' keybinding triggers syncAll()\n- Show sync status in StatusBar via Ref\u003cSyncStatus\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.819887+11:00","updated_at":"2025-12-12T12:17:55.89465+11:00","closed_at":"2025-12-12T12:17:55.89465+11:00","dependencies":[{"issue_id":"az-8ep","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.882335+11:00","created_by":"daemon"}]}
{"id":"az-8mp","title":"Fix TUI height in tmux and improve session scrolling","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T00:37:17.384839+11:00","updated_at":"2025-12-14T00:37:34.04098+11:00","closed_at":"2025-12-14T00:37:34.04098+11:00"}
{"id":"az-9an","title":"gg command should take me to top of current column not top of open column always","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:50.236333+11:00","updated_at":"2025-12-17T01:01:29.643058+11:00","closed_at":"2025-12-17T01:01:29.643058+11:00"}
{"id":"az-9b8","title":"Epic progress indicator in TaskCard","description":"Show progress bar for epic tasks: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5\n\n**Implementation:**\n- Query child task statuses\n- Calculate completed/total\n- Render as Unicode progress bar\n- Only show for issue_type=epic\n\n**Space cost:** One line, replaces description line for epics","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:29:15.040003+11:00","updated_at":"2025-12-12T13:29:15.040003+11:00","dependencies":[{"issue_id":"az-9b8","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.835556+11:00","created_by":"daemon"}]}
{"id":"az-9ch","title":"Worktree init hooks (direnv, env vars, custom commands)","description":"Allow configuring commands to run when a worktree is created or session is started. Common use cases: direnv allow, setting env vars, installing deps, etc.","design":"Config structure (in future az config file):\n```yaml\nworktree:\n  init:\n    - direnv allow\n    - pnpm install\n  env:\n    CLAUDE_MODEL: opus\n    DEBUG: true\n```\n\nImplementation options:\n1. Run init commands after worktree creation in WorktreeManager\n2. Run init commands in the tmux session before claude starts\n3. Both (worktree-level vs session-level hooks)\n\nOption 2 is simpler - modify the session command:\n```\n$SHELL -c 'direnv allow \u0026\u0026 claude; exec $SHELL'\n```\n\nFor env vars, use tmux set-environment or export in the shell command.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:13:03.534484+11:00","updated_at":"2025-12-12T17:24:21.906802+11:00","closed_at":"2025-12-12T17:24:21.906802+11:00","dependencies":[{"issue_id":"az-9ch","depends_on_id":"az-pnx","type":"blocks","created_at":"2025-12-12T12:13:09.239776+11:00","created_by":"daemon"}]}
{"id":"az-9co","title":"bd sync needs atomic operations to prevent race conditions","description":"","notes":"## Problem\n\nMultiple bd processes (daemon, beads-mcp servers, manual bd sync) can race to update the beads-sync branch, causing data loss.\n\n## Race Scenario\n\n1. Process A reads JSONL with [issue-1, issue-2]\n2. Process B creates issue-3, exports to JSONL\n3. Process A commits its JSONL to beads-sync (missing issue-3!)\n4. Process B runs bd sync, pulls from beads-sync\n5. Process B tombstones issue-3 (sees it as \"deleted\")\n\n## Root Cause\n\n- bd sync is not atomic\n- No locking between concurrent bd processes\n- beads-sync branch can be overwritten by stale data\n\n## Proposed Fix (upstream)\n\nOption 1: Git ref transactions\n- Use git's atomic ref updates\n- bd sync should fail if beads-sync moved since last read\n\nOption 2: File-based locking\n- Acquire lock before any sync operation\n- Release after commit+push complete\n\nOption 3: CRDT-based merge\n- Instead of overwrite, use conflict-free merge\n- Tombstones require consensus, not just \"missing from one branch\"\n\n## Workaround (Azedarach)\n\n- Use FileLockManager around bd sync calls\n- Prevents races within our own operations\n- Does NOT fix races with external bd processes\n\n## Related\n\n- az-zby: bd sync incorrectly tombstones issues","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T12:55:05.604475+11:00","updated_at":"2025-12-18T12:55:05.879012+11:00","labels":["beads-upstream"]}
{"id":"az-a8i","title":"StateDetector - Claude output pattern matching","description":"Detect Claude session state by monitoring PTY output and matching patterns.","design":"- Define StateDetector as Effect.Service\n- Use Stream from Effect to process PTY output\n- Pattern matching with priorities (higher priority wins)\n- Methods:\n  - detectFromOutput(chunk: string): Effect\u003cSessionState | null\u003e\n  - createOutputStream(pty): Stream\u003cSessionState, never\u003e\n- Use @effect/schema for pattern configuration validation\n- Default patterns for waiting, done, error states\n- Configurable patterns via Config service\n- Use Schedule for debouncing state changes\n- Emit state changes via PubSub","notes":"‚úÖ StateDetector service complete and tested.\n\nFiles created:\n- src/core/StateDetector.ts (main service)\n- src/core/StateDetector.example.ts (usage examples)\n\nFeatures implemented:\n‚úì SessionState type: idle | busy | waiting | done | error\n‚úì Effect.Service with Effect.Tag pattern\n‚úì detectFromChunk() - stateless pattern matching\n‚úì createDetector() - stateful detector with debouncing\n‚úì Priority-based pattern matching (waiting \u003e error \u003e done \u003e busy)\n‚úì StateDetectorLive layer (no dependencies)\n‚úì Convenience functions for easy usage\n‚úì Debouncing: busy state coalesces rapid output\n‚úì Terminal state stickiness: done/error persist until reset\n‚úì Comprehensive examples demonstrating all features\n\nPattern matching:\n- waiting: [y/n], 'Do you want to', 'Press Enter', etc.\n- error: 'Error:', 'Exception:', 'Failed:', 'ENOENT', etc.\n- done: 'Task completed', 'Successfully', 'Done.', etc.\n- busy: any non-empty output not matching above\n\nType checking: ‚úÖ No errors\nRuntime testing: ‚úÖ All examples run successfully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.92773+11:00","updated_at":"2025-12-12T01:29:02.419812+11:00","closed_at":"2025-12-12T01:29:02.419812+11:00","dependencies":[{"issue_id":"az-a8i","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.44929+11:00","created_by":"daemon"}]}
{"id":"az-aa2","title":"add ability to view/remove attached images","description":"","notes":"Planning implementation: Add attachment navigation within DetailPanel overlay. When viewing a task with attachments, user can press j/k to select attachments, 'o' to open in viewer, 'x' to delete. Need to: 1) Add attachment selection state to EditorService, 2) Update DetailPanel to show selection, 3) Add keybindings for detail overlay attachment interaction.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:17:59.590786+11:00","updated_at":"2025-12-18T10:46:02.51473+11:00","closed_at":"2025-12-18T10:36:26.706374+11:00","close_reason":"Implemented view/remove functionality for attached images. Users can now navigate attachments with j/k or arrow keys in the detail panel, press 'o' to open in system viewer, 'x' to remove, and 'i' to add more.","deleted_at":"2025-12-18T10:46:02.51473+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ags","title":"Project scaffolding with Bun, Effect, OpenTUI, and SolidJS","description":"Initialize the project with package.json, tsconfig.json (strict mode), and build tooling. Set up Ink as the TUI framework with React 18.","design":"- Use pnpm as package manager\n- **Bun runtime** (required for OpenTUI's Zig FFI)\n- TypeScript strict mode enabled\n- Effect ecosystem as core foundation:\n  - `effect` - core runtime, error handling, concurrency\n  - `@effect/platform` + `@effect/platform-bun` - Command execution, file system\n  - `@effect/cli` - CLI argument parsing\n  - `effect/Schema` - config and data validation\n  - `@effect-atom/atom` - reactive state bridging Effect to UI\n- **OpenTUI for TUI** (bleeding edge, experimental):\n  - `@opentui/core` - terminal primitives, Yoga layout\n  - `@opentui/solid` - SolidJS reconciler (actively maintained)\n  - `solid-js` - reactive UI framework\n- tsup for bundling (or Bun's bundler)\n- Create src/index.tsx entry point\n- Create bin/az.ts CLI executable\n- Set up Layer-based dependency injection from the start\n- Install Zig (required for building OpenTUI)","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- package.json with Bun runtime, Effect ecosystem, OpenTUI + SolidJS\n- tsconfig.json with strict mode, SolidJS JSX config, path aliases\n- Directory structure: src/{core,lib,ui,config}, bin/\n- bin/az.ts CLI entry point (executable, runs successfully)\n- src/index.tsx placeholder with solid-js import\n- All dependencies installed via `bun install`\n\nFILES CREATED:\n- package.json - Full dependency list for Effect + OpenTUI stack\n- tsconfig.json - Strict TS with jsx: \"react-jsx\", jsxImportSource: \"solid-js\"\n- bin/az.ts - Shebang entry point\n- src/index.tsx - Placeholder entry\n\nKEY DECISIONS:\n- Using Bun (not Node) because OpenTUI requires Bun's FFI for Zig backend\n- Using pnpm despite Bun runtime (hybrid setup works)\n- tsup for bundling (simpler than esbuild config)\n\nVERIFICATION:\n- `bun run type-check` passes\n- `./bin/az.ts` outputs \"Azedarach - TUI Kanban for Claude orchestration\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.210523+11:00","updated_at":"2025-12-11T17:27:44.457444+11:00","closed_at":"2025-12-11T17:25:13.896919+11:00","dependencies":[{"issue_id":"az-ags","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:07.779213+11:00","created_by":"daemon"}]}
{"id":"az-aiu","title":"Implement session templates for pre-planning prompts","description":"Create .claude/session-templates/ with task-type-specific CLAUDE.md templates (feature.md, bugfix.md, refactor.md, epic.md). Templates inject 'think first' planning phase. SessionManager loads appropriate template when spawning.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:24:59.891181+11:00","updated_at":"2025-12-12T13:25:20.531813+11:00"}
{"id":"az-ap1","title":"Complete CLI commands (attach, pause, status, sync)","description":"src/cli/index.ts has 5 TODO placeholders:\n\n- **attach** (line 174): Implement session attachment via TmuxService\n- **pause** (line 201): Implement session pause\n- **status** (line 226): Display session/board status summary\n- **sync** (line 255-259): Sync worktrees (all vs current directory)\n\nCLI should be fully functional for non-TUI workflows.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:59:44.511089+11:00","updated_at":"2025-12-17T15:59:44.511089+11:00"}
{"id":"az-bf8","title":"queue up commands that would conflict if run all at once","description":"e.g. space m (we shouldnt try to merge two branches at once!)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:48:33.510147+11:00","updated_at":"2025-12-17T15:51:46.00979+11:00","closed_at":"2025-12-17T15:51:46.009793+11:00"}
{"id":"az-bjp","title":"Parallel worker spawning from orchestration mode","description":"When user confirms orchestration, spawn workers in parallel.\n\n**Implementation:**\n- Use Effect.forEach with concurrency for parallel worktree creation\n- Each worker: WorktreeManager.create ‚Üí TmuxService.newSession ‚Üí inject template\n- Reserve issues via Agent Mail (if available)\n- Track all spawned workers in SessionManager\n\n**Error handling:**\n- If any spawn fails, show toast but continue with others\n- Partial success is acceptable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.790073+11:00","updated_at":"2025-12-14T02:13:30.509642+11:00","dependencies":[{"issue_id":"az-bjp","depends_on_id":"az-7sr","type":"blocks","created_at":"2025-12-12T13:29:24.844916+11:00","created_by":"daemon"},{"issue_id":"az-bjp","depends_on_id":"az-lqb","type":"blocks","created_at":"2025-12-12T13:29:24.88113+11:00","created_by":"daemon"},{"issue_id":"az-bjp","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.765448+11:00","created_by":"daemon"}]}
{"id":"az-bth","title":"can't put cursor on started task in normal mode","description":"its right above current cursor but up arrow does nothing. check az.log","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:50:52.307315+11:00","updated_at":"2025-12-15T14:07:19.991268+11:00","closed_at":"2025-12-15T14:07:19.991268+11:00"}
{"id":"az-c7e","title":"FileLockManager - prevent concurrent file access","description":"Implement socket-based file locking to prevent multiple Claude sessions from editing the same file simultaneously.","design":"- Define FileLockManager as Effect.Service\n- Use Unix domain socket for lock coordination (via @effect/platform)\n- Lock granularity: per-file path (normalized)\n- Methods:\n  - acquireLock(path, type): Effect\u003cLock, LockError | TimeoutError\u003e\n  - releaseLock(lock): Effect\u003cvoid, never\u003e\n  - withLock(path, type, effect): Effect\u003cA, E | LockError, R\u003e // scoped\n- Lock types: exclusive (write) vs shared (read) using Semaphore\n- Use Effect.timeout for lock acquisition timeout\n- Use Effect.ensuring for automatic lock release\n- Track locks in Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n- Handle session crash cleanup via Fiber interruption\n- Consider: advisory (warn via Logger) vs enforced (block via Deferred)\n- Socket path: /tmp/azedarach-\u003cproject-hash\u003e.sock","notes":"Implemented FileLockManager service following Effect patterns:\n\nCore implementation:\n- Service defined using Effect.Tag pattern (FileLockManager)\n- Lock types: exclusive (write) vs shared (read)\n- Error types: LockError, LockTimeoutError, LockConflictError\n- Lock state tracking via Ref\u003cHashMap\u003cPath, LockState\u003e\u003e\n\nKey methods:\n- acquireLock(path, type, timeout?, sessionId?): acquires lock or waits in queue\n- releaseLock(lock): releases lock and processes wait queue\n- getLockState(path): inspection for debugging/monitoring\n- withLock(options, effect): scoped convenience function for automatic cleanup\n\nLock semantics:\n- Exclusive locks: only one holder, blocks all other locks\n- Shared locks: multiple holders allowed, blocks exclusive locks\n- Wait queue processing: FIFO with automatic grant when compatible\n\nFeatures:\n- Effect.ensuring for automatic lock release\n- Deferred + timeoutFail for timeout handling\n- Automatic wait queue cleanup on fiber interruption\n- Path normalization for consistent lock granularity\n- Project hash for socket paths: /tmp/azedarach-\u003chash\u003e.sock\n\nFiles created:\n- src/core/FileLockManager.ts (580 lines)\n- src/core/FileLockManager.example.ts (354 lines with 8 examples)\n\nType checking: CLEAN (no errors)\nFollows patterns from: TmuxService, WorktreeManager, StateDetector","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:45.033059+11:00","updated_at":"2025-12-12T10:30:40.810809+11:00","closed_at":"2025-12-12T10:30:40.810809+11:00","dependencies":[{"issue_id":"az-c7e","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.562322+11:00","created_by":"daemon"}]}
{"id":"az-c9y","title":"Replace verbose StatusBar stats with compact indicators","description":"Replace verbose 'Tasks: 12  Active: 3' with compact indicators '12‚öô 3‚è∏ 2‚úó'. Expand to full text on wide terminals (‚â•100 cols). Add noteworthy alerts section that appears only when sessions need attention.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T13:24:59.538659+11:00","updated_at":"2025-12-12T13:25:20.220062+11:00","dependencies":[{"issue_id":"az-c9y","depends_on_id":"az-dqt","type":"blocks","created_at":"2025-12-12T13:25:26.209397+11:00","created_by":"daemon"}]}
{"id":"az-ce9","title":"how do we track context? do we watch this bit in claude code somehow?","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T01:11:36.741749+11:00","updated_at":"2025-12-18T01:11:36.741749+11:00"}
{"id":"az-cgf","title":"Add VC command input mode (:)","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-14T01:05:15.626687+11:00","updated_at":"2025-12-14T01:10:33.962738+11:00","closed_at":"2025-12-14T01:10:33.962738+11:00","dependencies":[{"issue_id":"az-cgf","depends_on_id":"az-f4q","type":"blocks","created_at":"2025-12-14T01:05:21.400864+11:00","created_by":"daemon"}]}
{"id":"az-cl1","title":"Add concurrency limit config for parallel sessions","description":"Add configuration option to limit maximum number of parallel Claude sessions.\n\nInspiration: AutoMaker's maxConcurrency setting with canStartNewTask check.\n\nImplementation:\n1. Add maxConcurrency to config schema (default: unlimited or 5)\n2. Check limit in SessionManager before starting new session\n3. Show visual indicator when at capacity\n4. Optionally queue pending starts when limit reached\n5. Display running/max in status bar (e.g., '3/5 sessions')","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:04Z","updated_at":"2025-12-16T12:00:04Z"}
{"id":"az-cs0","title":"when performing left/right actions keep action mode active. otherwise return to normal mode immediately","description":"currently if i space S action mode remains until the toast appears instead of returning to normal mode as soon as i press \"S\". this is just an example","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:15:17.592791+11:00","updated_at":"2025-12-17T14:15:21.967725+11:00","closed_at":"2025-12-17T14:15:21.967725+11:00"}
{"id":"az-csh","title":"when a title is too long truncate it so the text doesnt overflow","description":"","notes":"Working on adding title truncation to TaskCard.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:27:43.068828+11:00","updated_at":"2025-12-17T00:47:49.957663+11:00","closed_at":"2025-12-17T00:47:49.957663+11:00"}
{"id":"az-czq","title":"Tmux popup persists after Ctrl-C when editor was opened via 'c'","description":"When user presses 'c' to create a bead via editor, a tmux popup is spawned. If user Ctrl-C's azedarach before closing the popup, the popup remains orphaned and must be manually dismissed.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.795322+11:00","updated_at":"2025-12-14T21:46:18.162342+11:00","closed_at":"2025-12-14T21:46:18.162342+11:00"}
{"id":"az-d1v","title":"look into how tools like ccmonitor keep track of token/context usage","description":"https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/tree/main\nthey may have a better way than we currently use to track context usage in a session","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T00:28:23.974311+11:00","updated_at":"2025-12-18T00:28:23.974311+11:00"}
{"id":"az-d5q","title":"Help overlay with keybinding reference","description":"Contextual help overlay showing available commands.","design":"- Toggle with '?' key\n- Show all keybindings grouped by category\n- Context-aware: highlight actions valid for selected task\n- Dismiss with any key or Escape\n- Include version info","notes":"Created HelpOverlay component with Catppuccin-themed modal showing all keybindings grouped by category (Navigation, Modes, Select Mode, Action Mode, General). Added '?' keybind to App.tsx to toggle the help overlay. The overlay dismisses on any key press. Successfully type-checked with no errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.840117+11:00","updated_at":"2025-12-12T01:29:02.41928+11:00","closed_at":"2025-12-12T01:29:02.41928+11:00","dependencies":[{"issue_id":"az-d5q","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.144875+11:00","created_by":"daemon"}]}
{"id":"az-d8z","title":"Session Management","description":"Core orchestration layer: git worktrees, tmux sessions, Claude spawning, state detection, and file locking to prevent concurrent access.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.762911+11:00","updated_at":"2025-12-12T10:33:37.439444+11:00","closed_at":"2025-12-12T10:33:37.439444+11:00"}
{"id":"az-dl1","title":"Add detail level toggle for cards","description":"Add toggle to switch between minimal/standard/detailed card views.\n\nInspiration: AutoMaker's three-level detail toggle.\n\nLevels:\n- Minimal: ID + title only (fits more tasks on screen)\n- Standard: Current view (ID, title, priority, status indicator)\n- Detailed: Add description preview, session metrics, context health\n\nImplementation:\n1. Add detailLevel to ViewService (minimal/standard/detailed)\n2. Add 'd' key to cycle through levels\n3. Adjust TaskCard rendering based on level\n4. Persist preference in config","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:02Z","updated_at":"2025-12-16T12:00:02Z"}
{"id":"az-dn2","title":"we keep losing beads in the tui when doing stuff like killing other bead's sessions etc","description":"the following log may be related:\ntimestamp=2025-12-16T13:19:15.063Z level=WARN fiber=#1356 message=\"Sync failed for az-31i: ParseError: Failed to parse JSON: SyntaxError: JSON Parse error: Unrecognized token '‚Üí'\"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T23:42:04.341522+11:00","updated_at":"2025-12-17T01:02:07.434596+11:00","closed_at":"2025-12-17T01:02:07.4346+11:00"}
{"id":"az-dpi","title":"Integrate Agent Mail with SessionManager","description":"Wire Agent Mail into session lifecycle for automatic reservation management.\n\nDesign:\n- SessionManager.start() calls agentMail.reserve() before worktree creation\n- SessionManager.stop() calls agentMail.release() after cleanup\n- SessionManager.pause() keeps reservation but updates status\n- Add reservation info to Session type\n- Fail session start if issue already reserved by another agent\n- Handle reservation conflicts gracefully\n- Update Kanban board to show reservation status (who owns what)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.738474+11:00","updated_at":"2025-12-12T10:33:13.738474+11:00","dependencies":[{"issue_id":"az-dpi","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.870895+11:00","created_by":"daemon"},{"issue_id":"az-dpi","depends_on_id":"az-4r0","type":"blocks","created_at":"2025-12-12T10:33:21.939099+11:00","created_by":"daemon"},{"issue_id":"az-dpi","depends_on_id":"az-tgc","type":"blocks","created_at":"2025-12-12T10:33:21.972727+11:00","created_by":"daemon"}]}
{"id":"az-dqt","title":"Extend TaskWithSession type with session metrics","description":"Extend TaskWithSession interface with optional session metrics: contextPercent (0-100), sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput. This is the foundation for other session metrics features.","notes":"Session 2025-12-12: Created from Claude Code best practices research.\n\nRESEARCH CONTEXT:\n- 6 parallel research agents analyzed: Anthropic blog, Reddit, latest features, orchestration tools, CLAUDE.md patterns, real-world usage\n- Key finding: Context % monitoring is critical - users hit auto-compact (95%) unexpectedly\n- Key finding: MCP servers consume 55K-134K tokens before conversation starts\n- Design: Use progressive disclosure - border colors for at-a-glance, DetailPanel for full metrics\n\nUI DESIGN DECISIONS:\n- Border color encodes context health: lavender (\u003c70%), yellow (70-90%), red (\u003e90%)\n- Only show metrics when session is active (not idle)\n- Extend existing TaskWithSession type (no new components needed)\n\nIMPLEMENTATION NOTES:\n- Add: contextPercent, sessionStartedAt, estimatedTokens, lastCompactedAt, recentOutput\n- All fields optional (populated when session active)\n- This is foundation - unblocks az-6la, az-5p5, az-2ek, az-c9y\n\nNEXT STEP: Implement type changes in src/ui/types.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T13:25:00.109541+11:00","updated_at":"2025-12-14T00:37:36.658207+11:00","closed_at":"2025-12-13T00:58:21.053672+11:00"}
{"id":"az-e0w","title":"board doesn't seem to update when i change sort mode","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T16:48:52.461805+11:00","updated_at":"2025-12-17T16:50:15.44003+11:00","deleted_at":"2025-12-17T16:50:15.44003+11:00","deleted_by":"riordan","delete_reason":"manual delete","original_type":"task"}
{"id":"az-e3k","title":"do a full report on all the beads flows az uses","description":"i want to know all the ways our app connects with beads/uses the beads cli","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:14:03.324845+11:00","updated_at":"2025-12-18T10:46:02.515969+11:00","closed_at":"2025-12-18T10:19:39.166353+11:00","close_reason":"Completed full report documenting all 11 bd CLI commands, 17 integration files, and 3 architectural layers (BeadsClient facade, Effect services, UI handlers)","deleted_at":"2025-12-18T10:46:02.515969+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ee4","title":"Configuration \u0026 Polish","description":"User configuration (cosmiconfig + zod), multi-project support, help system, and final polish.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:05.070257+11:00","updated_at":"2025-12-11T14:44:05.070257+11:00"}
{"id":"az-eei","title":"creating beads with space C (capital) not working","description":"i dont see any errors in log either","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:12.469026+11:00","updated_at":"2025-12-17T01:07:50.693525+11:00","closed_at":"2025-12-17T01:07:50.693525+11:00"}
{"id":"az-esy","title":"Implement inline attachment mode in AttachmentService","description":"src/core/AttachmentService.ts line 204 has TODO for inline attachment.\n\nCurrently only external tmux attachment works. Inline mode should:\n- Capture session output in current terminal\n- Overlay UI on top of session stream\n- Allow quick interactions without leaving TUI","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:59:44.670743+11:00","updated_at":"2025-12-17T15:59:44.670743+11:00"}
{"id":"az-et1","title":"Add elapsed timer to TaskCard","description":"Display MM:SS elapsed timer on TaskCards when session is active (busy/waiting state).\n\nInspiration: AutoMaker's CountUpTimer component.\n\nImplementation:\n1. Already have session startedAt timestamp in session metrics\n2. Add timer display component that updates every second\n3. Show on card when session state is busy or waiting\n4. Format as MM:SS (pad with zeros)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T12:00:01Z","updated_at":"2025-12-17T14:09:14.159624+11:00","closed_at":"2025-12-17T14:09:14.159624+11:00"}
{"id":"az-f4q","title":"Add auto-pilot toggle keybinding (a)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T01:05:15.523081+11:00","updated_at":"2025-12-14T01:06:38.936838+11:00","closed_at":"2025-12-14T01:06:38.936838+11:00"}
{"id":"az-fei","title":"when i search and press enter on a search result i expect to put cursor on that item in normal mode","description":"it should be scrolled into view too","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T10:16:12.214738+11:00","updated_at":"2025-12-18T12:25:51.509771+11:00","close_reason":"Added mode change watcher to NavigationService that calls ensureValidFocus() when the search query changes. This keeps focusedTaskId in sync with the filtered view, so when Enter is pressed in search mode, the cursor stays on the visible task.","deleted_at":"2025-12-18T12:25:51.509771+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-fjy","title":"add a git push keybind","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:59:10.618121+11:00","updated_at":"2025-12-17T10:32:36.837731+11:00","closed_at":"2025-12-17T10:32:36.837731+11:00"}
{"id":"az-fn1","title":"Allow creating beads via Claude prompt with persistent session","description":"Enable users to create new beads from within azedarach by sending a natural language prompt to Claude.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T02:19:56.843403+11:00","updated_at":"2025-12-17T00:20:45.047717+11:00"}
{"id":"az-foy","title":"Update docs from Ink to OpenTUI + React","description":"","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-12T17:16:24.188255+11:00","updated_at":"2025-12-12T17:16:32.49283+11:00","closed_at":"2025-12-12T17:16:32.49283+11:00"}
{"id":"az-fvj","title":"BeadsClient - wrapper around bd CLI","description":"Create a TypeScript wrapper around the bd CLI for reading and updating beads issues.","design":"- Define BeadsClient as Effect Service using Effect.Service\n- Use @effect/platform Command for shelling out to bd\n- Methods return Effect with typed errors:\n  - list(): Effect\u003cIssue[], BeadsError\u003e\n  - show(id): Effect\u003cIssue, BeadsError | NotFoundError\u003e\n  - update(id, fields): Effect\u003cvoid, BeadsError\u003e\n  - close(id): Effect\u003cvoid, BeadsError\u003e\n  - sync(): Effect\u003cSyncResult, BeadsError\u003e\n- Use @effect/schema for parsing bd --json output\n- Support running in different worktrees via workingDirectory option\n- Create BeadsClientLive layer with real implementation\n- Create BeadsClientTest layer for testing","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full Effect service wrapping bd CLI\n- Schema validation for Issue type\n- All major bd commands wrapped with typed errors\n\nFILES CREATED:\n- src/core/BeadsClient.ts (447 lines) - Complete service\n- src/core/BeadsClient.example.ts (152 lines) - 8 usage examples\n\nSERVICE METHODS:\n- list(filters?) - List issues with status/priority/type filters\n- show(id) - Get single issue details\n- update(id, fields) - Update status/notes/priority\n- close(id, reason?) - Close issue\n- sync() - Push/pull beads database\n- ready() - Get unblocked issues\n- search(query) - Search issues\n\nERROR TYPES:\n- BeadsError - Generic bd command failures\n- NotFoundError - Issue not found\n- ParseError - JSON/Schema validation errors\n\nLAYERS:\n- BeadsClientLive - Service only (needs BunContext)\n- BeadsClientLiveWithPlatform - Complete with platform deps (recommended)\n\nVERIFICATION:\n- Type check passes\n- Runtime test fetched 10 ready issues from actual beads database","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:26.409567+11:00","updated_at":"2025-12-11T17:27:44.655776+11:00","closed_at":"2025-12-11T17:25:14.06403+11:00","dependencies":[{"issue_id":"az-fvj","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.006035+11:00","created_by":"daemon"},{"issue_id":"az-fvj","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.575251+11:00","created_by":"daemon"}]}
{"id":"az-g19","title":"Terminal attachment (external and inline)","description":"Implement session attachment for manual intervention.","design":"- External (a): detect terminal emulator, open new window/tab with tmux attach\n- Ghostty: ghostty -e tmux attach-session -t \u003cid\u003e\n- iTerm: osascript to open new tab\n- Inline (A): replace TUI with session output, handle detach to return\n- Track which sessions user has attached to","notes":"Implementation complete:\n\n1. Created AttachmentService (src/core/AttachmentService.ts):\n   - External attachment via attachExternal() - opens new terminal window/tab\n   - Inline attachment stub via attachInline() - reserved for future implementation\n   - Terminal type detection (Ghostty, iTerm, Terminal.app)\n   - Attachment history tracking\n   - Proper Effect error handling with AttachmentError and SessionNotFoundError\n\n2. Updated atoms.ts:\n   - Added AttachmentService to runtime layer (appLayer)\n   - Created attachExternalEffect() and attachInlineEffect() helper functions\n   - Properly composed layers with dependencies (AttachmentService depends on TmuxService and TerminalService)\n\n3. Integrated with App.tsx keyboard handling:\n   - Added 'a' key in action mode (Space + a) for external attachment\n   - Added 'A' key in action mode (Space + A) for inline attachment (shows error for now)\n   - Session ID is constructed as 'claude-{task.id}'\n   - Error handling with console.error fallback\n\nTechnical details:\n- AttachmentService uses TmuxService for session validation and attach command generation\n- TerminalService provides terminal detection and command execution\n- External attachment opens new terminal with 'tmux attach-session -t {sessionId}'\n- Inline attachment is stubbed - future implementation will require suspending TUI renderer\n- All code passes type-check with strict TypeScript mode\n- No 'as' casts or 'any' types used\n\nUsage:\n1. Navigate to a task with hjkl\n2. Press Space to enter action mode\n3. Press 'a' to attach externally in new terminal window\n4. Press 'A' to attempt inline (will show error message)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:08.219579+11:00","updated_at":"2025-12-12T10:32:33.851115+11:00","closed_at":"2025-12-12T10:32:33.851115+11:00","dependencies":[{"issue_id":"az-g19","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.313043+11:00","created_by":"daemon"}]}
{"id":"az-g7p","title":"sometimes space S/s moves the task to in progress but doesnt start a tmux session","description":"what could even cause the tmux session to not be started? check az.log maybe","notes":"Root cause identified: Action handlers in KeyboardService use Effect.tap() which fires-and-forgets the inner Effect. Need to change to Effect.flatMap() to properly await the session start.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:44:06.046821+11:00","updated_at":"2025-12-18T02:14:02.600175+11:00","closed_at":"2025-12-17T17:01:19.62138+11:00","close_reason":"Fixed: Moved bead status update from BEFORE session creation to AFTER. Previously if worktree, init commands, or tmux session creation failed, the bead would be left in \"in_progress\" state with no actual session. Now the status only updates after the session is successfully created.","deleted_at":"2025-12-18T02:14:02.600175+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-g84","title":"space c (chat with claude about task) not working","description":"it seems to start a session cause i see a blue dot in az tui but when i press space a it says it failed to attach (not found) i also think it would be better to attach inline or whatever its called in this instance (overlay tui and end on closing out) similar to the log viewer (L) keybind","notes":"Investigated the issue. Found two problems:\n\n1. Space+c starts session but doesn't auto-attach - user sees blue dot but session lookup fails on Space+a\n2. User wants inline popup attach (like Shift+L for logs) instead of external terminal\n\nSolution: Modify actionChatAboutTask to use tmux displayPopup like the log viewer, which will:\n- Start the Claude chat session\n- Immediately show it in a popup overlay\n- Auto-close popup when session ends","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:21:47.203086+11:00","updated_at":"2025-12-18T02:14:02.603071+11:00","closed_at":"2025-12-17T16:27:28.647989+11:00","deleted_at":"2025-12-18T02:14:02.603071+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-gds","title":"Subagent orchestration for parallel epic development","description":"Enable TUI to orchestrate multiple parallel Claude sessions working on related tasks (e.g., epic children). Each worker runs in its own worktree/tmux session. Coordination via Agent Mail for real-time updates, beads for persistent state.\n\n**Key Features:**\n1. Space+o on epic ‚Üí orchestration mode showing child tasks\n2. Select which tasks to parallelize\n3. Spawn workers (worktree + tmux + claude per task)\n4. Workers get injected context about epic and coordination rules\n5. Real-time progress tracking via Agent Mail status broadcasts\n6. Epic progress bar showing X/Y tasks complete\n7. Optional orchestrator Claude for planning/review phases\n\n**Architecture:**\n- TUI is external orchestrator (not a Claude subagent)\n- Workers are independent Claude sessions\n- Agent Mail handles: reservations, status, completion signals\n- Beads handles: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\n**New UI:**\n- Orchestration mode (Space+o)\n- Epic progress indicator (‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5)\n- Indented child tasks under epic\n- Worker status in session indicators\n\n**Session Templates:**\n- worker.md template with epic context injection\n- Coordination rules (stay focused, report discoveries)\n- Auto-close task on completion","notes":"Session 2025-12-12: Designed from Claude Code best practices research.\n\nRESEARCH VALIDATION:\n- Pattern confirmed: Git worktrees are de facto standard for parallel AI agents (Cursor, ccswarm, Claude-Flow all use this)\n- Key insight: TUI as external orchestrator avoids Claude subagent nesting limits\n- Agent Mail provides \u003c100ms coordination vs 2-5s git sync\n\nARCHITECTURE DECISIONS:\n- TUI spawns workers (not Claude spawning subagents) - no nesting limits\n- Each worker: worktree + tmux session + Claude instance\n- Agent Mail for: reservations, status broadcasts, completion signals  \n- Beads for: persistent notes, design decisions\n- Graceful degradation to git-only if Agent Mail unavailable\n\nUI DESIGN:\n- Space+o triggers orchestration mode on epics\n- Reuse select mode patterns for task selection\n- Progress bar: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 3/5 format\n- Indented children under epics in board view\n\nDEPENDENCIES:\n- az-7sr (orch mode) + az-lqb (template) ‚Üí az-bjp (spawning)\n- az-l7a (Agent Mail epic) ‚Üí az-2il (status broadcasts)\n\nNEXT STEP: Implement az-7sr (orchestration mode) or az-lqb (worker template) - both are ready","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T13:28:50.911119+11:00","updated_at":"2025-12-12T16:35:31.355396+11:00"}
{"id":"az-ghj","title":"clean up open tasks and offer to create 5-10 new tasks based on gaps in our program/tech debt","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:59.901658+11:00","updated_at":"2025-12-18T02:14:02.605602+11:00","closed_at":"2025-12-17T16:13:04.792751+11:00","deleted_at":"2025-12-18T02:14:02.605602+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-h3v","title":"Agent Mail server for local development","description":"Implement simple Agent Mail server for local multi-agent testing.\n\nDesign:\n- Bun HTTP server with Effect\n- In-memory reservation store (Map\u003cissueId, agentName\u003e)\n- Endpoints:\n  - POST /reserve/:issueId - acquire reservation\n  - POST /release/:issueId - release reservation\n  - GET /ready - list unreserved, unblocked issues\n  - POST /status/:issueId - update status\n  - GET /health - server health check\n- WebSocket support for real-time notifications (optional)\n- Configurable port via CLI argument\n- Graceful shutdown handling","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T10:33:13.621222+11:00","updated_at":"2025-12-12T10:33:13.621222+11:00","dependencies":[{"issue_id":"az-h3v","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.836567+11:00","created_by":"daemon"}]}
{"id":"az-hdj","title":"does pty watcher handle using tmux to add windows/panels to the bead session?","description":"","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T10:36:14.373167+11:00","updated_at":"2025-12-18T12:39:42.061838+11:00","close_reason":"Investigated: PTYMonitor does NOT handle multiple windows/panes. It only captures the default pane (session:0.0). If users split panes or add windows, those are not monitored. To fix, would need to store the pane ID at session start and target it explicitly with `-t %{pane_id}` format.","deleted_at":"2025-12-18T12:39:42.061838+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-hri","title":"Basic Kanban board component (OpenTUI + Solid)","description":"Create the main Ink-based Kanban board displaying beads issues in columns by status.","design":"- Use OpenTUI + SolidJS for components\n- App.tsx: root component, provides Effect runtime context\n- Board.tsx: horizontal flexbox layout of columns (Yoga)\n- Column.tsx: vertical list of tasks per status (open, in_progress, blocked, review, closed)\n- TaskCard.tsx: individual task with title, id, session indicator\n- Session indicators: üîµ Busy, üü° Waiting, ‚úÖ Done, ‚ùå Error, ‚è∏Ô∏è Paused\n- Use SolidJS signals for reactive state (pairs well with Effect Ref)\n- Use createResource for async data fetching from Effect services\n- Style with OpenTUI's built-in primitives (Box, Text, etc.)","notes":"Implemented basic Kanban board component with OpenTUI + SolidJS:\n\n- Created UI types (SessionState, TaskWithSession, COLUMNS, SESSION_INDICATORS)\n- TaskCard.tsx: displays individual tasks with title, ID, session indicator, priority color\n- Column.tsx: vertical list of tasks per status with header and count\n- Board.tsx: horizontal layout of columns using Yoga flexbox\n- StatusBar.tsx: bottom bar with keyboard shortcuts and stats\n- App.tsx: root component with Effect runtime, fetches tasks from BeadsClient\n- launch.tsx: TUI initialization with OpenTUI render\n\nAll components use OpenTUI primitives (box, text) with proper styling (fg/bg colors, attributes for bold, border styles). Successfully type checks with strict mode.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.662469+11:00","updated_at":"2025-12-11T18:03:13.707242+11:00","closed_at":"2025-12-11T18:03:13.707242+11:00","dependencies":[{"issue_id":"az-hri","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.667781+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.898548+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-fvj","type":"blocks","created_at":"2025-12-11T14:46:26.110348+11:00","created_by":"daemon"},{"issue_id":"az-hri","depends_on_id":"az-mq9","type":"blocks","created_at":"2025-12-11T17:10:08.980724+11:00","created_by":"daemon"}]}
{"id":"az-i0d","title":"improve the initial prompt when we press space S","description":"sometimes claude gets confused and doesnt realise we are saying to work on a specific bead with that id","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:23:28.189773+11:00","updated_at":"2025-12-18T02:14:02.596918+11:00","closed_at":"2025-12-18T01:34:17.372932+11:00","close_reason":"Improved the initial prompt in Space+S to include the task title alongside the bead ID. Now sends \"work on az-xxx: \u003ctitle\u003e\" instead of just \"work on az-xxx\", giving Claude clearer context about what to work on.","deleted_at":"2025-12-18T02:14:02.596918+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-k5a","title":"is there a hook for when claude requests to enter plan mode","description":"if there is we should use it to update the session status\nif not we should improve our pty monitoring to pick it up","notes":"## Research Findings\n\n**Answer: No dedicated hook for plan mode entry/exit.**\n\nPlan mode is a permission system state, not a tool-based event. However, detection is possible via:\n\n### Available Options for Azedarach\n\n1. **Monitor `permission_mode` field in hooks** - All hooks receive this field:\n   - `PreToolUse`, `PostToolUse`, `PermissionRequest` all include `permission_mode: \"plan\"|\"default\"|...`\n   - Could detect mode by watching for changes in this field\n\n2. **PTY output monitoring** (current approach) - Look for plan mode indicators:\n   - Claude asking \"Would you like me to enter plan mode?\"\n   - Plan mode banner/status in terminal output\n   - ExitPlanMode tool calls\n\n3. **Transcript file parsing** - `transcript_path` in hook inputs points to conversation JSON\n\n### Recommendation for Azedarach\n\nEnhance PTY monitoring to detect:\n- Plan mode entry prompt patterns\n- `permission_mode` changes via any existing hooks we're using\n- Plan mode exit via ExitPlanMode tool detection\n\nThis is a documentation/research task - no code changes needed unless we want to implement enhanced detection.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:33:09.074229+11:00","updated_at":"2025-12-18T12:42:32.735864+11:00","closed_at":"2025-12-18T12:42:32.735864+11:00","close_reason":"Implemented plan mode detection via PTY monitoring. Added planMode as AgentPhase with detection patterns for plan mode indicators, ExitPlanMode tool, and status bar patterns.","comments":[{"id":5,"issue_id":"az-k5a","author":"riordan","text":"Implementing plan mode detection via PTY monitoring as requested","created_at":"2025-12-18T01:40:43Z"}],"deleted_at":"2025-12-18T12:39:42.059798+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-k5m","title":"Persist session state via tmux query","description":"Session state is lost on azedarach restart because SessionManager stores state in-memory Ref. Fix by querying tmux list-sessions on startup and matching session names to bead IDs.","design":"Option 1 (recommended): Query tmux as source of truth\n- On SessionManager init or listActive(), also run tmux list-sessions\n- Parse session names matching our pattern (just beadId)\n- Merge with in-memory state\n- Tmux existence = session exists, regardless of in-memory state\n\nImplementation:\n1. Add syncFromTmux() method to SessionManager\n2. Call it in listActive() before returning\n3. Or call it once on service init via Effect.sync in the Layer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:33:52.363085+11:00","updated_at":"2025-12-12T11:34:33.533566+11:00","closed_at":"2025-12-12T11:34:33.533566+11:00"}
{"id":"az-kej","title":"add a way to see the diff between a bead branch and main so i can code review","description":"","design":"## Implementation Plan: Git Diff Overlay\n\n### Overview\nAdd a \"diff\" action (Space+g) that shows git diff between the bead's branch and main in a scrollable overlay. This enables code review directly from the Azedarach TUI.\n\n### Architecture\nFollowing existing patterns:\n1. **PRWorkflow**: Add `getDiff()` method to get branch diff\n2. **OverlayService**: Add `diff` overlay type  \n3. **prHandlers**: Add `showDiff()` handler\n4. **bindings.ts**: Register `g` key in action mode\n5. **DiffOverlay**: New component to display diff with syntax coloring\n6. **useOverlays**: Add `showingDiff` flag\n7. **App.tsx**: Render DiffOverlay\n8. **ActionPalette**: Add \"diff\" action line\n\n### Key Design Decisions\n- Use `git diff main..{branch}` for the diff (shows what branch adds to main)\n- Display in tmux popup for proper scrolling and less +F style viewing\n- Key: `g` in action mode (mnemonic: \"git diff\" or \"get diff\")\n- Requires non-idle session (needs worktree to diff)\n\n### Implementation Order\n1. Add getDiff to PRWorkflow.ts\n2. Add handler in prHandlers.ts  \n3. Register keybinding in bindings.ts\n4. Add to ActionPalette.tsx\n5. Update docs/keybindings.md","notes":"Using tmux popup approach (like Space+L for logs) instead of custom overlay - simpler, better scrolling, proper terminal rendering of ANSI colors from git diff","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T02:10:27.860224+11:00","updated_at":"2025-12-18T12:45:04.438616+11:00"}
{"id":"az-kgq","title":"Multi-project support","description":"Monitor tasks across multiple beads-enabled projects.","design":"- az add /path/to/project: register project\n- az list: show registered projects\n- Combined view: tasks from all projects, grouped or mixed\n- Project selector/filter in TUI\n- Per-project configuration","notes":"Starting implementation. Explored codebase - SessionManager already project-aware, need to add ProjectService and update hardcoded process.cwd() usages.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T14:45:41.986553+11:00","updated_at":"2025-12-18T13:05:55.3238+11:00","closed_at":"2025-12-18T13:05:55.3238+11:00","close_reason":"Implemented multi-project support with ProjectService, CLI commands (az project add/list/remove/switch), BeadsClient cwd parameter, and TUI project selector (g p with 1-9 keys)","dependencies":[{"issue_id":"az-kgq","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.274456+11:00","created_by":"daemon"}]}
{"id":"az-kis","title":"Utility modules: paths, logger, tmux helpers","description":"Create foundational utility modules used throughout the codebase.","design":"- paths.ts: worktree path generation, project name extraction (pure functions)\n- logger.ts: Use Effect's built-in Logger service with custom formatting\n- tmux.ts: TmuxService as Effect.Service wrapping @effect/platform Command\n  - Methods: newSession, attachSession, sendKeys, listSessions, killSession\n  - Typed errors: TmuxNotFoundError, SessionNotFoundError\n- terminal.ts: TerminalService for detecting/launching terminal emulators\n  - Support Ghostty, iTerm, Terminal.app\n  - Returns Effect with TerminalNotFoundError","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- TmuxService Effect service\n- TerminalService Effect service\n- paths.ts pure utility functions\n\nFILES CREATED:\n- src/core/TmuxService.ts (3.6KB) - tmux session management\n- src/core/TerminalService.ts (1.8KB) - terminal detection/launching\n- src/core/paths.ts (868B) - path utilities\n- src/core/example-usage.ts (2.5KB) - usage examples\n\nTMUX SERVICE METHODS:\n- newSession(name, opts?) - Create detached session\n- killSession(name) - Kill session\n- listSessions() - List with metadata (windows, created, attached)\n- hasSession(name) - Check existence\n- sendKeys(session, keys) - Send keystrokes\n- attachCommand(session) - Get attach command string\n\nTERMINAL SERVICE METHODS:\n- detect() - Returns \"ghostty\" | \"iterm\" | \"terminal-app\" | \"unknown\"\n- openWithCommand(cmd) - Opens new terminal window with command\n\nPATH UTILITIES:\n- getProjectName(path) - Extract basename\n- getWorktreePath(projectPath, beadId) - ../ProjectName-\u003cbeadId\u003e/\n- getSessionName(beadId) - Uses bead ID directly\n- normalizePath(path) - path.resolve()\n\nVERIFICATION:\n- All files compile with TypeScript strict mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:44:26.516814+11:00","updated_at":"2025-12-11T17:27:44.742141+11:00","closed_at":"2025-12-11T17:25:14.137924+11:00","dependencies":[{"issue_id":"az-kis","depends_on_id":"az-05y","type":"parent-child","created_at":"2025-12-11T14:46:08.116031+11:00","created_by":"daemon"},{"issue_id":"az-kis","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T14:46:25.747591+11:00","created_by":"daemon"}]}
{"id":"az-krz","title":"User documentation and guides","description":"Create comprehensive user documentation in docs/ folder covering TUI usage, keybindings, tmux integration, services architecture, and testing procedures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:43:35.93321+11:00","updated_at":"2025-12-12T10:43:42.698148+11:00","closed_at":"2025-12-12T10:43:42.698148+11:00"}
{"id":"az-kud","title":"improve tmux workflow","description":"i want to figure out a way to use az as the primary way i navigate through tmux to the right sessions.\ni am just starting to learn tmux so i may be doing thing all wrong but so far i've been pressing ctrl-a s to open the tmux session picker i guess and then navigating to az session or another session created previously by az.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:24:37.484276+11:00","updated_at":"2025-12-16T22:37:21.448766+11:00","closed_at":"2025-12-16T22:37:21.448766+11:00"}
{"id":"az-kzk","title":"Quick task creation from TUI","description":"Create new beads tasks without leaving the TUI.","design":"- 'n' key opens task creation modal\n- ink-text-input for title, description\n- Select type, priority from list\n- Optionally set dependencies\n- Calls bd create under the hood","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:42.159577+11:00","updated_at":"2025-12-12T12:20:02.57418+11:00","closed_at":"2025-12-12T12:20:02.57418+11:00","dependencies":[{"issue_id":"az-kzk","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.411847+11:00","created_by":"daemon"}]}
{"id":"az-l7a","title":"Agent Mail Integration for Multi-Agent Coordination","description":"Implement Agent Mail coordination layer for multi-agent beads workflows. Agent Mail reduces coordination latency from 2-5 seconds (git sync) to \u003c100ms (HTTP API), preventing work collisions when multiple Claude sessions operate simultaneously.\n\nKey benefits:\n- 20-50x faster coordination than git sync\n- Prevents duplicate work through exclusive file reservations\n- Lightweight (~50MB memory footprint)\n- Optional with graceful degradation to git-only\n\nIntegration points:\n1. Issue reservation before starting work\n2. Issue release when work completes\n3. Ready query to find unblocked, unreserved issues\n4. Status updates for real-time visibility\n\nConfiguration:\n- BEADS_AGENT_MAIL_URL: Server endpoint\n- BEADS_AGENT_NAME: Unique agent identifier\n- BEADS_PROJECT_ID: Shared namespace\n\nReference: https://github.com/steveyegge/beads/blob/main/docs/AGENT_MAIL.md","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T10:32:57.000556+11:00","updated_at":"2025-12-12T10:32:57.000556+11:00"}
{"id":"az-l7d","title":"enhance docs with all keybinds, modes, vc explainer, etc","description":"Enhanced documentation with:\\n- keybindings.md: Space+m (merge), Space+i (image attach), Image Attachment Overlay section\\n- services.md: ImageAttachmentService documentation\\n- README.md: Expanded VC Integration with architecture diagram, decision table, examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:14:45.203716+11:00","updated_at":"2025-12-17T14:14:51.661199+11:00","closed_at":"2025-12-17T14:14:51.661199+11:00"}
{"id":"az-lex","title":"setup ~/prog/Chefy with az config","description":"we need to setup chefy ready to use az with a proper config. draw inspo from this repo's config. chefy uses pnpm so pnpm i not bun i on new worktrees, it also uses direnv but should use envdev as well after direnv allow, should also use zsh, etc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:46:08.985802+11:00","updated_at":"2025-12-17T15:35:21.03052+11:00","closed_at":"2025-12-17T15:35:21.030523+11:00"}
{"id":"az-lit","title":"when we create a bead we should immediately put the cursor on it","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:22:17.05286+11:00","updated_at":"2025-12-17T00:52:00.683781+11:00","closed_at":"2025-12-17T00:52:00.683781+11:00"}
{"id":"az-lqb","title":"Worker session template with epic context injection","description":"Create worker.md session template that injects:\n- Task title, description, design\n- Parent epic context (title, design, goals)\n- Coordination rules (stay focused, report discoveries)\n- bd commands for status updates\n\n**Template variables:** $TASK_ID, $TASK_TITLE, $EPIC_ID, $EPIC_TITLE, $EPIC_DESIGN\n\n**Location:** .claude/session-templates/worker.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:29:14.913748+11:00","updated_at":"2025-12-14T02:13:27.604322+11:00","dependencies":[{"issue_id":"az-lqb","depends_on_id":"az-gds","type":"parent-child","created_at":"2025-12-12T13:29:32.80298+11:00","created_by":"daemon"}]}
{"id":"az-lsi","title":"figure out whats next with our claude status hook system","description":"","notes":"Starting implementation of Option 1: Integrate Claude Code's native hooks (Notification, Stop, SessionEnd) for authoritative state detection in spawned worktrees.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:58:54.252353+11:00","updated_at":"2025-12-17T11:17:26.126289+11:00","closed_at":"2025-12-17T11:17:26.126292+11:00"}
{"id":"az-mlv","title":"when i press space m on beads that are in closed column but have tmux session running they seem to merge ok but the beads disappear from closed","description":"no idea where they disappear to","design":"## Root Cause\n\nThe `bd merge` driver uses standard 3-way merge semantics:\n- If a bead exists in base (ancestor) and main, but NOT in branch\n- Merge interprets this as \"branch deleted the bead\"\n- Result: bead is removed from main, marked as tombstone in DB\n\n## Why Branch Has Missing Beads\n\nWorktree's .beads/issues.jsonl becomes incomplete due to:\n1. Worktree created from older main (before bead existed)\n2. bd sync failures that don't import all beads\n3. Conflict resolution that drops beads\n\n## Proposed Fix\n\nAdd `bd sync --import-only` call in main AFTER the git merge to recover any beads that were incorrectly removed by the merge driver. This ensures the main database re-imports from the merged JSONL.","notes":"Root cause found: PRWorkflow.mergeToMain calls `beadsClient.sync(worktree.path)` without `--from-main` flag. Comment says --from-main but code doesn't use it. Fix: add syncFromMain method to BeadsClient and use it in merge workflow.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:11:43.179532+11:00","updated_at":"2025-12-18T02:14:02.598659+11:00","closed_at":"2025-12-18T02:01:50.13422+11:00","close_reason":"Fixed: Added syncImportOnly after git merge in PRWorkflow.mergeToMain to recover beads that may be incorrectly removed by the bd merge driver's 3-way merge semantics","deleted_at":"2025-12-18T02:14:02.598659+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-moj","title":"State transition hooks system","description":"Pluggable hook system for state transition events.","design":"- Define HookRegistry as Effect.Service\n- Hook types as tagged union: onWaiting | onDone | onError | onPaused\n- Built-in hooks: NotificationHook, PRCreationHook, BeadsSyncHook\n- Methods:\n  - register(hookType, handler): Effect\u003cvoid\u003e\n  - trigger(hookType, context): Effect\u003cvoid\u003e\n- Use PubSub subscription for event-driven hooks\n- Hook handlers are Effects with typed context:\n  - HookContext = { task: Issue, session: Session, worktree: Worktree }\n- Use Effect.forEach with { concurrency: \"unbounded\" } for parallel hooks\n- User-configurable hooks via Config (shell commands)\n- Use Effect.catchAll for error isolation between hooks","notes":"Implemented state transition hooks system with the following components:\n\n**Core Services:**\n- `HookRegistry` (src/core/HookRegistry.ts): Main service for hook registration/triggering with Effect.Service pattern\n- `HookOrchestrator` (src/core/HookOrchestrator.ts): Wires HookRegistry to SessionManager's PubSub, registers user shell hooks from config\n\n**Built-in Hooks:**\n- `BuiltInHooks` (src/hooks/BuiltInHooks.ts): Registers NotificationHook, PRCreationHook, BeadsSyncHook\n\n**Configuration:**\n- Added `hooks` section to config schema (schema.ts, defaults.ts)\n- User can define shell commands for each event type: onWaiting, onDone, onError, onPaused\n- Shell hooks receive context via environment variables: HOOK_TASK_ID, HOOK_TASK_TITLE, etc.\n- Can disable built-in hooks with `hooks.disableBuiltIn: true`\n\n**Key Design:**\n- Hook types as tagged union: \"onWaiting\" | \"onDone\" | \"onError\" | \"onPaused\"\n- HookContext: { task, session, worktree, stateChange }\n- Parallel execution with Effect.forEach({ concurrency: \"unbounded\" })\n- Error isolation via Effect.catchAll per hook\n- PubSub subscription for event monitoring\n\nAll types pass strict TypeScript checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:24.613629+11:00","updated_at":"2025-12-17T00:46:56.514818+11:00","closed_at":"2025-12-17T00:46:56.514818+11:00","dependencies":[{"issue_id":"az-moj","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.589726+11:00","created_by":"daemon"},{"issue_id":"az-moj","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.411943+11:00","created_by":"daemon"}]}
{"id":"az-mq9","title":"Create effect-atom SolidJS adapter","description":"Create a SolidJS adapter for effect-atom since only React and Vue adapters exist. This bridges Effect services to SolidJS's reactive system.","design":"- Create src/lib/effect-atom-solid/ adapter (or separate package later)\n- Core primitives to implement:\n  - `useAtomValue(atom)` ‚Üí uses SolidJS `from()` or `createSignal` + subscription\n  - `useAtomSet(atom)` ‚Üí returns setter function\n  - `useAtom(atom)` ‚Üí returns [Accessor, Setter] tuple\n  - `useAtomMount(atom)` ‚Üí lifecycle via `onMount`/`onCleanup`\n  - `createAtomResource(atom)` ‚Üí bridges to SolidJS `createResource` for Suspense\n- Use `RegistryContext` via SolidJS `createContext`/`useContext`\n- Leverage SolidJS's `from()` utility for external subscriptions\n- Pattern: subscribe to Atom changes, update SolidJS signal\n- Consider contributing back to tim-smart/effect-atom","notes":"Session 2025-12-11:\n\nCOMPLETED:\n- Full SolidJS adapter for @effect-atom/atom\n- Implements all core hooks matching React adapter API\n\nFILES CREATED:\n- src/lib/effect-atom-solid/hooks.ts - useAtomValue, useAtomSet, useAtom, useAtomMount, useAtomRefresh\n- src/lib/effect-atom-solid/Provider.tsx - AtomProvider with registry options\n- src/lib/effect-atom-solid/index.ts - Barrel exports\n- src/lib/effect-atom-solid/example.tsx - Working counter example\n- src/lib/effect-atom-solid/README.md - Full documentation\n\nKEY DECISIONS:\n- Used createSignal + subscription pattern (SolidJS equivalent of useSyncExternalStore)\n- Values returned as Accessor\u003cT\u003e (must call: count()) per SolidJS conventions\n- Default scheduler: queueMicrotask (not React Scheduler)\n- Used onCleanup for automatic subscription cleanup\n\nPOTENTIAL CONTRIBUTION:\n- This adapter could be contributed back to tim-smart/effect-atom\n- API surface mirrors @effect-atom/atom-react for easy migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:10:02.323692+11:00","updated_at":"2025-12-11T17:27:44.548067+11:00","closed_at":"2025-12-11T17:25:13.974746+11:00","dependencies":[{"issue_id":"az-mq9","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T17:10:08.844553+11:00","created_by":"daemon"},{"issue_id":"az-mq9","depends_on_id":"az-ags","type":"blocks","created_at":"2025-12-11T17:10:08.914278+11:00","created_by":"daemon"}]}
{"id":"az-n6k","title":"i seem to only be able to space m merge to main one bead and then i have to restart az","description":"after one the next time i space m a different bead it does nothing","notes":"Root cause: `Effect.fork` in CommandQueueService.processNext was creating fibers tied to the parent scope. When processNext returned, the scope closed and interrupted the forked fiber before it could clean up (set running = null). This left the queue in a stuck state where `running !== null` blocked subsequent operations.\n\nFix: \n1. Changed service from `effect:` to `scoped:` to get a layer-level Scope\n2. Captured scope at construction: `const serviceScope = yield* Effect.scope`\n3. Changed `Effect.fork` to `Effect.forkIn(effect, serviceScope)`\n\nThis ensures command fibers:\n- Aren't interrupted when processNext returns (outlive parent)\n- Get cleaned up when app shuts down (not daemon fibers)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:32:43.637796+11:00","updated_at":"2025-12-18T02:14:02.601165+11:00","closed_at":"2025-12-17T17:12:59.43952+11:00","close_reason":"Fixed by using scoped service and Effect.forkIn to properly manage fiber lifecycle","deleted_at":"2025-12-18T02:14:02.601165+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-ni9g","title":"space D should also run cleanup like space d if required","description":"","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T13:03:36.08385+11:00","updated_at":"2025-12-18T13:03:40.214147+11:00"}
{"id":"az-nk1","title":"Add number keys 1-9 for quick session attach","description":"Allow pressing 1-9 keys in normal mode to quickly attach to running sessions.\n\nInspiration: AutoMaker uses 1-9, 0 to view output for first 10 in-progress cards.\n\nImplementation:\n1. In normal mode, number keys 1-9 attach to nth running session\n2. Sessions ordered by: busy first, then waiting, then by start time\n3. Show number indicators on cards when sessions are running\n4. 0 could attach to 10th session or be used for other purpose","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T12:00:03Z","updated_at":"2025-12-16T12:00:03Z"}
{"id":"az-nqo","title":"Complete SessionService implementation (spawn/attach/onComplete)","description":"SessionService is a thin facade that consolidates scattered session logic in KeyboardService into a reusable API layer.\n\n**Current State (Duplicated):**\n- `spawn()` logic: KeyboardService lines 362-369 (Space+s) and 388-401 (Space+i) both call sessionManager.start()\n- `attach()` logic: KeyboardService line 443 (Space+a) calls attachmentService.attachExternal()\n- `onComplete()` logic: **MISSING** ‚Äî no PR workflow automation exists\n\n**Refactoring Goals:**\n1. Extract `spawn()` ‚Üí consolidate both keybinding paths into SessionService.spawn()\n2. Extract `attach()` ‚Üí consolidate Space+a/Space+o paths into SessionService.attach()  \n3. Implement `onComplete()` ‚Üí wire PRWorkflow for automatic PR creation + board updates (NEW)\n4. Update KeyboardService to delegate to SessionService instead of direct core service calls\n\n**Benefit:** Single source of truth for session operations, enables auto-PR workflow, cleaner architecture (UI routing vs business logic separation).","design":"## Architecture: SessionService Facade Pattern\n\n```\nKeyboardService (UI event routing)\n    ‚Üì delegates\nSessionService (consolidated API)  ‚Üê NEW facade layer\n    ‚Üì delegates\nCore Services:\n  - SessionManager.start()\n  - AttachmentService.attachExternal()\n  - PRWorkflow.createPR()\n  - TmuxService (session attachment)\n  - BeadsClient (board updates)\n```\n\n**SessionService responsibilities:**\n- Expose spawn(taskId), attach(taskId), onComplete(taskId) as Effect-returning methods\n- Depend on ToastService + NavigationService for UI feedback\n- Delegate actual work to core services\n- Consolidate error handling \u0026 logging","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T15:59:44.332899+11:00","updated_at":"2025-12-18T02:21:09.519077+11:00","closed_at":"2025-12-18T02:21:09.519079+11:00","close_reason":"Implemented SessionService facade with spawn(), attach(), onComplete() methods. KeyboardService now delegates to SessionService for all session operations.","deleted_at":"2025-12-18T02:14:02.596252+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-o5a","title":"Complete KeyboardService migration - replace App.tsx inline handlers","description":"Finish the half-completed migration from inline useKeyboard handlers in App.tsx to the data-driven KeyboardService + useKeyboardBridge pattern.","notes":"## Session Progress (2025-12-15)\n\n### Completed\n- Phase 1: NavigationService methods added (halfPageDown, halfPageUp, goToFirst, goToLast, goToFirstColumn, goToLastColumn, jumpToEnd)\n- Layer composition in atoms.ts restructured to support NavigationService ‚Üí BoardService dependency\n- KeyboardService rewritten with all modes and ~60 keybindings\n- **Fixed type errors** by:\n  1. Removing explicit `Effect.Effect\u003cvoid\u003e` return types from helper functions (let TS infer)\n  2. Updated `Keybinding` interface to allow `BeadsError` and `KeybindingDeps` (CommandExecutor | FileSystem)\n  3. Removed explicit return type from `handleKey` method\n- **Extended BeadsClient** to support all bd CLI fields:\n  - `update()`: Added title, description, design, acceptance, assignee, estimate, labels\n  - `create()`: Added design, acceptance, assignee, estimate, labels\n- **Refactored BeadEditorService** to use BeadsClient instead of running bd commands directly\n- **MAJOR: ID-based cursor navigation** - Changed cursor from index-based {columnIndex, taskIndex} to focusedTaskId: string | null\n  - Eliminates sync issues between UI and services\n  - NavigationService now uses EditorService for search/sort config\n  - Navigation operations find current position in filtered view, calculate new position, store new task ID\n- **Single data source** - App.tsx now uses boardTasksAtom from BoardService instead of separate tasksAtom\n  - When board.refresh() is called, UI updates automatically\n- **Skip empty columns** - Left/right navigation skips empty columns to find next non-empty one\n- **Cursor safety** - After deleting a bead, nav.initialize() moves cursor to valid task\n- **az-451 Data.struct refactor** - SubscriptionRef state now uses Data.struct() for structural equality:\n  - EditorService: EditorMode variants + SortConfig\n  - OverlayService: Overlay objects + emptyArray() singleton\n  - ToastService: Toast objects + emptyArray() singleton\n  - Created src/lib/empty.ts with singleton emptyRecord()/emptyArray()\n\n### Status: TYPE-CHECK PASSES ‚úì\n\n### Files Modified This Session\n- src/services/NavigationService.ts - Complete rewrite for ID-based cursor\n- src/services/KeyboardService.ts - Updated getSelectedTask to use focusedTaskId\n- src/services/BoardService.ts - Added getFilteredTasksByColumn, getFilteredTaskAt, Map‚ÜíRecord\n- src/services/EditorService.ts - Data.struct() wrapping for EditorMode/SortConfig\n- src/services/OverlayService.ts - Data.struct() wrapping + emptyArray()\n- src/services/ToastService.ts - Data.struct() wrapping + emptyArray()\n- src/ui/App.tsx - Use boardTasksAtom, call refreshBoard on mount\n- src/ui/atoms.ts - Removed cursorAtom, added initializeNavigationAtom, refreshBoardAtom\n- src/ui/hooks/useNavigation.ts - Derives position from focusedTaskId locally\n- src/ui/Board.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/ui/CompactView.tsx - Accept readonly TaskWithSession[], Record for jumpLabels\n- src/lib/empty.ts - NEW: singleton emptyRecord()/emptyArray()\n\n### Remaining Work\n1. Wire useKeyboardBridge into App.tsx (handleKeyAtom already connected)\n2. Remove any remaining inline handlers from App.tsx\n3. Test all keybindings thoroughly\n4. Consider removing debug logging from KeyboardService\n\n### Recent Commits\n- eccbe28 - refactor: Add Data.struct wrapping to SubscriptionRef state\n- 19beb0a - feat: Add singleton empty collection utilities\n- 092959c - refactor: ID-based cursor navigation and single data source","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T00:43:39.319315+11:00","updated_at":"2025-12-15T13:36:38.73138+11:00","closed_at":"2025-12-15T13:36:38.73138+11:00"}
{"id":"az-o5m9","title":"merged tasks are being left in in-progress status","description":"","notes":"Root cause identified: In mergeToMain(), the bead is closed (step 10) AFTER the git push (step 9). This means the closed status is never pushed to remote. The fix is to either: (1) move the close before the push, or (2) do an additional sync+push after closing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T13:06:11.946082+11:00","updated_at":"2025-12-18T13:14:25.570421+11:00","closed_at":"2025-12-18T13:14:25.570421+11:00","close_reason":"Fixed by moving bead close before git push in mergeToMain() and cleanup(), and adding bd sync after close to persist the status change to JSONL and commit it to git."}
{"id":"az-odr","title":"Fix Space+m merge workflow to prevent merge conflicts","description":"The Space+m (merge to main) workflow has repeatedly failed to prevent merge conflicts from reaching the main branch. This has happened multiple times, requiring manual conflict resolution.\n\n## Root Cause Analysis\nThe current `checkMergeConflicts` in PRWorkflow.ts only does a file-level overlap check (files modified on both branches). This doesn't catch actual content conflicts - Git only discovers those during the merge attempt.\n\n## What's Happening Now\n1. `checkMergeConflicts` compares file lists between branches\n2. If files overlap, shows a confirmation dialog\n3. User confirms (or no overlap detected), merge proceeds\n4. Git attempts merge and finds actual conflicts\n5. Conflicts land on main branch\n\n## Expected Behavior\nThe merge should NEVER introduce conflicts to main. If conflicts exist, they should be resolved in the worktree BEFORE the merge to main happens.\n\n## Proposed Solution\n1. **Perform a test merge first** - In the worktree, do `git fetch origin main \u0026\u0026 git merge --no-commit origin/main`\n2. **Check for conflicts** - If conflicts occur, abort the test merge and report them\n3. **Only proceed if clean** - If test merge succeeds, then push to main\n4. **Auto-abort on conflict** - If test merge has conflicts, abort it (`git merge --abort`) and show which files conflict\n\nThis ensures main always stays clean.","design":"## Implementation Plan\n\n### 1. Update PRWorkflow.checkMergeConflicts\nInstead of file list comparison, perform an actual test merge:\n\n```typescript\ncheckMergeConflicts = ({ beadId, projectPath }) =\u003e\n  Effect.gen(function* () {\n    const worktreePath = yield* getWorktreePath(beadId, projectPath)\n    \n    // Fetch latest main\n    yield* gitInWorktree(worktreePath, [\"fetch\", \"origin\", \"main\"])\n    \n    // Try merge with --no-commit to test\n    const result = yield* gitInWorktree(worktreePath, \n      [\"merge\", \"--no-commit\", \"--no-ff\", \"origin/main\"]\n    ).pipe(Effect.either)\n    \n    if (Either.isLeft(result)) {\n      // Get conflict list\n      const conflicts = yield* gitInWorktree(worktreePath, \n        [\"diff\", \"--name-only\", \"--diff-filter=U\"]\n      )\n      // Abort the test merge\n      yield* gitInWorktree(worktreePath, [\"merge\", \"--abort\"])\n      \n      return {\n        hasConflictRisk: true,\n        conflictingFiles: conflicts.split('\\n').filter(Boolean),\n        canAutoMerge: false\n      }\n    }\n    \n    // Clean test merge succeeded - abort it (we'll do real merge after)\n    yield* gitInWorktree(worktreePath, [\"merge\", \"--abort\"])\n    return { hasConflictRisk: false, conflictingFiles: [], canAutoMerge: true }\n  })\n```\n\n### 2. Update mergeToMain flow\n- If `checkMergeConflicts` shows conflicts, DO NOT proceed\n- Instead of confirmation dialog, show error with conflict file list\n- User must resolve conflicts manually in worktree first\n\n### 3. Files to modify\n- `src/core/PRWorkflow.ts` - Update checkMergeConflicts and mergeToMain\n- `src/services/keyboard/prHandlers.ts` - Update actionMergeToMain error handling","acceptance_criteria":"- [ ] Space+m always checks for actual conflicts before merging\n- [ ] If conflicts exist, merge is blocked (not just warned)\n- [ ] Error message shows which files conflict\n- [ ] Test merge is always aborted, never leaves worktree dirty\n- [ ] Clean merges proceed without extra confirmation\n- [ ] Main branch never has unresolved conflicts after Space+m","status":"closed","priority":1,"issue_type":"bug","assignee":"claude","created_at":"2025-12-17T17:00:52.211803+11:00","updated_at":"2025-12-18T02:14:02.594699+11:00","closed_at":"2025-12-18T02:10:35.262268+11:00","close_reason":"Complete: Space+m now (1) checks for actual conflicts via git merge-tree, (2) offers Claude-assisted resolution if conflicts detected, (3) only merges to main when clean. Main branch is protected from unresolved conflicts.","labels":["bug-fix","merge","workflow"],"comments":[{"id":3,"issue_id":"az-odr","author":"riordan","text":"Adding Claude-assisted conflict resolution feature","created_at":"2025-12-17T15:10:29Z"}],"deleted_at":"2025-12-18T02:14:02.594699+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"bug"}
{"id":"az-ofl","title":"have to allow claude permissions again in every worktree","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:26:49.402571+11:00","updated_at":"2025-12-15T10:58:08.359395+11:00","closed_at":"2025-12-15T10:58:08.359395+11:00"}
{"id":"az-om3","title":"WorktreeManager - git worktree lifecycle","description":"Manage git worktree creation, tracking, and cleanup for isolated task execution.","design":"- Define WorktreeManager as Effect.Service\n- Use @effect/platform Command for git operations (or simple-git if needed)\n- Naming: ../ProjectName-\u003cbead-id\u003e/\n- Methods return Effect with typed errors:\n  - create(beadId, baseBranch): Effect\u003cWorktree, GitError\u003e\n  - remove(beadId): Effect\u003cvoid, GitError | WorktreeNotFoundError\u003e\n  - list(): Effect\u003cWorktree[], GitError\u003e\n  - exists(beadId): Effect\u003cboolean, GitError\u003e\n- Use Effect.acquireRelease for cleanup guarantees\n- Track active worktrees in Ref\n- Handle epic vs task worktree sharing logic\n- Create WorktreeManagerLive and WorktreeManagerTest layers","notes":"Implemented WorktreeManager Effect service with:\n- Service interface with create, remove, list, exists, get methods\n- Error types: GitError, WorktreeNotFoundError, WorktreeExistsError, NotAGitRepoError\n- Idempotent create operation (safe to call multiple times)\n- Ref-based state tracking for active worktrees\n- Parses git worktree list --porcelain output\n- acquireRelease pattern via acquireWorktree for cleanup guarantees\n- Convenience functions for all operations\n- WorktreeManagerLive and WorktreeManagerLiveWithPlatform layers\n- Comprehensive example file with 7 usage patterns\n- Follows BeadsClient and TmuxService patterns\n- All type checks pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.585679+11:00","updated_at":"2025-12-11T18:03:13.741817+11:00","closed_at":"2025-12-11T18:03:13.741817+11:00","dependencies":[{"issue_id":"az-om3","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.224593+11:00","created_by":"daemon"}]}
{"id":"az-ph1","title":"Add agent phase detection and display","description":"Detect and display Claude agent phases (Planning/Action/Verification) on TaskCards. Parse Claude output patterns to identify current phase and show visual indicator.\n\nInspiration: AutoMaker shows phase status on cards with Planning ‚Üí Action ‚Üí Verification workflow.\n\nImplementation:\n1. Extend StateDetector to detect phase transitions from output patterns\n2. Add phase field to session state (idle/planning/implementing/testing/done)\n3. Display phase badge/indicator on TaskCard when session is active\n4. Update phase in real-time as output is parsed","notes":"Explored codebase. Key files:\n- StateDetector.ts: Pattern-based detection, returns SessionState (idle/busy/waiting/done/error)\n- types.ts: SessionState, SessionMetrics, TaskWithSession, SESSION_INDICATORS\n- TaskCard.tsx: Shows indicator from SESSION_INDICATORS, has header line with id/type/indicator\n- DetailPanel.tsx: Shows session metrics when active\n\nImplementation plan:\n1. Add AgentPhase type and PHASE_INDICATORS to types.ts\n2. Add agentPhase field to SessionMetrics interface\n3. Extend StateDetector with phase detection patterns\n4. Update TaskCard to show phase indicator\n5. Update DetailPanel to show phase in metrics section","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T12:00:00Z","updated_at":"2025-12-17T17:22:20.767381+11:00","closed_at":"2025-12-17T17:22:20.767385+11:00"}
{"id":"az-pn6","title":"StatusBar component","description":"Bottom status bar showing available actions and system status.","design":"- Fixed position at bottom\n- Show available keybindings for current context\n- Show connection status, sync status\n- Show count of running sessions\n- Responsive to terminal width","notes":"Enhanced StatusBar component with:\n1. Connection/sync status indicator (‚óè connected, ‚óã disconnected) using theme colors\n2. Responsive terminal width handling - hides keybinds \u003c100 cols, mode display \u003c80 cols, selected count \u003c60 cols\n3. Project name 'azedarach' displayed on left with bold styling\n4. Improved visual hierarchy using Catppuccin theme colors (green for connected, overlay0 for disconnected)\n5. Added optional 'connected' prop to StatusBarProps (defaults to true)\n6. Type-safe implementation - pnpm type-check passes with no errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:07.987695+11:00","updated_at":"2025-12-12T01:29:02.416939+11:00","closed_at":"2025-12-12T01:29:02.416939+11:00","dependencies":[{"issue_id":"az-pn6","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.038999+11:00","created_by":"daemon"}]}
{"id":"az-pnx","title":"Configuration system with @effect/schema and Effect Config","description":"User configuration loading and validation.","design":"- Use Effect's built-in Config module for configuration\n- Use @effect/schema for config file validation (replaces zod)\n- Define ConfigSchema with Schema.Struct for type-safe config\n- Config sections: terminal, worktree, session, completion, notifications, patterns\n- Support multiple sources via Config.withDefault and Config.nested:\n  - Environment variables (AZEDARACH_*)\n  - Config files (.azedarach.json, .azedarachrc)\n  - package.json \"azedarach\" key\n- Create ConfigLive layer that loads and validates config\n- Sensible defaults for all options via Schema.withDefault","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:41.673276+11:00","updated_at":"2025-12-12T17:24:13.126088+11:00","closed_at":"2025-12-12T17:24:13.126088+11:00","dependencies":[{"issue_id":"az-pnx","depends_on_id":"az-ee4","type":"parent-child","created_at":"2025-12-11T14:46:10.015922+11:00","created_by":"daemon"}]}
{"id":"az-pza","title":"TUI \u0026 Interaction","description":"Ink-based terminal UI: Kanban board, keyboard navigation, session attachment, and user interaction flows.","notes":"Session 2025-12-12:\n\nEPIC PROGRESS: 6/7 tasks completed (86%)\n\nCOMPLETED CHILDREN:\n- az-hri: Basic Kanban board ‚úÖ\n- az-mq9: effect-atom SolidJS adapter ‚úÖ\n- az-t4t: Keyboard navigation (Helix-style) ‚úÖ\n- az-pn6: StatusBar component ‚úÖ\n- az-g19: Terminal attachment (external) ‚úÖ\n- az-srh: Detail view panel ‚úÖ\n\nREMAINING:\n- az-stv: Task actions (start/attach/pause/resume) - NOW UNBLOCKED\n  - Depends on SessionManager (az-xi5) which is now complete\n  - This is the final task to wire session lifecycle to TUI\n\nPHASE 2 STATUS:\nTUI is fully functional with all navigation, selection, task movement, and viewing features. Only session lifecycle integration remains.\n\nNEXT SESSION:\n- Complete az-stv to close this epic\n- Wire SessionManager.start/stop/pause/resume to keyboard actions\n- Add visual feedback for session states in TaskCard","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T14:44:04.871997+11:00","updated_at":"2025-12-12T10:54:04.23523+11:00","closed_at":"2025-12-12T10:54:04.23523+11:00"}
{"id":"az-q5c","title":"Test bead for output check","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:23:49.203815+11:00","updated_at":"2025-12-15T01:24:28.486686+11:00","closed_at":"2025-12-15T01:24:28.486686+11:00"}
{"id":"az-qmg","title":"instead of using an extra line to underline column headers just use underlined ascii characters maybe?","description":"","notes":"Starting work - will use text underline attribute instead of separate line","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T12:57:11.332088+11:00","updated_at":"2025-12-17T00:44:19.692037+11:00","closed_at":"2025-12-17T00:44:19.692037+11:00"}
{"id":"az-qmo","title":"Add stop session action (Space+x)","description":"No way to stop/kill a running session from the TUI. Need Space+x to kill tmux session and mark task as idle.","design":"- Add stopSessionAtom using runtime.fn calling SessionManager.stop\n- Wire Space+x in action mode to call stopSession(task.id)\n- Confirm before stopping? Or just stop immediately\n- Show success toast 'Stopped session for {id}'\n- Refresh tasks after stop","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:42:23.169998+11:00","updated_at":"2025-12-12T11:43:10.52549+11:00","closed_at":"2025-12-12T11:43:10.52549+11:00"}
{"id":"az-r9u","title":"looks like there is hidden bead that doesnt quite fit in the screen","description":"our screen size calc must be off","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:26:58.321424+11:00","updated_at":"2025-12-16T21:36:22.5216+11:00","closed_at":"2025-12-16T21:36:22.5216+11:00"}
{"id":"az-s1n","title":"add a pre tool use hook to prevent type casting like we have in ~/prog/Chefy","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:45:55.42323+11:00","updated_at":"2025-12-18T02:14:02.599709+11:00","closed_at":"2025-12-17T17:08:36.020343+11:00","close_reason":"Added pre-edit-type-safety.cjs hook that blocks Edit/Write operations containing type casting anti-patterns (as Type, as any, : any). Hook is registered in settings.json under PreToolUse.","deleted_at":"2025-12-18T02:14:02.599709+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-shf","title":"when a bead action is occurring such as space S, disable further actions from being taken on that bead until its idle again","description":"","notes":"Starting implementation. Strategy:\n1. Create taskQueueInfoAtom for reactive queue state\n2. Add isBusy check to ActionPalette isAvailable()\n3. Add busy guard to handlers that use withQueue\n4. Show running operation label in toast when blocked","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:04:50.355647+11:00","updated_at":"2025-12-18T02:14:02.603551+11:00","closed_at":"2025-12-17T17:30:22.984791+11:00","close_reason":"Implemented bead action busy guard:\n\n1. Added `checkBusy()` helper to HandlerContext - checks if task has running operation, shows toast if busy\n2. Applied guard to all queued handlers: startSession, startSessionWithPrompt, stopSession, createPR, mergeToMain, cleanup\n3. ActionPalette now dims queued actions when busy and shows \"‚è≥ {operation}...\" indicator\n4. Created focusedTaskRunningOperationAtom for reactive UI updates\n\nUsers now see clear feedback when actions are blocked and cannot trigger duplicate operations on the same bead.","deleted_at":"2025-12-18T02:14:02.603551+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-shv","title":"Error toast notifications in TUI","description":"Show dismissible error toasts when actions fail (e.g., attach to non-existent session, start on non-idle task). Currently errors only go to console.error which users don't see.","design":"- Toast component: fixed position, auto-dismiss after 5s or on keypress\n- Error state atom: Array\u003c{id, message, timestamp}\u003e\n- Show in StatusBar area or floating overlay\n- Red background with error icon\n- Queue multiple errors, show oldest first","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T10:59:23.087691+11:00","updated_at":"2025-12-12T11:07:55.898746+11:00","closed_at":"2025-12-12T11:07:55.898746+11:00"}
{"id":"az-srh","title":"Detail view for selected task","description":"Expandable detail panel showing full task information.","design":"- Toggle with Enter or Tab on selected task\n- Show: title, description, design notes, acceptance criteria\n- Show: dependencies, PR link if exists\n- Show: recent session output (last N lines)\n- Show: available actions for current state","notes":"Implementation complete. Created DetailPanel.tsx component that shows full task details in a modal overlay. Added Enter key handler in normal mode to toggle the detail view. Updated HelpOverlay to document the Enter key. Component displays: task ID, type, priority, status, session state, description, design notes, notes, timestamps, and available actions based on task state. Follows same overlay pattern as HelpOverlay with semi-transparent background and centered box using Catppuccin theme colors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T14:45:08.103114+11:00","updated_at":"2025-12-12T10:32:33.95362+11:00","closed_at":"2025-12-12T10:32:33.95362+11:00","dependencies":[{"issue_id":"az-srh","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:09.178011+11:00","created_by":"daemon"}]}
{"id":"az-ssm","title":"i tried az in Chefy and for some reason the cursor got lost after i sorted by updated","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:49:22.39364+11:00","updated_at":"2025-12-15T14:06:56.110719+11:00","closed_at":"2025-12-15T14:06:56.110719+11:00"}
{"id":"az-stv","title":"Task actions: start, attach, pause, resume","description":"Implement keyboard shortcuts for task lifecycle actions.","design":"- Enter: start task (create worktree, spawn Claude)\n- a: attach to running session (opens external terminal)\n- A: attach inline (TUI shows session output)\n- p: pause session (interrupt, WIP commit)\n- r: resume paused session\n- Validate action is valid for current task state","notes":"Session 2025-12-12:\n\nNOW UNBLOCKED - All dependencies completed:\n- az-xi5 (SessionManager): ‚úÖ Closed - full orchestration service\n- az-t4t (Keyboard navigation): ‚úÖ Closed - Helix-style modal keybindings\n\nIMPLEMENTATION PLAN:\n1. Wire SessionManager to Action mode commands:\n   - Space+s: SessionManager.start() - create worktree + spawn Claude\n   - Space+a: Already done (AttachmentService.attachExternal)\n   - Space+p: SessionManager.pause() - Ctrl+C + WIP commit\n   - Space+r: SessionManager.resume() - reattach to paused session\n\n2. Update TaskCard to show live session state:\n   - Use SessionManager.subscribeToStateChanges() PubSub\n   - Update sessionState in TaskWithSession reactively\n   - Already have session indicators: üîµüü°‚úÖ‚ùå‚è∏Ô∏è\n\n3. Validate action availability:\n   - 's' only on idle tasks\n   - 'a' only on busy/waiting tasks\n   - 'p' only on busy tasks\n   - 'r' only on paused tasks\n\nDEPENDENCIES NOW MET:\n- SessionManager: src/core/SessionManager.ts\n- WorktreeManager: src/core/WorktreeManager.ts\n- TmuxService: src/core/TmuxService.ts\n- StateDetector: src/core/StateDetector.ts\n\nFILES TO MODIFY:\n- src/ui/App.tsx - Add action handlers for s/p/r\n- src/ui/atoms.ts - Add session lifecycle effects\n- src/ui/TaskCard.tsx - May need state subscription","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.880144+11:00","updated_at":"2025-12-12T10:53:49.478801+11:00","closed_at":"2025-12-12T10:53:49.478801+11:00","dependencies":[{"issue_id":"az-stv","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.920801+11:00","created_by":"daemon"},{"issue_id":"az-stv","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.054522+11:00","created_by":"daemon"},{"issue_id":"az-stv","depends_on_id":"az-t4t","type":"blocks","created_at":"2025-12-11T14:46:28.161361+11:00","created_by":"daemon"}]}
{"id":"az-t4t","title":"Keyboard navigation (vim-style)","description":"Implement vim-style keyboard navigation for the Kanban board.","design":"- Use OpenTUI's input handling (onKeyPress or similar)\n- SolidJS signals for tracking selection state:\n  - selectedColumn: Accessor\u003cnumber\u003e\n  - selectedTask: Accessor\u003cnumber\u003e\n- h/‚Üê, l/‚Üí: navigate columns (setSelectedColumn)\n- j/‚Üì, k/‚Üë: navigate tasks within column (setSelectedTask)\n- Visual highlight via conditional styling\n- Wrap navigation at boundaries (or stop)\n- Create useKeyboardNavigation hook for reusability","notes":"Session 2025-12-11 (evening):\n\nCOMPLETED:\n- Full Helix-style modal keybinding system implemented\n- Normal mode: hjkl navigation, g‚Üígoto, v‚Üíselect, Space‚Üíaction menu\n- Goto mode: gw shows 2-char jump labels (home row keys), gg/ge first/last, gh/gl column ends\n- Select mode: multi-selection via Space toggle, hjkl navigation\n- Action mode: h/l moves task(s) to adjacent column (updates status via bd CLI)\n- Ctrl-d/Ctrl-u half-page scrolling\n- Catppuccin Mocha theme colors\n- Virtual scrolling: columns show maxVisible tasks based on terminal height\n- StatusBar shows mode (NOR/SEL/GTO/ACT) with contextual keybind hints\n\nFILES MODIFIED:\n- src/ui/types.ts - Added EditorMode, GotoSubMode, JumpTarget types, generateJumpLabels()\n- src/ui/App.tsx - Full modal state machine, keyboard handling, terminal height calculation\n- src/ui/Board.tsx - Added activeTaskIndex, terminalHeight props\n- src/ui/Column.tsx - Virtual scrolling with scroll indicators\n- src/ui/TaskCard.tsx - Simplified to avoid OpenTUI fragment bugs\n- src/ui/StatusBar.tsx - Mode indicator + contextual keybinds per mode\n- src/ui/theme.ts - Catppuccin Mocha color palette\n- src/ui/atoms.ts - moveTaskEffect, moveTasksEffect for task movement\n- README.md - Comprehensive Helix-style keybinding documentation\n\nISSUES FIXED:\n- client.ready() only returned open/unblocked tasks - changed to client.list()\n- OpenTUI JSX fragments caused rendering corruption - use single text elements\n- Column overflow - implemented virtual scrolling\n\nREMAINING:\n- Some minor rendering artifacts in first column (title-only cards occasionally)\n- Action mode only implements h/l (move) - s/a/p/r/d/P not yet implemented\n\nNEXT STEPS:\n- Could close this bead - core vim-style navigation is complete\n- Action mode commands (start session, attach, etc.) belong in az-stv (Task actions)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:07.772639+11:00","updated_at":"2025-12-11T23:49:35.046226+11:00","closed_at":"2025-12-11T23:49:35.046226+11:00","dependencies":[{"issue_id":"az-t4t","depends_on_id":"az-pza","type":"parent-child","created_at":"2025-12-11T14:46:08.800764+11:00","created_by":"daemon"},{"issue_id":"az-t4t","depends_on_id":"az-hri","type":"blocks","created_at":"2025-12-11T14:46:26.269114+11:00","created_by":"daemon"}]}
{"id":"az-tgc","title":"Agent Mail configuration and environment","description":"Add configuration support for Agent Mail settings.\n\nDesign:\n- Environment variables:\n  - BEADS_AGENT_MAIL_URL (optional)\n  - BEADS_AGENT_NAME (defaults to hostname or generated)\n  - BEADS_PROJECT_ID (defaults to git remote or project path hash)\n- Config service using @effect/platform Config\n- Validation with @effect/schema\n- Auto-detect if Agent Mail server is available\n- CLI flag --agent-mail-url to override\n- Show Agent Mail status in TUI StatusBar","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T10:33:13.864792+11:00","updated_at":"2025-12-12T10:33:13.864792+11:00","dependencies":[{"issue_id":"az-tgc","depends_on_id":"az-l7a","type":"blocks","created_at":"2025-12-12T10:33:21.905172+11:00","created_by":"daemon"}]}
{"id":"az-tgj","title":"Shift-D delete bead not working - reports \"no worktree to delete\"","description":"When pressing Space -\u003e Shift-D to delete a bead, the wrong action fires. The keyboard library reports event.name as lowercase even when shift is held, so case \"D\" never matches - it falls through to case \"d\" (cleanup worktree).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:41:38.746846+11:00","updated_at":"2025-12-14T21:43:51.026071+11:00","closed_at":"2025-12-14T21:43:51.026071+11:00"}
{"id":"az-tsf","title":"sometimes i have to bd init when i create a worktree and attach to the session with az","description":"i assume its to do with the fact the new session has to wait for direnv (with flake) to setup the env. maybe we need to increase a timeout somewhere?","notes":"Root cause identified: tmux session uses `bash -c` which bypasses direnv shell hooks. Fix: wrap claude command with `direnv exec .` to explicitly load environment before starting Claude.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:01:38.873045+11:00","updated_at":"2025-12-16T22:11:39.827838+11:00","closed_at":"2025-12-16T22:11:39.827838+11:00"}
{"id":"az-tz9","title":"when an operation is happening on a bead such as a merge we should show an indication on board","description":"e.g. show a loading spinner on the bead card itself (top right maybe)","notes":"Implemented operation indicators on task cards.\n\nChanges:\n1. Added `taskRunningOperationAtom(taskId)` in atoms.ts - parameterized atom that subscribes to CommandQueueService state for any task\n2. Updated TaskCard.tsx to show operation indicators (‚è≥ for merge/create-pr, üßπ for cleanup, ‚ö° for start, ‚èπÔ∏è for stop)\n3. Updated CompactView.tsx with same indicator support for compact mode\n\nThe indicators appear in the header line after session/phase indicators when an async operation is running on the bead.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T10:42:47.237644+11:00","updated_at":"2025-12-18T12:46:11.319016+11:00","close_reason":"Implemented operation indicators on task cards - shows when merge, cleanup, start, stop operations are running","deleted_at":"2025-12-18T12:39:42.060737+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-u9t","title":"when i start a session it moves in the list","description":"when i press space s to start a tmux session for a bead it moves in the list due to sorting i guess and sometimes this moves it out of view","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:25:41.450657+11:00","updated_at":"2025-12-16T21:29:29.243055+11:00","closed_at":"2025-12-16T21:29:29.243055+11:00"}
{"id":"az-use","title":"bd sync doesnt have a json output. need to parse it differently","description":"sync failed for [bd id] -\u003e not valid json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:25:05.897274+11:00","updated_at":"2025-12-18T02:14:02.601632+11:00","closed_at":"2025-12-17T16:53:52.433345+11:00","close_reason":"Fixed by parsing human-readable output since bd sync --json doesn't work. Changed sync() to accept {cwd, fromMain} options. Updated all callers to use fromMain:true for worktrees.","deleted_at":"2025-12-18T02:14:02.601632+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-uxz","title":"Action palette overlay for Space menu","description":"Action mode keybindings are getting crowded in the status bar. Create a proper floating action palette that appears when Space is pressed, showing all available actions with descriptions.","design":"- Floating box overlay (like HelpOverlay)\n- Show action, keybind, and short description\n- Gray out unavailable actions based on task state\n- e.g., 'Start' grayed if session already running\n- Dismiss on Esc or action execution\n- Consider grouping: Session (s/a/p/r/x), Move (h/l), etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:00:26.143992+11:00","updated_at":"2025-12-12T12:16:53.933473+11:00","closed_at":"2025-12-12T12:16:53.933473+11:00"}
{"id":"az-v6h","title":"use effect STM or something to enforce atomic operations where possible","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:43:45.048239+11:00","updated_at":"2025-12-17T15:43:45.048239+11:00"}
{"id":"az-vn0","title":"i just ended a session and then all beads with active sessions disappeared from the board","description":"i used space x to end the session and after quitting az and restarting it the beads that disappeared are still not back","notes":"## Investigation (2025-12-15)\n\n### Analysis\n\nInvestigated the bug where beads with active sessions disappeared after ending a session with Space+x.\n\n**Key findings:**\n1. Beads ARE present in the database (verified with `bd list` - 76 beads, 26 open, 1 in_progress)\n2. The `SessionManager.stop()` function only removes session tracking, doesn't modify beads\n3. The `bd sync` operation syncs changes FROM worktrees but shouldn't delete beads\n\n**Possible causes identified:**\n1. Error in `BoardService.refresh()` scheduled task causing stale/empty data\n2. Mismatch between session tracking and bead data after sync\n3. Transient issue that's difficult to reproduce\n\n**Root cause could not be definitively identified** - the code looks correct and beads exist in the database.\n\n### Fixes Applied\n\nAdded diagnostic logging to help identify the issue if it recurs:\n\n1. **BoardService.ts**: Added error logging for scheduled refresh failures\n2. **SessionManager.ts**: Added logging around session stop operations:\n   - Log when stopping session\n   - Log when sync completes/fails\n   - Log final session state\n3. **BoardService.ts**: Added warning log when task counts seem inconsistent (0 beads or session mismatch)\n\n### How to Diagnose in Future\n\nIf the bug recurs, check `az.log` for:\n- \"BoardService refresh failed\" - indicates data loading error\n- \"Stopping session for\" / \"Session stopped for\" - tracks session lifecycle\n- \"Sync failed for\" - indicates beads sync issues\n- \"Task load: X beads, Y active sessions\" - tracks data counts\n\n### Status\n\nClosing as \"cannot reproduce\" with diagnostic logging added. The logging will help identify the root cause if the issue occurs again.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:40:32.916186+11:00","updated_at":"2025-12-16T17:16:31.935474+11:00","closed_at":"2025-12-16T17:16:31.935474+11:00"}
{"id":"az-voa","title":"i dont like ctrl-a A as a way to return to az, come up with a better global key command","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T10:08:08.210971+11:00","updated_at":"2025-12-17T10:48:27.086814+11:00","closed_at":"2025-12-17T10:48:27.086814+11:00"}
{"id":"az-vpj","title":"make sure we warn the user if space m will cause conflicts and they can press y/n to proceed or cancel","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:26.919959+11:00","updated_at":"2025-12-17T01:09:17.730326+11:00","closed_at":"2025-12-17T01:09:17.730326+11:00"}
{"id":"az-vpz","title":"Migrate state management to Effect-atom native patterns","description":"Refactor current state management to use Effect-atom native patterns for better integration with the Effect ecosystem. This includes:\n\n- Audit current state management approach\n- Identify candidates for migration to effect-atom\n- Implement atomic state with proper Effect integration\n- Ensure reactive updates flow through the TUI correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T10:32:35.479946+11:00","updated_at":"2025-12-15T12:42:24.805977+11:00","closed_at":"2025-12-15T12:42:24.80598+11:00"}
{"id":"az-vx2","title":"Add debug overlay (d key) showing service state","description":"Developer tool for debugging state issues:\n\n**Debug overlay shows:**\n- Current mode (EditorService)\n- Cursor position and focused task ID (NavigationService)  \n- Active sessions with states (SessionManager)\n- Command queue status (CommandQueueService)\n- Filter/sort settings (BoardService)\n- Recent errors/warnings\n\n**Toggle with 'd' key in normal mode**\n- Semi-transparent overlay on right side\n- Auto-refreshes every 500ms\n- Useful for debugging state sync issues like az-vn0 (disappearing tasks)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:59:45.895225+11:00","updated_at":"2025-12-18T02:14:02.60623+11:00","closed_at":"2025-12-17T17:06:44.78128+11:00","close_reason":"Implemented debug overlay with 'd' key toggle showing mode, navigation, board, session, and command queue state","deleted_at":"2025-12-18T02:14:02.60623+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"feature"}
{"id":"az-w2m","title":"up/down arrow should wrap around the current column when at the bottom/top not move to next column","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:54:54.218653+11:00","updated_at":"2025-12-18T02:14:02.599141+11:00","closed_at":"2025-12-17T17:02:47.827581+11:00","close_reason":"Implemented wrap-around navigation for up/down keys within columns","deleted_at":"2025-12-18T02:14:02.599141+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-wiu","title":"Eliminate React hooks in favor of Effect services (audit \u0026 migrate)","description":"Per az-x4e, 9 files still use React hooks (useEffect/useMemo/useState):\n\n- src/ui/App.tsx\n- src/ui/Board.tsx\n- src/ui/Column.tsx\n- src/ui/CompactView.tsx\n- src/ui/Toast.tsx\n- src/ui/DetailPanel.tsx\n- src/ui/CreateTaskPrompt.tsx\n- src/ui/ClaudeCreatePrompt.tsx\n- src/index.tsx\n\n**Audit each file** to determine:\n1. What state/effects can move to Effect services\n2. What computation can move to atoms\n3. What's truly local UI state (may be acceptable)\n\nDocument findings and create migration plan. This task is the audit; az-x4e is the execution.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T15:59:45.338873+11:00","updated_at":"2025-12-17T15:59:45.338873+11:00"}
{"id":"az-wot","title":"image paste from clipboard not working still on mac","description":"no logs, no toast, just nothing happens when i press p with a image in clipboard","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:12:34.022384+11:00","updated_at":"2025-12-18T02:14:02.597438+11:00","closed_at":"2025-12-18T01:36:22.272642+11:00","close_reason":"Fixed: ImageAttachmentService state was not being initialized when overlay opened via keybinding. Handler now auto-initializes state from overlay if needed, and added user feedback when clipboard support unavailable.","deleted_at":"2025-12-18T02:14:02.597438+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-x4e","title":"avoid useEffect, useMemo, useState, etc.","description":"switch from react hooks such as those in the title to fully encapsulating state mgmt in effect services","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:24:52.577357+11:00","updated_at":"2025-12-17T15:03:52.386143+11:00","dependencies":[{"issue_id":"az-x4e","depends_on_id":"az-wiu","type":"blocks","created_at":"2025-12-17T15:59:52.10568+11:00","created_by":"daemon"}]}
{"id":"az-xi5","title":"SessionManager - Claude session orchestration","description":"Core orchestration: spawn Claude in tmux sessions, manage lifecycle, coordinate with worktrees.","design":"- Define SessionManager as Effect.Service\n- Depends on: WorktreeManager, TmuxService, BeadsClient, StateDetector, FileLockManager\n- Methods return Effect with typed errors:\n  - start(beadId): Effect\u003cSession, SessionError | WorktreeError\u003e\n  - stop(beadId): Effect\u003cvoid, SessionError\u003e\n  - pause(beadId): Effect\u003cvoid, SessionError\u003e // Ctrl+C, WIP commit\n  - resume(beadId): Effect\u003cvoid, SessionError\u003e\n  - getState(beadId): Effect\u003cSessionState, SessionError\u003e\n  - listActive(): Effect\u003cSession[], never\u003e\n- Use Effect.gen for orchestration flow\n- Use PubSub for state change events\n- Track sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- Create SessionManagerLive layer that composes dependencies","notes":"Implemented SessionManager service in src/core/SessionManager.ts following Effect service pattern.\n\nKey implementation details:\n- Service interface with 7 methods: start, stop, pause, resume, getState, listActive, updateState, subscribeToStateChanges\n- Uses Effect.gen pattern for orchestration\n- Composes WorktreeManager, TmuxService, BeadsClient, and StateDetector services\n- Tracks sessions in Ref\u003cHashMap\u003cBeadId, Session\u003e\u003e\n- PubSub for state change events\n- SessionManagerLive layer with all dependencies included\n- All methods require CommandExecutor in context (provided by BunContext layer)\n- Type-safe error handling with typed error unions\n- Comprehensive JSDoc documentation\n\nThe start() method creates worktree, spawns tmux session, and launches Claude.\nThe pause() method sends Ctrl+C and creates WIP commit.\nThe stop() method kills tmux session.\n\nAll types pass strict TypeScript checking (pnpm type-check).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:44:44.82144+11:00","updated_at":"2025-12-12T10:32:34.049829+11:00","closed_at":"2025-12-12T10:32:34.049829+11:00","dependencies":[{"issue_id":"az-xi5","depends_on_id":"az-d8z","type":"parent-child","created_at":"2025-12-11T14:46:08.3385+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-om3","type":"blocks","created_at":"2025-12-11T14:46:26.452316+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-kis","type":"blocks","created_at":"2025-12-11T14:46:26.845057+11:00","created_by":"daemon"},{"issue_id":"az-xi5","depends_on_id":"az-a8i","type":"blocks","created_at":"2025-12-11T14:46:27.560945+11:00","created_by":"daemon"}]}
{"id":"az-xmj","title":"something is wrong with create task with claude STILL","description":"redesign the feature from the ground up cause we have tried to fix it 3 times already","notes":"Starting redesign with \"Direct bd create\" approach: Claude extracts structured data (title/type/priority) from natural language, then we call bd create directly. No more Claude CLI tool execution.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:05.459264+11:00","updated_at":"2025-12-18T02:14:02.602606+11:00","closed_at":"2025-12-17T17:23:32.780765+11:00","close_reason":"Redesigned \"Create Task with Claude\" feature using two-phase approach: (1) Claude extracts structured JSON data from natural language, (2) BeadsClient.create() is called directly. This eliminates the unreliable CLI tool execution and output parsing.","deleted_at":"2025-12-18T02:14:02.602606+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"az-xoz","title":"fix action mode delete bead keybind","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T01:25:22.242622+11:00","updated_at":"2025-12-15T01:37:29.061321+11:00","closed_at":"2025-12-15T01:37:29.061321+11:00"}
{"id":"az-xw8","title":"Generate hooks config when spawning sessions","description":"SessionManager generates .claude/hooks.json in worktree when spawning sessions. Hooks auto-sync beads on Stop event and update issue notes. Pure bash-based automation without MCP overhead.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-12T13:25:00.000819+11:00","updated_at":"2025-12-12T13:25:20.656259+11:00","dependencies":[{"issue_id":"az-xw8","depends_on_id":"az-aiu","type":"blocks","created_at":"2025-12-12T13:25:32.748995+11:00","created_by":"daemon"}]}
{"id":"az-y6n","title":"up arrow in compact view moves a whole page up not a single task up","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:08:27.533042+11:00","updated_at":"2025-12-17T10:27:38.776467+11:00","closed_at":"2025-12-17T10:27:38.776471+11:00"}
{"id":"az-yf4","title":"PRWorkflow - automated GitHub PR creation","description":"Automate PR creation when tasks complete using gh CLI.\n\nDesign:\n- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, WorktreeManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n\nMethods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n  - cleanup(beadId): Effect\u003cvoid, GitError\u003e -- NEW\n\nWorkflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n\nPR body template includes bead description, acceptance criteria.\nLink PR back to bead via bd update --notes.\nUse Effect.retry with Schedule for transient failures.\n\n**Cleanup after merge:**\n  1. Ensure session is stopped\n  2. WorktreeManager.remove() - delete worktree directory\n  3. git push origin --delete \u003cbranch\u003e - delete remote branch\n  4. git branch -D \u003cbranch\u003e - delete local branch\n  5. bd close \u003cbeadId\u003e - mark task complete\n\nThis cleanup function will also be exposed for manual use (az-6t6).","design":"- Define PRWorkflow as Effect.Service\n- Depends on: SessionManager, BeadsClient, Config\n- Use @effect/platform Command for git and gh CLI operations\n- Methods:\n  - createPR(beadId): Effect\u003cPR, PRError | GitError\u003e\n  - getPR(beadId): Effect\u003cPR | null, PRError\u003e\n  - mergePR(prNumber): Effect\u003cvoid, PRError\u003e\n- Workflow on \"done\" state:\n  1. bd sync (via BeadsClient)\n  2. git add -A \u0026\u0026 git commit\n  3. git push -u origin \u003cbranch\u003e\n  4. gh pr create --draft --title \"...\" --body \"...\"\n- PR body template includes bead description, acceptance criteria\n- Link PR back to bead via bd update --notes\n- Use Effect.retry with Schedule for transient failures","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T14:45:24.509773+11:00","updated_at":"2025-12-12T12:30:29.541722+11:00","closed_at":"2025-12-12T12:30:29.541722+11:00","dependencies":[{"issue_id":"az-yf4","depends_on_id":"az-zv6","type":"parent-child","created_at":"2025-12-11T14:46:09.444969+11:00","created_by":"daemon"},{"issue_id":"az-yf4","depends_on_id":"az-xi5","type":"blocks","created_at":"2025-12-11T14:46:28.29207+11:00","created_by":"daemon"}]}
{"id":"az-z4n","title":"Improve error messages with actionable guidance","description":"Current errors may be cryptic. Enhance error handling:\n\n**Error categories:**\n- Git errors ‚Üí Suggest git commands to fix (merge conflicts, dirty worktree)\n- Beads errors ‚Üí Guide to bd commands or sync issues\n- Tmux errors ‚Üí Check tmux installation, session conflicts\n- PR errors ‚Üí GitHub auth issues, branch protection rules\n\n**Implementation:**\n- Create ErrorFormatter service\n- Map error types to user-friendly messages\n- Include \"Try:\" suggestions with specific commands\n- Show in Toast with longer duration for errors\n- Option to copy error details to clipboard","notes":"Implementation complete:\\n\\n**Created ErrorFormatter service (src/services/ErrorFormatter.ts):**\\n- Registry of 30+ error formatters for all tagged error types\\n- Pattern matching within formatters for sub-cases (merge conflicts, auth issues, network errors)\\n- User-friendly messages with actionable \\\"Try:\\\" suggestions\\n- Exports: format(), formatForToast(), logFormatted(), ErrorFormatter service\\n\\n**Updated KeyboardService:**\\n- showErrorToast() now uses formatForToast() for rich error messages\\n- Merge error handling uses formatForToast()\\n\\n**Updated atoms.ts:**\\n- Task creation error uses formatForToast()\\n\\n**Updated Toast component:**\\n- Multi-line message support (for error + suggestion)\\n- Error toasts now last 8 seconds (vs 5 for info/success)\\n- Wider max width (70 chars) to accommodate suggestions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:59:45.712759+11:00","updated_at":"2025-12-18T02:14:02.604498+11:00","closed_at":"2025-12-17T16:28:45.033741+11:00","deleted_at":"2025-12-18T02:14:02.604498+11:00","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"feature"}
{"id":"az-z5n","title":"i feel like any beads that have a tmux session should be in progress","description":"currently you can have tmux sessions running on open/closed beads","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:35:21.548241+11:00","updated_at":"2025-12-16T22:04:52.421753+11:00","closed_at":"2025-12-16T22:04:52.421753+11:00"}
{"id":"az-zby","title":"bd sync incorrectly tombstones issues that exist in JSONL","description":"When running `bd sync`, issues that exist in both the JSONL (from git) and the local database are incorrectly tombstoned instead of being reconciled.\n\n**Symptoms:**\n- After `bd sync`, issues disappear from the TUI/CLI\n- Database shows issues as `status='tombstone'` \n- JSONL file still contains the issues with valid status (open/closed)\n- No entries in deletions.jsonl for these tombstoned issues\n\n**Root cause hypothesis:**\nThe sync merge logic treats \"issue in JSONL but state differs from DB\" as \"deleted\" rather than \"updated from another branch\". This particularly affects issues merged from worktree branches.\n\n**Workaround:**\nManual SQL recovery to restore status from JSONL:\n```sql\nUPDATE issues SET status='\u003cjsonl_status\u003e', closed_at='\u003cjsonl_closed_at\u003e' WHERE id='\u003cid\u003e';\n```\n\n**Affected:** 21 issues in one incident (2025-12-18)","notes":"**Additional finding (2025-12-18):**\n\n`bd sync --import-only` does NOT recover tombstoned issues. It says \"8 skipped\" for issues that are tombstoned in the database but have valid status in JSONL.\n\nThe import logic appears to skip any issue that already exists in the DB, regardless of whether it's tombstoned. It should compare the JSONL status against DB status and update if JSONL has a non-tombstone status.\n\n**Affected code path:**\n- Azedarach's PRWorkflow.ts:724 calls `syncImportOnly` after git merge\n- This call is silently failing to recover tombstoned issues\n- The `Effect.catchAll(() =\u003e Effect.void)` means failures are swallowed\n\n**The fix should be in beads' import logic** - when importing from JSONL:\n1. If JSONL status is valid (not tombstone) AND DB status is tombstone\n2. Update DB to match JSONL status (un-tombstone the issue)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T02:12:15.839482+11:00","updated_at":"2025-12-18T02:16:18.616471+11:00","labels":["beads-upstream","data-loss"]}
{"id":"az-zqi","title":"Full bead editor (Space+e)","description":"Open selected bead in $EDITOR with structured markdown format. Parse on save, validate structure, discard if invalid, update via bd CLI if valid.","design":"Format:\n```markdown\n# {id}: {title}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nType:     {type}        (read-only)\nPriority: {P0-P4}\nStatus:   {status}\nAssignee: {assignee}\nLabels:   {comma-separated}\nEstimate: {minutes}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Description\n\n{description}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Design\n\n{design}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Notes\n\n{notes}\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n## Acceptance Criteria\n\n{acceptance}\n```\n\nValidation:\n- Header must match `# {id}: {title}`\n- Separator lines: 20+ ‚îÄ chars\n- Priority: P0-P4\n- Status: open|in_progress|blocked|closed\n- Section headers required\n\nFlow:\n1. Space+e ‚Üí write /tmp/azedarach-{id}.md\n2. Spawn $EDITOR (blocking)\n3. Parse markdown on return\n4. Validate ‚Üí show error toast if invalid\n5. Diff against original ‚Üí bd update changed fields\n6. Refresh tasksAtom","notes":"Type change handling:\nIf user changes Type: field (e.g., task ‚Üí epic), the editor must:\n1. Detect type changed during parse\n2. bd create --type=newType with all other fields ‚Üí get new ID\n3. Copy dependencies: bd dep add new-id (for each dep)\n4. bd delete old-id\n5. Navigate TUI to new bead\n\nThis is necessary because bd update cannot change issue_type after creation.\n\nFormat is Azedarach-owned since bd has no full-bead format - only per-field edit (bd edit --notes) or CLI flags (bd update --notes='...').","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:59:31.596266+11:00","updated_at":"2025-12-12T12:20:24.690791+11:00","closed_at":"2025-12-12T12:20:24.690791+11:00","dependencies":[{"issue_id":"az-zqi","depends_on_id":"az-shv","type":"blocks","created_at":"2025-12-12T10:59:35.281709+11:00","created_by":"daemon"}]}
{"id":"az-zu3","title":"Implement hybrid state detection: native hooks + PTY monitoring","description":"Design and implement a hybrid state detection system that combines Claude Code's native hooks (authoritative state) with PTY output monitoring (supplementary signals).\n\n## Architecture\n- Native hooks (idle_prompt, stop, session_end) provide authoritative state transitions\n- PTY stream provides error pattern detection and \"busy\" feedback\n- State aggregator reconciles signals into final state\n\n## Benefits\n- Authoritative state from hooks\n- Graceful degradation if hooks fail\n- Error detection via PTY patterns\n- Future-proof as Claude adds more hooks\n\n## Depends on\n- az-lsi (native hook integration - provides foundation)","notes":"## Implementation Plan Approved\n\n### Approach\n- Full PTYMonitor service (separate scoped service)\n- Full state detection (busy, error, done using existing StateDetector patterns)\n- Hooks take priority (2s window after hook fires)\n- 500ms polling interval\n\n### Files to Modify\n1. `src/core/TmuxService.ts` - Add `capturePane` method\n2. `src/core/PTYMonitor.ts` - Create new service (~180 lines)\n3. `src/ui/atoms.ts` - Wire PTYMonitor, update session atoms\n4. `src/services/BoardService.ts` - Integrate metrics into loadTasks\n\n### Types Already Exist\n- SessionMetrics, AgentPhase, TaskWithSession in src/ui/types.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T01:04:40.22594+11:00","updated_at":"2025-12-17T16:45:38.912457+11:00","closed_at":"2025-12-17T16:45:38.912457+11:00","close_reason":"Implemented hybrid state detection with PTYMonitor service. Added: TmuxService.capturePane, PTYMonitor service (token extraction, session registration, hook priority, 500ms polling), BoardService integration for metrics, atoms wiring for reactive UI updates. Fixed unrelated CLI import type error.","dependencies":[{"issue_id":"az-zu3","depends_on_id":"az-lsi","type":"blocks","created_at":"2025-12-17T01:04:47.033729+11:00","created_by":"daemon"}]}
{"id":"az-zv6","title":"Automation \u0026 Workflows","description":"Automated workflows: PR creation, state transition hooks, notifications, and beads sync coordination.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T14:44:04.97152+11:00","updated_at":"2025-12-11T14:44:04.97152+11:00"}
