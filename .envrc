# Only use Nix flake if Nix is installed
if command -v nix &> /dev/null; then
  use flake
else
  echo "Nix not found, skipping flake setup"
fi

# Load .env.local if present (personal local overrides)
if [ -f .env.local ]; then
  watch_file .env.local
  dotenv .env.local
  echo "Loaded .env.local"
fi

# Beads: Auto-enable no-daemon mode in git worktrees
# In worktrees, .git is a file pointing to the actual .git location
# In main worktree, .git is a directory
# This enables beads to work across all worktrees without daemon conflicts
if [ -f .git ]; then
  export BEADS_NO_DAEMON=1
  echo "Git worktree detected - enabled BEADS_NO_DAEMON=1"
fi

# Set beads workspace directory for MCP plugin
# This ensures beads MCP tools can find the workspace without manual set_context() calls
export BEADS_WORKING_DIR="$PWD"
